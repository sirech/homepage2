{"componentChunkName":"component---src-templates-blog-post-js","path":"/multiwindow-multi-burn-rate-alerts-in-datadog/","result":{"data":{"site":{"siteMetadata":{"title":"Mario Fernandez","description":"This is the blog from Mario Fernandez, a Software Developer working for ThoughtWorks","author":"Mario Fernandez","url":"https://hceris.com","twitter":"@sirech"}},"post":{"id":"d7579674-922a-5d68-b5bf-28dc6d4185f8","html":"<figure class=\"figure figure--right\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0e24080f9bd079aa94e2391eb3a810ae/61d5f/cover.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.02127659574468%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABg1SrSFjxP//EABwQAAIBBQEAAAAAAAAAAAAAAAACARESEyEiMf/aAAgBAQABBQKFFS4xyJ5Gzqn/xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAwEBPwGH/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPwFvSn//xAAZEAACAwEAAAAAAAAAAAAAAAAAARARMTL/2gAIAQEABj8CjBsSo6P/xAAdEAEAAgICAwAAAAAAAAAAAAABABExQRBhIVGh/9oACAEBAAE/IbXF9Su6TXEHepPkYkwggUvPuf/aAAwDAQACAAMAAAAQ/wA//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERMVH/2gAIAQMBAT8QV0R9P//EABYRAQEBAAAAAAAAAAAAAAAAAABBcf/aAAgBAgEBPxCFl//EAB8QAQACAgEFAQAAAAAAAAAAAAEAESFBsTFRYaHB8P/aAAgBAQABPxBMF2u5/cSxgODa73EVLNYsgmuJ46nn1AZVYswxRwFtB2nyf//Z'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert\" title=\"Alert\" src=\"/static/0e24080f9bd079aa94e2391eb3a810ae/acb04/cover.jpg\" srcset=\"/static/0e24080f9bd079aa94e2391eb3a810ae/bc01b/cover.jpg 188w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/bf173/cover.jpg 375w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/acb04/cover.jpg 750w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/ec605/cover.jpg 1125w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/61d5f/cover.jpg 1162w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <figcaption class=\"figure__caption\">\n  Multiwindow indeed\n  </figcaption>\n</figure>\n<p>I used to pay little attention to automated alerts before. Until I started to be On-Call regularly, that is. Such a powerful motivator! Few things sharpen your thoughts regarding Type I and Type II errors more than waking up at three in the morning due to a misconfigured alert.</p>\n<p>Since then, I’ve <a href=\"../monitoring-alerts-that-dont-suck/\">written</a> and <a href=\"https://github.com/sirech/talks/blob/master/2021-11-devoxx-humane_on_call_alerting_doesnt_have_to_be_painful.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">spoken</a> about alerting. You’d think there’s only so much so can say about the matter. Nothing further from the truth. It turns out it’s a riveting topic.</p>\n<p>My newest obsession is multiwindow, multi-burn rate alerts. I’ve spent a lot of time trying to tune alerts to make my rotations less miserable when the answer was in front of me all along. Check out this post if you want to see how to provision them in DataDog, using Terraform.</p>\n<h2>Multi Burn Rate Multiwindow</h2>\n<p><em>That’s a lot of multis in one sentence</em>. But hear me out. I recommend starting with <a href=\"https://sre.google/workbook/alerting-on-slos/\" target=\"_blank\" rel=\"noopener noreferrer\">Chapter five</a> of the SRE handbook to get a comprehensive overview. As far as I know, that’s the first place that mentions it.</p>\n<p>You’ll likely read it the first time and stare at it blankly. It happened to me, at least. It’s something to digest slowly, or it won’t make much sense. Go ahead, I don’t mind waiting.</p>\n<figure class=\"figure\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a77765a19d83b9907757fb106daef314/45662/multi-window.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAC4jAAAuIwF4pT92AAABhklEQVQoz2VRS4+bQBjj//+W3qtq1TbqntJNpDRtsiUJJMAAM8ybeX0MEKrdatvDWpYlS/bFTpZl0VozRgFiCBFgjHkBqA0whhD/EiBqOwjtpdSMSecAYJymOVne4D0wZgjt8eeVetpx5Tg3QhjOjRI2J+K5aNLn7HA4Xa+oaViMU2Kt7fueMWqMJ9SuM7R7+Jo97XQ/cOmF9Fx6qaGp6S0v97/O+/3vzebH4XCepntCKQ0hLMsyhFhT/RPh5mF1fFyxrhOYCEw4JoIQgrq2qG+nFJX4eqvblo/jnAghQgjW9pz5rLD7Y5Z++Lj99JjnuLrg8kKqDBdnXGW4yrsqI1Vaosqi2jk3JTHG+/0+jjH4SKjMLsf6yzpdb2kPWoHUIP+pAtVHQSivkVQQ4/gy2DzP3jvnho7IrizQt83p+5ZII7kV3Aj+shlnryoc6wRDiAsfh7eyczaEADAYrZ3qjdbGOmudlMq5oHVvX61z3nuvpAxhUEr/v+o9jDEYY0JI27YA4X3gDwEp9aczyk7vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Multi-Window\" title=\"Multi-Window\" src=\"/static/a77765a19d83b9907757fb106daef314/1d69c/multi-window.png\" srcset=\"/static/a77765a19d83b9907757fb106daef314/4dcb9/multi-window.png 188w,\n/static/a77765a19d83b9907757fb106daef314/5ff7e/multi-window.png 375w,\n/static/a77765a19d83b9907757fb106daef314/1d69c/multi-window.png 750w,\n/static/a77765a19d83b9907757fb106daef314/78797/multi-window.png 1125w,\n/static/a77765a19d83b9907757fb106daef314/45662/multi-window.png 1410w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  <figcaption class=\"figure__caption\">\n  Credit to: https://sre.google/workbook/alerting-on-slos/\n  </figcaption>\n</figure>\n<p>Here’s the TLDR: Having a burn rate measures how quickly you’re exhausting your <a href=\"https://www.atlassian.com/incident-management/kpis/error-budget\" target=\"_blank\" rel=\"noopener noreferrer\">error budget</a>. Two extra thoughts:</p>\n<ul>\n<li>Think in terms of error budgets. How many errors are acceptable? Don’t trigger alerts if the budget isn’t at risk.</li>\n<li>Using multiple burn rates makes alerts easier to tune. If a metric needs to track big spikes and sustained increases, it’ll likely have to overcompensate for one or the other.</li>\n</ul>\n<p>That being said, this article isn’t about theory. I want to get into the <em>how</em>. I’m focusing on <a href=\"https://www.datadoghq.com/\" target=\"_blank\" rel=\"noopener noreferrer\">DataDog</a> because it’s the monitoring system I’ve used the most lately.</p>\n<h2>The Initial Attempt</h2>\n<p>After reading about burn rates, I tried to implement them in DataDog. Surprisingly, it didn’t seem possible when I started looking. I only found this talk from <a href=\"https://www.youtube.com/watch?v=iAKksNmAZDw\" target=\"_blank\" rel=\"noopener noreferrer\">DevOps Austin</a> to send me down the right path.</p>\n<p>You <em>can</em> in fact simulate burn rates in DataDog. There’s a catch, though. DataDog doesn’t have an equivalent to the <a href=\"https://prometheus.io/docs/prometheus/latest/querying/functions/#rate\" target=\"_blank\" rel=\"noopener noreferrer\">rate</a> function in Prometheus. You don’t have a reliable way of assessing a metric within a specific time frame.</p>\n<p>The <code class=\"language-text\">rollup</code> <a href=\"https://docs.datadoghq.com/dashboards/functions/rollup/\" target=\"_blank\" rel=\"noopener noreferrer\">function</a> is the closest alternative. Sadly, it’s fundamentally flawed. It evaluates once per window. Let’s say you use a burn rate with a thirty-minute window. With a <code class=\"language-text\">rollup</code>, the metric fails after the full window’s end. That, of course, won’t cut it if you have a critical issue ongoing. What a bummer.</p>\n<h2>Finally, Native Support!</h2>\n<p>I had given in to despair when I got the great news: There’s now built-in native support for burn rates. They’re <a href=\"https://docs.datadoghq.com/monitors/service_level_objectives/burn_rate/\" target=\"_blank\" rel=\"noopener noreferrer\">in beta</a>, but completely usable. And best of all, it’s available through the API.</p>\n<p>I repeat it a lot, and I’m still not tired of saying it: Provision infrastructure with code. Alerting is infrastructure. If we click our way through the UI, whatever we conjure won’t be repeatable. So let’s get down to the code. I’m using my trusty tool <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform</a>. Any recent version of the <a href=\"https://www.terraform.io/\" target=\"_blank\" rel=\"noopener noreferrer\">provider</a> will do the trick.</p>\n<p>Let’s talk about the code that we need to build these alerts, bit by bit.</p>\n<h3>SLO</h3>\n<p>The whole thing starts by defining an <a href=\"https://docs.datadoghq.com/monitors/service_level_objectives/\" target=\"_blank\" rel=\"noopener noreferrer\">SLO</a>. You can use it in dashboards, but the good stuff comes when we combine the SLO with alerts associated with it.</p>\n<p>This block is parametrized so that we can use it as part of a generic module:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"datadog_service_level_objective\"</span></span> <span class=\"token string\">\"slo\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">count</span> <span class=\"token punctuation\">=</span> try(var.enabled, <span class=\"token boolean\">false</span>) <span class=\"token punctuation\">=</span><span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span> ? <span class=\"token number\">1</span> : <span class=\"token number\">0</span>\n\n  <span class=\"token property\">name</span>        <span class=\"token punctuation\">=</span> var.name\n  <span class=\"token property\">type</span>        <span class=\"token punctuation\">=</span> var.type\n  <span class=\"token property\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"\"</span>\n\n  <span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">numerator</span>   <span class=\"token punctuation\">=</span> var.numerator\n    <span class=\"token property\">denominator</span> <span class=\"token punctuation\">=</span> var.denominator\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">thresholds</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">timeframe</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"30d\"</span>\n    <span class=\"token property\">target</span>    <span class=\"token punctuation\">=</span> var.target\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token property\">tags</span> <span class=\"token punctuation\">=</span> var.tags\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s instantiate one! We’re leveraging the standard <a href=\"https://docs.datadoghq.com/tracing/guide/metrics_namespace/\" target=\"_blank\" rel=\"noopener noreferrer\">Trace Application Metrics</a> for <a href=\"https://docs.datadoghq.com/tracing/setup_overview/setup/java?tab=containers\" target=\"_blank\" rel=\"noopener noreferrer\">Java</a> here. If you instrument your application code with the <a href=\"https://github.com/DataDog/dd-agent\" target=\"_blank\" rel=\"noopener noreferrer\">dd agent</a> you’ll have them. The most relevant parts in the next snippet are the <code class=\"language-text\">numerator</code> and <code class=\"language-text\">denominator</code>, which form the evaluation metric for the SLO:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">module<span class=\"token type variable\"> \"error_rate_slo\" </span></span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">source</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"../../slo\"</span>\n  <span class=\"token property\">enabled</span> <span class=\"token punctuation\">=</span> var.enabled\n\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">service_name</span><span class=\"token punctuation\">}</span></span> <span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">environment</span><span class=\"token punctuation\">}</span></span> / P<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">priority_tier</span><span class=\"token punctuation\">}</span></span> - Error Rate SLO [<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">slo</span><span class=\"token punctuation\">}</span></span>%]\"</span>\n\n  <span class=\"token property\">numerator</span> <span class=\"token punctuation\">=</span> <span class=\"token heredoc string\">&lt;&lt;-EOT\nsum:trace.servlet.request.hits{env:${var.environment},service:${var.service_name}}.as_count()\n-\nsum:trace.servlet.request.errors{env:${var.environment},service:${var.service_name}}.as_count()\nEOT</span>\n\n  <span class=\"token property\">denominator</span> <span class=\"token punctuation\">=</span> <span class=\"token heredoc string\">&lt;&lt;-EOT\nsum:trace.servlet.request.hits{env:${var.environment},service:${var.service_name}}.as_count()\nEOT</span>\n\n  <span class=\"token property\">target</span> <span class=\"token punctuation\">=</span> var.slo\n  <span class=\"token property\">tags</span>   <span class=\"token punctuation\">=</span> concat(<span class=\"token punctuation\">[</span><span class=\"token string\">\"env:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">environment</span><span class=\"token punctuation\">}</span></span>\"</span>, <span class=\"token string\">\"service:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">service_name</span><span class=\"token punctuation\">}</span></span>\"</span><span class=\"token punctuation\">]</span>, var.tags)\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>SLO’s express a ratio of positive events. Our metrics gather total hits and errors, so we’ve got to invert the metric. It looks like this:</p>\n<p><code class=\"language-text\">(hits - errors) / hits</code></p>\n<p><code class=\"language-text\">slo</code> is the target percentage. For instance, it can be <code class=\"language-text\">99.9</code>. Have a look <a href=\"https://en.wikipedia.org/wiki/High_availability\" target=\"_blank\" rel=\"noopener noreferrer\">here</a> to get an idea of the meaning of the number of nines.</p>\n<p>A side note: don’t forget to use <code class=\"language-text\">as_count</code>. The way it computes an aggregation of events is <a href=\"https://docs.datadoghq.com/monitors/guide/as-count-in-monitor-evaluations/\" target=\"_blank\" rel=\"noopener noreferrer\">more intuitive</a>.</p>\n<h3>Burn Rate</h3>\n<p>SLOs have been part of DataDog for some time. Attaching a <a href=\"https://docs.datadoghq.com/monitors/\" target=\"_blank\" rel=\"noopener noreferrer\">DataDog monitor</a> to it is the new part. We’re about to do just that:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">resource <span class=\"token type variable\">\"datadog_monitor\"</span></span> <span class=\"token string\">\"slow_burn_rate\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">service_name</span><span class=\"token punctuation\">}</span></span> <span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">environment</span><span class=\"token punctuation\">}</span></span> - Error Rate SLO [<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">slo</span><span class=\"token punctuation\">}</span></span>, <span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">local</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">slow_burn_rate</span><span class=\"token punctuation\">}</span></span>x]\"</span>\n\n  <span class=\"token property\">type</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"slo alert\"</span>\n\n  <span class=\"token property\">query</span> <span class=\"token punctuation\">=</span> <span class=\"token heredoc string\">&lt;&lt;-EOT\nburn_rate(\"${module.error_rate_slo.id}\").over(\"${local.slow_time_window}\").long_window(\"${local.slow_window_long}\").short_window(\"${local.slow_window_short}\") > ${local.slow_burn_rate}\nEOT</span>\n\n  <span class=\"token property\">message</span> <span class=\"token punctuation\">=</span> templatefile(<span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">path</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">module</span><span class=\"token punctuation\">}</span></span>/message.md\"</span>, <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">service</span>     <span class=\"token punctuation\">=</span> var.service_name\n    <span class=\"token property\">environment</span> <span class=\"token punctuation\">=</span> var.environment\n    <span class=\"token property\">notify</span>      <span class=\"token punctuation\">=</span> local.notify\n  <span class=\"token punctuation\">}</span>)\n\n  <span class=\"token property\">tags</span> <span class=\"token punctuation\">=</span> concat(<span class=\"token punctuation\">[</span><span class=\"token string\">\"env:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">environment</span><span class=\"token punctuation\">}</span></span>\"</span>, <span class=\"token string\">\"service:<span class=\"token interpolation\"><span class=\"token punctuation\">$</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">var</span><span class=\"token punctuation\">.</span><span class=\"token type variable\">service_name</span><span class=\"token punctuation\">}</span></span>\"</span><span class=\"token punctuation\">]</span>, var.tags)\n\n  <span class=\"token property\">priority</span> <span class=\"token punctuation\">=</span> var.priority_tier\n\n  <span class=\"token property\">monitor_thresholds</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">critical</span> <span class=\"token punctuation\">=</span> local.slow_burn_rate\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Focus on the <code class=\"language-text\">query</code>. We have the following elements:</p>\n<ul>\n<li>The id of the SLO created above</li>\n<li>The evaluation time frame (30 days)</li>\n<li>The long window’s length</li>\n<li>The short window’s length</li>\n<li>The burn rate</li>\n</ul>\n<p>We have two burn rates, a quick and a slow one. We’re following <a href=\"https://sre.google/workbook/alerting-on-slos/#recommended_parameters_for_an_slo_based_a\" target=\"_blank\" rel=\"noopener noreferrer\">SRE’s advice</a> for the parameters here:</p>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">locals</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">quick_window_long</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"1h\"</span>\n  <span class=\"token property\">quick_window_short</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"5m\"</span>\n  <span class=\"token property\">quick_burn_rate</span>    <span class=\"token punctuation\">=</span> <span class=\"token number\">14.4</span>\n  <span class=\"token property\">quick_time_window</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"30d\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"hcl\"><pre class=\"language-hcl\"><code class=\"language-hcl\"><span class=\"token keyword\">locals</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">slow_window_long</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"6h\"</span>\n  <span class=\"token property\">slow_window_short</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"30m\"</span>\n  <span class=\"token property\">slow_burn_rate</span>    <span class=\"token punctuation\">=</span> <span class=\"token number\">6</span>\n  <span class=\"token property\">slow_time_window</span>  <span class=\"token punctuation\">=</span> <span class=\"token string\">\"30d\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that we don’t need to adjust the burn rate based on the error rate. DataDog does that for us.</p>\n<p>And that’s about it. If you provision this code, you’ll see an SLO like this one:</p>\n<figure class=\"figure\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8be6dc2ee2eae09b4d98f0c5301901de/89557/slo.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 84.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACR0lEQVQ4y6VUXW/TMBTN/3/nDYSQQNteJrEXhNjWraV0QvAyGFMHWxsnbT7aJE78Ecf5OMjuNraqBYlZOorvtXXu9bFPHEopwjBEHMdI0hRRtEQYLRBEEaqqghld121F23Zomw5CCAgp4aSFxJW/hBdT1E0NwRRq1RkatG27EY8I6w6KNygYA+cCDhMSlElIpVFVGnVdo9KVrbxtPCQ0hR8OJ88LSCmRZhmSJEWSZlguE6RpZucmn1Fq4yyjNmekWIdSCmVZwjGs5hizeQDi+SC+jykhcImHiUswJR6m5usSu25yprBpwuhmvndzS2iENBUYF8hzBsY4GBNQqoLWeiPMfiPNOpqmgXO3KGWJQipwpSGk+quGKyHXcKutQ/MCQkiboMRHeP7drPzzuWyD43o+Li7HEGUJHi2gaP7fZJaQsQKcc3sxT+nsnnCeFHAj+mSie8JSaSzSHDljaNrmjwO61mI9vsttii2hOWpT10D72Anrrlh3yrbYMVdeKI5rPsUFHaPQzOp5nv3AXEb2SZjq4+IaP4sbeGJuCSac4Bu9xDWb2j1RuYBu65VTSDHDa3cfz369wnD5BUXN8Hyygx3yFsfxEAuVYNc7wBt3H3veAXLN8C7o4eV0Dy8mu4jUAqfxCFfsZtVhQEP0w0/4QI7Qnw1xFn/FITnGiddHbz5ALxjiZDbAIBjhiPTQD0YYhZ9t7j05xGl4ht78IwjzVx1KrVCmGbQs7XHKShmDW3Rth1IpdLe/LZNTlULbNEYLi0prazvT3G+JWB8as9SSZAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"SLO\" title=\"SLO\" src=\"/static/8be6dc2ee2eae09b4d98f0c5301901de/1d69c/slo.png\" srcset=\"/static/8be6dc2ee2eae09b4d98f0c5301901de/4dcb9/slo.png 188w,\n/static/8be6dc2ee2eae09b4d98f0c5301901de/5ff7e/slo.png 375w,\n/static/8be6dc2ee2eae09b4d98f0c5301901de/1d69c/slo.png 750w,\n/static/8be6dc2ee2eae09b4d98f0c5301901de/78797/slo.png 1125w,\n/static/8be6dc2ee2eae09b4d98f0c5301901de/aa440/slo.png 1500w,\n/static/8be6dc2ee2eae09b4d98f0c5301901de/89557/slo.png 1928w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</figure>\n<p>The SLO has two alerts attached to it, for our two burn rates. Unlike with <code class=\"language-text\">rollup</code>, they don’t need a full evaluation window to trigger. Exactly what we need!</p>\n<figure class=\"figure\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e6894c1eb4aec2158d84c0ec42b25cec/29114/alert-slo.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.191489361702125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8ElEQVQY032Rz07EIBCH+/6P4M2X8OLJg76AidF4MHF1220p0G0pUP58BjbZxLjuJBMG5jffMND0g0CMEqk0UkoGIfhuO+ZloVhKiZzzv17yIWXM6rDO0xRQKV6d4+2jR0rHtnlCiOeCa0BC6ZrBLyRvaabpyLIYVuuYzEYI/LHLN8s1d9Ce26eWm4cdj++KZt8dMGblc/eF1poYA10/cJxnpFI1jjEW6kWgNhv3L5K755HX1tAoM1XBIEaU0jUWYsRah5CSfdthnTuPX0DFczrtIf+aprHhJF6txTlfDwusiMta39faK5+SiTERYqo1P2U50rFpIRr4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Alert SLO\" title=\"Alert SLO\" src=\"/static/e6894c1eb4aec2158d84c0ec42b25cec/1d69c/alert-slo.png\" srcset=\"/static/e6894c1eb4aec2158d84c0ec42b25cec/4dcb9/alert-slo.png 188w,\n/static/e6894c1eb4aec2158d84c0ec42b25cec/5ff7e/alert-slo.png 375w,\n/static/e6894c1eb4aec2158d84c0ec42b25cec/1d69c/alert-slo.png 750w,\n/static/e6894c1eb4aec2158d84c0ec42b25cec/78797/alert-slo.png 1125w,\n/static/e6894c1eb4aec2158d84c0ec42b25cec/aa440/alert-slo.png 1500w,\n/static/e6894c1eb4aec2158d84c0ec42b25cec/29114/alert-slo.png 1920w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n  </figure>\n<h2>An Alert That you Can Trust</h2>\n<p>Is all the hassle worth it? You bet it is. Since I’ve replaced our existing alerts with multiwindow, multi-burn rate alerts, I’ve spent close to zero time babysitting them. That’s a welcome change, compared to some of my previous attempts. It comes down to the yin and yang of alerting, false positives, and false negatives.</p>\n<h3>False Positives</h3>\n<p>Having two (or more) windows is a good layer of defense against over-eager triggers. False positives are technically not a bad thing for the business side. I do focus on them a lot because they, in my experience, inevitably lead to slopiness. If you get bombarded with alerts, you’ll start taking them less seriously. Also, I firmly believe that developers willing to spend their time outside of work on-call deserve a decent setup.</p>\n<h3>False Negatives</h3>\n<p>The quick burn rate triggers fairly quickly in case of errors. Don’t worry, you won’t miss anything, especially if you have a tight SLO.</p>\n<p>Moreover, the slow burn rate covers a scenario that often falls through the cracks. A slight increase in errors that persists for a longer period. Good luck tuning a regular alert to account for this without waking you up constantly. Luckily, if you follow this article you won’t have to do that. Listen to somebody that has spent a good chunk of time on-call, get those burn rates online!</p>","frontmatter":{"layout":"post","title":"Multiwindow, Multi-Burn-Rate Alerts in DataDog","path":"/multiwindow-multi-burn-rate-alerts-in-datadog/","categories":["Monitoring","Alerts","Terraform","DataDog","On-Call"],"date":"2022/01/03","draft":false,"description":"Multiwindow, multi-burn-rate alerts are the hottest way of building reliable alerts. Let's configure some in DataDog using Terraform","canonical":null,"image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#282858","images":{"fallback":{"src":"/static/0e24080f9bd079aa94e2391eb3a810ae/05435/cover.jpg","srcSet":"/static/0e24080f9bd079aa94e2391eb3a810ae/e47a7/cover.jpg 188w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/7947d/cover.jpg 375w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/05435/cover.jpg 750w","sizes":"(min-width: 750px) 750px, 100vw"},"sources":[{"srcSet":"/static/0e24080f9bd079aa94e2391eb3a810ae/31395/cover.webp 188w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/9bc7c/cover.webp 375w,\n/static/0e24080f9bd079aa94e2391eb3a810ae/15f20/cover.webp 750w","type":"image/webp","sizes":"(min-width: 750px) 750px, 100vw"}]},"width":750,"height":502}}}}},"related":{"nodes":[{"frontmatter":{"title":"Book Review: Prometheus up and running","path":"/book-review-prometheus-up-and-running/","date":"2021/01/08"}},{"frontmatter":{"title":"Monitoring Alerts That Don't Suck","path":"/monitoring-alerts-that-dont-suck/","date":"2021/07/02"}},{"frontmatter":{"title":"Synthetic Transactions and Monitoring in Testing","path":"/synthetic-transactions/","date":"2021/09/26"}}]},"previous":{"frontmatter":{"title":"Synthetic Monitoring: A Detailed Introductory Guide","path":"/synthetic-monitoring-a-detailed-introductory-guide/","date":"2021/12/06"}},"next":{"frontmatter":{"title":"The System Design Interview","path":"/the-system-design-interview/","date":"2022/08/08"}}},"pageContext":{"related":["/monitoring-alerts-that-dont-suck/","/synthetic-transactions/","/book-review-prometheus-up-and-running/"],"previous":"/synthetic-monitoring-a-detailed-introductory-guide/","next":"/the-system-design-interview/"}},"staticQueryHashes":[]}