{"componentChunkName":"component---src-templates-blog-post-js","path":"/setting-up-traefik/","result":{"data":{"site":{"siteMetadata":{"title":"Mario Fernandez","description":"This is the blog from Mario Fernandez, a Software Developer working for ThoughtWorks","author":"Mario Fernandez","url":"https://hceris.com","twitter":"@sirech"}},"post":{"id":"fad446d4-c263-5335-83f4-e130b040a64d","html":"<p>I have been setting up a new cloud based infrastructure for an application lately. As part of it, we had some requirements regarding load balancing, SSL and so on. As part of that I had the opportunity to evaluate <a href=\"https://traefik.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Traefik</a>. This a pretty cool tool that works as a Reverse Proxy (and more).</p>\n<p>Now, this sounds just like using <a href=\"https://www.nginx.com/\" target=\"_blank\" rel=\"noopener noreferrer\">nginx</a>, right? There is nothing new here. However, <em>Traefik</em> is built with <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker</a> and the Cloud in mind, and it is quite lightweight and worth exploring.</p>\n<!--more-->\n<h2>Putting it together</h2>\n<p>I have set up a <a href=\"https://github.com/sirech/traefik-test\" target=\"_blank\" rel=\"noopener noreferrer\">repository in Github</a> with a simple, practical demonstration. If you are using <a href=\"https://docs.docker.com/compose/\" target=\"_blank\" rel=\"noopener noreferrer\">docker-compose</a> to bind a bunch of containers together, it is basically ready to go!</p>\n<p>With this minimal setup you get:</p>\n<ul>\n<li>Load balancing between different containers</li>\n<li>SSL Termination</li>\n<li>Automated discovery</li>\n<li>Routing</li>\n<li>And even mTLS if you need it</li>\n</ul>\n<p>It really packs a punch with a fairly small configuration effort.</p>\n<h2>Comparing it with nginx</h2>\n<p>If you check the <a href=\"https://github.com/sirech/traefik-test/blob/master/traefik/traefik.toml\" target=\"_blank\" rel=\"noopener noreferrer\">configuration file</a>, you see the basic setup to serve apps. For comparison, here is a config file to serve a static app in <em>nginx</em> over https:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n    listen 80;\n    server_name ${HOST};\n    return 301 https://$host$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n\n    server_name ${HOST} www.${HOST};\n\n    root /srv/main;\n\n    ssl_certificate           /cert/live/${HOST}/fullchain.pem;\n    ssl_certificate_key       /cert/live/${HOST}/privkey.pem;\n    ssl_trusted_certificate   /cert/live/${HOST}/chain.pem;\n\n    location / {\n        rewrite ^([^.\\?]*[^/])$ $1/ permanent;\n        try_files $uri $uri/ $uri/index.html =404;\n\n        gzip_static on;\n        expires off;\n        add_header Cache-Control \"no-store\";\n    }\n\n    location ^~ /static/  {\n        gzip_static on;\n        expires max;\n        add_header Cache-Control public;\n    }\n}</code></pre></div>\n<p>Now something to note is that <em>nginx</em> is a proper webserver while <code class=\"language-text\">traefik</code> is not. So this example actually serves assets. Even then, you can argue that the set up is quite similar, so why not stay with what is already there? There are two features that I really like from <code class=\"language-text\">traefik</code>.</p>\n<h3>The dashboard</h3>\n<p><code class=\"language-text\">traefik</code> gives you a really nice dashboard where you can see the actual connections between your services. Here is a screenshot:</p>\n<figure class=\"figure\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/14e6f619c5778085e8d2df0dfc66073a/2adcb/traefik.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAByUlEQVQoz43Tz2vUQBTA8fxtgoK3njx5Eau9VfDuzb9E8ORNsbAu/SEeCtpWUCv2h9vdWtvuZu0mk5k3yWQmX8lmW13cVR98eElm5vGYRyJlBKUFyR3Oe1w5h/cUZWPeeu5KooGynKU5Yi1GZtMiZMZiJUfG7EzGWKKVQ836py7v9nocxoavw2n1t+ML4fnJkPbuPju97xwkmv1RNmVvlNFJNNHTXc1SW7HYSlh6lbLYSrm9MvEy4daLlEdvFE++DVl432Vh54ib20dc3+pwY7tzla9tdbj78ZgoVsJ5ahmYQFoELmzjh3gG2jXvUhIbIc4L+rknLkqGE/XzidL0bc4wd0T1/SRJijaWWDuaqCaa8N4jtsAW9eXXS9Vv+6Byrt4EIRCJzij1COU8m2fFVKFf4VHWEZvAQHus+3PKpQ/khSP6cKpoHyS0u4aNnmGtzl1hvSts9ITVI+HtiZBoIZ1I/iJ69sXw8LVheTXjwZpieU2Nh3S/rbjXSrjTUjzezJqCxpJoO87zRL7IIeTMjnCVmw4uD8psdYeJ0pz2BwxTw+e4wAfwoWpUjNV/x2WH/xKlmSbLMvpSjocipacKAT8RQoUry/8u+BN85oYrp5MU4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Traefik's Dashboard\" title=\"Traefik's Dashboard\" src=\"/static/14e6f619c5778085e8d2df0dfc66073a/1d69c/traefik.png\" srcset=\"/static/14e6f619c5778085e8d2df0dfc66073a/4dcb9/traefik.png 188w,\n/static/14e6f619c5778085e8d2df0dfc66073a/5ff7e/traefik.png 375w,\n/static/14e6f619c5778085e8d2df0dfc66073a/1d69c/traefik.png 750w,\n/static/14e6f619c5778085e8d2df0dfc66073a/78797/traefik.png 1125w,\n/static/14e6f619c5778085e8d2df0dfc66073a/aa440/traefik.png 1500w,\n/static/14e6f619c5778085e8d2df0dfc66073a/2adcb/traefik.png 1984w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</figure>\n<p>It is a small detail, but I really like having a visual overview of the state of my routes. This can be extremely helpful in the beginning, when you are still setting up services. I always found <em>nginx</em> particularly obscure to debug when I had problems.</p>\n<p>But there is a bigger benefit than that…</p>\n<h3>Discovery</h3>\n<p>If you checked the configuration, you might have noticed that there are no services configured there. This is in my opinion the killer feature of <code class=\"language-text\">traefik</code>. It can connect to the provider that you specify, in this case <a href=\"https://docs.traefik.io/configuration/backends/docker/\" target=\"_blank\" rel=\"noopener noreferrer\">docker</a>, and automatically fetch all the running containers for you, dynamically. Say goodbye to painfully creating a new configuration and adding it to your <em>nginx</em> configuration, plus the required restart afterwards.</p>\n<p>The only need you need to do is adding some configuration every time you spin up a new service, to let <code class=\"language-text\">traefik</code> now how you want it to be reached. It really does not get much easier:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">labels:\n  - \"traefik.backend=echo\"\n  - \"traefik.frontend.entryPoints=https\"\n  - \"traefik.frontend.rule=Host:echo.testing.com;Path:/standard\"</code></pre></div>\n<p>With this simple snippet, we are making <code class=\"language-text\">traefik</code> aware of our new service, and setting up an entrypoint and the routing to reach it. That’s it. You do not need to do anything else. The simplicity is really refreshing. For most cases I feel you will not need much more than this.</p>\n<h2>Pending ideas</h2>\n<p>There are more things to check, actually. <code class=\"language-text\">traefik</code> has a lot of routing posibilities, albeit less comprehensive than other reverse proxies. We have been considering doing some fancy header checks to route to different test systems that share the same url, which I might talk about in more detail when I actually have something more concrete.</p>\n<p>The other feature I am really keen to try out is <a href=\"https://docs.traefik.io/configuration/acme/\" target=\"_blank\" rel=\"noopener noreferrer\">automated certificate configuration</a> through <a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener noreferrer\">LetsEncrypt</a>. <em>LetsEncrypt</em> alone is a life saver, it is extremely convenient to set up https for your domains. I use it for my website already through some custom scripts that call the <a href=\"https://hub.docker.com/r/certbot/certbot/\" target=\"_blank\" rel=\"noopener noreferrer\">certbot docker container</a>. However <code class=\"language-text\">traefik</code> takes this one step further by taking the task out of your hands altogether. I want to jump on this the moment I got a free moment.</p>\n<h2>Where to start?</h2>\n<p>I can only encourage reading <a href=\"https://docs.traefik.io/\" target=\"_blank\" rel=\"noopener noreferrer\">the starter guide</a> first, to get everything running. Then I would read about the <a href=\"https://docs.traefik.io/basics/\" target=\"_blank\" rel=\"noopener noreferrer\">basics</a>, to understand the terminology and how everything is bound together. After that you can really start playing and experimenting. The <a href=\"https://github.com/sirech/traefik-test\" target=\"_blank\" rel=\"noopener noreferrer\">repository</a> I posted can help you bootstrapping a bit the process.</p>","frontmatter":{"layout":"post","title":"Setting up Traefik","path":"/setting-up-traefik/","categories":["Traefik","DevOps","Load Balancing","SSL Termination","mTLS","Smart Routing"],"date":"2018/08/16","draft":false,"description":"Traefik is a cloud native reverse proxy. I want to show how to do load balancing, SSL termination, routing and Mutual TLS with it","canonical":null,"image":null}},"related":{"nodes":[]},"previous":{"frontmatter":{"title":"Angular from the perspective of a React fan - Part 3","path":"/angular-from-react-part3/","date":"2018/07/07"}},"next":{"frontmatter":{"title":"Replacing ESLint with prettier","path":"/replacing-eslint-with-prettier/","date":"2018/08/29"}}},"pageContext":{"related":[],"previous":"/angular-from-react-part3/","next":"/replacing-eslint-with-prettier/"}},"staticQueryHashes":[]}