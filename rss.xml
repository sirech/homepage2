<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Mario Fernandez]]></title><description><![CDATA[This is the blog from Mario Fernandez, a Software Developer working for ThoughtWorks]]></description><link>https://hceris.com</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 15 Apr 2023 15:33:44 GMT</lastBuildDate><atom:link href="https://hceris.com/rss.xml" rel="self" type="application/rss+xml"/><item><title><![CDATA[The Humble Extract Method]]></title><description><![CDATA[The extract method refactoring is a low-cost, high-impact tool to increase maintainability in your code. Let's talk about its benefits]]></description><link>https://hceris.com/the-humble-extract-method/</link><guid isPermaLink="false">https://hceris.com/the-humble-extract-method/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Refactoring]]></category><pubDate>Mon, 27 Feb 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;After reviewing a lot of code in the past couple of months, I’ve realized that I regularly leave comments like this one:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Can we break this down into smaller pieces?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/50ecbbe08d280c18e51685dc01032100/bfe25/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.42553191489361%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABzCiVD//EABYQAAMAAAAAAAAAAAAAAAAAAAEQIP/aAAgBAQABBQKAv//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EAB0QAAICAQUAAAAAAAAAAAAAAAABESFREGFxkaH/2gAIAQEAAT8hjY4RWH3pZwQ8+H//2gAMAwEAAgADAAAAEOsf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERYf/aAAgBAwEBPxCMU//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EFf/xAAcEAEAAwACAwAAAAAAAAAAAAABABEhQVFhcZH/2gAIAQEAAT8QBeuji5WKh9YFNb1GiPcLsrySjKR//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Refactoring&quot; title=&quot;&quot; src=&quot;/static/50ecbbe08d280c18e51685dc01032100/acb04/cover.jpg&quot; srcset=&quot;/static/50ecbbe08d280c18e51685dc01032100/bc01b/cover.jpg 188w,
/static/50ecbbe08d280c18e51685dc01032100/bf173/cover.jpg 375w,
/static/50ecbbe08d280c18e51685dc01032100/acb04/cover.jpg 750w,
/static/50ecbbe08d280c18e51685dc01032100/ec605/cover.jpg 1125w,
/static/50ecbbe08d280c18e51685dc01032100/bfe25/cover.jpg 1422w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Turns out, I like to advocate for shorter methods. Is this the right thing to pay attention to? I think so. I strongly believe that breaking down code is often the most cost-effective way to increase maintainability.&lt;/p&gt;
&lt;p&gt;For that, the best alternative is &lt;em&gt;extracting smaller methods&lt;/em&gt;. It’s easy and works consistently. It should be part of every developer’s toolkit.&lt;/p&gt;
&lt;p&gt;In this article, I’m writing about the simple yet powerful extract method refactoring.&lt;/p&gt;
&lt;h2&gt;What Is Extract Method, Exactly?&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Extract method&lt;/em&gt; is &lt;a href=&quot;https://refactoring.com/catalog/extractFunction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;a refactoring&lt;/a&gt; where you move a code fragment to a separate function with a name that describes its purpose. Consider this snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;splitNumbers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// convert each string to a number&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; numbers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; split&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; numbers
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is too small to truly benefit from breaking it down, so bear with me for the sake of the example. Anyway, there’s a section that converts a string to a number. It’s a prime candidate for extraction:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;splitNumbers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; numbers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertStringToNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; numbers
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertStringToNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There it is! We now have a proper submethod instead of an inline comment. For a more realistic scenario, imagine this was a hundred lines long instead of five. The good thing is, the approach would work the exact same way. Moreover, you can repeat the procedure and break down the new methods.&lt;/p&gt;
&lt;p&gt;All in all, this refactoring is pretty straightforward. In fact, it’s been supported by IDEs like &lt;a href=&quot;https://www.jetbrains.com/help/idea/extract-method.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;IntelliJ&lt;/a&gt; for basically forever. And yet! Despite its simplicity, this humble change brings quite a lot of value. Let’s talk about its benefits.&lt;/p&gt;
&lt;h2&gt;Shorter Methods Improve Readability&lt;/h2&gt;
&lt;p&gt;The most obvious outcome of using &lt;em&gt;Extract Method&lt;/em&gt; is that it makes methods &lt;strong&gt;short&lt;/strong&gt;. Is that a good thing, though?&lt;/p&gt;
&lt;p&gt;Yes! Let me argue why. Shortening methods is necessary to get them to do one thing only (also known as the &lt;a href=&quot;https://en.wikipedia.org/wiki/Single-responsibility_principle&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Single Responsibility Principle&lt;/a&gt;). Methods that do one thing are generally less complex. They require less knowledge about the surrounding context.&lt;/p&gt;
&lt;p&gt;When you navigate a big codebase, you can’t keep every detail in your head. If you have short, single-purpose methods you can tune out some complexity and focus on one part at a time. That, in my mind, leads to a massive readability boost.&lt;/p&gt;
&lt;p&gt;One argument I’ve heard against extracting methods is that it’s easier to understand code if it’s all in the same place. I find the reasoning unsatisfying. In my opinion, it assumes you’ll be able to zoom in and focus on the relevant parts as you read through a possibly massive block. To do that, you need to be pretty familiar with the codebase already. Otherwise, you’re going to struggle.&lt;/p&gt;
&lt;p&gt;In my view, a more sustainable alternative is to rely on abstract methods that hide implementation details. That way, even if your understanding is incomplete you’ll still be effective. Note that this only holds true if the abstractions are &lt;em&gt;good&lt;/em&gt;. If the division doesn’t make any sense, you’ll be without a doubt worse off.&lt;/p&gt;
&lt;p&gt;How short is short enough? That’s a matter of debate and preference. Hear &lt;a href=&quot;https://www.oreilly.com/library/view/clean-code-a/9780136083238/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Uncle Bob&lt;/a&gt; for some guidance:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;My rule is “extract till you drop”.  A function is too big if I can meaningfully extract another function from it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Extracting Methods is an Opportunity for Good Naming&lt;/h2&gt;
&lt;p&gt;Naming is hard. And yet, without good names extracting methods isn’t worth it. Even if the abstraction is good, a bad name makes it inaccessible. Thus, good naming is crucial for readability.&lt;/p&gt;
&lt;p&gt;A name that describes the method’s purpose serves as lightweight documentation. Documentation that’s supported by the language, unlike comments. Automated tooling can find and change methods in a way that’s usually impossible in ad-hoc comments.&lt;/p&gt;
&lt;p&gt;If you’re struggling to find a name for an extracted method, it can be a sign of two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An unclear boundary, and thus a fuzzy responsibility. That makes it hard to find a proper name&lt;/li&gt;
&lt;li&gt;The method is still too big and needs to be split further&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Not Bad, and There Is More&lt;/h2&gt;
&lt;p&gt;The combination of smaller methods and better names reduces cognitive load. Each method serves as a small reusable abstraction. For instance, something as typical as iterating over a list to apply a function to every element:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mutableListOf&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A better alternative is to use a higher-level abstraction, in this case, &lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt; encapsulates the implementation and lets you focus on what you want to express.&lt;/p&gt;
&lt;p&gt;Anyhow. While shorter methods and better names are the big two aspects, other considerations speak for using this refactoring.&lt;/p&gt;
&lt;h3&gt;Nesting Is Another form of Complexity&lt;/h3&gt;
&lt;p&gt;Excessive length isn’t the only way complexity creeps in. Code that’s nested multiple layers deep is as hard to read as an overly long piece of code. It can hide bugs as you inadvertently put things in the wrong scope.&lt;/p&gt;
&lt;p&gt;Luckily, extracting methods reduces nesting the same way that it reduces length.&lt;/p&gt;
&lt;h3&gt;Small Methods Reduce Coupling&lt;/h3&gt;
&lt;p&gt;Dependencies make it harder to reason about code. They make it harder to change as well.&lt;/p&gt;
&lt;p&gt;Suppose you have a massive method. There are plenty of local variables capturing intermediate results. While they provide an opportunity for meaningful names, they lack the encapsulation that methods provide. You have access to everything that happened before within the same scope, which can entangle the logic beyond salvation.&lt;/p&gt;
&lt;p&gt;Not only that, you start getting worried about unexpected changes. You can’t be sure that the variable wasn’t modified unless you painstakingly go through the whole logic. Doubly so in languages that don’t allow read-only variables.&lt;/p&gt;
&lt;h3&gt;What About Testability?&lt;/h3&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 284px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2b283964c3da3e9d74ce30511601be03/2afb1/working-effectively.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAH/xAAXAQADAQAAAAAAAAAAAAAAAAAAAgMB/9oADAMBAAIQAxAAAAGDp2Vc5EohWTC5hDT/xAAdEAEAAgICAwAAAAAAAAAAAAABAAIDERITECEy/9oACAEBAAEFAukJXHqXoj3cpzZbILTellvqp7A8f//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBES/9oACAEDAQE/AXkpT//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBES/9oACAECAQE/AVotz//EAB8QAAIBAgcAAAAAAAAAAAAAAAABIQIQESIxMkGBof/aAAgBAQAGPwLQxUE1ohGx2hUmX046Hf8A/8QAHBAAAgMBAQEBAAAAAAAAAAAAAREAITFRQYHB/9oACAEBAAE/ISIjd9gdfFzQ03Ly8rUJ3+gjnDHAfuy1ITDgn+EAXAeRQ0Nh0z//2gAMAwEAAgADAAAAEEsEjv/EABkRAAIDAQAAAAAAAAAAAAAAAAABEBEhMf/aAAgBAwEBPxC3MKeCcf/EABgRAAIDAAAAAAAAAAAAAAAAAAABEEFR/9oACAECAQE/ELDUacf/xAAdEAEBAAMBAQADAAAAAAAAAAABEQAhQWFRcYGh/9oACAEBAAE/EF1h2SL9xYACRNreR1rIkQERZfwZsQXeM9cTYFAt3k/RiAn3k64HUpVYLeK0EY2EN9MIxDpnhgWqdnmIo23PDP7nP//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Working Effectively with Legacy Code&quot; title=&quot;&quot; src=&quot;/static/2b283964c3da3e9d74ce30511601be03/2afb1/working-effectively.jpg&quot; srcset=&quot;/static/2b283964c3da3e9d74ce30511601be03/bc01b/working-effectively.jpg 188w,
/static/2b283964c3da3e9d74ce30511601be03/2afb1/working-effectively.jpg 284w&quot; sizes=&quot;(max-width: 284px) 100vw, 284px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;And lastly, we come to testability. Does extracting methods improve testability? You could argue it doesn’t, as you should have your tests ready &lt;em&gt;before&lt;/em&gt; you perform the refactoring.&lt;/p&gt;
&lt;p&gt;However! Reality isn’t always so kind. You might face a huge, gnarly class that lacks tests. Writing tests might prove impossible unless you make the problem more manageable.&lt;/p&gt;
&lt;p&gt;As described in the book &lt;a href=&quot;../book-review-working-effectively-with-legacy-code/&quot;&gt;Working Effectively with Legacy Code&lt;/a&gt;, extracting methods allows you to break down smaller pieces. At some point, they become small enough that you can write some tests for them.&lt;/p&gt;
&lt;p&gt;It’s not pretty, but it gets the job done. Much better than the alternative of not really knowing if your changes will break something.&lt;/p&gt;
&lt;h2&gt;Notice I Didn’t Talk about Reuse&lt;/h2&gt;
&lt;p&gt;I haven’t mentioned reusability throughout the article. It is, in fact, not the primary goal of &lt;em&gt;Extract Method&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;A smaller auxiliary method is valuable even if we only use it once. Making code more readable is already a significant benefit, worth doing on its own. If that method encapsulates a reusable abstraction, that’s a welcome benefit. But it’s not something to force or expect.&lt;/p&gt;
&lt;h2&gt;Is Extracting Methods Worth The Effort?&lt;/h2&gt;
&lt;p&gt;In any big codebase, the code developers write lives for a long time. Often, it’s still there while the original developers moved somewhere else.&lt;/p&gt;
&lt;p&gt;Meanwhile, new developers will read it many times and try to figure out what it does. Capturing the context of why a decision happened is hard, so these poor developers are left without context. By investing some effort into making it more readable you’ll make their life easier.&lt;/p&gt;
&lt;p&gt;Not that you should overdo it, though. An endless collection of one-liners isn’t an improvement, either. Aim for methods that stand on their own and have one purpose. That’s a reasonable guideline to follow.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Effective Remote Work]]></title><description><![CDATA[Effective remote work is a book about making remote work successful, both for employees and their company]]></description><link>https://hceris.com/book-review-effective-remote-work/</link><guid isPermaLink="false">https://hceris.com/book-review-effective-remote-work/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Team Organization]]></category><category><![CDATA[Career]]></category><pubDate>Sun, 27 Nov 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/969c0e90551a1c7cb3717ecffe93d726/066f9/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 120.2127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAYABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAZjfKs0EeKgXUbf/xAAbEAADAAMBAQAAAAAAAAAAAAAAAQIREyEDEP/aAAgBAQABBQKll9S6O0P1k3QbGPNfP//EABgRAAIDAAAAAAAAAAAAAAAAAAASARAR/9oACAEDAQE/AUEmtP/EABgRAAMBAQAAAAAAAAAAAAAAAAATYRAR/9oACAECAQE/AWQZM4f/xAAaEAACAgMAAAAAAAAAAAAAAAAAASAxITKR/9oACAEBAAY/AqlS4ZZqf//EABoQAQEAAwEBAAAAAAAAAAAAAAEAESFBUeH/2gAIAQEAAT8hfM5ajUAAs0cEyzbxGdgvlo+r/9oADAMBAAIAAwAAABCrF0D/xAAZEQACAwEAAAAAAAAAAAAAAAAAAREhUWH/2gAIAQMBAT8Qbadh0SP/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QkGCTWH//xAAdEAEAAgIDAQEAAAAAAAAAAAABABEhMUFxgVGR/9oACAEBAAE/EKx1hbcpDlQZjfkPJx36hNAD7uWt31AHpoWJuJ0MDKwqep//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Effective Remote Work&quot; title=&quot;&quot; src=&quot;/static/969c0e90551a1c7cb3717ecffe93d726/066f9/cover.jpg&quot; srcset=&quot;/static/969c0e90551a1c7cb3717ecffe93d726/bc01b/cover.jpg 188w,
/static/969c0e90551a1c7cb3717ecffe93d726/bf173/cover.jpg 375w,
/static/969c0e90551a1c7cb3717ecffe93d726/066f9/cover.jpg 400w&quot; sizes=&quot;(max-width: 400px) 100vw, 400px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://pragprog.com/titles/jsrw/effective-remote-work/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Effective Remote Work&lt;/a&gt; is a book about, well, remote work. The author, James Stanier, works for &lt;a href=&quot;https://shopify.engineering/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Shopify&lt;/a&gt;, a company with a long tradition of working remotely.&lt;/p&gt;
&lt;p&gt;These past few years have been a large-scale experiment in working remotely for most tech companies. However, the way it happened was so abrupt and unprepared that many people had a miserable experience.&lt;/p&gt;
&lt;p&gt;It’s time to correct that! Despite the bumpy start, many companies still offer at least hybrid work. It seems this practice is here to stay. This book is a great resource about making remote work effective, productive, and sustainable. Let’s go over some of the things it mentions.&lt;/p&gt;
&lt;h2&gt;No Second-class Citizens&lt;/h2&gt;
&lt;p&gt;The book advocates treating everybody as a remote worker. I like that goal. You start with basic stuff like ensuring you don’t forget to include remote people in meetings. But it goes beyond that. Are they included in decision-making? Do they have the same career opportunities as people going to the office daily?&lt;/p&gt;
&lt;h2&gt;Proper Onboarding&lt;/h2&gt;
&lt;p&gt;A good onboarding plan is a must whether you work remotely or not. Working remotely magnifies a bad experience. Sitting at home feeling helpless because you don’t know something is frustrating. Remote workers need to be able to unblock themselves, and you need to help them with that.&lt;/p&gt;
&lt;h2&gt;Durable Artifacts&lt;/h2&gt;
&lt;p&gt;This point completely matches my experience in the past three years of working remotely almost full-time. Collaboration around &lt;strong&gt;durable&lt;/strong&gt; artifacts should be at the center of everything you do. If you don’t regularly create easily accessible documents, you’ll repeat the same conversations over and over. Or, even worse, decisions will happen ad-hoc in secret meetings.&lt;/p&gt;
&lt;p&gt;Good technical writing makes written communication better. Go check &lt;a href=&quot;https://developers.google.com/tech-writing/overview&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Google’s courses&lt;/a&gt; for a great resource.&lt;/p&gt;
&lt;h2&gt;The Spectrum of Synchronousness&lt;/h2&gt;
&lt;p&gt;People might not answer immediately when you have a question. You need to balance between things that require synchronous communication and the ones that can wait. If you have worked with people in different time zones you’ll know what I mean.&lt;/p&gt;
&lt;h2&gt;The Remote Test&lt;/h2&gt;
&lt;p&gt;Similar to &lt;a href=&quot;https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the Joel Test&lt;/a&gt;, the book ends with a list of criteria for remote work. The questions that help determine if you’re ready are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Do you treat everyone as remote?&lt;/li&gt;
&lt;li&gt;Do you provide a remote workspace setup?&lt;/li&gt;
&lt;li&gt;Do you spend money equally on in-office and remote staff?&lt;/li&gt;
&lt;li&gt;Do you optimize for asynchronous communication?&lt;/li&gt;
&lt;li&gt;Do you create artifacts from synchronous interactions?&lt;/li&gt;
&lt;li&gt;Do you measure staff by their impact?&lt;/li&gt;
&lt;li&gt;Do you allow staff to choose flexible hours?&lt;/li&gt;
&lt;li&gt;Are the members of the executive team remote workers?&lt;/li&gt;
&lt;li&gt;Do you use the best collaborative tools that money can buy?&lt;/li&gt;
&lt;li&gt;Do you hire staff anywhere in the world?&lt;/li&gt;
&lt;li&gt;Do you support families as well as employees?&lt;/li&gt;
&lt;li&gt;Do you give back to an employee’s local community?&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;This book is very poignant now that remote work has normalized to a never-seen-before degree. Many companies have embraced the practice. Thus, it’s worth investing in understanding how to be effective in this environment. Compared to another book like &lt;a href=&quot;https://www.amazon.com/Remote-Office-Required-Jason-Fried/dp/0804137501&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Remote: Office Not Required&lt;/a&gt;, there’s a lot of actionable advice that you can apply starting today. It gets ⭐⭐⭐⭐ stars from me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Anatomy of a Successful Retro]]></title><description><![CDATA[Let's talk about a structure for retrospectives that's effective and easy to implement. Make sure you get value out of doing retros]]></description><link>https://hceris.com/anatomy-of-a-successful-retro/</link><guid isPermaLink="false">https://hceris.com/anatomy-of-a-successful-retro/</guid><category><![CDATA[Agile]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><pubDate>Sun, 16 Oct 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ad369550d344265b1ea347910865e76d/85fb2/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGxBTFoGaEf/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERAjEz/9oACAEBAAEFAtjxZEMXOn//xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwFX/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEh/9oACAECAQE/AVR//8QAGBAAAwEBAAAAAAAAAAAAAAAAABAhAQL/2gAIAQEABj8CpC9LV//EABgQAQADAQAAAAAAAAAAAAAAAAEAESEx/9oACAEBAAE/ITaxeXiU8LmyZQyKuf/aAAwDAQACAAMAAAAQ8z//xAAYEQADAQEAAAAAAAAAAAAAAAAAARExQf/aAAgBAwEBPxCa6Oun/8QAFREBAQAAAAAAAAAAAAAAAAAAAQD/2gAIAQIBAT8QFG//xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhMYH/2gAIAQEAAT8QlWL71mVLTxF7cVB68E5mwfNadQP3ERfGb//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Retrospective&quot; title=&quot;&quot; src=&quot;/static/ad369550d344265b1ea347910865e76d/acb04/cover.jpg&quot; srcset=&quot;/static/ad369550d344265b1ea347910865e76d/bc01b/cover.jpg 188w,
/static/ad369550d344265b1ea347910865e76d/bf173/cover.jpg 375w,
/static/ad369550d344265b1ea347910865e76d/acb04/cover.jpg 750w,
/static/ad369550d344265b1ea347910865e76d/ec605/cover.jpg 1125w,
/static/ad369550d344265b1ea347910865e76d/c58a3/cover.jpg 1500w,
/static/ad369550d344265b1ea347910865e76d/85fb2/cover.jpg 3873w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Retrospectives are an integral part of &lt;a href=&quot;https://www.atlassian.com/agile&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Agile&lt;/a&gt;. When they are effective, they provide a powerful tool for continuous improvement. However, when they go wrong they become a catalyst for frustration and pointless venting. You don’t want to end your week on such a negative note, do you?&lt;/p&gt;
&lt;p&gt;While I won’t claim to be an expert facilitator, I’ve experienced my fair share of crappy retros to know what I like and don’t like. Let’s talk about how to run retros productively. You don’t need a dedicated agile coach to get meaningful outcomes.&lt;/p&gt;
&lt;h2&gt;What Is a Retro?&lt;/h2&gt;
&lt;p&gt;Short and sweet: It’s a regular meeting where the team comes together and reflects on all that has happened lately. You discuss the most promising topics and seek actions to improve.&lt;/p&gt;
&lt;p&gt;How do you recognize a good retro? Well, what about the opposite question? What are some retro smells that can doom the whole endeavor?&lt;/p&gt;
&lt;h2&gt;Retro Smells&lt;/h2&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3f2ea0eda73278e99fa60838885f6d0e/e4c4d/debate.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABRBQNYkj/xAAZEAEAAwEBAAAAAAAAAAAAAAABAAIRExL/2gAIAQEAAQUC6zpVh5sWCYQcP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AYj/xAAZEAACAwEAAAAAAAAAAAAAAAAAMQIQESH/2gAIAQEABj8C2TFSEcP/xAAbEAADAAIDAAAAAAAAAAAAAAAAASERQWFxsf/aAAgBAQABPyHDgaE9cu3S4vRl1BL1JSYP/9oADAMBAAIAAwAAABAYP//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCrj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QD//EABoQAQADAAMAAAAAAAAAAAAAAAEAETEhQXH/2gAIAQEAAT8QyKsT17LkixVh3Nq6TpGfKvTiNaQKCPWf/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Debate&quot; title=&quot;&quot; src=&quot;/static/3f2ea0eda73278e99fa60838885f6d0e/acb04/debate.jpg&quot; srcset=&quot;/static/3f2ea0eda73278e99fa60838885f6d0e/bc01b/debate.jpg 188w,
/static/3f2ea0eda73278e99fa60838885f6d0e/bf173/debate.jpg 375w,
/static/3f2ea0eda73278e99fa60838885f6d0e/acb04/debate.jpg 750w,
/static/3f2ea0eda73278e99fa60838885f6d0e/ec605/debate.jpg 1125w,
/static/3f2ea0eda73278e99fa60838885f6d0e/c58a3/debate.jpg 1500w,
/static/3f2ea0eda73278e99fa60838885f6d0e/e4c4d/debate.jpg 4216w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Healthy debate
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The one thing that grinds my gears is poor time management. For example, collecting stickies for 55 minutes and then realizing that you have only five minutes to half-ass some action items.&lt;/p&gt;
&lt;p&gt;Another questionable habit is talking about things that you can’t influence. Don’t get me wrong: sometimes it’s good to vent and blow off steam. But it can’t become the norm. Otherwise, you’ll create a fountain of negativity.&lt;/p&gt;
&lt;p&gt;My last personal favorite is the topic that comes up repeatedly, without ever getting to any resolution. Extra points if it’s an overly generic thing like &lt;em&gt;not enough communication&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Everybody has their pet peeves. As a facilitator, it’s your job to sidestep them and foster a productive ritual.&lt;/p&gt;
&lt;h2&gt;Following A Structure&lt;/h2&gt;
&lt;p&gt;I tend to follow a familiar structure. I want &lt;em&gt;repeatability&lt;/em&gt; and &lt;em&gt;predictability&lt;/em&gt;.
That’s easier to do with a general framework. At the same time, you want to adapt to what people want to talk about. This is my rough script for a 60 minutes slot.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set the Tone&lt;/li&gt;
&lt;li&gt;Icebreaker&lt;/li&gt;
&lt;li&gt;Previous Actions&lt;/li&gt;
&lt;li&gt;Reflection&lt;/li&gt;
&lt;li&gt;Actions&lt;/li&gt;
&lt;li&gt;Wrap-Up&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s go a bit more into detail.&lt;/p&gt;
&lt;h3&gt;Set the Tone&lt;/h3&gt;
&lt;p&gt;Start with a quick (I repeat, quick) reminder that a retrospective is a safe space. Have you read the &lt;a href=&quot;http://retrospectivewiki.org/index.php?title=The_Prime_Directive&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Prime directive&lt;/a&gt;? It does sound a bit tacky, to be fair. Behind the “Star Trek”-like message hides an important question: Are people comfortable talking about potentially uncomfortable topics? If not, you have serious problems that can’t be fixed by gathering people in a room. Sorry for that.&lt;/p&gt;
&lt;h3&gt;Icebreaker&lt;/h3&gt;
&lt;p&gt;Icebreakers are small activities to lighten the mood. It seems silly, but it doesn’t hurt, provided you don’t invest too much time. Focus on the positive.&lt;/p&gt;
&lt;p&gt;The icebreaker that consistently works best for me is collecting kudos. Spend a few minutes letting people thank others for their work and contributions. Share it broadly.&lt;/p&gt;
&lt;h3&gt;Previous Actions&lt;/h3&gt;
&lt;p&gt;It’s crucial to keep track of the actions decided in previous retrospectives. Are you accumulating a long list of unclaimed actions that won’t ever happen? That’s a huge red flag.&lt;/p&gt;
&lt;p&gt;I like to go over previous actions to check progress. For the incomplete ones, it’s worth ensuring they’re still relevant and necessary. Prune the obsolete ones, and carry the rest as part of this iteration. It’s fine, but keep an eye on actions that never go anywhere.&lt;/p&gt;
&lt;h3&gt;Reflection&lt;/h3&gt;
&lt;p&gt;Now comes the meaty part. You’re going to do an exercise where you leave time for the participants to collect their thoughts and write them down in stickies. There are many formats for this. A typical one is to use three buckets like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start Doing&lt;/li&gt;
&lt;li&gt;Stop Doing&lt;/li&gt;
&lt;li&gt;Continue Doing&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Areas that aren’t going well hold the most potential for improvement. Nevertheless, don’t tunnel too much on those. A reminder of activities worth keeping alive can be very useful, even if it doesn’t merit further debate.&lt;/p&gt;
&lt;p&gt;Be very, very careful of sticky overdose. Collecting 50 stickies is great until you realize you won’t get to discuss 95% of them. Here is the spot where many retros go awry. Limit the number of stickies to keep the logistics manageable.&lt;/p&gt;
&lt;p&gt;Once you collect all these wonderful ideas it’s time to read them to ensure they’re clear to everybody. Then, group them and let people vote for the ones they want to discuss. This is a clarification process, don’t allow discussions to start just yet. Some people love to talk about their pet issues regardless of priority. They might monopolize the limited time if you aren’t careful.&lt;/p&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a09dc4bd544cc4197ceca2865fda1aa8/1a77e/timer.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFLJIhYziP/xAAZEAEBAQADAAAAAAAAAAAAAAACAQMAEhT/2gAIAQEAAQUCN7KgjNGWl3yPRo8//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/Aaf/xAAdEAACAQQDAAAAAAAAAAAAAAABAgAQERIyQVFx/9oACAEBAAY/AlRtTxMioBHU2WeGWLtT/8QAGxABAAIDAQEAAAAAAAAAAAAAAQAhETFRYcH/2gAIAQEAAT8hu9Xhn2OuvVBEqGeswnaHkYKDsXcdz//aAAwDAQACAAMAAAAQcN//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QE2X/xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QkL//xAAdEAEBAAIBBQAAAAAAAAAAAAABEQAhUTFBYXGB/9oACAEBAAE/ENtVTMl2weEmXaUlms0V465Y0GFWfLml0uJ2uTD0N2H21i4Gf//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Timer&quot; title=&quot;&quot; src=&quot;/static/a09dc4bd544cc4197ceca2865fda1aa8/acb04/timer.jpg&quot; srcset=&quot;/static/a09dc4bd544cc4197ceca2865fda1aa8/bc01b/timer.jpg 188w,
/static/a09dc4bd544cc4197ceca2865fda1aa8/bf173/timer.jpg 375w,
/static/a09dc4bd544cc4197ceca2865fda1aa8/acb04/timer.jpg 750w,
/static/a09dc4bd544cc4197ceca2865fda1aa8/ec605/timer.jpg 1125w,
/static/a09dc4bd544cc4197ceca2865fda1aa8/c58a3/timer.jpg 1500w,
/static/a09dc4bd544cc4197ceca2865fda1aa8/1a77e/timer.jpg 4800w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  The most important tool in any retro
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;No matter how efficient you are, you’ll have consumed about half the time by now. You’ll have time for about three topics. I like to use a very rigid structure for this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pick the most-voted topic&lt;/li&gt;
&lt;li&gt;Start a timer for 7 minutes. Use the slot to explore the problem and think of actions&lt;/li&gt;
&lt;li&gt;Once the timer is over, I move on to the next topic. If I feel that people still want to talk a bit more, I do a quick thumbs up / thumbs down vote to confirm the suspicion. You might discuss fewer topics, but you don’t leave a conversation unfinished&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You might read this and recoil in horror. It’s so formulaic! However, there’s a reason behind it. If you want to finish on time, you’ll have to be ruthless with time management. If you explain the rules in advance, it feels less rude and awkward. Remember, we’re committed to finishing on time.&lt;/p&gt;
&lt;h3&gt;Actions&lt;/h3&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 169px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/917e53d161dead098389206d79c3360a/2334a/action.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 177.5147928994083%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAYabQc51gwnnpa9N5xxn6JwV/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAERIDIP/aAAgBAQABBQJGSZGYQucgBE0Fc1ZJXpSiVQ2R4//EABoRAAICAwAAAAAAAAAAAAAAAAABAhAREjH/2gAIAQMBAT8BNWKSXDN//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEQ/9oACAECAQE/AVRN/8QAHxAAAgEDBQEAAAAAAAAAAAAAAAERAiExEBIgImFx/9oACAEBAAY/AsMmm+jW2fh0quiWWH7khLn/AP/EAB0QAQACAQUBAAAAAAAAAAAAAAEAESExQVFhcZH/2gAIAQEAAT8h3BC5jqMe6R9j8Ac3FurRbejAYVb2IdYdzClTLhKoFHcA+xRqmYAoX7OIsJ//2gAMAwEAAgADAAAAEAc3sovv/8QAGhEBAAIDAQAAAAAAAAAAAAAAAQARECExUf/aAAgBAwEBPxAF5E+kFKb9iltz/8QAGBEBAAMBAAAAAAAAAAAAAAAAAQARISD/2gAIAQIBAT8QlIpdc4f/xAAeEAEBAQACAwADAAAAAAAAAAABEQAhMUFRcWGx8P/aAAgBAQABPxB4siU9PrKaktEX03ZsfcSYQhrTnDtweFPgfe4YKVGcGZpWrX+NavQASjzv3xhiFX8MQBfVr908wYcCPOQNyO3f/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Action&quot; title=&quot;&quot; src=&quot;/static/917e53d161dead098389206d79c3360a/2334a/action.jpg&quot; srcset=&quot;/static/917e53d161dead098389206d79c3360a/2334a/action.jpg 169w&quot; sizes=&quot;(max-width: 169px) 100vw, 169px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Realistic actions
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A healthy discussion has value on its own, but we want to foster improvement. That requires some actions. As the facilitator, you have to be on the lookout for them. Pounce when given the opportunity.&lt;/p&gt;
&lt;p&gt;There are plenty of catchy acronyms to define good action items, such as &lt;a href=&quot;https://en.wikipedia.org/wiki/SMART_criteria&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SMART&lt;/a&gt;. Follow the one you like. Remember that any action needs to be doable in a reasonable time frame. Ideally before the next retro. I refuse to write down commitments unless I can assign a person to them. I think that actions without an owner are as good as useless.&lt;/p&gt;
&lt;p&gt;What if you don’t find any actions to take? It’s not ideal, but it happens. I’ve seen facilitators push to get some action, any action will do. I disagree with this approach. If you couldn’t find a meaningful thing to do, so be it.&lt;/p&gt;
&lt;h3&gt;Wrap-Up&lt;/h3&gt;
&lt;p&gt;If you did everything well until now, you’ll have about one minute left to wrap up, summarize the actions, and thank everybody for their time. Well done, recruit!&lt;/p&gt;
&lt;p&gt;Write this summary down somewhere, especially the actions. Make sure that you aren’t sharing things you shouldn’t.&lt;/p&gt;
&lt;h2&gt;Scaling it Up&lt;/h2&gt;
&lt;p&gt;So we got one decent retro. Good! Now let’s make it a regular occurrence. There’s no reason that you can’t get a reproducible result.&lt;/p&gt;
&lt;p&gt;I believe that team rituals shouldn’t be owned by an individual. Spreading them across the team increases ownership. Thus, I think moderation should rotate among the people on the team. It’s good practice for them and an antidote against having the same people talking all the time.&lt;/p&gt;
&lt;p&gt;As a parting piece of advice, shake things up! Repeating the same format all the time puts people on auto-pilot. Switch formats occasionally to keep it fresh. Every now and then, do a completely different thing. A futurospective about where the team wants to be next year. Focus on only one topic that’s important for the team.&lt;/p&gt;
&lt;h2&gt;What Do We Actually Get Out of Retrospectives?&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/90e31e51b5846db33dc9632b4869fcda/b2234/zen.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQCBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABxRyhVomj/8QAGRAAAgMBAAAAAAAAAAAAAAAAAQIAAxEi/9oACAEBAAEFAkrViwWsHdtPanIWM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAx/9oACAECAQE/Aaf/xAAcEAABAwUAAAAAAAAAAAAAAAAAAREhECJBgZH/2gAIAQEABj8CuXTkOZ6RA9P/xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhMVFhcf/aAAgBAQABPyHeYwEjr4Nllmn2LraGWRuyr7ins//aAAwDAQACAAMAAAAQAN//xAAWEQEBAQAAAAAAAAAAAAAAAAARARD/2gAIAQMBAT8QWGf/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEh/9oACAECAQE/EAx2AL//xAAaEAEAAwEBAQAAAAAAAAAAAAABABExIYFx/9oACAEBAAE/ELwWKaz3kWdbQwr3WXQWYda8Izo0wnfsOWS1UarH/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Zen&quot; title=&quot;&quot; src=&quot;/static/90e31e51b5846db33dc9632b4869fcda/acb04/zen.jpg&quot; srcset=&quot;/static/90e31e51b5846db33dc9632b4869fcda/bc01b/zen.jpg 188w,
/static/90e31e51b5846db33dc9632b4869fcda/bf173/zen.jpg 375w,
/static/90e31e51b5846db33dc9632b4869fcda/acb04/zen.jpg 750w,
/static/90e31e51b5846db33dc9632b4869fcda/ec605/zen.jpg 1125w,
/static/90e31e51b5846db33dc9632b4869fcda/c58a3/zen.jpg 1500w,
/static/90e31e51b5846db33dc9632b4869fcda/b2234/zen.jpg 2592w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Enlightment state
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Getting quality action items is good. Implementing them within a reasonable time frame is even better. Let’s start with that.&lt;/p&gt;
&lt;p&gt;That said, I think retrospectives are also about creating a culture of reflection. It’s easy to let routine take over and do things the same way as before. Reflective teams are proactive in finding ways of improving on their own. A good retrospective is one small step towards that lofty goal.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The Behavioral Interview]]></title><description><![CDATA[The behavioral interview is the last component of the FAANG interview. Less technical yet challenging, as you need to talk about your experience effectively]]></description><link>https://hceris.com/the-behavioral-interview/</link><guid isPermaLink="false">https://hceris.com/the-behavioral-interview/</guid><category><![CDATA[Interviews]]></category><category><![CDATA[Coding Challenge]]></category><category><![CDATA[FAANG]]></category><category><![CDATA[Career]]></category><pubDate>Wed, 07 Sep 2022 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Interviewing at BigTech&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../tips-for-coding-interviews-at-faang/&quot;&gt;Part 1 - Coding Interview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-system-design-interview/&quot;&gt;Part 2 - System Design&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-behavioral-interview/&quot;&gt;&lt;strong&gt;Part 3 - Behavioral&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bfdf323d5cce7a31aa0970b520168a61/93719/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABor0yip44s//EABoQAAMBAAMAAAAAAAAAAAAAAAECAxEABBL/2gAIAQEAAQUCaAJWI52BllPoO2VYaf/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/Aar/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGI/8QAGhAAAgIDAAAAAAAAAAAAAAAAABEBIQIQgf/aAAgBAQAGPwJlrhJZktf/xAAcEAEAAQQDAAAAAAAAAAAAAAABABEhMUEQcYH/2gAIAQEAAT8hxL7LkCNlkY9SmTrgiOSazCrs/9oADAMBAAIAAwAAABBDP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EBhP/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAh/9oACAECAQE/ELKf/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFRkf/aAAgBAQABPxBTgraAS6rPI8LuWPqOp0lPrkRC2b2JSrXS0w2PS1n/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Behavioral interview&quot; title=&quot;&quot; src=&quot;/static/bfdf323d5cce7a31aa0970b520168a61/acb04/cover.jpg&quot; srcset=&quot;/static/bfdf323d5cce7a31aa0970b520168a61/bc01b/cover.jpg 188w,
/static/bfdf323d5cce7a31aa0970b520168a61/bf173/cover.jpg 375w,
/static/bfdf323d5cce7a31aa0970b520168a61/acb04/cover.jpg 750w,
/static/bfdf323d5cce7a31aa0970b520168a61/ec605/cover.jpg 1125w,
/static/bfdf323d5cce7a31aa0970b520168a61/c58a3/cover.jpg 1500w,
/static/bfdf323d5cce7a31aa0970b520168a61/93719/cover.jpg 4000w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The behavioral interview is the last component of the interview loop at &lt;a href=&quot;https://en.wikipedia.org/wiki/Big_Tech&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;BigTech&lt;/a&gt;. It’s not, as its name implies, a technical interview. Instead, it focuses on your previous experience. You’re there to show that you understand how to act and communicate. It’s similar to the System Design round in that it weighs more heavily for senior candidates.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Well, I don’t need preparation to talk about my experience&lt;/em&gt;, you might think. And you’d be wrong. Don’t underestimate this interview or you will fail it miserably. A behavioral interview isn’t an informal chat where you reminisce about your previous experience and have a good laugh in the end. There are clear expectations.&lt;/p&gt;
&lt;p&gt;I’m ending my series about interviewing talking about this interview format.&lt;/p&gt;
&lt;h2&gt;Structure of a Behavioral Interview&lt;/h2&gt;
&lt;p&gt;A behavioral interview centers around open-ended questions. There are many, many &lt;a href=&quot;https://igotanoffer.com/blogs/tech/amazon-behavioral-interview&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sample questions&lt;/a&gt; on the internet. They tend to sound similar, though:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tell me about a project where you had a big impact&lt;/li&gt;
&lt;li&gt;Tell me how you solved a conflict between multiple teams&lt;/li&gt;
&lt;li&gt;Tell me about a time when you had to make a quick decision&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that these questions focus on your &lt;em&gt;previous&lt;/em&gt; experience, not hypothetical scenarios. The reasoning is that it’s easier to understand how you think by hearing about what you did already.&lt;/p&gt;
&lt;p&gt;These questions are vague and undefined. However, that doesn’t mean you should answer with the first thing that comes to mind. Doing so is a recipe for rejection. Instead, the canonical advice is to use the &lt;a href=&quot;https://interviewsteps.com/blogs/news/amazon-star-method&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;STAR&lt;/a&gt; method. While that’s the right starting point, we can build on top and do better. Allow me to explain.&lt;/p&gt;
&lt;h2&gt;STAR is Flawed&lt;/h2&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/75312e3aa45b27bcfecdb798c293491b/c42e5/book.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwACBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHj4U4GaP/EABkQAQADAQEAAAAAAAAAAAAAAAIAAREDEP/aAAgBAQABBQIckzZ8Sl3syf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBEhEv/aAAgBAQAGPwLpDjMSLcf/xAAcEAEAAgEFAAAAAAAAAAAAAAABABEhEEFRYYH/2gAIAQEAAT8hU0dHMC6eaKNXwAuWdyIcs//aAAwDAQACAAMAAAAQJy//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCH/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/ELqv/8QAHBABAAMAAwEBAAAAAAAAAAAAAQARITFBUXFh/9oACAEBAAE/EBtoNI6+6hdgCAff34RKUeocbIHGorhad3l9iul/Z//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Book&quot; title=&quot;&quot; src=&quot;/static/75312e3aa45b27bcfecdb798c293491b/acb04/book.jpg&quot; srcset=&quot;/static/75312e3aa45b27bcfecdb798c293491b/bc01b/book.jpg 188w,
/static/75312e3aa45b27bcfecdb798c293491b/bf173/book.jpg 375w,
/static/75312e3aa45b27bcfecdb798c293491b/acb04/book.jpg 750w,
/static/75312e3aa45b27bcfecdb798c293491b/ec605/book.jpg 1125w,
/static/75312e3aa45b27bcfecdb798c293491b/c58a3/book.jpg 1500w,
/static/75312e3aa45b27bcfecdb798c293491b/c42e5/book.jpg 4928w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  This response could be shorter
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;STAR (&lt;em&gt;Situation&lt;/em&gt;, &lt;em&gt;Task&lt;/em&gt;, &lt;em&gt;Action&lt;/em&gt;, &lt;em&gt;Result&lt;/em&gt;) is a way of structuring your answers to any behavioral question. You start explaining the context. Then, you talk about your task. You follow with your actions, and in the end, you round it up with the results of those actions. Using this structure ensures that you tell a coherent story.&lt;/p&gt;
&lt;p&gt;There’s a problem, and it has to do with repetition. In practice, &lt;em&gt;Situation&lt;/em&gt; and &lt;em&gt;Task&lt;/em&gt; often overlap significantly. If you follow the method rigidly you’ll end up mostly saying the same thing twice. It might sound innocuous, but you can’t afford to use your limited time inefficiently.&lt;/p&gt;
&lt;p&gt;In these interviews, time is your enemy. At Meta, for instance, they last 45 minutes. That includes the introduction and &lt;em&gt;your&lt;/em&gt; questions, mind you. You won’t have enough time to talk about all the wonderful things you have done. Repeating yourself leaves you less time to provide useful signal. It makes the interviewer’s evaluation harder, which reduces your chances.&lt;/p&gt;
&lt;p&gt;I prefer using a streamlined version of STAR. Let’s call it PAR: &lt;em&gt;Problem&lt;/em&gt;, &lt;em&gt;Action&lt;/em&gt;, &lt;em&gt;Result&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;Using PAR&lt;/h2&gt;
&lt;p&gt;Let’s say you get one of the aforementioned questions. You come prepared and want to answer it following this method. What are the relevant bits to include for each section?&lt;/p&gt;
&lt;h3&gt;Problem&lt;/h3&gt;
&lt;p&gt;This part is about giving context. Where were you, when was that, and what was your role. Make it short and crisp. Skip any detail about your position that’s not fundamental for understanding the situation.&lt;/p&gt;
&lt;p&gt;After that, it’s time to describe the problem. Remember that you have to make it understandable for people who weren’t there. Talk about the timelines. If you were measuring the problem with some KPI, that’s worth mentioning.&lt;/p&gt;
&lt;p&gt;Be succinct! An interviewer will get frustrated if you bore them with irrelevant details. Practice saying the least possible that is still enough to understand what’s going on.&lt;/p&gt;
&lt;h3&gt;Action&lt;/h3&gt;
&lt;p&gt;You set up the stages, now it’s time for the important bit. What did &lt;em&gt;you&lt;/em&gt; do? Explain that without domain-specific context or internal terminology. Focus on what &lt;em&gt;you&lt;/em&gt; did. A behavioral question isn’t the time to talk about the team. They are looking to hire &lt;strong&gt;you&lt;/strong&gt;, not your team. Ensure that there’s no ambiguity about that.&lt;/p&gt;
&lt;p&gt;Don’t go too broad with your answer. For a complex project, you did a lot of things. You don’t have time for all of them. Pick the top three that are the most relevant for the question and had the most impact. Again, you’re looking for the right amount of detail.&lt;/p&gt;
&lt;h3&gt;Result&lt;/h3&gt;
&lt;p&gt;The result is where you round up your answer and come to a satisfying conclusion. You did a whole bunch of things. Talk about the outcome. There &lt;strong&gt;has&lt;/strong&gt; to be some outcome. If all your actions changed nothing, find another example.&lt;/p&gt;
&lt;p&gt;Ideally, you’ll have numbers that you can mention. You don’t always have solid, well-measured numbers, but you can make reasoned estimations. Don’t make outlandish claims unless you’re ready to justify them.&lt;/p&gt;
&lt;p&gt;Depending on time, consider including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Next Steps: What would come next?&lt;/li&gt;
&lt;li&gt;Scaling: How can you use what you did to scale it to a bigger audience?&lt;/li&gt;
&lt;li&gt;Learnings: What would you do differently next time?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You put all three together, and that’s your answer. See &lt;a href=&quot;https://lethain.com/star-method/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this post&lt;/a&gt; from Will Larson to see an example.&lt;/p&gt;
&lt;h2&gt;Building a Portfolio of Experiences&lt;/h2&gt;
&lt;p&gt;In my experience, the best way to prepare for the behavioral interview is to build and curate a portfolio of examples based on your experience. There are way too many questions out there. You can’t prepare specific answers for all of them. Instead, I focused on having strong examples that cover multiple behaviors. That way, you can adjust them to the situation instead of scrambling to think of something unique on the spot.&lt;/p&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/93a1093d00d8b17b0c168740d51ff694/12609/portfolio.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAdjExLzSgn//xAAaEAABBQEAAAAAAAAAAAAAAAACAAEDESES/9oACAEBAAEFAhVMpMkF6Uh8gev/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPwE1f//EABgQAAMBAQAAAAAAAAAAAAAAAAAQEQJR/9oACAEBAAY/AlpWF6f/xAAaEAEBAQEAAwAAAAAAAAAAAAABEQAhEEGR/9oACAEBAAE/ITXpret9DwFSDDWDei7/2gAMAwEAAgADAAAAELgf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QqP/EABcRAAMBAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QCsX/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMWHB/9oACAEBAAE/EBcsy8YgBbZfZUXO4mqGythnQ1XAMNDPU+T/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Portfolio&quot; title=&quot;&quot; src=&quot;/static/93a1093d00d8b17b0c168740d51ff694/acb04/portfolio.jpg&quot; srcset=&quot;/static/93a1093d00d8b17b0c168740d51ff694/bc01b/portfolio.jpg 188w,
/static/93a1093d00d8b17b0c168740d51ff694/bf173/portfolio.jpg 375w,
/static/93a1093d00d8b17b0c168740d51ff694/acb04/portfolio.jpg 750w,
/static/93a1093d00d8b17b0c168740d51ff694/ec605/portfolio.jpg 1125w,
/static/93a1093d00d8b17b0c168740d51ff694/c58a3/portfolio.jpg 1500w,
/static/93a1093d00d8b17b0c168740d51ff694/12609/portfolio.jpg 3000w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  A future portfolio of success
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.amazon.jobs/en/principles&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Amazon Leadership Principles&lt;/a&gt; are a good base. They cover plenty of ground, so you get to think about many different aspects of your previous jobs. I have a table with examples spanning my career that I’ve refined carefully. I usually follow the same approach to extend this table.&lt;/p&gt;
&lt;p&gt;First, I write down a sketch of my answer. Just enough that I know all the points I want to cover. It’s fine to bring your notes to an interview, but don’t read a whole answer straight out of them. Once the case is ready it’s time to polish it! Your first version will inevitably suck. You probably made it too long. Or didn’t make the results clear enough. In any case, you need to iterate relentlessly. Get feedback from somebody you trust for extra perspective.&lt;/p&gt;
&lt;p&gt;Lastly, test it out. Read the scenario aloud to yourself or somebody else. Do a mock interview, or use it in a real interview. While your experience remains the same, your ability to present it will improve massively.&lt;/p&gt;
&lt;h3&gt;Some Extra Thoughts&lt;/h3&gt;
&lt;p&gt;Don’t make stuff up. Honestly, you’ll probably get caught and fail the interview. Even if you somehow put it past your interviewer, you’re setting yourself up for failure.&lt;/p&gt;
&lt;p&gt;Try to cover a decent span of your career. People want to see that you have acquired a broad array of experiences. At the same time, your most recent work is the most valuable. It’s easier to remember, and it’s a closer representation of who you are today. Your strongest examples should come from the last few years.&lt;/p&gt;
&lt;p&gt;You should prepare enough examples. You might get behavioral questions in every interview you do. Expect a couple of them. Talking about the same scenario over and over won’t be beneficial.&lt;/p&gt;
&lt;p&gt;Lastly, don’t limit yourself to positive experiences exclusively. We all have failed at some point. Talking about your failures openly is a great way to show self-reflection and growth. What did you learn, and what would you do differently? Needless to say, don’t confront failure by blaming others. Even if it happens to be true you’re showing a very concerning side to somebody who’s trying to gauge your contributions.&lt;/p&gt;
&lt;h2&gt;Measure your Outcomes&lt;/h2&gt;
&lt;p&gt;Let’s be clear: You can’t change your experience. You can make present it better. You can show your ability to reflect and learn. Don’t get discouraged if you think that your examples are too modest.&lt;/p&gt;
&lt;p&gt;If you don’t have impactful examples, think about how to get there over time. Use this to guide your work. If you’re working on a problem at work, go deep and understand its true impact. Seek metrics that will reflect changes. If you’re doing good work, you’ll be able to show it sooner or later. If you somehow didn’t burn all your motivation yet, &lt;a href=&quot;https://www.youtube.com/watch?v=PJKYqLP6MRE&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this video&lt;/a&gt; from Jackson Gabbard.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The System Design Interview]]></title><description><![CDATA[The system design interview is an unavoidable part of interviewing at FAANG. Let's see how to prepare for them successfully]]></description><link>https://hceris.com/the-system-design-interview/</link><guid isPermaLink="false">https://hceris.com/the-system-design-interview/</guid><category><![CDATA[Interviews]]></category><category><![CDATA[Coding Challenge]]></category><category><![CDATA[FAANG]]></category><category><![CDATA[Career]]></category><category><![CDATA[System Design]]></category><pubDate>Mon, 08 Aug 2022 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Interviewing at BigTech&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../tips-for-coding-interviews-at-faang/&quot;&gt;Part 1 - Coding Interview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-system-design-interview/&quot;&gt;&lt;strong&gt;Part 2 - System Design&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-behavioral-interview/&quot;&gt;Part 3 - Behavioral&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2e09d4c88c29d19f4f82b566f9810781/d2602/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAbTJZm4QgP/EABkQAQEBAAMAAAAAAAAAAAAAAAIDEgABBP/aAAgBAQABBQImbOc8s+jTzrUKLJvZqv8A/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAEREv/aAAgBAwEBPwG5af/EABcRAAMBAAAAAAAAAAAAAAAAAAABERL/2gAIAQIBAT8Bihk//8QAGhABAQEBAAMAAAAAAAAAAAAAAQARAiFBcf/aAAgBAQAGPwLxzoxhpIlx8tn1f//EABwQAAICAgMAAAAAAAAAAAAAAAABESFRYUFxkf/aAAgBAQABPyGVRPihtd6B5GdomnTwcpMjxmCpJYP/2gAMAwEAAgADAAAAENTf/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxBUwo//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EHkZB//EAB0QAQADAAEFAAAAAAAAAAAAAAEAESExQVGBkcH/2gAIAQEAAT8QF1ULNK7eI4RBpSz2wzLlWhezVN1zrj5A7FQN8ROXmM0ONqf/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;System design interview&quot; title=&quot;&quot; src=&quot;/static/2e09d4c88c29d19f4f82b566f9810781/acb04/cover.jpg&quot; srcset=&quot;/static/2e09d4c88c29d19f4f82b566f9810781/bc01b/cover.jpg 188w,
/static/2e09d4c88c29d19f4f82b566f9810781/bf173/cover.jpg 375w,
/static/2e09d4c88c29d19f4f82b566f9810781/acb04/cover.jpg 750w,
/static/2e09d4c88c29d19f4f82b566f9810781/ec605/cover.jpg 1125w,
/static/2e09d4c88c29d19f4f82b566f9810781/c58a3/cover.jpg 1500w,
/static/2e09d4c88c29d19f4f82b566f9810781/d2602/cover.jpg 4032w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;System design &lt;a href=&quot;https://blog.pragmaticengineer.com/preparing-for-the-systems-design-and-coding-interviews/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;interviews&lt;/a&gt; are a staple of interviewing loops at BigTech. In a system design interview, your job is to design a complex system, such as a video platform like YouTube. You aren’t required to code anything. Instead, you focus on the high-level architecture and discuss aspects like scalability for your design.&lt;/p&gt;
&lt;p&gt;Usually, only somewhat senior candidates get this interview. The assumption is that you need to gather a certain amount of experience before you can talk about designing systems in depth. However, it wouldn’t be out of the ordinary if you haven’t done one of these before. It all depends on your career path. In this article, I want to share what I’ve learned while preparing for them.&lt;/p&gt;
&lt;h2&gt;What Am I Supposed to Show in a System Design Interview?&lt;/h2&gt;
&lt;p&gt;In this interview, you show your technological breadth and depth. You consider the different trade-offs and work with the interviewer to get the best solution you can in the allotted time.&lt;/p&gt;
&lt;p&gt;It’s not just about technology, though. The problem is almost always unclear and loosely defined. It’s up to you to bring clarity, understand what to build in more detail, and discuss the alternatives.&lt;/p&gt;
&lt;p&gt;Keep in mind that system design can be decisive in your leveling, even more so than the coding part. Check this &lt;a href=&quot;https://www.youtube.com/watch?v=ZgdS0EUmn70&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;video&lt;/a&gt; from Jackson Gabbard is an excellent introduction to the topic.&lt;/p&gt;
&lt;h2&gt;A Solid Foundation&lt;/h2&gt;
&lt;p&gt;The first layer of preparation is your day-to-day job. If you’re designing systems, you have the opportunity to hone your skills and acquire experience.&lt;/p&gt;
&lt;p&gt;So, practice as much as you can! Write your proposals as &lt;a href=&quot;https://blog.pragmaticengineer.com/scaling-engineering-teams-via-writing-things-down-rfcs/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RFCs&lt;/a&gt; and get feedback from senior engineers in your organization. Review other people’s designs. If this isn’t a well-established process, maybe there’s an opportunity to drive that initiative. It’ll do wonders to your engineering palate. Even if you don’t operate at BigTech scale, it’s a valuable experience.&lt;/p&gt;
&lt;p&gt;If your company doesn’t provide any opportunity to engage in these activities, you should consider moving to a different place. Technical decisions made without any debate? That sounds suspect to me.&lt;/p&gt;
&lt;h2&gt;Preparation Materials&lt;/h2&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 229px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e55306979bed2408d979c36a8d865e60/d0281/ddia.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 130.85106382978722%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABcSAAAXEgFnn9JSAAAFLElEQVR42oWVa0yTdxTG+bBk+7JkH3RuS8zUZTpRg25xoqKoUxCdFy5azDZELJcqWhGVMu7QCk5AueiiMm+bA+d0BhU3Z9RhtkS5taWF3qEFPqCIGB1ya3/L+2JZVdxO8vT8m/85T5/znDdvvZxA275CdCvXY9woQx8QhtpnMTVjplM7dsb/4x0f7rw+AXvqXoYAL6fLxWD3Q/raOui/d1/E0xY7vUYLvSbr6DBah+9FWPm7ycTAvS6GnE68BIVPTVa6K6/Rc/UmPb/eoudaNT2/3x6G51nA9WE8uvkXj278KWah5qmlhUGXCy8AR1oujXOD0PmvoWGSrwiN90LUU/xQT1mAevJ8NNP8afhg7sh93dgZ1L3tQ/27s7j7xiQcaXkI4kTCjn3F6BeHYolOwK7Mw7pDQWtKBtYtiZij5Vjjd2OJ34UlNgHbzhSMoZE0TPBF/aEfmo8WUjfOh3ZV4b+EbVn56APX07xiA7p5K9EvCRbPli2JGCWb0c1bRXNQODrflZilcpoC1lE3biYNE+bQMH42NW9OoV3pQdiuOkBToATjeimGNREY10nR+a/FGByF6cs4kdwQGkVz0AaMYZuGsyQaQ8hGDCGR6BcF064s8CDMPYhuUTDGDTG0pGRj25mKJT4Rc5RcJLTIdmGTfy2ObJFuwyJLwJaUjlm6A5tcgSF04/MKHel5aGcvR78kFM20RWhnLkXntxq9fzCNs4PQ+iyl8ZMAGj8NQjtrGdqPA8Uajbc/6sl+1L83i/YcD4WO1FyalktoTc7CHBmPJWYHpq9kOFT7MYREYN68ndaUTCyxcozhm8XlCbBu3S2S1r7l/YKHeUVofZaIvljj92CKkGFYG4FZ8G+5RDwbw6U0B0fQtPoLMRvCojCGR6OZ6k/tmOkvEOYUoJ7mj37pevSBEvSB4eiXSWicv5rGBWvQCnnOCprnrqLZZxn6ifPQTl2E2nsx2pkB1L8/R1zsCKFdkY0mIBiDNJ6myBiaImNpipKhj4hGL92C4bMQNH6fc1OyibMbY7jgt5Laib40jJlOzdjp3HltPI5U1TCh8PG4Ts298vN0XbxC14XLdP1yhc6KCzy8cIneq9e5vG03eVIZh4tLUObvJy1XRaFUhuPoKR5frKLzZDlP6jXDL4ehwUFeFY9dTi5e+43YxARyC/IpL/+RA/n5fJObS2nZUSpvXKe16/5I/cDAAF5DQ0O4nE6cArHLJV4M9vVx+9YtUhQKtsbFkbQrkQMFBZw6eZLz538mLTWF0qIisjPSyUpPw26ziX39bkJ3PHnyhLa2NkqKi9kWH09mRjonThzn4IFCVEolR48c4buyMpKS9pCdnc2ZMz/Q0dGB0+kcFjI4iNfgs5E7Ozupqqpih1yOSqXk0KFSvj18iO9Pn+bE8ePsTEhAkZSELC6OrMwMSktLRLS2tor9LuG96knY0tKC3W4nWaFgr0rJ2YoKSoqL2L0rkazMTMJCQ4iWSikrO0Z1dTU2mw2dTofJZBqZUCQUPXzmnRDJyQrk27dz7txPotLCwgKOHTtKRXk5JpNx1OW5+59T2Nvby6lTJ8nduxdlTo5IXFlZOSqB4JknRiWsra2h5u5dcVQBt29XjxQKTcIk7ubR8NLIly5V0lBfj1qtfmkcz6b/iucIhYeyuvoP6upqxUvhgX+RTFDY19cn1vb394vZfRb+8UYI3SH4+ODBg1cqEJrNZjN2hx2H3S5u2GK1iht/2N0t/qCXUOT2yB1uv0aDoNadPeuE74LSfwC4fWTOenuPowAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;DDIA&quot; title=&quot;&quot; src=&quot;/static/e55306979bed2408d979c36a8d865e60/d0281/ddia.png&quot; srcset=&quot;/static/e55306979bed2408d979c36a8d865e60/4dcb9/ddia.png 188w,
/static/e55306979bed2408d979c36a8d865e60/d0281/ddia.png 229w&quot; sizes=&quot;(max-width: 229px) 100vw, 229px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  The bible of System Design
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Designing data-intensive applications (&lt;a href=&quot;https://hceris.com/book-review-designing-data-intensive-applications/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DDIA&lt;/a&gt;) is the canonical book for system design. It’s almost a mandatory read as it covers such a vast amount of topics that are relevant to system design. Additionally, it helps polish your vocabulary to communicate more efficiently with the interviewer.&lt;/p&gt;
&lt;p&gt;Specialized courses are popping up that cover the topic. Alex Wu’s &lt;a href=&quot;https://courses.systeminterview.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;course&lt;/a&gt; is probably the best and completely worth your money.&lt;/p&gt;
&lt;p&gt;YouTube has a ton of content. For instance, this &lt;a href=&quot;https://www.youtube.com/channel/UCRPMAqdtSgd0Ipeef7iFsKw&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;channel&lt;/a&gt; is a good source of inspiration. &lt;a href=&quot;https://www.youtube.com/nctv&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;QCon’s&lt;/a&gt; talks are good as well.&lt;/p&gt;
&lt;p&gt;Lastly, BigTech companies almost always maintain an engineering blog. That’s an excellent resource to understand how they fix their problems.&lt;/p&gt;
&lt;h2&gt;Practicing Actual Interviews&lt;/h2&gt;
&lt;p&gt;Once you have a solid base, it’s time to practice. Unlike coding interviews, system design is hard to practice alone. System design interviews are very reliant on timing. You’re looking for an intuitive feeling of how long to spend on each part of the interview. I don’t think you can get the timings right without testing them under realistic conditions.&lt;/p&gt;
&lt;p&gt;Mock interviews are by far the most effective way to practice system design. You can use &lt;a href=&quot;https://interviewing.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;interviewing.io&lt;/a&gt; if you’re in a rush and don’t mind paying. Or check one of the many interviewing-oriented Discord channels and find a buddy to run some mocks.&lt;/p&gt;
&lt;p&gt;It took me a lot of mental effort to start doing mock interviews. I just found it awkward. I tried to get by doing it by myself. I can tell you it’s not the same. Get over it as fast as possible. It’s worth it.&lt;/p&gt;
&lt;p&gt;Don’t go into a system design interview without practice. You’re almost guaranteed to fail.&lt;/p&gt;
&lt;h2&gt;Tips And Tricks&lt;/h2&gt;
&lt;p&gt;There’s a vast amount of materials out there. I won’t cover the basics, or tell you to do &lt;a href=&quot;https://www.dballona.com/en/system-design-capacity-planning-basics&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;capacity planning&lt;/a&gt; or anything like that. Instead, I’m focusing on some realizations that helped me polish my interviews.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Manage Time&lt;/em&gt;. Interviews are shorter than you think. To pass a senior loop, you have to make sure that you handle time effectively&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Reduce Scope&lt;/em&gt;. This is related to time management. System design problems are almost always bigger than what you can handle in an hour. You have to find ways to reduce the scope. Otherwise, you might leave the problem unfinished, or fail to dive into a concrete area.
&lt;ul&gt;
&lt;li&gt;Your main scoping tool is the functional requirements. Don’t define too many of them&lt;/li&gt;
&lt;li&gt;Be prepared to descope during the high-level design. If you realize that you’re trying to do too much, offer to skip some parts or skip details. Whatever you do, don’t risk a half-finished solution&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Don’t repeat yourself&lt;/em&gt;. Train to not repeat the same thing multiple times. You need all the extra time you can buy&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Have an agenda&lt;/em&gt;. I’ll get to this in a second&lt;/li&gt;
&lt;li&gt;&lt;em&gt;It’s not a quiz&lt;/em&gt;. Some people memorize extremely specific details. That misses the point. I would say that presenting a coherent and reasoned solution is better, even if you skip some details&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Talk about trade-offs&lt;/em&gt;. Every design has pros and cons. You should ensure that you explain the consequences of your decisions and how they inform your design&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Who uses the System?&lt;/em&gt; It’s tempting to dive into replication strategies, partitioning, and a multitude of other technical challenges. But you should always keep the user in your mind. Who is using the system? What’s their success? If I introduce a change in my design, will it result in a better experience for them?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A lot of these suggestions are very fuzzy. How much scope is too much? How do you know how much time you can spend in an area? That’s why you practice. You need to get a feeling of that, and that’s only happening if you practice in advance.&lt;/p&gt;
&lt;h2&gt;Present a Clear Structure&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/691e38677e523461b4dc7279ffa5e946/f681a/plan.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQCA//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAG1BSWXEP8A/8QAGRABAAMBAQAAAAAAAAAAAAAAAQIDEQAh/9oACAEBAAEFAjw3i0epWxnLCvGH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAQQDAAAAAAAAAAAAAAAAAQACECEREjH/2gAIAQEABj8CwIuls48gUv/EABkQAAMBAQEAAAAAAAAAAAAAAAABESGBMf/aAAgBAQABPyFVIxDjRVqh89DEi25elJPT/9oADAMBAAIAAwAAABAv/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPxBH/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/EK1//8QAGxABAQADAQEBAAAAAAAAAAAAAREAITFhQXH/2gAIAQEAAT8QOAAhDCKv3HKVJH76eYvHeUBObwFHpwjExQ3DaF5n/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Plan&quot; title=&quot;&quot; src=&quot;/static/691e38677e523461b4dc7279ffa5e946/acb04/plan.jpg&quot; srcset=&quot;/static/691e38677e523461b4dc7279ffa5e946/bc01b/plan.jpg 188w,
/static/691e38677e523461b4dc7279ffa5e946/bf173/plan.jpg 375w,
/static/691e38677e523461b4dc7279ffa5e946/acb04/plan.jpg 750w,
/static/691e38677e523461b4dc7279ffa5e946/ec605/plan.jpg 1125w,
/static/691e38677e523461b4dc7279ffa5e946/c58a3/plan.jpg 1500w,
/static/691e38677e523461b4dc7279ffa5e946/f681a/plan.jpg 5029w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  We&apos;re getting somewhere here
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There’s so much you can talk about in a system design interview. It’s easy to get lost or start aimlessly rambling. That’s why it’s useful to create a rough outline of the topics you’re going to cover. It has two crucial benefits:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You have a structure to follow to keep you on track&lt;/li&gt;
&lt;li&gt;You align with the interviewer. If they want to dive into a topic, make sure to integrate that into your plan and cover it&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that you should &lt;strong&gt;never&lt;/strong&gt; repeat the same structure for each interview. You’ve got to figure out the relevant parts for the problem at hand and consider your interviewer’s expectations. They surely want to touch on some topics. Don’t ignore those.&lt;/p&gt;
&lt;p&gt;With that being said, this is a sample agenda I’ve used before:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Problem Exploration
&lt;ol&gt;
&lt;li&gt;Functional Requirements&lt;/li&gt;
&lt;li&gt;Cross-Functional Requirements&lt;/li&gt;
&lt;li&gt;What is the success case for the user, and how to measure it&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Plan
&lt;ol&gt;
&lt;li&gt;Propose a list of topics&lt;/li&gt;
&lt;li&gt;Align on items to cover&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Quantitative Analysis
&lt;ol&gt;
&lt;li&gt;QPS&lt;/li&gt;
&lt;li&gt;Data amounts&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;API&lt;/li&gt;
&lt;li&gt;High-Level Design
&lt;ol&gt;
&lt;li&gt;Main services&lt;/li&gt;
&lt;li&gt;Interactions between them&lt;/li&gt;
&lt;li&gt;What kind of data do you produce and store&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Deep Dive
&lt;ol&gt;
&lt;li&gt;Find the most promising topic to dive in&lt;/li&gt;
&lt;li&gt;Go as deep as you can&lt;/li&gt;
&lt;li&gt;Trade-offs!&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Operational concerns
&lt;ol&gt;
&lt;li&gt;Points of failure (error handling)&lt;/li&gt;
&lt;li&gt;Monitoring&lt;/li&gt;
&lt;li&gt;Analytics -&gt; Business metrics&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Scaling Up
&lt;ol&gt;
&lt;li&gt;What are the bottlenecks&lt;/li&gt;
&lt;li&gt;Elasticity&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Remember that you won’t have time to talk about everything.&lt;/p&gt;
&lt;p&gt;Another way to use an agenda to your benefit is to come back to it as you address different topics. If your design is close to complete, go back to the requirements and check that you covered them.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Huge Disclaimer&lt;/strong&gt;: If you sketch a plan, it’s fundamental to make sure you hold yourself to it. If you only manage to run through half of it, you’re pretty much priming your interviewer to fail you. Practice until you can manage the timeslot. Be prepared to descope things as you move along, but don’t ever get to the point where the interviewer cuts in the middle of a sentence with something like “We don’t have any more time, let’s stop here”.&lt;/p&gt;
&lt;h2&gt;Logistics&lt;/h2&gt;
&lt;p&gt;Use a diagramming tool. Get familiar with one so that you don’t waste time trying to draw circles. I like &lt;a href=&quot;https://whimsical.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Whimsical&lt;/a&gt; or &lt;a href=&quot;https://excalidraw.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Excalidraw&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Write down things! Don’t leave empty boxes. If you’re talking about a topic, write it down, even if only on a high level. The interviewer might go back to the board after the interview. It’s always a challenging balance to strike, as writing absolutely everything you say will slow you down significantly.&lt;/p&gt;
&lt;h2&gt;Putting it All Together&lt;/h2&gt;
&lt;p&gt;As you can see, the system design interview focuses on you showing how to apply your experience in technology to fix a nebulous problem in the best way possible. It’s fuzzy and open-ended, and it requires you to think clearly and communicate efficiently. Improve your chances of success by working on all these pieces in advance!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Tips for Coding Interviews at FAANG]]></title><description><![CDATA[Coding interviews at FAANG are difficult. Let me share some tips that helped me go through these interviews successfully]]></description><link>https://hceris.com/tips-for-coding-interviews-at-faang/</link><guid isPermaLink="false">https://hceris.com/tips-for-coding-interviews-at-faang/</guid><category><![CDATA[Interviews]]></category><category><![CDATA[Coding Challenge]]></category><category><![CDATA[FAANG]]></category><category><![CDATA[Career]]></category><pubDate>Mon, 11 Jul 2022 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Interviewing at BigTech&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../tips-for-coding-interviews-at-faang/&quot;&gt;&lt;strong&gt;Part 1 - Coding Interview&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-system-design-interview/&quot;&gt;Part 2 - System Design&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../the-behavioral-interview/&quot;&gt;Part 3 - Behavioral&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9dff55309a2652e21cb2509173830c07/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHQlcIslKn/xAAZEAADAQEBAAAAAAAAAAAAAAAAAgMSEyH/2gAIAQEAAQUCKWydnKqzl1yen//EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAEDAQE/AYf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREQITH/2gAIAQEABj8CNHBRwStx/8QAHBABAAICAwEAAAAAAAAAAAAAAQARMUEhcYGh/9oACAEBAAE/IaoWFxF3uKYT5KQY2M24zc7fZ//aAAwDAQACAAMAAAAQV9//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAwEBPxCD/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/EBV//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITFBUWGB/9oACAEBAAE/EAuvB3Fy5HUT5GhJrmhE/JGb7yV0SrhWYVC3aP/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Whiteboard interview&quot; title=&quot;&quot; src=&quot;/static/9dff55309a2652e21cb2509173830c07/acb04/cover.jpg&quot; srcset=&quot;/static/9dff55309a2652e21cb2509173830c07/bc01b/cover.jpg 188w,
/static/9dff55309a2652e21cb2509173830c07/bf173/cover.jpg 375w,
/static/9dff55309a2652e21cb2509173830c07/acb04/cover.jpg 750w,
/static/9dff55309a2652e21cb2509173830c07/ec605/cover.jpg 1125w,
/static/9dff55309a2652e21cb2509173830c07/c58a3/cover.jpg 1500w,
/static/9dff55309a2652e21cb2509173830c07/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Have you ever considered a position in &lt;a href=&quot;https://en.wikipedia.org/wiki/Big_Tech&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;BigTech&lt;/a&gt; as an engineer? Lots of people do. There’s no shortage of articles where people talk about their experiences.&lt;/p&gt;
&lt;p&gt;If you’ve looked into it, you know that you’ll have to pass a coding interview as part of the process. Possibly multiple rounds, depending on the company. You’re unlikely to get an offer without a decent performance. Better be prepared for them.&lt;/p&gt;
&lt;p&gt;Let’s talk about coding interviews. There are way too many articles about this topic already. I’m assuming you’re familiar with the format already. I’m going to focus on a bunch of things that helped me during the interview process at FAANG.&lt;/p&gt;
&lt;p&gt;If you’re not up to speed, check out &lt;a href=&quot;https://blog.pragmaticengineer.com/preparing-for-the-systems-design-and-coding-interviews/#coding-interviews&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this article&lt;/a&gt; from the pragmatic engineer. He’s an invaluable source on all things related to tech.&lt;/p&gt;
&lt;h2&gt;Coding Interviews Have Moved Online&lt;/h2&gt;
&lt;p&gt;Coding interviews are about writing a small program. Typically it’s an algorithmic challenge. Traditionally, you’d do that in person, writing your code on a whiteboard.&lt;/p&gt;
&lt;p&gt;Nowadays, most interviews happen remotely using some online editor. It’s a pretty significant improvement, as coding on a whiteboard is quite uncomfortable. Still, don’t expect much more than simple code highlighting. You don’t get to compile or run your code.&lt;/p&gt;
&lt;p&gt;Thus, the very first thing to do is to get familiar with the environment you’ll be using in the real interview.&lt;/p&gt;
&lt;h2&gt;Preparing for a Coding Interview&lt;/h2&gt;
&lt;p&gt;It goes without saying, but if you’re going through the process, you’ll have to spend time preparing. If you can’t commit to that, or you fundamentally oppose the idea, then you should skip the whole thing. I don’t think you can realistically pass a FAANG interview loop without any preparation.&lt;/p&gt;
&lt;p&gt;With that in mind, here are six tips for a more successful coding interview:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The Right Amount of Grinding&lt;/li&gt;
&lt;li&gt;Speed is Key&lt;/li&gt;
&lt;li&gt;Share your Thoughts&lt;/li&gt;
&lt;li&gt;Get Used to Write Readable Code&lt;/li&gt;
&lt;li&gt;A Clear Structure&lt;/li&gt;
&lt;li&gt;Don’t Give Up&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;The Right Amount of Grinding&lt;/h3&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2505631315ee2ca9932729f3065bc97a/78bce/grinding.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAU5V0wQKy1//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIDEhEx/9oACAEBAAEFAqpIsqMJEXybWT0//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERIRASMSL/2gAIAQEABj8C1fGebL6Jky8f/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAExQREhcZH/2gAIAQEAAT8h9PjU6O7HouL6wy9EoRmTk//aAAwDAQACAAMAAAAQvA//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EG6tKf/EABcRAAMBAAAAAAAAAAAAAAAAAAEQITH/2gAIAQIBAT8QExf/xAAcEAEBAAMBAAMAAAAAAAAAAAABEQAhYUExseH/2gAIAQEAAT8QITqQPnTuCJqaHYn3ievFQ3OY80RsfcnDsKur38mKd1W1vzn/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Grinding&quot; title=&quot;&quot; src=&quot;/static/2505631315ee2ca9932729f3065bc97a/acb04/grinding.jpg&quot; srcset=&quot;/static/2505631315ee2ca9932729f3065bc97a/bc01b/grinding.jpg 188w,
/static/2505631315ee2ca9932729f3065bc97a/bf173/grinding.jpg 375w,
/static/2505631315ee2ca9932729f3065bc97a/acb04/grinding.jpg 750w,
/static/2505631315ee2ca9932729f3065bc97a/ec605/grinding.jpg 1125w,
/static/2505631315ee2ca9932729f3065bc97a/c58a3/grinding.jpg 1500w,
/static/2505631315ee2ca9932729f3065bc97a/78bce/grinding.jpg 5100w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Putting that subscription to use
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There’s a whole industry built around preparing for technical interviews. Books, videos, courses, websites, you name it. I would stick to &lt;a href=&quot;https://leetcode.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LeetCode&lt;/a&gt;. LeetCode is a highly convenient place to practice exercises similar to the ones you’ll encounter.&lt;/p&gt;
&lt;p&gt;LeetCode has a ton of exercises, though. It’s easy to get lost. You read horror stories of people that spent months doing it full time. I don’t think you need to get to those extremes to have success.&lt;/p&gt;
&lt;p&gt;Aim for breadth. I used LeetCode to develop a broad portfolio of techniques you can apply to any problem. Some concrete recommendations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cover a variety of structures, like Arrays, Hashes, Linked Lists, Heaps, Trees, or Graphs&lt;/li&gt;
&lt;li&gt;Cover a variety of techniques, like Binary Search, BFS/DFS, Sort, Backtracking, or Sliding Windows&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Other structures like Tries or &lt;a href=&quot;https://en.wikipedia.org/wiki/Disjoint_sets&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Disjoint Sets&lt;/a&gt; make some difficult problems super easy. It’s never a bad idea to expand your toolkit.&lt;/p&gt;
&lt;p&gt;Certain algorithms are just too hard to implement in the context of an interview. Nobody other than a sadist will ask you to write a Red-Black Tree in an interview. Then you have some edge cases, like Dynamic Programming. Google is supposed to like them a lot. Get familiar with some of them, but remember that plenty of people struggle mightily solving them.&lt;/p&gt;
&lt;p&gt;LeetCode categorizes problems as &lt;em&gt;easy/medium/hard&lt;/em&gt;. I doubt you will pass an interview for BigTech if you can only handle easy problems. If you are good at finishing medium problems, you’re probably good to go. If you can reliably solve hard problems under the constraints of an interview you probably don’t need my advice.&lt;/p&gt;
&lt;h3&gt;Speed is Key&lt;/h3&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0db5e10bee26e511d7e5ac70c44fd24a/d2602/kotlin.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAC/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABJG0JjR//xAAbEAACAQUAAAAAAAAAAAAAAAAAAgEDBBARJP/aAAgBAQABBQJmpy+7c5iM/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAABBAMBAAAAAAAAAAAAAAACAAEzkRIgIVH/2gAIAQEABj8CLIXfvqiK1Gd6f//EABoQAAICAwAAAAAAAAAAAAAAAAABESEQQZH/2gAIAQEAAT8hZulutZXDODhB/9oADAMBAAIAAwAAABB8H//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAeEAEAAgEEAwAAAAAAAAAAAAABACERMUFhcZHB8P/aAAgBAQABPxBygpGyhRnhguo9Z+4O/wCvcrFHNuTeW6nhGP/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Kotlin&quot; title=&quot;&quot; src=&quot;/static/0db5e10bee26e511d7e5ac70c44fd24a/acb04/kotlin.jpg&quot; srcset=&quot;/static/0db5e10bee26e511d7e5ac70c44fd24a/bc01b/kotlin.jpg 188w,
/static/0db5e10bee26e511d7e5ac70c44fd24a/bf173/kotlin.jpg 375w,
/static/0db5e10bee26e511d7e5ac70c44fd24a/acb04/kotlin.jpg 750w,
/static/0db5e10bee26e511d7e5ac70c44fd24a/ec605/kotlin.jpg 1125w,
/static/0db5e10bee26e511d7e5ac70c44fd24a/c58a3/kotlin.jpg 1500w,
/static/0db5e10bee26e511d7e5ac70c44fd24a/d2602/kotlin.jpg 4032w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  The king of terse code
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Interviews are short. You have about 15-20 minutes per problem to solve two problems, at best. Minimizing the amount of typing gives you back some valuable time.&lt;/p&gt;
&lt;p&gt;For that reason, I recommend using the highest-level language you’re comfortable with. I don’t know if esoteric languages are a good bet, though.&lt;/p&gt;
&lt;p&gt;Python is a common choice because it’s both popular and high-level. I’m not a C++ person, but it feels a bit too low level. I find Java too verbose (consider using a newer version if you pick it). I don’t like JavaScript as it doesn’t have a very comprehensive standard library.&lt;/p&gt;
&lt;p&gt;I ended up using Kotlin. Similar to Java, but much more succinct. You can use all the standard libraries. I like the language a lot, so it made my preparation easier. I think you should stick to one language, though. Most companies are fairly accommodating in that respect.&lt;/p&gt;
&lt;h3&gt;Share your Thoughts&lt;/h3&gt;
&lt;p&gt;You can’t solve problems silently. Even if you’re correct, you might lose your interviewer. However, don’t mistake this ubiquitous advice for constant talking. Just avoiding silence isn’t good enough.&lt;/p&gt;
&lt;p&gt;You should talk about the options that you’re considering. What are the tradeoffs? Maybe you have a great idea that won’t fit within the interview. Share your thoughts and let the interviewer participate. Many are happy to support you and offer valuable tips and input.&lt;/p&gt;
&lt;p&gt;Once you start coding, shift to discuss why you are doing things. Explain the choices you make in data structures. Walk the interviewer through the structure of the code. Show her a coherent path.&lt;/p&gt;
&lt;p&gt;Talking while coding isn’t easy to practice just by doing LeetCode. Consider walking a friend through a problem, or doing a mock interview.&lt;/p&gt;
&lt;h3&gt;Get Used to Writing Readable Code&lt;/h3&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/cfc3eed1f7a6842ba3bae3045f3c5cda/fc9e0/readable.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAAVcwrmY//8QAFRABAQAAAAAAAAAAAAAAAAAAASD/2gAIAQEAAQUCK//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQEAAwEAAAAAAAAAAAAAAAEAEBEhQf/aAAgBAQABPyHDnrBwkg2X/9oADAMBAAIAAwAAABC3P//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ECf/xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhMWFBcZH/2gAIAQEAAT8QVwlKUUOs65LJPwRdbgwWL6KP/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Readable&quot; title=&quot;&quot; src=&quot;/static/cfc3eed1f7a6842ba3bae3045f3c5cda/acb04/readable.jpg&quot; srcset=&quot;/static/cfc3eed1f7a6842ba3bae3045f3c5cda/bc01b/readable.jpg 188w,
/static/cfc3eed1f7a6842ba3bae3045f3c5cda/bf173/readable.jpg 375w,
/static/cfc3eed1f7a6842ba3bae3045f3c5cda/acb04/readable.jpg 750w,
/static/cfc3eed1f7a6842ba3bae3045f3c5cda/ec605/readable.jpg 1125w,
/static/cfc3eed1f7a6842ba3bae3045f3c5cda/c58a3/readable.jpg 1500w,
/static/cfc3eed1f7a6842ba3bae3045f3c5cda/fc9e0/readable.jpg 5817w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Good variable naming
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The pressure of getting something done quickly will tempt you to take shortcuts. Don’t do that.&lt;/p&gt;
&lt;p&gt;Use good variable names and split chunks into functions. Write idiomatic code. If needed, add a comment or two. It will help you, and it will help the interviewer evaluate you.&lt;/p&gt;
&lt;p&gt;Splitting the code has another benefit; you can tackle things in order of importance. Most interviewers won’t care if you leave boilerplate functions unimplemented. I’ve had interviewers that completed some of my methods while I was writing the core part.&lt;/p&gt;
&lt;p&gt;You won’t have linters or formatters to help produce readable output. It’s on you to get this ingrained as a habit. Doing it naturally means you won’t have to focus on it, which leaves space to focus on other meatier parts of the interview.&lt;/p&gt;
&lt;h3&gt;A Clear Structure&lt;/h3&gt;
&lt;p&gt;Following a clear structure helped me a lot. If you get nervous you might forget important steps. Take this as an example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Understand the problem. State it in your own words.&lt;/li&gt;
&lt;li&gt;Input/Output. Write down some inputs and the outputs. Think of edge cases.&lt;/li&gt;
&lt;li&gt;Approach. Think of an approach, and explain the tradeoffs.&lt;/li&gt;
&lt;li&gt;Code the solution&lt;/li&gt;
&lt;li&gt;Read through your solution carefully. Spot errors&lt;/li&gt;
&lt;li&gt;Test the code. Run a sample input manually&lt;/li&gt;
&lt;li&gt;How does the solution perform? Use the O-notation, for time and space&lt;/li&gt;
&lt;li&gt;Can you improve it?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Notice how coding is just one among many steps. That’s comparable to how you’d approach a problem in real life.&lt;/p&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/fd63d/discipline.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABtBZzz2m//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAECAxETIf/aAAgBAQABBQJz5WVM67ROrHtRdvn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGI/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECMiAxQf/aAAgBAQAGPwKvRpReyuH/xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMUGR/9oACAEBAAE/IYLGvmCz0Dg4K1auo7WMLMG9t/T/2gAMAwEAAgADAAAAEH8f/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EBtb/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxAP/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBgf/aAAgBAQABPxDjcA9kRPl5UKjsU1iQilsMGPAhwEt2uRm+G7axaqa9U//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Discipline&quot; title=&quot;&quot; src=&quot;/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/acb04/discipline.jpg&quot; srcset=&quot;/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/bc01b/discipline.jpg 188w,
/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/bf173/discipline.jpg 375w,
/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/acb04/discipline.jpg 750w,
/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/ec605/discipline.jpg 1125w,
/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/c58a3/discipline.jpg 1500w,
/static/f92eeacb10aa1ba2e28e87a8cd4ee17d/fd63d/discipline.jpg 4100w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Programmers estimating the time complexity of a double loop
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Being disciplined is key. It gives you time to explore the boundaries of the problem. Maybe you misunderstood the problem. Establishing a conversation helps you work on what the interviewer wants, not what you have in mind. Depending on seniority, you won’t pass the interview if you only code a solution without thinking about edge cases and testing the solution by yourself.&lt;/p&gt;
&lt;p&gt;If you don’t find the optimal approach, take any solution that you can think of and iterate. Iterate continuously until you get to a good place. Clear code and discipline help tremendously here.&lt;/p&gt;
&lt;p&gt;Given that you’re diligently preparing, there’s a chance that you get a problem that you’ve seen before. Don’t pretend to struggle and “magically” find the optimal solution. You’ll make an ass of yourself and fail in the process. Be honest in what you know. Let the interviewer change the problem if they need to, but don’t force the issue yourself.&lt;/p&gt;
&lt;p&gt;Learn to do reasonable O-notation estimations on the fly. Nobody is going to expect hard proof in the middle of the interview. A few heuristics go a long way.&lt;/p&gt;
&lt;h3&gt;Don’t Give Up!&lt;/h3&gt;
&lt;p&gt;If you get stuck, don’t panic. Keep trying things, and keep voicing your thoughts. A naive solution is better than no solution. You might think that you’re bombing the interview, but some problems are too big by design.&lt;/p&gt;
&lt;p&gt;If you’re running out of time, explain how you would continue with the parts that are missing. Whatever you do, don’t give up. Even if your performance isn’t great, show as much as possible.&lt;/p&gt;
&lt;h2&gt;What if I Always Get Nervous During Coding Interviews?&lt;/h2&gt;
&lt;p&gt;Welcome to the club! Very few people are naturally good at this. An interview is a stressful situation, no matter what. Preparing well gives you the backbone to rely on when things get rough. Interviewers want you to succeed, for the most part.&lt;/p&gt;
&lt;p&gt;Even if you are well prepared, you’ll fail some interviews miserably. Shit happens. Don’t take it as a personal failure. Everybody has gone through that.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Site Reliability Workbook]]></title><description><![CDATA[Everybody's favorite saga about Site Reliability Engineering is back. This time it comes with plenty of actionable advice.]]></description><link>https://hceris.com/book-review-site-reliability-workbook/</link><guid isPermaLink="false">https://hceris.com/book-review-site-reliability-workbook/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Monitoring]]></category><category><![CDATA[Alerts]]></category><category><![CDATA[On-Call]]></category><pubDate>Mon, 23 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/877fe33b02bca4b4f35c2832599d2ea3/09d21/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAgT/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABrLmprKiNJ0WmzlFB0gX/xAAeEAABBAIDAQAAAAAAAAAAAAACAAEDBBESEBQjM//aAAgBAQABBQI2jzrAvWNS/VVW2iOubn1zVcNAWG4//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAESEP/aAAgBAwEBPwGkIlZ//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAESEFH/2gAIAQIBAT8Bh9GW8//EACQQAAIBAgMJAAAAAAAAAAAAAAABAhESAyIyICExQVFhcZGh/9oACAEBAAY/As0PhoXopg2uPcn5OKqZuo3dGjNUCjae/lsf/8QAHBABAAMBAAMBAAAAAAAAAAAAAQARITFBUWHB/9oACAEBAAE/IRYG9WLMSkLdvZakiTY66y2uHtcBkC2IawS9jd+TEdApjxPgQyf/2gAMAwEAAgADAAAAECcRQ//EABcRAQEBAQAAAAAAAAAAAAAAAAERADH/2gAIAQMBAT8QbcypctghDf/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxAQgRxgZVdb/8QAHhABAQEAAQUBAQAAAAAAAAAAAREAITFBUXHRwfH/2gAIAQEAAT8QY99EJfeaBzxX409JTEh7P3TLx0JmaAdA7giOz1NJ+EF4xuVuvU/NXoFCHM85BhKb+VgCAHrf/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Site Reliability Workbook&quot; title=&quot;&quot; src=&quot;/static/877fe33b02bca4b4f35c2832599d2ea3/09d21/cover.jpg&quot; srcset=&quot;/static/877fe33b02bca4b4f35c2832599d2ea3/bc01b/cover.jpg 188w,
/static/877fe33b02bca4b4f35c2832599d2ea3/bf173/cover.jpg 375w,
/static/877fe33b02bca4b4f35c2832599d2ea3/09d21/cover.jpg 540w&quot; sizes=&quot;(max-width: 540px) 100vw, 540px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://sre.google/workbook/table-of-contents/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Site Reliability Workbook&lt;/a&gt; is the successor of &lt;a href=&quot;https://sre.google/sre-book/table-of-contents/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Site Reliability Engineering&lt;/a&gt;. In the first book, Google introduced its vision of site reliability to the world, launching countless discussions about the distinction between SRE and DevOps.&lt;/p&gt;
&lt;p&gt;One common criticism of that treaty was that it was hard to apply for organizations with fewer resources than Google. The second book aims to fix that. This time around, they’re focusing on discussing practices that anybody can implement to become more effective at operating live systems.&lt;/p&gt;
&lt;h2&gt;So Much Content&lt;/h2&gt;
&lt;p&gt;This book is a gigantic &lt;code class=&quot;language-text&quot;&gt;HOWTO&lt;/code&gt; on how to implement SRE. There’s a good amount of theory, there’s is source code, and there are case studies. It covers three areas throughout its almost 500 pages:&lt;/p&gt;
&lt;h3&gt;Foundations&lt;/h3&gt;
&lt;p&gt;Foundations are the base building blocks you’ll use daily if you adopt an SRE approach. SLOs, monitoring, toil, and a call for simplicity in software architecture.&lt;/p&gt;
&lt;h3&gt;Practices&lt;/h3&gt;
&lt;p&gt;What kind of practices help to continuously improve and iterate? Having a healthy On-Call rotation for one. Handling incidents in general features prominently, including reflecting on causes and next steps in postmortems.&lt;/p&gt;
&lt;p&gt;Interestingly, how to handle configuration is another big topic here. I was pleasantly surprised to learn that Google emphasizes manageable configuration definitions. They mention &lt;a href=&quot;../templating-concourse-pipelines-with-jsonnet/&quot;&gt;jsonnet&lt;/a&gt; as a tool to handle that complexity.&lt;/p&gt;
&lt;h3&gt;Processes&lt;/h3&gt;
&lt;p&gt;The last part of the book is about processes. How should an SRE team engage with other teams? How do they recognize if the time for collaboration is over? In a way, this section reminds me of another book, &lt;a href=&quot;../book-review-team-topologies/&quot;&gt;team topologies&lt;/a&gt;. I’ve lost count of how many times I’ve said that a platform team and an enablement team have completely different mandates. This part really resonated with me.&lt;/p&gt;
&lt;h2&gt;Let’s Talk About SLOs&lt;/h2&gt;
&lt;p&gt;Chapter 5 focuses on &lt;a href=&quot;https://sre.google/sre-book/service-level-objectives/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;service level objectives (SLOs)&lt;/a&gt;. It’s by far my favorite chapter. I’ve re-read it over and over. I’ve spent a lot of time thinking about alerts over the past year.&lt;/p&gt;
&lt;p&gt;Understanding how to implement &lt;a href=&quot;../multiwindow-multi-burn-rate-alerts-in-datadog/&quot;&gt;multiwindow, multi-burn-rate alerts&lt;/a&gt; improved my quality of life massively when I was on a project that suffered from poor alerts. And let me tell you, it’s not an easy thing to understand. Don’t underestimate the complexity behind implementing high-quality alerts.&lt;/p&gt;
&lt;p&gt;This book is the best source to understand SLOs. It’s worth getting just for this chapter alone.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;This book covers a lot of ground. There’s a lot to unpack, much of it extremely actionable. I’ve found myself coming back to it a lot lately. It seems to have more sticking power than the first book. I think it’s a very recommendable read. It gets ⭐⭐⭐⭐ stars from me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Making a Microservice More Resilient Against Downstream Failure]]></title><description><![CDATA[With the help of resilience4j, I've built a fallback cache to significantly increase the fault tolerance of a service with multiple downstream dependencies]]></description><link>https://hceris.com/making-a-microservice-more-resilient-against-downstream-failure/</link><guid isPermaLink="false">https://hceris.com/making-a-microservice-more-resilient-against-downstream-failure/</guid><category><![CDATA[Software Engineering]]></category><category><![CDATA[Monitoring]]></category><category><![CDATA[DataDog]]></category><category><![CDATA[Netflix]]></category><category><![CDATA[resilience4j]]></category><pubDate>Sun, 08 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bac49ffc53ee0d99335d4d22563fc285/c6da0/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAME/9oADAMBAAIQAxAAAAG+WclrJj//xAAWEAEBAQAAAAAAAAAAAAAAAAABABD/2gAIAQEAAQUCcIwv/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAES/9oACAEDAQE/AZRKP//EABYRAAMAAAAAAAAAAAAAAAAAAAACE//aAAgBAgEBPwGjFGP/xAAYEAADAQEAAAAAAAAAAAAAAAAAATEgQf/aAAgBAQAGPwLpWV4//8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBEDFR/9oACAEBAAE/IW7QZFiSTB//2gAMAwEAAgADAAAAEHjf/8QAFREBAQAAAAAAAAAAAAAAAAAAAGH/2gAIAQMBAT8Qgg//xAAYEQACAwAAAAAAAAAAAAAAAAAAEQEhUf/aAAgBAgEBPxCxMnQ//8QAHBAAAgEFAQAAAAAAAAAAAAAAAAERECExYaHR/9oACAEBAAE/EFnNrTG2T+odxnT/AP/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Resilience&quot; title=&quot;&quot; src=&quot;/static/bac49ffc53ee0d99335d4d22563fc285/acb04/cover.jpg&quot; srcset=&quot;/static/bac49ffc53ee0d99335d4d22563fc285/bc01b/cover.jpg 188w,
/static/bac49ffc53ee0d99335d4d22563fc285/bf173/cover.jpg 375w,
/static/bac49ffc53ee0d99335d4d22563fc285/acb04/cover.jpg 750w,
/static/bac49ffc53ee0d99335d4d22563fc285/ec605/cover.jpg 1125w,
/static/bac49ffc53ee0d99335d4d22563fc285/c58a3/cover.jpg 1500w,
/static/bac49ffc53ee0d99335d4d22563fc285/c6da0/cover.jpg 5231w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I like thinking about monitoring and &lt;a href=&quot;../monitoring-alerts-that-dont-suck/&quot;&gt;alerting&lt;/a&gt; a lot. &lt;a href=&quot;../multiwindow-multi-burn-rate-alerts-in-datadog/&quot;&gt;SLOs&lt;/a&gt; have been one of my latest obsessions over the past few months.&lt;/p&gt;
&lt;p&gt;However, all these metrics are worthless if left unattended! Worse than worthless. If you have comprehensive alerts that don’t get fixed, you’ll get swamped by a barrage of alerts.&lt;/p&gt;
&lt;p&gt;That’s precisely what I want to talk about. This post covers making services more tolerant against downstream failures, using the wonderful &lt;a href=&quot;https://resilience4j.readme.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;resilience4j&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Instability Can Ruin Your Day&lt;/h2&gt;
&lt;p&gt;In my last project, I maintained a service with high visibility. The service didn’t own any data, relying instead on several downstream dependencies. Sadly, these dependencies were very unstable and experienced frequent downtime. The issues propagated to our service, causing errors. It made us look bad. Check these error spikes:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7f3bcb3cae324c2e4659cb809e83ecb3/e67a8/errors.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxklEQVR42lWS22sTQRTG9/9/ERF8bxGRWvSpD30RQQXthTRJ20iMoWlis9kkzV6yczuXT2c3KfVjGM5tZs78OIkPYZPnRVFa57wP221dG2OsA6CK53trAAghOOeZOWFm65w0UlXZSQNr9OMJJWaS6MYInuJIiNg5H+9GrAus/QWuM1xmGCz111qHa71ZUDfT26X+XKmnWNYsJBAaZfa+gCXUQR8qfdPHYR8fvq8Pu/J+gIMujm7x9qx6d60HPZyMMMm19EqCBJBhWl9Mw2Buhyu9frC9P743LiZnV1fj4vLe9u/KzqQeDmadu21/5s/uTDfVzsxVThJR2EBSbsjZBkzbkvy3VPZB3dkqUE2IKC/K2jrvfSACINpUNVBElSMqNDRjShXOe9vSFhHvvTxRftLeBkBEz1Ot2dKmEAJ2T+2TQBiPwDy5n/246KTZUleZcAN6r3g4BKKm253aUXB18fIFrBn+Hn8+PZ2nc/r2RSOU9v87JSpqqpJNbvOVeOMeU/a1Of+6ef3KZVP2VXVz/un4aPTxmNZz3izcJlVbufJRhBOQlovSmdwus2BN7DmOU2xAmIXJGDedzsqqiikRYYKwEP2j/RdI867i/q8ZugAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Error Rate&quot; title=&quot;&quot; src=&quot;/static/7f3bcb3cae324c2e4659cb809e83ecb3/1d69c/errors.png&quot; srcset=&quot;/static/7f3bcb3cae324c2e4659cb809e83ecb3/4dcb9/errors.png 188w,
/static/7f3bcb3cae324c2e4659cb809e83ecb3/5ff7e/errors.png 375w,
/static/7f3bcb3cae324c2e4659cb809e83ecb3/1d69c/errors.png 750w,
/static/7f3bcb3cae324c2e4659cb809e83ecb3/78797/errors.png 1125w,
/static/7f3bcb3cae324c2e4659cb809e83ecb3/aa440/errors.png 1500w,
/static/7f3bcb3cae324c2e4659cb809e83ecb3/e67a8/errors.png 1740w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Shit is hitting the fan
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Not only were our users getting a mediocre experience, but our &lt;a href=&quot;https://github.com/sirech/talks/blob/master/2021-11-devoxx-humane_on_call_alerting_doesnt_have_to_be_painful.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;On-Call&lt;/a&gt; rotations were becoming a shitshow. We &lt;em&gt;had&lt;/em&gt; to do something about it. It was leading to a dangerous spiral that could only end in burn-out.&lt;/p&gt;
&lt;h2&gt;Enter Resilience4j&lt;/h2&gt;
&lt;p&gt;Our service is written in Java. That makes &lt;code class=&quot;language-text&quot;&gt;resilience4j&lt;/code&gt; a natural fit. In case you don’t know, it’s a library written by Netflix focused on fault tolerance. As a bonus, it’s based on &lt;a href=&quot;https://www.vavr.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Vavr&lt;/a&gt;. Thus, it benefits from things like the &lt;a href=&quot;../kotlin-either-types-instead-of-exceptions/&quot;&gt;Either type&lt;/a&gt; and all that good stuff. It’s right up my alley.&lt;/p&gt;
&lt;p&gt;To prevent the nasty error spikes I showed above, we’re focusing on two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Using resilience operators to make our microservice a better-behaved citizen&lt;/li&gt;
&lt;li&gt;Building a fallback cache to prevent downstream errors from affecting our users&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Using Resilience Operators&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;resilience4j&lt;/code&gt; provides a bunch of &lt;a href=&quot;https://resilience4j.readme.io/docs&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;operators&lt;/a&gt; out of the box that increases the fault tolerance of your remote calls. One big plus of this library is its composability. There’s little difference between using a &lt;a href=&quot;https://resilience4j.readme.io/docs/retry&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Retry&lt;/a&gt; alone or piping other operators like a &lt;a href=&quot;https://resilience4j.readme.io/docs/circuitbreaker&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CircuitBreaker&lt;/a&gt;. I’m not getting into the details of how they work, head over the documentation to get more details.&lt;/p&gt;
&lt;p&gt;If you use &lt;a href=&quot;https://spring.io/projects/spring-boot&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spring Boot&lt;/a&gt;, there’s support for using annotations. There’s always support for annotations if SpringBoot is involved. Interestingly enough, I feel the annotations create a bit too much duplication. See, I wanted to apply a common set of operators to six or seven remote calls. Annotating the methods and adding the fallbacks led to a messy solution.&lt;/p&gt;
&lt;p&gt;Instead, I built a small abstraction, a &lt;em&gt;FallbackCache&lt;/em&gt;. Before we consider the caching part, let’s focus on instantiating these operators. The code is quite declarative:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Retry&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MeterRegistry&lt;/span&gt; meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;RetryRegistry&lt;/span&gt; retryRegistry &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RetryRegistry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofDefaults&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;TaggedRetryMetrics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofRetryRegistry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;retryRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bindTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; retryRegistry&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;retry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;CircuitBreaker&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getCircuitBreaker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MeterRegistry&lt;/span&gt; meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;CircuitBreakerRegistry&lt;/span&gt; circuitBreakerRegistry &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CircuitBreakerRegistry&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofDefaults&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;TaggedCircuitBreakerMetrics&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofCircuitBreakerRegistry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;circuitBreakerRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bindTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; circuitBreakerRegistry&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;circuitBreaker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are a vast amount of settings that you can configure. The default settings work well to get started. On top of that, I’m adding metrics for &lt;a href=&quot;https://micrometer.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;micrometer&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Building a Fallback Cache&lt;/h2&gt;
&lt;p&gt;Building resilience operators is only one part of the equation. Yes, we’re retrying failed requests automatically. Thanks to the circuit breaker we won’t &lt;a href=&quot;https://en.wikipedia.org/wiki/Denial-of-service_attack&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DDOS&lt;/a&gt; downstream services. But the user won’t care. As it is, the errors propagate back to them.&lt;/p&gt;
&lt;p&gt;My answer is a fallback cache. The flow is as follows:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fd7c91df342709089cd09900c79b04a6/7db30/degradation.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 76.59574468085107%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPklEQVR42oVTa3PaMBDM//9VTafpx0LSdKalkFKMjZFfkvWwrNd2dAECnT40s5blk9a63bs7AAghoVMBVauw2R3xY9+iZCPaMcDYkLcgpQRtJsQYL+trnL/dnRdEHCMhxkQHhRBo2xbGGPR9j311gHMefxpnnrv8mKyFMfbmz0opIslk8zyDc4FD1YALAeccWtXiIA4E69/OEmHXc7wUWzBTUsB5D845+n7AMAxEmvHSfIXSEtM04XH/hIf1R3zYPIBbfk2YMAqJihU4ij28c7CTgVbyBAU7WUg9ohy2sNYS4agEuOQEqSRlQSln1hAC2DBh/bPBaltjvWPY7BjNQjnEEBBCRHARs3Pw3sP7gHBCXmeOi4Z5+JhgZ4fZBYIPCQMfwZoWWmvSNJuSnf7buGh4vuVVCCnFiylIiYyrmg5cjK86RwcbJoKP/pYwb/6+2aIzDAkxn6eSYYyRKVmz2VqMu4LeU0hYsRXefbvH/eo9Cl7cEhozoW5q7PiKbpZiwDQZqJMpWbfZGHTLJyLO+nHNUfOaICeJFFPO69WUnJYYDbpO4dgOYBkdR9uPEFKThhlzirQ362m0gTWWKkArTe7fmCJMwO7QYl/3KJmguWpG6Pmt1YaB023/acp1L/4+3GwJuSyyLGVVQyr9/9bLB2rWIp0CuY9zWnVdU8fkos2ETdejHzjV3p6X+Fw+47n8gkY1t6boyeJltUb/aXEJSCmJbBxHasVgLfhiieB9rioUQ4FFscSyeMRRHi+EvwB7pImi2u/ZFQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Fallback flow&quot; title=&quot;&quot; src=&quot;/static/fd7c91df342709089cd09900c79b04a6/1d69c/degradation.png&quot; srcset=&quot;/static/fd7c91df342709089cd09900c79b04a6/4dcb9/degradation.png 188w,
/static/fd7c91df342709089cd09900c79b04a6/5ff7e/degradation.png 375w,
/static/fd7c91df342709089cd09900c79b04a6/1d69c/degradation.png 750w,
/static/fd7c91df342709089cd09900c79b04a6/78797/degradation.png 1125w,
/static/fd7c91df342709089cd09900c79b04a6/7db30/degradation.png 1494w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  That&apos;s a happy user
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This boils down to three steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make a call to the downstream service with retries and a circuit breaker&lt;/li&gt;
&lt;li&gt;If the call works, store the result in a cache and return it&lt;/li&gt;
&lt;li&gt;If the call fails, use the cache to serve a fallback so that the user experience isn’t compromised&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Before you ask, caching proactively wasn’t an option as we didn’t have a way to invalidate the cache when the underlying data changed. Anyhow, these three steps map nicely to a class with the following methods:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SyncFallbackCache&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Cacheable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AbstractFallbackCache&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; keySupplier&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAndCache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getFromCacheOrThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RuntimeException&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s go one by one.&lt;/p&gt;
&lt;h3&gt;Making the Call&lt;/h3&gt;
&lt;p&gt;The fallback cache doesn’t do anything on its own, as it’s rather a wrapper. We use a &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Supplier&lt;/a&gt; to pass the operation to perform. We need a key to identify the element in the cache, which uses another supplier for extra flexibility.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; keySupplier&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; decoratedSupplier &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Decorators&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSupplier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAndCache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;withRetry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;retry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;withCircuitBreaker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;decorate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; keySupplier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSupplier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;decoratedSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RuntimeException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getFromCacheOrThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We decorate the supplier with our operators. If the call works, we return the result. If not, there’s a &lt;a href=&quot;https://www.javadoc.io/doc/io.vavr/vavr/0.9.2/io/vavr/control/Try.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Try&lt;/a&gt; wrapping it that looks for something to serve from the cache. An empty cache means we’re out of options, and we can only propagate the error upstream.&lt;/p&gt;
&lt;h3&gt;Store the Result&lt;/h3&gt;
&lt;p&gt;Whenever we get a valid result, we store it in the cache. Let’s assume that &lt;code class=&quot;language-text&quot;&gt;valueSupplier.get()&lt;/code&gt; returns without any errors:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAndCache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/*
    This has the disadvantage that the [get result, cache it] is not atomic. So if two requests try to update the same key at the same time, it might create an undetermined result.

    However, two calls to the same service should return the same value, so we should be able to live with that.

    This is not happening inside the compute method anymore due to problems acquiring the lock that led to significant timeouts.
   */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; valueSupplier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not save result to cache&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cacheable&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This action should be as seamless as possible. We want to avoid blocking anything while we save the data. Moreover, we swallow any error that happens while saving. Failing to save to the cache shouldn’t result in a failed request.&lt;/p&gt;
&lt;h3&gt;Use the Fallback&lt;/h3&gt;
&lt;p&gt;If the supplier didn’t work, our last hope is to find some content in the cache for the associated key. We can show valid, albeit possibly outdated, information to the user. A cache miss ends up with the original exception.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getFromCacheOrThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RuntimeException&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ifPresent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;FallbackCache[%s] got cached value&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; value
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cacheable&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orElseThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;FallbackCache[%s] got an error without a cached value&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                exception
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; exception&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;The Caller’s Perspective&lt;/h3&gt;
&lt;p&gt;As a user, I need to instantiate a &lt;code class=&quot;language-text&quot;&gt;SyncFallbackCache&lt;/code&gt; and call the public method with the operation I want to safeguard.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SyncFallbackCache&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SupplierUserPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SupplierUserPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPermissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; supplierId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id:%s;suId:%s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; supplierId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserPermissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; supplierId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSupplierUserMyInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPermissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, we don’t need to know about what’s happening underneath. It’s pretty nifty. You could argue that the return type isn’t explicit enough, as the method may throw an exception that’s not part of the signature. An alternative is to model it with an &lt;a href=&quot;https://www.javadoc.io/doc/io.vavr/vavr/0.10.0/io/vavr/control/Either.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Either&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Where’s the Cache?&lt;/h2&gt;
&lt;p&gt;I haven’t spoken about the cache. The easiest alternative is using an in-memory cache like &lt;a href=&quot;https://github.com/ben-manes/caffeine&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Caffeine&lt;/a&gt;. Something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MeterRegistry&lt;/span&gt; meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; cache &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Caffeine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recordStats&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expireAfterWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofHours&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;maximumSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token class-name&quot;&gt;CaffeineCacheMetrics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;monitor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meterRegistry&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This approach is convenient yet flawed. Our application runs as a container. Every time it’s restarted, the cache is wiped out. It leads to a bad hit rate percentage, which hovered around 65-70%. That’s not great for a cache and still propagates way too many failures to the end-user.&lt;/p&gt;
&lt;p&gt;We switched to a persistent cache based on &lt;a href=&quot;https://aerospike.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Aerospike&lt;/a&gt; to mitigate the problem. &lt;em&gt;SpringBoot&lt;/em&gt; has some integrations to make this easier:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NavigationRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;AerospikeRepository&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CachedNavigation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Document&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;collection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;navigation_CachedNavigationMenu&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CachedNavigation&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Cacheable&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LegacyNavMenuItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LegacyNavMenuItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; navigation&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LegacyNavMenuItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; navigation&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using the cache for failure scenarios means invalidation isn’t that relevant. The persistent cache made a tangible difference that brought our hit rate percentage to the high 90s. That’s a lot better, isn’t it?&lt;/p&gt;
&lt;h2&gt;A Journey With a Happy Ending&lt;/h2&gt;
&lt;p&gt;Was all this effort &lt;em&gt;worth it&lt;/em&gt;? Hell, yes. Our error rate went from 2% to 0.03%. We’ve set an SLO for the service’s availability of 99,95%. Our rotations became significantly smoother. I had so much time available that I could write blog posts about it!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Designing Data-Intensive Applications]]></title><description><![CDATA[If you want to dive into distributed systems, there's no better choice right now than Designing Data-Intensive Applications]]></description><link>https://hceris.com/book-review-designing-data-intensive-applications/</link><guid isPermaLink="false">https://hceris.com/book-review-designing-data-intensive-applications/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[Distributed Systems]]></category><pubDate>Mon, 07 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/55fae20353acc8a672bc67478bffaae8/41099/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABgBAAMBAQAAAAAAAAAAAAAAAAACAwEE/9oADAMBAAIQAxAAAAHVHbz59XTXPDLUEqNP/8QAGxAAAgMBAQEAAAAAAAAAAAAAAgMAARESEyH/2gAIAQEAAQUCblHsUAktwVu/VjyD66PzAJVz/8QAGREBAAIDAAAAAAAAAAAAAAAAAgARARAh/9oACAEDAQE/ASzUSzfN/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQIBAT8BI3//xAAcEAEAAgIDAQAAAAAAAAAAAAABAAIQERIiQpH/2gAIAQEABj8CQCefkFqbnJvrASpOtTH/xAAbEAADAAMBAQAAAAAAAAAAAAAAAREhQWFRkf/aAAgBAQABPyGGFLiH4XwHwrcEXmvUMorlnTNthQvdHYNvI1o//9oADAMBAAIAAwAAABDsD8D/xAAYEQEAAwEAAAAAAAAAAAAAAAABABARIf/aAAgBAwEBPxAQ1inrl//EABcRAQEBAQAAAAAAAAAAAAAAAAERABD/2gAIAQIBAT8QVcCd/8QAHBABAAMBAQEBAQAAAAAAAAAAAQARITFhUXGR/9oACAEBAAE/EANSKPL2YdXsLdoWgrrAE0K0Wis+ywglgnH5NaUOpXW+Q0SFNpe2Q1iegs59ZdVP5P/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Designing Data-Intensive Applications&quot; title=&quot;&quot; src=&quot;/static/55fae20353acc8a672bc67478bffaae8/41099/cover.jpg&quot; srcset=&quot;/static/55fae20353acc8a672bc67478bffaae8/bc01b/cover.jpg 188w,
/static/55fae20353acc8a672bc67478bffaae8/bf173/cover.jpg 375w,
/static/55fae20353acc8a672bc67478bffaae8/41099/cover.jpg 500w&quot; sizes=&quot;(max-width: 500px) 100vw, 500px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you’re in the mood for a challenging book, then &lt;em&gt;Designing Data-Intensive Applications&lt;/em&gt; (often known as DDIA) is exactly what you need. It packs an insane amount of content inside its ~500 pages. I can’t think of a better candidate to learn about distributed systems at scale.&lt;/p&gt;
&lt;h2&gt;Full Attention Demanded&lt;/h2&gt;
&lt;p&gt;The book covers distributed systems. General knowledge is probably required, otherwise, it will be a bit too much for you. You don’t need to be a Big Data specialist, though.&lt;/p&gt;
&lt;p&gt;Before you start with this one, beware: This is a pretty heavy book to read. Be prepared to read chapters multiple times. I’ve read the consensus chapter quite a few times already, and I still don’t feel confident that I know what’s going on.&lt;/p&gt;
&lt;h2&gt;Each Chapter is a Mini Book&lt;/h2&gt;
&lt;p&gt;There are twelve chapters in the book. Each chapter centers around one main topic, such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Replication&lt;/li&gt;
&lt;li&gt;Partitioning&lt;/li&gt;
&lt;li&gt;Transactions&lt;/li&gt;
&lt;li&gt;Consensus&lt;/li&gt;
&lt;li&gt;Streams&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Most chapters start relatively easy, but they go into extensive &lt;em&gt;depth&lt;/em&gt;. Like, they go up to the very edge of the state-of-the-art. You’ll notice by the number of references to recent research papers.&lt;/p&gt;
&lt;h2&gt;The Oracle of System Design&lt;/h2&gt;
&lt;p&gt;System Design is a big part of interviewing for &lt;a href=&quot;https://en.wikipedia.org/wiki/Big_Tech&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;BigTech&lt;/a&gt; (FAANG and others), starting from senior positions. DDIA touches on several topics that are quite relevant for that kind of interview. Can this book replace the experience of designing distributed systems at scale? No, of course not. But, it’s an excellent way to start building a solid base. Since I read DDIA, I’ve noticed that I pick up more details when I read the engineering blog of some companies.&lt;/p&gt;
&lt;p&gt;Besides, the gigantic list of references for every chapter is an invaluable resource if you want to dive deeper into any of these topics. No kidding, there are like 100 references per chapter.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;Don’t get fooled: If you want to power through the whole book you’re going to invest some serious effort. It’s not some light reading just before going to bed.&lt;/p&gt;
&lt;p&gt;Even then, it’s written clearly and concisely, so it won’t make your life unnecessarily hard. Despite the cognitive load, it’s one of the best purely technical books I’ve read in a while. It gets ⭐⭐⭐⭐⭐ stars from me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Monitoring Tools: 6 to Cover All Your Needs]]></title><description><![CDATA[Here are the six different types of monitoring tools that will give you and your team everything you need to feel confident about your applications' health.]]></description><link>https://hceris.com/monitoring-tools-to-cover-all-your-needs/</link><guid isPermaLink="false">https://hceris.com/monitoring-tools-to-cover-all-your-needs/</guid><category><![CDATA[Monitoring]]></category><category><![CDATA[Alerts]]></category><category><![CDATA[Splunk]]></category><category><![CDATA[DevOps]]></category><pubDate>Thu, 06 Jan 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFLpUpWZwf/xAAbEAACAgMBAAAAAAAAAAAAAAABAgASAxETMf/aAAgBAQABBQLC9Xud947EweT/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAADAQEAAAAAAAAAAAAAAAAAEBExUf/aAAgBAQAGPwKdNVKv/8QAHRAAAgIBBQAAAAAAAAAAAAAAAREAMRAhQVFhcf/aAAgBAQABPyFgAcGs3UPiFToC4jM21Y//2gAMAwEAAgADAAAAEFQf/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxB6yH//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EFiIf//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQXHB/9oACAEBAAE/ELWdwTqr2c4i61CvF52p8lZFFUax8i0VLY6PJ//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alert&quot; title=&quot;&quot; src=&quot;/static/d2068999487c2705ce582a4333c65ea7/acb04/cover.jpg&quot; srcset=&quot;/static/d2068999487c2705ce582a4333c65ea7/bc01b/cover.jpg 188w,
/static/d2068999487c2705ce582a4333c65ea7/bf173/cover.jpg 375w,
/static/d2068999487c2705ce582a4333c65ea7/acb04/cover.jpg 750w,
/static/d2068999487c2705ce582a4333c65ea7/ec605/cover.jpg 1125w,
/static/d2068999487c2705ce582a4333c65ea7/99781/cover.jpg 1497w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Monitoring &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-are-distributed-systems.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;distributed systems&lt;/a&gt; is a complex undertaking. A modern cloud-native architecture contains many moving pieces, and you must observe them all to truly assess a system’s health. For that, you need all the information you can get. As a result, launching an application today without the proper amount of monitoring simply isn’t an option.&lt;/p&gt;
&lt;p&gt;Luckily, there are a plethora of monitoring tools available on the market, covering every possible use case. These products have evolved a lot to provide developers the tools they need to handle all this complexity. They make monitoring accessible and convenient.&lt;/p&gt;
&lt;p&gt;In this post, I want to talk about different types of monitoring tools. I’ll use Splunk’s offerings to show how they help you monitor a system. I believe that a dedicated SaaS monitoring solution is the right choice for many organizations. Therefore, in this post, I’ll give you an idea of the benefits of using one.&lt;/p&gt;
&lt;h2&gt;A Sample Application to Monitor&lt;/h2&gt;
&lt;p&gt;First, let’s consider a sample scenario. I’m thinking of an application setup that’s familiar enough for many people. My goal is to make the different elements easier to picture. This diagram is a good starting point:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 200%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAG+UlEQVR42p2We3BUVx3Hf+EVELW1j9FBW0f7GEZCyfAKhEaeklAmDZhQa3i0HVusjkkBZ8BI1QwjGgen/1iV4VWdlk6ttqVaoW3eISEUAnlu9v26r3Pv3ns3u9kNJHfvuT/n3N0Ni5IWPDPf+f3OOb/7ub/f756zswBTjHfePzfpP1H1XP7CFaXztj+/Z2Z27fTbZ+COx8x7HsqD6ffDivVbvv5YcVnRqo2V87704CK462sL8+4YtnR1OSwu2QxF6yryF5ds/tbytRXfWFyyef7qTU9NX73pKVi5YeutHxyRNYipI6CqZJoc06bp8VFbFy73TmP736nYcffSNeXLSrfunLd8bUXhuvLqu9n6+U+uTMbmCEDv9cKIiwfO2wPuiBcUPQ6yHgWiR0EfTYDDGwCnPwiICEMePwy6ffY60aJ2XK6UaAxAHw5B1C99XggNLfarocJINF6oREcmJesjhUSLFnKyUiipmj3P3c/RkshI7D5Iunm4xqkbVWEYuRg3Hk9cM2KJhBFLJCc1MpowiKoZejxuxJLJm/Yyuh5LJDGWSP4EDIsylZkWIjUty6QmmpT+jyi1brmeETVNE41U6iWwKAVKaZllWWhZlomI1LrzkULLfmEtWJaVC7RhiMh8Rv5UpUNtoGmlgS/dBGTZZSLwdkcmeGpglqaOjaNTTaBHT6JHT9wkt5ZAXzSJJs0WM0WGrGSaAZ5xEdzTOIwHW91Y1+rCn7W4sI6p1YUHWlx4sM2FyYnU7QP/7VXwF+0e/E2XH3/d6cOGC37bP9zls+fMJv4/YBpwpDswCc8C7yjD91wE9zU58eV2D/68jZXttu3BjM9sYtz4LOCNj+LVE/iRT8GWoIrNgQg2B27YpkAE20MqGib9dGDOsbEP2O1oqmNTmgFOICJrTIpa1mfKviHp+PEMsCYLLM/0cGpRi91122Z9dr9zY0xK94NJKZimWUApfYNSeopS+lquEK0TiHgcEY8i4iuI+MdcPxN3klL6Vso0N7DsbCjLNFfsBzWuT9iWaRm0PvrTlZ5f/XKVXjof3p2/c0F7/Ya5H5bJ3LXJGNOkAMaoBvHes3mpeGSGSa0ZY4lk/lhibHbAoX+OBdVXX1lTV3np6QPlPQ1HnnXhsRrSs3fjJ787tOMqHn627yoi5o2Njs0ZUUdnjyXHpkF39X3gqvkmeLZPg4seDSKiAiOKBjimAeeWJ9++CP6+9AdLOk/vLXbsWgkfFb1Y3P3m7qLuZ0R/BKKKBpocASHIA7RWfgGc+wpmhUpgevflgVl8gGsQQ8LrUUk4KQSFUxInHJcF4ZgsisdURXyVCMJR25fFPzBfDAmnmPggdyLg9n8V8PcAjh8/vHv4hw9sPok4Q+ZETRFk7B+SMCIQVHiCclZcjp8jFk84CcO+0CKorngHsB4exP1w/9E+zNdE0fW3JgXrT4+Mv90kG3GFGISTDZmXUzJPUmmb9W0ZiiCnCCeNh32hBVBcevmRJZu81Y9827eKDzTP1kXRe/xfCu7/S4z+9axsxWRiEU62ZJ5YCk9s+9/KZGiGfaECqNw1WLfrRQeWVfW5ARBkXvLzIYLtlyQqhglGBDldmpAuLV2mjLKQES9bci5wy46BJ6tfcPSUVvUfQXx9uhSWfBFRxrgi0yyA2VxfFYjd34y11Fzg8g09jxVvvFJXtOHqVsSOWQzIMiAcoVlAtvmaKKPbL+BvW5xY3+TEQ03D+HLjsPXmJR9qAjG9nmABlFX1HvjRPhdu2tY/hAgghSV/BkKzmdk94glGJQV73Rzuen8Qd59z4t5GN27/p8M63OJEXSCmhwHXb+mt/P7zQ561T/a+iviWXfJUQF1SsN/D4c73+nH7mQF84YMh/O4/+q2GFidGs8Cnn3sXDjWcgT0HzsH51s65hJO8twKyktkH4sMSdgyFsHUwreaBkNXn5lHhJTPoDRbA46XVc5atqVj4wII1X8RrY7OlsDiZ4U2HN2MZNEYUjN+QxVox+VGK1m29p6Rs28OPLll/L05cz2fADITe6kYwy8qXuIx4YrH5JHDNE9+buWL9lq/kf3n+LN7nnyOFRa8uq+xhqhHVioiKLeazQ6zLKjvIlkYi9jrzdaKmgf5QAZSUbbP/yZ44+Qa0NLbOVQTZ+fGHLeh1+sbbWjoN54DTGOofNlqbzxsyR4yzHzQahJOM9pYuY7BvyPAMeyeaPm5PRUTlesDtXwCPl1bBn/78Wl7Q5YGu9q65Mk+0tubzDIhdHRfRNehCx4ATOzu6UQqL2NzYblu25+gfRq/Tix1tXXY7gp5AoZ2do98BFzouwMXO7hmcP/yMRtR9YkioUSWllnBSLeHEWlWK1PIBrlaX1Vo+yNdGxPSeFBZqNRKp5fzhmoDbf+9/ACWrf8ZRA+0sAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;cloud architecture&quot; title=&quot;&quot; src=&quot;/static/4082a29abe6082789afebdea51f6f9b5/01e7c/cloud_architecture.png&quot; srcset=&quot;/static/4082a29abe6082789afebdea51f6f9b5/4dcb9/cloud_architecture.png 188w,
/static/4082a29abe6082789afebdea51f6f9b5/5ff7e/cloud_architecture.png 375w,
/static/4082a29abe6082789afebdea51f6f9b5/01e7c/cloud_architecture.png 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;These are the components involved:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;a href=&quot;https://en.wikipedia.org/wiki/Single-page_application&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;single-page application&lt;/a&gt; serving the front end. This means that a significant part of the interactions are happening in the user’s browser.&lt;/li&gt;
&lt;li&gt;A &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-a-container.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;containerized&lt;/a&gt; back end, providing an API for the front end. If you’re using &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-are-microservices.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;microservices&lt;/a&gt;, it’s going to be a multitude of different services communicating with each other.&lt;/li&gt;
&lt;li&gt;A &lt;a href=&quot;https://kubernetes.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes&lt;/a&gt; cluster running the backend workload. Again, in practice, there’ll be multiple clusters. There are development and production environments to consider. If the system is available globally, there’ll be clusters in multiple regions as well. All that running in the context of a cloud provider, such as &lt;a href=&quot;https://aws.amazon.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS&lt;/a&gt;. Apart from hosting the components mentioned above, other things are likely to be part of the setup: networking, such as virtual networks, gateways, and load balancers; datastores, both SQL and NoSQL; event stream processors; lambda functions.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I could go on, but I think you get the point. There are quite a few things to keep in mind! Now let’s see what kind of monitoring is out there for each piece.&lt;/p&gt;
&lt;h2&gt;A Very Quick Introduction to Monitoring&lt;/h2&gt;
&lt;p&gt;Before I talk about monitoring tools, it’s worth setting the stage talking about monitoring basics.&lt;/p&gt;
&lt;p&gt;At its core, monitoring is about collecting and analyzing information about a running system. The system emits metrics over time that the monitoring solution aggregates. There are many aspects relevant for metrics collection:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Pull vs. push&lt;/strong&gt;: The monitoring system can either fetch the metrics actively or wait for the monitored systems to push the metrics to it.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Native metrics vs. injected agents&lt;/strong&gt;: The monitoring system reads metrics that are native to the system. Alternatively, it injects a software agent that runs alongside the monitored system, producing these metrics so that they can reach the central monitoring system.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sampling&lt;/strong&gt;: How often is the monitoring collecting metrics? The more metrics, the more accurate picture you build. However, it also means more data to store and to move through the system.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tagging&lt;/strong&gt;: Usually, you represent monitoring data as a time series with readings distributed over time. Tags are extra information attached to the data. An example is knowing which server produced a reading.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cardinality&lt;/strong&gt;: Tags are powerful, but if you have many distinct tags with a multitude of possible values, the explosion of combinations makes it hard to store and handle.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I won’t belabor these points too much. Suffice it to say, the metrics are there. The next step is to use a monitoring system to ingest them.&lt;/p&gt;
&lt;p&gt;That’s enough introduction for now. Let’s talk tools.&lt;/p&gt;
&lt;h2&gt;Application Performance Monitoring&lt;/h2&gt;
&lt;p&gt;This is what Wikipedia has to say about Application Performance Monitoring (&lt;a href=&quot;https://en.wikipedia.org/wiki/Application_performance_management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;APM&lt;/a&gt;):&lt;/p&gt;
&lt;p&gt;The monitoring and management of performance and availability of &lt;a href=&quot;https://en.wikipedia.org/wiki/Software&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;software&lt;/a&gt; applications.&lt;/p&gt;
&lt;p&gt;In other words, understanding how an application is behaving in real-time. This type of monitoring applies to the backend API from the example. An APM tool monitors three main metrics:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Rate:&lt;/strong&gt; How many requests has the application received?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Errors:&lt;/strong&gt; What kind of errors happened?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Duration:&lt;/strong&gt; How long do the requests take?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For each metric, you want both depth and breadth. You should be able to dig into one request and analyze it thoroughly. You also need an aggregated view of all the requests to understand how the application is behaving. Remember to avoid focusing only on averages, as they can be &lt;a href=&quot;https://dzone.com/articles/3-performance-testing-metrics-every-tester-should&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;misleading&lt;/a&gt;.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGBNeHSGB//xAAaEAACAgMAAAAAAAAAAAAAAAACAwESAAQT/9oACAEBAAEFAmmXW5ZpTMpcureGagVV/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHxAAAgAFBQAAAAAAAAAAAAAAAAECESExMiJBUZGh/9oACAEBAAY/AotTvyZxdjm3cddzPwanOp//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMWFRccH/2gAIAQEAAT8hLSEOrcyn0Q8EF8nQjSKE6UeG+Ljqf//aAAwDAQACAAMAAAAQzA//xAAXEQEAAwAAAAAAAAAAAAAAAAABEBEh/9oACAEDAQE/EErY/8QAFhEBAQEAAAAAAAAAAAAAAAAAASEQ/9oACAECAQE/EBlz/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBYYGh8P/aAAgBAQABPxB9piNBbG52r55hq0Vsvkmd1UwVnW5rRlZA09xWLFWw47T/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;apm&quot; title=&quot;&quot; src=&quot;/static/e9a11944710a1ffd9394e7a66b34b5e0/acb04/splunkapm.jpg&quot; srcset=&quot;/static/e9a11944710a1ffd9394e7a66b34b5e0/bc01b/splunkapm.jpg 188w,
/static/e9a11944710a1ffd9394e7a66b34b5e0/bf173/splunkapm.jpg 375w,
/static/e9a11944710a1ffd9394e7a66b34b5e0/acb04/splunkapm.jpg 750w,
/static/e9a11944710a1ffd9394e7a66b34b5e0/307d7/splunkapm.jpg 760w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/devops/application-performance-monitoring.html&quot;&gt;www.splunk.com/en_us/devops/application-performance-monitoring.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It’s worth mentioning that Splunk’s APM supports &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-opentelemetry.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OpenTelemetry&lt;/a&gt;, a framework from the Cloud Native Computing Foundation (&lt;a href=&quot;https://www.cncf.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CNCF&lt;/a&gt;) aimed at standardizing the collection of telemetry in software. If you’re worried about vendor lock-in, this is an excellent way of reaping the benefits of a product like this while staying flexible.&lt;/p&gt;
&lt;h2&gt;Real User Monitoring&lt;/h2&gt;
&lt;p&gt;Monitoring tools didn’t always reach the client. Before, the chain ended when the back end sent a response back to the client. What happened in the browser was none of your business. However, times have changed. The prevalence of single-page applications has rendered that approach obsolete. The amount of logic contained in the frontend is too high to remain unmonitored.&lt;/p&gt;
&lt;p&gt;Real user monitoring (&lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-real-user-monitoring.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RUM&lt;/a&gt;) covers just that. It’s embedded in the JavaScript run by the browser and helps you understand how the user interacts with your application.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGFVOV2Gxn/xAAZEAACAwEAAAAAAAAAAAAAAAACAwEEEhP/2gAIAQEAAQUCaw+sNLNMpJVivlhIzNZPJf8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/AUTZ/8QAFREBAQAAAAAAAAAAAAAAAAAAEDH/2gAIAQIBAT8Bp//EAB0QAAIBBQEBAAAAAAAAAAAAAAARAQISMUFRYaH/2gAIAQEABj8CqVdWem59ukl96TN2RXfBN7P/xAAaEAADAQEBAQAAAAAAAAAAAAAAARFBITFR/9oACAEBAAE/IXJhVyhRLYThq3p4haD1bk8Nw4Po94P/2gAMAwEAAgADAAAAEJAP/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxAQpjH/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QMGMX/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFRYUGBsf/aAAgBAQABPxBTT1ggLx5lEM4t8Rj0gFn2RWIXoXlOtxq5oG+xfM3fZs1qwxvqf//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;rum&quot; title=&quot;&quot; src=&quot;/static/749ceaeb44db2ce83d9e7626610c0005/acb04/monitoringtools_1.jpg&quot; srcset=&quot;/static/749ceaeb44db2ce83d9e7626610c0005/bc01b/monitoringtools_1.jpg 188w,
/static/749ceaeb44db2ce83d9e7626610c0005/bf173/monitoringtools_1.jpg 375w,
/static/749ceaeb44db2ce83d9e7626610c0005/acb04/monitoringtools_1.jpg 750w,
/static/749ceaeb44db2ce83d9e7626610c0005/307d7/monitoringtools_1.jpg 760w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/real-user-monitoring.html&quot;&gt;www.splunk.com/en_us/software/real-user-monitoring.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The building block here is the user session. You can follow all user sessions and their click path, which lets you understand how your users are interacting with your software. Given that this part of the application doesn’t run on your servers, you need extra information, such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Which browser is used? &lt;/li&gt;
&lt;li&gt;Where are the users located geographically? &lt;/li&gt;
&lt;li&gt;Which operating system do they use?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Similar to APM, you want both single high-fidelity requests and aggregations.&lt;/p&gt;
&lt;h2&gt;Synthetic Monitoring&lt;/h2&gt;
&lt;p&gt;Developers worry about how a system is working from the inside. Your users won’t see that, though. From their perspective, your application is a black box that either works or doesn’t. &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Synthetic_monitoring&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Synthetic monitoring&lt;/a&gt; simulates the interactions of real users with an application. Synthetics are like high-level tests that run from multiple data centers across the world. They say a lot more about the application’s state than a test executed from a developer’s machine, or even from a &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-ci-cd-pipeline.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CI/CD&lt;/a&gt; agent.&lt;/p&gt;
&lt;p&gt;Keep in mind that a synthetic is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Black-box_testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;black-box test&lt;/a&gt;. It can’t tell you what’s wrong exactly, but it can detect if your users are having trouble reaching your application.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB7DTVFMaM/wD/xAAbEAACAgMBAAAAAAAAAAAAAAAAAQIDERIhIv/aAAgBAQABBQJeloJYLrHU49if/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQIQEf/aAAgBAwEBPwFihtf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEZ/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEQETFBkZL/2gAIAQEABj8Cu9meookJx//EABwQAAMAAQUAAAAAAAAAAAAAAAABESFBUXGBkf/aAAgBAQABPyGKKF3HL2IJX26JCDRTB5aEpqf/2gAMAwEAAgADAAAAELTP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EBDxn//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EKH/xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMWFRodH/2gAIAQEAAT8QDEVZokfHPHUptdF/WGwUW9fZiiMZdlQ4iS1hsocmf//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;synthetic&quot; title=&quot;&quot; src=&quot;/static/ac1857f973e687672676dc69c104b199/acb04/monitoringtools_2.jpg&quot; srcset=&quot;/static/ac1857f973e687672676dc69c104b199/bc01b/monitoringtools_2.jpg 188w,
/static/ac1857f973e687672676dc69c104b199/bf173/monitoringtools_2.jpg 375w,
/static/ac1857f973e687672676dc69c104b199/acb04/monitoringtools_2.jpg 750w,
/static/ac1857f973e687672676dc69c104b199/307d7/monitoringtools_2.jpg 760w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/synthetic-monitoring.html&quot;&gt;www.splunk.com/en_us/software/synthetic-monitoring.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This kind of monitoring is the first line of defense when trying to ensure that your system is available at all times. I see it as continuous end-to-end testing. It applies to both the frontend and the backend components. It depends on what you want to monitor.&lt;/p&gt;
&lt;p&gt;Another aspect of synthetic tests is performance. You can see these tests as a baseline of the expected performance of the system. The historical data allows you to understand the evolution of the performance of the system. If you have the data, you’re able to apply performance improvements and measure their impact effectively.&lt;/p&gt;
&lt;p&gt;Once you have a suite of synthetic tests, it’s natural to see them as an early warning system. If there are issues, the alerts should notify your engineers, as we’ll see when we get to notifications.&lt;/p&gt;
&lt;h2&gt;Infrastructure Monitoring&lt;/h2&gt;
&lt;p&gt;More and more workloads run on the cloud these days. If you practice &lt;a href=&quot;https://infrastructure-as-code.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Infrastructure as Code&lt;/a&gt;, you treat your infrastructure as another artifact managed through code. In that case, monitoring as code is a logical evolution. Even if you provision infrastructure manually, it requires monitoring. &lt;/p&gt;
&lt;p&gt;Infrastructure is a big topic. At a lower level of abstraction, you have things like storage (&lt;a href=&quot;https://aws.amazon.com/s3/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;S3&lt;/a&gt;), load balancing (&lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/application-load-balancer/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ALB&lt;/a&gt;), or computing instances (&lt;a href=&quot;https://aws.amazon.com/ec2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;EC2&lt;/a&gt;). While the cloud provider is responsible for providing and operating this infrastructure, you’re still interested in monitoring what’s running there, as it’s part of your stack. You can do just that with the help of infrastructure monitoring.&lt;/p&gt;
&lt;p&gt;What if you’re running some container orchestration software? I’m thinking, of course, about Kubernetes. Is there an organization out there that doesn’t use Kubernetes right now? Doesn’t seem like it. However, Kubernetes is a complex beast. It’s definitely worth getting a closer look at it through rich monitoring. This doesn’t only mean monitoring the applications running in a cluster. Kubernetes consists of different resource types, such as &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Deployments&lt;/a&gt; or &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/service/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Services&lt;/a&gt;, running on top of &lt;a href=&quot;https://kubernetes.io/docs/concepts/architecture/nodes/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Nodes&lt;/a&gt;. You need to monitor all of them if you want to get the full picture.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVR42m2S7WsTQRDG8/9/9j8Q6YfaYrHB1CYpIoigmEqiYi5NtJJecu93+3K3Ozv7yF7aoujCj5nZheeZ3Z2BJfMuTm6xvlnb9XrNNzdr3mw2fYyiFa9Wqz5GUXQf/2UZRRTvdiBLHwfE3fWrN0M8Pznj6XSC8XiM0WjUc3Fx0RPysD+dTjGZTB65mk5wNZng9fiSP3+Zg8l9HTC5T0nZotGGAfiAlNJrrf1D/YBz7q+60uxFxyFnZg9LtBgQuRk7gnOOrSWQcxBKo6pqSCHQtm2P1hqiEVBK9blWCmkpIFsLR8REDkTuIGitgTUdW9OBmYId/lyefTDE/5eH956d44OgI5qpOkOZ77muMqgmg6grZEmGPMkgG4E8zZHukkMtBLJ9iixJUeYliCiocjDsBdnRTMka33/85PkyQrzbYrlZ4Wj4Ak/PjjFffsOH+TWenZ/gePQSm1+3mL5/i6PzU5xeDtFIeRDkxw7tTFUx6nTLsojRiQSqLpBs73pEVaApcyTbLdI4hpY1qixFchcji2PYTsG78Fw6dLsYkDUzWWXotGQyGp2UMLpFKxXYWahawJEF2Q6qEmh2FUyj4b3rITIgsiybHMZ0i4G13cwaAeuIyZEXRnp5j2PnS135MBPhLJGpX+Vrf1fv+j1m10fvwZ2qw8cePqUoMtRVzqZtIJocWlWQIocWJdq2RnAXdQ6lSjQyg9YVOt2gVTW0KNDKgltZHK5sjP2kwyw5pmBK5Hpz57gnuFtLrJTuY99YOD/MFu/rWx4untBqPwMY89+e4oXxdbCXZQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;k8s&quot; title=&quot;&quot; src=&quot;/static/d43604a02672392c6b90de995bc64645/1d69c/monitoringtools_3.png&quot; srcset=&quot;/static/d43604a02672392c6b90de995bc64645/4dcb9/monitoringtools_3.png 188w,
/static/d43604a02672392c6b90de995bc64645/5ff7e/monitoringtools_3.png 375w,
/static/d43604a02672392c6b90de995bc64645/1d69c/monitoringtools_3.png 750w,
/static/d43604a02672392c6b90de995bc64645/78797/monitoringtools_3.png 1125w,
/static/d43604a02672392c6b90de995bc64645/aa440/monitoringtools_3.png 1500w,
/static/d43604a02672392c6b90de995bc64645/29114/monitoringtools_3.png 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/devops/kubernetes-monitoring.html&quot;&gt;www.splunk.com/en_us/devops/kubernetes-monitoring.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;What about other infrastructure components? Splunk’s got you covered! Let’s say you have a couple of serverless functions (like &lt;a href=&quot;https://aws.amazon.com/lambda/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS Lambda&lt;/a&gt;) that you want to observe. Serverless functions execute on-demand and disappear right after completion. That makes them very flexible, but also harder to monitor. An integrated monitoring system takes that burden out of your hands. Similar to APM, you’re interested in rate, errors, and duration.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVR42p1SW2sTQRTOf/dNUHzygpf2qVTMg1hRUBDUXtDa3cSmJbVN2qTZNEmbTbK7szNzzpz5ZLb2gr554IPDN8x3Lt+pEdPmaDJGPxlTb3guw+HwHyRJIknyF3crHwwSDhpE/KPGjhrx3i42dvZlPT7Az2YTcRyj0WhUCHnzims2EEXRNXf1HkWRtNr7YOb9GrOLnEcIAeD/E+FvEGzVnHNxOs+glBJmgrUWWmuQ0XBkwWTh2EIcAV7CJzjnwM6BvIODh/MigWd2rdBhbI3GTLF0Uq7qlcZi62iKbycZtnsZtvs5vvdy7I0URAQeHmamkG/2YLYGoOOZuFCMuFUj5lhYcGFT2csPoZwKy8Wv+QDdfIxeNkY/n+AkG2OkUjh2cCIgY2HSAjYt4EoSdnw5chB0leBEOnkbpWgQWYxHHSymp4HH1E5wYcdY0KzqMICIoK2BJhM6lmoNQZCZY2KGJxaez+EvDcLx5094//oRng5e4UW/jqV+HY9PVnD36Ak+nq9Xq1FaoSgKeO8lFPkj6OJghGcSJlMtPsS76Rfc6T7E/e5zPOgu4V7nGV4O3+LD5Cta2UElaKxBmqbBSBHxNy4rY9G5yORwsvATZT0T+0WR+UWZ+cxkfqHzCl789amQtd6U2mtjPIdmmG4JaoP2VEl7WqCfWWhjkM0WMMrClgRbcgWjqTqZMF6YShU5ClWEEjd3aC1FwVU4zVKeCbyXcFgbFzuy3K/LyuCNrCZrsjpYq/LlXl02pzsCB8nyTMpCy9msy6fTNphl9zeUB4U+scMdlAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;serverless&quot; title=&quot;&quot; src=&quot;/static/2d0eb4a2f3637a889af79950bb3cdd39/1d69c/monitoringtools_4.png&quot; srcset=&quot;/static/2d0eb4a2f3637a889af79950bb3cdd39/4dcb9/monitoringtools_4.png 188w,
/static/2d0eb4a2f3637a889af79950bb3cdd39/5ff7e/monitoringtools_4.png 375w,
/static/2d0eb4a2f3637a889af79950bb3cdd39/1d69c/monitoringtools_4.png 750w,
/static/2d0eb4a2f3637a889af79950bb3cdd39/78797/monitoringtools_4.png 1125w,
/static/2d0eb4a2f3637a889af79950bb3cdd39/aa440/monitoringtools_4.png 1500w,
/static/2d0eb4a2f3637a889af79950bb3cdd39/29114/monitoringtools_4.png 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/devops/serverless-monitoring.html&quot;&gt;www.splunk.com/en_us/devops/serverless-monitoring.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve been involved in projects where we migrated big, existing applications to the cloud. That’s a process that takes months, if not years. If you have one monitoring tool to observe both domains, that makes your job a little bit easier.&lt;/p&gt;
&lt;p&gt;With a comprehensive view of all layers throughout the stack, establishing a mindset of &lt;a href=&quot;https://www.stevesmith.tech/blog/you-build-it-you-run-it/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;You Build it, You Run It&lt;/a&gt; becomes much more attainable.&lt;/p&gt;
&lt;h2&gt;From Observation to Notification&lt;/h2&gt;
&lt;p&gt;Monitoring allows you to understand the situation of your system. But it requires you to have somebody checking it. Highly available systems can’t afford to wait for somebody to check if everything looks good. That’s too slow in case of an incident. You want the responsible people to know that something is wrong immediately.&lt;/p&gt;
&lt;p&gt;What to do, then? You translate your monitors into detectors, making use of what we know as well as using AI/ML techniques to identify things that we might not know yet. Whenever a metric reaches a certain threshold, the detector triggers an alert which immediately and notifies whoever is responsible without delay. That person then jumps in and, thanks to the comprehensive set of monitoring tools outlined throughout this post, fixes the issue and saves the day. Neat.&lt;/p&gt;
&lt;h3&gt;Beware of Misconfigured Alerts&lt;/h3&gt;
&lt;p&gt;It’s not as easy as it sounds, though. In fact, it’s pretty common to overwhelm engineers by creating a ton of alerts that trigger at any point in time. Or the opposite problem, alerts that sit unacknowledged despite the system being on fire.&lt;/p&gt;
&lt;p&gt;Another problem comes when you try to adjust the thresholds for the alerts. This is a bit of an art. With an incorrect value, an alert either triggers too frequently or never at all. That’s not what you want. The alerts should trigger just often enough to be meaningful.&lt;/p&gt;
&lt;p&gt;Alert fatigue is a real risk when operating an application. If your developers become desensitized to alerts due to false positives, they’ll slowly start paying less attention to the pager. That’s a recipe for disaster.&lt;/p&gt;
&lt;p&gt;If you’ve been in an on-Call rotation before, you probably know the pain of using a substandard tool. &lt;a href=&quot;https://www.splunk.com/en_us/software/splunk-on-call.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;This quote&lt;/a&gt; from Splunk’s On-Call sums it up better than I ever could:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“Make On-Call Suck Less”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVR42m1Sy24TQRDcj88B5YAQgkgELCWxHIGQgAM3PgCRg4lzC8kmtmPLzr5f8+6eQjOGAAojlVba7q6p6ppEa/N1s54jvf5BaZr6NE0RcHV19QjpdYrbmyVubxZYzFcPmN/c0Xq1hTHmWyKlOv/86S0m4xGfnp5iPB5jNBrh5OTkAUdHRzg+Psab0SGePt/Di1f7OHi9j5eHT+L32cEeTSYHUFJdJEQ0VUMDazRb5zwRwznCo+OBXhU4Sye4WH6MOJ+/x8XyA74v3tHl+kuYmyVEPG2qLcrinrXWGPoKm2yJpq3R9wOklGBmhJpSCm3Xoms62EHDGQ928ToKF1prZwkxT+u6QFvn7JkgRIVNcYe6KqCFgDYmEhIzrHUQSkFoDecMrLNwVqFvC9JahPosYeZpU5doq4x9UKJ6tG0b1SljQETw3kNpA6kNtnmOLC+glYL3jDDDTMREO4W/CbPtipkJ1ijkRYEsz9E0TbQcrPZ9H1KM1gcp4Yj/3jB54A9hVVUoyzJ2GKPRtRWGroeQMpI456Ii6xxM00BnW+iygGoyKJFBFhmpug71WUy56zoMw8DeA3Jocb+8RpNnkEJEQngfrQdVYqiwXV+iyu5QFQvU7RJNsSI5NLuUrbVTa22Qy2HYaoOu69EOAo4Iu2fk4g7DThGtKcigWDk4yyFg2v03s8Q5NzXaBCXsrIOUPcpsha6ud4kqHdegY7IuBvSfQxxfgd0RhuZAaKyFGjrcb1ZoywKi72IgoTmoDXWOqf4L7z3Rr5R/AnZkhYF+EyNbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;on-call&quot; title=&quot;&quot; src=&quot;/static/d71a376499d7159727488e1bbcdd8774/1d69c/monitoringtools_5.png&quot; srcset=&quot;/static/d71a376499d7159727488e1bbcdd8774/4dcb9/monitoringtools_5.png 188w,
/static/d71a376499d7159727488e1bbcdd8774/5ff7e/monitoringtools_5.png 375w,
/static/d71a376499d7159727488e1bbcdd8774/1d69c/monitoringtools_5.png 750w,
/static/d71a376499d7159727488e1bbcdd8774/906b5/monitoringtools_5.png 950w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/splunk-on-call.html&quot;&gt;www.splunk.com/en_us/software/splunk-on-call.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A good on-call tool centralizes schedules, reduces unnecessary noise, and ensures that the right person is alerted at the right moment. In a more complex setup, assigning the right person to the correct group of alerts isn’t trivial. Essentially, it’s like a giant calendar where you want to ensure that there’s coverage for any day. Of course, you don’t want to manage that calendar yourself. Instead, you let the tool help you. The organizational help from the tooling makes it much more manageable.&lt;/p&gt;
&lt;h2&gt;Let’s Not Forget Security&lt;/h2&gt;
&lt;p&gt;If you run any software, and that software has at least one user, security is your problem. As countless data leaks remind us all too often, security is a concern that many organizations still don’t take seriously enough. Practices such as &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-devsecops.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DevSecOps&lt;/a&gt; encourage thinking about security right from the start. Security starts with using best practices while developing applications. However, it doesn’t end there. You need constant monitoring to remain one step ahead of adversarial parties.&lt;/p&gt;
&lt;p&gt;One piece of the puzzle is security information and event management (&lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-siem.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SIEM&lt;/a&gt;). You want to identify threats based on all the data that you collect. These threats translate to alerts based on risk. Much like with on-call, alert fatigue is a thing. A tool needs to ensure that unnecessary alerts aren’t reaching your operators.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.170212765957444%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACZUlEQVR42lVSTW8TMRDNr0aCUpW20CLEAQnBgQsnDnBBHACh9kARQohCU6lRsgmhtKXNR5ts1utdez3j8UPebflY6emN59nP49lpOec+/Tw+RrefUC/pSzdJpBu5lzRIkv/iXr8vyeB7g/6gRjfp8/DwEM65ry1r7f79h49wbeWWLK9v4sbqHSyt3cHyxiaW1jbq+Cp3fWUd11dv4+b6JpbW7+Lm2gaWb29iZeOePHj8BNbabouZ93JjYYjFsg8CBAoIAIK/RBZMGFXzWuOoX+Y5IJCEUHkvFXsw+04rhNA+n81wkZ6LtRaD4RDpZIqjo2OcjUYwusC4P0B6cgK7yHA+/IFiPEGZZZhMpzDGQETEEYGZOy0Rac8XC+RaiUjAaDwGrIEzJdIsQ6E1OC8BAcja2tQoVedFUH8iXtj7xpCY27aqECSIhFBveD8c49mX73WsrcPRry6O+7tw0uixIzHf633G6eEBJECI+a9hXBCTWOcAYTz/NsSb3ll92Afg9dYrvN1+gYpiF5uyKsd4/vIpPuzu1EXGCikasvftVOVYKC015wVQKPjZFIWxKI2FzgsolSHXJWxFqCqCdYR8PIKeTqB0KXEfXxleZBqqMJIXBtYLss4+Tt+9AjmHeHOs/GymcDpTmKQac1WgAjD7uI3xzhYYEK0LEFEnjk1blRUq9lJWFMhLCLYM5mIS6r8UHykSLHEwLoJqlhAareHmycSdlve+PVcaaa4lzTVUaVCkc6jJGVxstPeII+G9j+MBfwn2UmsNRKqrsXGO9uIBR8SOSGo4ijc24L9M/4D/gKPOtYejg99a7HsNIiHWWQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;security&quot; title=&quot;&quot; src=&quot;/static/d591ab337e8e8dd614902e7a4b883dbb/1d69c/monitoringtools_7.png&quot; srcset=&quot;/static/d591ab337e8e8dd614902e7a4b883dbb/4dcb9/monitoringtools_7.png 188w,
/static/d591ab337e8e8dd614902e7a4b883dbb/5ff7e/monitoringtools_7.png 375w,
/static/d591ab337e8e8dd614902e7a4b883dbb/1d69c/monitoringtools_7.png 750w,
/static/d591ab337e8e8dd614902e7a4b883dbb/78797/monitoringtools_7.png 1125w,
/static/d591ab337e8e8dd614902e7a4b883dbb/aa440/monitoringtools_7.png 1500w,
/static/d591ab337e8e8dd614902e7a4b883dbb/29114/monitoringtools_7.png 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/enterprise-security.html&quot;&gt;www.splunk.com/en_us/software/enterprise-security.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Another part of security is monitoring suspicious behavior. For that, there’s user behavior analytics (&lt;a href=&quot;https://en.wikipedia.org/wiki/User_behavior_analytics&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;UBA&lt;/a&gt;). Such a system looks for malicious patterns across many users, applying machine learning methodologies so that you catch these threats as early as possible.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVR42kVSyW4UMRCd//8ABBw4cSGgSNw4cAUEh4FEiRLQ0DBLet/s7vbueqg8M0xLT67qsl8tr1bOuS/OOVhrg/eeYoxg31kHtr33HEtgm4jgIsFZe7pn4SMF5z3731be+x/LskApFflRXdcIIaSHXdvy/0TM0MagKQu4rkaIlBJEIpi2CnqScN7frpxza2MMAERjDG02m/SYvzzPobUCxxlMePiTITRFilsxHs86D3oc4Hy4SYRcxTAMsWmaRNK2LcQ4wmiV7O12m9D3PZw16D5eo3z7EtX716ivX6H/cBWMUrDOHQm11omQ25VSgAhwdoYcG5RllcZQVRWkHKHnAs1hj322SdW2ZQFd7YOWglu+EEopo5Tyf3s8z0Ut6Lou2TxXHzy8mSBGgbbtIISA0gZBL8HME6w7ERptoBYd1aJhtIVSGpyEiXkcDPaV1rCccJ6hpwmBE7HKWl9ajiGum67G30MWn+odxNJBnYQ4q40TzmqzsowQ4xnh1NXNCoT1r/093nx6Ea8+P8O7r8+xqzIEx2QxrYcNEdrHIzkuCXD2wYXaI2EIYc3q3d3fxZ8/HynLMpomSSoQlYuj7eTocdB02yrqTSDtIynH59FeHCNcKowxJsKHh4eY/c6w3x9QFgWe8gJtPyAvSjS8RkKgqCqUVY2u71E3TbrDsaLIwzAMvOhJlO9MuN1uw263I0bXdSTGkawxVOQ5NU1Dzjma55nGcSQpJS1sC0HLJEjJPszLwnO//QfTTJLFCk/KegAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;user behavior&quot; title=&quot;&quot; src=&quot;/static/8da2741b278744b77c3ba58dcde8c4cb/1d69c/monitoringtools_8.png&quot; srcset=&quot;/static/8da2741b278744b77c3ba58dcde8c4cb/4dcb9/monitoringtools_8.png 188w,
/static/8da2741b278744b77c3ba58dcde8c4cb/5ff7e/monitoringtools_8.png 375w,
/static/8da2741b278744b77c3ba58dcde8c4cb/1d69c/monitoringtools_8.png 750w,
/static/8da2741b278744b77c3ba58dcde8c4cb/906b5/monitoringtools_8.png 950w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/user-behavior-analytics.html&quot;&gt;www.splunk.com/en_us/software/user-behavior-analytics.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Even if your security hygiene is top-notch, there’s always the chance of a security breach. If this happens, it’s fundamental to preserve evidence. This is the kind of information that you don’t use daily, but you’ll be extremely grateful to have if you ever need it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What did the attacker do? Are you able to trace their steps back?&lt;/li&gt;
&lt;li&gt;What information was accessed? This will have legal ramifications.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABXyYg6BcP/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQIAAwQRExL/2gAIAQEAAQUCdnNm7JiE8rkAfjuYqea//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAMAAgMBAAAAAAAAAAAAAAABEQIxEiFBUf/aAAgBAQAGPwLKcpTp5Md+j1s3Bq+n/8QAHBAAAgIDAQEAAAAAAAAAAAAAAREAITFRcWHR/9oACAEBAAE/ITUTDScLq7xw9kvfglCkyu99hHAOAfsy45n/2gAMAwEAAgADAAAAEEfP/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxAxq//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EBZ//8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUFRoWFxkf/aAAgBAQABPxDPgwwhbxHLQL27JZtKMmz2QmGV6BOjqYzYXkfY54zeGjzP/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;forensics&quot; title=&quot;&quot; src=&quot;/static/ed844698fed55c2286f30d206959ffca/acb04/monitoringtools_9.jpg&quot; srcset=&quot;/static/ed844698fed55c2286f30d206959ffca/bc01b/monitoringtools_9.jpg 188w,
/static/ed844698fed55c2286f30d206959ffca/bf173/monitoringtools_9.jpg 375w,
/static/ed844698fed55c2286f30d206959ffca/acb04/monitoringtools_9.jpg 750w,
/static/ed844698fed55c2286f30d206959ffca/307d7/monitoringtools_9.jpg 760w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/cyber-security/forensics-and-investigation.html&quot;&gt;www.splunk.com/en_us/cyber-security/forensics-and-investigation.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;As you see, there are a few tools here that will let you sleep better at night. Don’t get complacent, though. Tools don’t replace good security practices—they only enhance them.&lt;/p&gt;
&lt;h2&gt;Monitoring as a Platform&lt;/h2&gt;
&lt;p&gt;I wasn’t lying when I said there are many aspects of monitoring to talk about! I’ve presented a whole bunch of monitoring tools here. Each one brings its flavor of monitoring to the table. Even so, there are more tools that I didn’t get to. They’re all very solid products on their own. But your application isn’t a collection of discrete chunks. All these parts are interconnected. A warning in one place might indicate a problem in a completely different spot.&lt;/p&gt;
&lt;p&gt;That’s where the value of an integrated platform like &lt;a href=&quot;https://www.splunk.com/en_us/observability.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Splunk&lt;/a&gt; becomes readily apparent. Monitoring isn’t a checkbox that you mark for individual components. The capability to correlate different metrics, and easily jump between different layers is invaluable if you want to provide a truly reliable service. Give your engineers the right tools, and they’ll feel omniscient.&lt;/p&gt;
&lt;p&gt;Can you build this yourself? Yes, of course. With enough effort, you can replicate the integration. What’s the effort, though? I’m confident in saying that it’s more than you think. I’ve seen more than one organization severely underestimate this undertaking and regret it later. You owe it to yourself to at least consider an existing solution before going that route. As you’ve seen, Splunk covers many if not most monitoring requirements. All the tools I’ve presented in this article are deeply connected. You can jump from a RUM trace to APM with one click. Or easily convert any metric into an alert in On-Call. I can’t stress this point enough: This level of integration is hard to achieve.&lt;/p&gt;
&lt;h2&gt;Log Observer&lt;/h2&gt;
&lt;p&gt;Is log aggregation part of monitoring? When you want to understand everything that happens in a system, the line starts to blur. If you’re observing a certain metric, checking associated logs adds a richer signal. That can only help, right?&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUBBP/EABYBAQEBAAAAAAAAAAAAAAAAAAQAAv/aAAwDAQACEAMQAAABttn2upNGT//EABkQAAIDAQAAAAAAAAAAAAAAAAADAQISEf/aAAgBAQABBQLp0tfMzAx2GWZo/8QAGREAAgMBAAAAAAAAAAAAAAAAAAIBAyEx/9oACAEDAQE/AVSW4RTmn//EABgRAAIDAAAAAAAAAAAAAAAAAAABAhEh/9oACAECAQE/ASTd4z//xAAZEAACAwEAAAAAAAAAAAAAAAAAMQECEiD/2gAIAQEABj8C4muUI//EABsQAAMAAgMAAAAAAAAAAAAAAAABETFBECFR/9oACAEBAAE/IXDfF8s7K7MuPVLU+kUP/9oADAMBAAIAAwAAABAE/wD/xAAXEQEBAQEAAAAAAAAAAAAAAAARAQAh/9oACAEDAQE/ELZLpAd3/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEx/9oACAECAQE/EFbB/8QAHRABAQACAQUAAAAAAAAAAAAAAREAITFRYXGB8P/aAAgBAQABPxCOa764Wwt84dKBIXK109YpIsbTdXid8Wa4gb9zn//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;logs&quot; title=&quot;&quot; src=&quot;/static/99712d8ca670583d227391855ced4a71/acb04/monitoringtools_11.jpg&quot; srcset=&quot;/static/99712d8ca670583d227391855ced4a71/bc01b/monitoringtools_11.jpg 188w,
/static/99712d8ca670583d227391855ced4a71/bf173/monitoringtools_11.jpg 375w,
/static/99712d8ca670583d227391855ced4a71/acb04/monitoringtools_11.jpg 750w,
/static/99712d8ca670583d227391855ced4a71/307d7/monitoringtools_11.jpg 760w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Source: &lt;a href=&quot;https://www.splunk.com/en_us/software/log-observer.html&quot;&gt;www.splunk.com/en_us/software/log-observer.html&lt;/a&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;As I mentioned, the correlation aspect is a welcome benefit of using an integrated platform. If you’re observing an event caught through a metric or trace, a clear tie-in to a log event is going to save you a lot of effort. It’s especially true if you don’t need to spend a lot of effort building this connection because it comes for free as part of an observability platform. That’s convenient.&lt;/p&gt;
&lt;h2&gt;What Did We Learn?&lt;/h2&gt;
&lt;p&gt;Monitoring is not a monolithic concept. As architectures evolve, different domains require a slightly different approach. Cloud-native architectures are a clear example of this. There are many specialized moving parts. They greatly benefit from tools built purposely to monitor them.&lt;/p&gt;
&lt;p&gt;You can build bespoke monitoring for everything you run. But that takes your engineers’ focus away from delivering business value. In my experience, getting a dedicated tool with the full support of the company behind it is generally more cost-efficient than building it yourself. &lt;/p&gt;
&lt;p&gt;There’s another benefit that’s important to mention. An integrated approach enables correlation between signals that come from different sources. Difficult problems rarely stay within boundaries. If your tooling lets you jump from one area to another, it’s going to increase visibility significantly. Breaking silos is a big part of adopting a &lt;a href=&quot;https://www.splunk.com/en_us/data-insider/what-is-devops-and-why-is-it-important.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DevOps&lt;/a&gt; mindset throughout an organization.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.splunk.com/en_us/blog/devops/monitoring-tools-6-to-cover-all-your-needs.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Splunk&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Multiwindow, Multi-Burn-Rate Alerts in DataDog]]></title><description><![CDATA[Multiwindow, multi-burn-rate alerts are the hottest way of building reliable alerts. Let's configure some in DataDog using Terraform]]></description><link>https://hceris.com/multiwindow-multi-burn-rate-alerts-in-datadog/</link><guid isPermaLink="false">https://hceris.com/multiwindow-multi-burn-rate-alerts-in-datadog/</guid><category><![CDATA[Monitoring]]></category><category><![CDATA[Alerts]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[DataDog]]></category><category><![CDATA[On-Call]]></category><pubDate>Mon, 03 Jan 2022 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0e24080f9bd079aa94e2391eb3a810ae/61d5f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 67.02127659574468%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABg1SrSFjhP//EABsQAAICAwEAAAAAAAAAAAAAAAACASEREhMy/9oACAEBAAEFAoUVNjnIvmLLx//EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAEDAQE/AYf/xAAXEQADAQAAAAAAAAAAAAAAAAAAARIh/9oACAECAQE/AW9KP//EABkQAQEAAwEAAAAAAAAAAAAAAAABESIxUf/aAAgBAQAGPwJ44tSYTZ//xAAbEAEAAgMBAQAAAAAAAAAAAAABABExQWEQIf/aAAgBAQABPyG1xfJXdjXgPVSRCTCWaF9Nz//aAAwDAQACAAMAAAAQ/wD/AP/EABgRAAMBAQAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/EFdEfT//xAAWEQEBAQAAAAAAAAAAAAAAAAAAQXH/2gAIAQIBAT8QhYf/xAAfEAEAAgIABwAAAAAAAAAAAAABESEAQTFRYYGhsfD/2gAIAQEAAT8QSibXM/X2yRwKDaZ3ialo2YZpidKv34wyUSJKcHHElB3n/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alert&quot; title=&quot;&quot; src=&quot;/static/0e24080f9bd079aa94e2391eb3a810ae/acb04/cover.jpg&quot; srcset=&quot;/static/0e24080f9bd079aa94e2391eb3a810ae/bc01b/cover.jpg 188w,
/static/0e24080f9bd079aa94e2391eb3a810ae/bf173/cover.jpg 375w,
/static/0e24080f9bd079aa94e2391eb3a810ae/acb04/cover.jpg 750w,
/static/0e24080f9bd079aa94e2391eb3a810ae/ec605/cover.jpg 1125w,
/static/0e24080f9bd079aa94e2391eb3a810ae/61d5f/cover.jpg 1162w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Multiwindow indeed
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I used to pay little attention to automated alerts before. Until I started to be On-Call regularly, that is. Such a powerful motivator! Few things sharpen your thoughts regarding Type I and Type II errors more than waking up at three in the morning due to a misconfigured alert.&lt;/p&gt;
&lt;p&gt;Since then, I’ve &lt;a href=&quot;../monitoring-alerts-that-dont-suck/&quot;&gt;written&lt;/a&gt; and &lt;a href=&quot;https://github.com/sirech/talks/blob/master/2021-11-devoxx-humane_on_call_alerting_doesnt_have_to_be_painful.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;spoken&lt;/a&gt; about alerting. You’d think there’s only so much so can say about the matter. Nothing further from the truth. It turns out it’s a riveting topic.&lt;/p&gt;
&lt;p&gt;My newest obsession is multiwindow, multi-burn rate alerts. I’ve spent a lot of time trying to tune alerts to make my rotations less miserable when the answer was in front of me all along. Check out this post if you want to see how to provision them in DataDog, using Terraform.&lt;/p&gt;
&lt;h2&gt;Multi Burn Rate Multiwindow&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;That’s a lot of multis in one sentence&lt;/em&gt;. But hear me out. I recommend starting with &lt;a href=&quot;https://sre.google/workbook/alerting-on-slos/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Chapter five&lt;/a&gt; of the SRE handbook to get a comprehensive overview. As far as I know, that’s the first place that mentions it.&lt;/p&gt;
&lt;p&gt;You’ll likely read it the first time and stare at it blankly. It happened to me, at least. It’s something to digest slowly, or it won’t make much sense. Go ahead, I don’t mind waiting.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a77765a19d83b9907757fb106daef314/45662/multi-window.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAC4jAAAuIwF4pT92AAABlklEQVR42k2Q3YrbMBCF8/5v0vtelJRtLwoNJWy3bbw4qTdxHP8o+rcsyRrJlrVkU5YOHx8chgPDrFJKUvaUUu8ngClAmM4XwBTCDDDd8X4yY9AGhsEoZQCC93OMyyqltCxLSskYYNxgrMj6i/qZcTlypgXXnGnFzb5ju1OTPxe73aEs2+tVTlNcWWuHYWCMGe0Q0T+K+unTw/kpU0PgYhRy5HIUPZCOXMr6T1Zk2d/t9neen2JMK0IIAKSUPISG9nmN2vXX/eabZFheUY/RzQThqmuP5emQV1X78nJGiN7OZowBgDGaUVdUwy4r9h8+Pj5syjOtj/RyJPWJXI60KUlz5u0RN0Xdda5trXPzynsfYwzBWxtaLF4Oz/V6k29/UQVSOvE/wgkVWIdZ04oepjDfHhZj9N5b6/GVkepUff6+3z4SaSU3Uhoh/sG55sKyK2Vtw+U4TW/leZ6VUs6Bc6CV0lzqXmltjLFCSGNs/xatHa0dx3HspXTOa61v5fvEGJdleXdKqe97hBDGGCEEAO/beZ7vfgVajvVoqujzRQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Multi-Window&quot; title=&quot;&quot; src=&quot;/static/a77765a19d83b9907757fb106daef314/1d69c/multi-window.png&quot; srcset=&quot;/static/a77765a19d83b9907757fb106daef314/4dcb9/multi-window.png 188w,
/static/a77765a19d83b9907757fb106daef314/5ff7e/multi-window.png 375w,
/static/a77765a19d83b9907757fb106daef314/1d69c/multi-window.png 750w,
/static/a77765a19d83b9907757fb106daef314/78797/multi-window.png 1125w,
/static/a77765a19d83b9907757fb106daef314/45662/multi-window.png 1410w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Credit to: https://sre.google/workbook/alerting-on-slos/
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Here’s the TLDR: Having a burn rate measures how quickly you’re exhausting your &lt;a href=&quot;https://www.atlassian.com/incident-management/kpis/error-budget&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;error budget&lt;/a&gt;. Two extra thoughts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Think in terms of error budgets. How many errors are acceptable? Don’t trigger alerts if the budget isn’t at risk.&lt;/li&gt;
&lt;li&gt;Using multiple burn rates makes alerts easier to tune. If a metric needs to track big spikes and sustained increases, it’ll likely have to overcompensate for one or the other.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That being said, this article isn’t about theory. I want to get into the &lt;em&gt;how&lt;/em&gt;. I’m focusing on &lt;a href=&quot;https://www.datadoghq.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DataDog&lt;/a&gt; because it’s the monitoring system I’ve used the most lately.&lt;/p&gt;
&lt;h2&gt;The Initial Attempt&lt;/h2&gt;
&lt;p&gt;After reading about burn rates, I tried to implement them in DataDog. Surprisingly, it didn’t seem possible when I started looking. I only found this talk from &lt;a href=&quot;https://www.youtube.com/watch?v=iAKksNmAZDw&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DevOps Austin&lt;/a&gt; to send me down the right path.&lt;/p&gt;
&lt;p&gt;You &lt;em&gt;can&lt;/em&gt; in fact simulate burn rates in DataDog. There’s a catch, though. DataDog doesn’t have an equivalent to the &lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/querying/functions/#rate&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;rate&lt;/a&gt; function in Prometheus. You don’t have a reliable way of assessing a metric within a specific time frame.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;rollup&lt;/code&gt; &lt;a href=&quot;https://docs.datadoghq.com/dashboards/functions/rollup/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;function&lt;/a&gt; is the closest alternative. Sadly, it’s fundamentally flawed. It evaluates once per window. Let’s say you use a burn rate with a thirty-minute window. With a &lt;code class=&quot;language-text&quot;&gt;rollup&lt;/code&gt;, the metric fails after the full window’s end. That, of course, won’t cut it if you have a critical issue ongoing. What a bummer.&lt;/p&gt;
&lt;h2&gt;Finally, Native Support!&lt;/h2&gt;
&lt;p&gt;I had given in to despair when I got the great news: There’s now built-in native support for burn rates. They’re &lt;a href=&quot;https://docs.datadoghq.com/monitors/service_level_objectives/burn_rate/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;in beta&lt;/a&gt;, but completely usable. And best of all, it’s available through the API.&lt;/p&gt;
&lt;p&gt;I repeat it a lot, and I’m still not tired of saying it: Provision infrastructure with code. Alerting is infrastructure. If we click our way through the UI, whatever we conjure won’t be repeatable. So let’s get down to the code. I’m using my trusty tool &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt;. Any recent version of the &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;provider&lt;/a&gt; will do the trick.&lt;/p&gt;
&lt;p&gt;Let’s talk about the code that we need to build these alerts, bit by bit.&lt;/p&gt;
&lt;h3&gt;SLO&lt;/h3&gt;
&lt;p&gt;The whole thing starts by defining an &lt;a href=&quot;https://docs.datadoghq.com/monitors/service_level_objectives/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SLO&lt;/a&gt;. You can use it in dashboards, but the good stuff comes when we combine the SLO with alerts associated with it.&lt;/p&gt;
&lt;p&gt;This block is parametrized so that we can use it as part of a generic module:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;datadog_service_level_objective&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;slo&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; try(var.enabled, &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;) &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; ? &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; : &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.name
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.type
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;numerator&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.numerator
    &lt;span class=&quot;token property&quot;&gt;denominator&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.denominator
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;thresholds&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;timeframe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;30d&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;target&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.target
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;tags&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.tags
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s instantiate one! We’re leveraging the standard &lt;a href=&quot;https://docs.datadoghq.com/tracing/guide/metrics_namespace/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Trace Application Metrics&lt;/a&gt; for &lt;a href=&quot;https://docs.datadoghq.com/tracing/setup_overview/setup/java?tab=containers&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Java&lt;/a&gt; here. If you instrument your application code with the &lt;a href=&quot;https://github.com/DataDog/dd-agent&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;dd agent&lt;/a&gt; you’ll have them. The most relevant parts in the next snippet are the &lt;code class=&quot;language-text&quot;&gt;numerator&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;denominator&lt;/code&gt;, which form the evaluation metric for the SLO:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;span class=&quot;token type variable&quot;&gt; &quot;error_rate_slo&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;source&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;../../slo&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;enabled&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.enabled

  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;service_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; / P&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;priority_tier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; - Error Rate SLO [&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;slo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;%]&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;numerator&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token heredoc string&quot;&gt;&amp;lt;&amp;lt;-EOT
sum:trace.servlet.request.hits{env:${var.environment},service:${var.service_name}}.as_count()
-
sum:trace.servlet.request.errors{env:${var.environment},service:${var.service_name}}.as_count()
EOT&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;denominator&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token heredoc string&quot;&gt;&amp;lt;&amp;lt;-EOT
sum:trace.servlet.request.hits{env:${var.environment},service:${var.service_name}}.as_count()
EOT&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.slo
  &lt;span class=&quot;token property&quot;&gt;tags&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; concat(&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;env:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;service:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;service_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;, var.tags)
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;SLO’s express a ratio of positive events. Our metrics gather total hits and errors, so we’ve got to invert the metric. It looks like this:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;(hits - errors) / hits&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;slo&lt;/code&gt; is the target percentage. For instance, it can be &lt;code class=&quot;language-text&quot;&gt;99.9&lt;/code&gt;. Have a look &lt;a href=&quot;https://en.wikipedia.org/wiki/High_availability&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt; to get an idea of the meaning of the number of nines.&lt;/p&gt;
&lt;p&gt;A side note: don’t forget to use &lt;code class=&quot;language-text&quot;&gt;as_count&lt;/code&gt;. The way it computes an aggregation of events is &lt;a href=&quot;https://docs.datadoghq.com/monitors/guide/as-count-in-monitor-evaluations/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;more intuitive&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Burn Rate&lt;/h3&gt;
&lt;p&gt;SLOs have been part of DataDog for some time. Attaching a &lt;a href=&quot;https://docs.datadoghq.com/monitors/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DataDog monitor&lt;/a&gt; to it is the new part. We’re about to do just that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;datadog_monitor&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;slow_burn_rate&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;service_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; - Error Rate SLO [&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;slo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;slow_burn_rate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;x]&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;slo alert&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token heredoc string&quot;&gt;&amp;lt;&amp;lt;-EOT
burn_rate(&quot;${module.error_rate_slo.id}&quot;).over(&quot;${local.slow_time_window}&quot;).long_window(&quot;${local.slow_window_long}&quot;).short_window(&quot;${local.slow_window_short}&quot;) &gt; ${local.slow_burn_rate}
EOT&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; templatefile(&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/message.md&quot;&lt;/span&gt;, &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;service&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.service_name
    &lt;span class=&quot;token property&quot;&gt;environment&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.environment
    &lt;span class=&quot;token property&quot;&gt;notify&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.notify
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;)

  &lt;span class=&quot;token property&quot;&gt;tags&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; concat(&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;env:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;service:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;service_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;, var.tags)

  &lt;span class=&quot;token property&quot;&gt;priority&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.priority_tier

  &lt;span class=&quot;token property&quot;&gt;monitor_thresholds&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;critical&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.slow_burn_rate
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Focus on the &lt;code class=&quot;language-text&quot;&gt;query&lt;/code&gt;. We have the following elements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The id of the SLO created above&lt;/li&gt;
&lt;li&gt;The evaluation time frame (30 days)&lt;/li&gt;
&lt;li&gt;The long window’s length&lt;/li&gt;
&lt;li&gt;The short window’s length&lt;/li&gt;
&lt;li&gt;The burn rate&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We have two burn rates, a quick and a slow one. We’re following &lt;a href=&quot;https://sre.google/workbook/alerting-on-slos/#recommended_parameters_for_an_slo_based_a&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SRE’s advice&lt;/a&gt; for the parameters here:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;locals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;quick_window_long&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1h&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;quick_window_short&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;5m&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;quick_burn_rate&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;14.4&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;quick_time_window&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;30d&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;locals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;slow_window_long&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;6h&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;slow_window_short&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;30m&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;slow_burn_rate&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;slow_time_window&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;30d&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice that we don’t need to adjust the burn rate based on the error rate. DataDog does that for us.&lt;/p&gt;
&lt;p&gt;And that’s about it. If you provision this code, you’ll see an SLO like this one:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8be6dc2ee2eae09b4d98f0c5301901de/89557/slo.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 84.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACRklEQVR42qVUXW/TMBTN/3/nhZcJoSEmBEJoL4h9sVJtICGEpo0xtrVJ2zRN23zYseOPOAddF6a2dAixKx1dX9s5vj6+N0GeF0iSBGmaYp5lmExmSCZTjCcptDYga9v2XjjXwjUtKiEgZY1gVgpcDacYpgVsYyGYgtUt0cA5txErhLaFqhowzlAJiYALiYJLSGWgjYG1Ftpov/k+Wyakg5ctKMsSUkpkWeavPM9yzGZzZFnux1meIy8KH5M85LXWf6Cua4+AWJumwSiOEQ2GHv0oQhgN0Asj9KMB+uTDyK/RHB1MSQivm7wbK6UQCCn9CbwSKEsOzitwLqC0hjFmI+ixSJp1UGIBkVnb+BdiUqFSBkIq/3p/szv5lmQkTYPil4ZkeT9CcnaxUfx/RUAanV9eQSoFnqTQJftvMk/IGIOoKl9fdI/2AWSecDQrEaXFg7JaIaSCnmYlGOdolrrAtc5jPf49tyn2hHTVxlrArXbC+sOsd8p9cUCisZrjuurjvPgObio0rsHX/AJJnfqSoPiyvMYP1sNIjD3BLQ9xVnzznvZM6imss4tO6ZUDPA1f4tHNE3ycf0FhGB7fbuP54A2O0hOkao5n0Wtsh6/wYrgLZjh2x/vY6u1gq7+DqZrjIO3ipgoXGY7yGO+TLt5F+ziOuzhNP2MvPMDR4BiHcQeHcRdHow464xPsRQfojE9xknzyc2/pm+QUh/EHDKuYMmwhTY06y2GlQuscaq0AKiPXLmJVe++1cg5KUyc1fp1AfylqO0ruJ3w3Hxdi0xl8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;SLO&quot; title=&quot;&quot; src=&quot;/static/8be6dc2ee2eae09b4d98f0c5301901de/1d69c/slo.png&quot; srcset=&quot;/static/8be6dc2ee2eae09b4d98f0c5301901de/4dcb9/slo.png 188w,
/static/8be6dc2ee2eae09b4d98f0c5301901de/5ff7e/slo.png 375w,
/static/8be6dc2ee2eae09b4d98f0c5301901de/1d69c/slo.png 750w,
/static/8be6dc2ee2eae09b4d98f0c5301901de/78797/slo.png 1125w,
/static/8be6dc2ee2eae09b4d98f0c5301901de/aa440/slo.png 1500w,
/static/8be6dc2ee2eae09b4d98f0c5301901de/89557/slo.png 1928w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The SLO has two alerts attached to it, for our two burn rates. Unlike with &lt;code class=&quot;language-text&quot;&gt;rollup&lt;/code&gt;, they don’t need a full evaluation window to trigger. Exactly what we need!&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e6894c1eb4aec2158d84c0ec42b25cec/29114/alert-slo.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 28.191489361702125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7UlEQVR42n2RTU7EMAyFe/8TsOYWLJBgww2GxawQMG2nTZP+JmmS5kNJByQ0A5ae7NjOs19SNK2gFR1SKaSUtEJQVjXDOJFs2zZijH8i1cMW0cZmFFL1jNOEXVeObw1CWJxzeO9/LvxHSGCHmwmrpuiHkXle0MYwaofzXNntzWKuqdlx/1Jx9/TB42tHcapqFq15/zzRSUkInnPTkgapvqesz7jLlGvCyGIDz0fFw0FyKGcKtQy5oZMqI8edQmuzE1Z1jr/lJ6KEuO1nYvylpjDe5mZjLMbanLR2JYSQ/ZSe40J4U3qMhPQxYcv+C1J60q/sgoOgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alert SLO&quot; title=&quot;&quot; src=&quot;/static/e6894c1eb4aec2158d84c0ec42b25cec/1d69c/alert-slo.png&quot; srcset=&quot;/static/e6894c1eb4aec2158d84c0ec42b25cec/4dcb9/alert-slo.png 188w,
/static/e6894c1eb4aec2158d84c0ec42b25cec/5ff7e/alert-slo.png 375w,
/static/e6894c1eb4aec2158d84c0ec42b25cec/1d69c/alert-slo.png 750w,
/static/e6894c1eb4aec2158d84c0ec42b25cec/78797/alert-slo.png 1125w,
/static/e6894c1eb4aec2158d84c0ec42b25cec/aa440/alert-slo.png 1500w,
/static/e6894c1eb4aec2158d84c0ec42b25cec/29114/alert-slo.png 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;/figure&gt;
&lt;h2&gt;An Alert That you Can Trust&lt;/h2&gt;
&lt;p&gt;Is all the hassle worth it? You bet it is. Since I’ve replaced our existing alerts with multiwindow, multi-burn rate alerts, I’ve spent close to zero time babysitting them. That’s a welcome change, compared to some of my previous attempts. It comes down to the yin and yang of alerting, false positives, and false negatives.&lt;/p&gt;
&lt;h3&gt;False Positives&lt;/h3&gt;
&lt;p&gt;Having two (or more) windows is a good layer of defense against over-eager triggers. False positives are technically not a bad thing for the business side. I do focus on them a lot because they, in my experience, inevitably lead to slopiness. If you get bombarded with alerts, you’ll start taking them less seriously. Also, I firmly believe that developers willing to spend their time outside of work on-call deserve a decent setup.&lt;/p&gt;
&lt;h3&gt;False Negatives&lt;/h3&gt;
&lt;p&gt;The quick burn rate triggers fairly quickly in case of errors. Don’t worry, you won’t miss anything, especially if you have a tight SLO.&lt;/p&gt;
&lt;p&gt;Moreover, the slow burn rate covers a scenario that often falls through the cracks. A slight increase in errors that persists for a longer period. Good luck tuning a regular alert to account for this without waking you up constantly. Luckily, if you follow this article you won’t have to do that. Listen to somebody that has spent a good chunk of time on-call, get those burn rates online!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Synthetic Monitoring: A Detailed Introductory Guide]]></title><description><![CDATA[Synthetic monitoring is a way of simulating real user behavior in an application by continuously proving that core flows still work]]></description><link>https://hceris.com/synthetic-monitoring-a-detailed-introductory-guide/</link><guid isPermaLink="false">https://hceris.com/synthetic-monitoring-a-detailed-introductory-guide/</guid><category><![CDATA[Monitoring]]></category><category><![CDATA[Alerts]]></category><pubDate>Mon, 06 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5a16052a882928bdfea294d2ad48d0e2/8affb/cover.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.23404255319148%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8UlEQVR42mVTTWsUQRCd3+DFP+B/8OTZHyB4U/wDIgQPIV5iLnpQBDGak/GuyUERRNCIspKNuBHxkBW9mcvmYz/Y6aru6u4nVTM9iTjwtqa7eqpevX5biQhEAkIIyAkWFTFGNLl/ofsnuf/PVN57IAM5A0fzP927RIG0Hxdoo1JUYoBEfwoNkcp7hj7vh49w/8MFbA1XbW2smcHM0KYK55yxYq6xsbuItU+X8fTzNTz+eAk/9t8CCai0akoJ6/2rWB2cx3r/io0etYirrasWCwo9KxFUT/Dg3UUsbJzF0stzuPH8DHq/ntl0HcMDGuLLaA2H9LNh6BlEhNo5i9yyjSLw3mFr+ASbu7fw6vsKXgwW8Xu0jRxbhgomQeDcRL0U3WO2966g9xDVMWjMdj5wMkhIjYah/XA8PsZkOrao6yS6f8KsaKnaakFtMp/P4VwNZte5oyo3R+1oGoPeZMtM4crYRBAmY0negXyN6WyG0eGRSWO2sZGYcTyZYDydWSRipOCNlSPqupsU6rco2Hd7OMh72HzzGteXVtAffDPtK/3p7XzFzdt3sXzvIRaW76C3vWNJ13at69retXjxoQ+qKVlOWWpz6UaO6i1vopvwImYljcVWBcXkOWf7A5RH152GRceCsi4533rw9LmyV0xfcn8B9RqM5OI5eQAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Synthetic Monitoring&quot; title=&quot;&quot; src=&quot;/static/5a16052a882928bdfea294d2ad48d0e2/1d69c/cover.png&quot; srcset=&quot;/static/5a16052a882928bdfea294d2ad48d0e2/4dcb9/cover.png 188w,
/static/5a16052a882928bdfea294d2ad48d0e2/5ff7e/cover.png 375w,
/static/5a16052a882928bdfea294d2ad48d0e2/1d69c/cover.png 750w,
/static/5a16052a882928bdfea294d2ad48d0e2/78797/cover.png 1125w,
/static/5a16052a882928bdfea294d2ad48d0e2/8affb/cover.png 1254w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Have you ever said to yourself, “I’m not completely sure if my users can access my website”? It’s frightening to say it out loud, yet more common than you think. Even if you use strong engineering practices while developing software, there are no guarantees. Your production system could be down with you being none the wiser.&lt;/p&gt;
&lt;p&gt;Unless you actively monitor it, that is. There are many tools to monitor applications. One, in particular, called synthetic monitoring, is a great fit to answer that question. In this post, I’m going to introduce synthetic monitoring to you. We’ll address the following topics:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What synthetic monitoring is, and why it’s useful&lt;/li&gt;
&lt;li&gt;Example scenarios and things to consider when writing synthetics&lt;/li&gt;
&lt;li&gt;Where synthetic monitoring fits in the monitoring ecosystem&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;What Is Synthetic Monitoring?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Synthetic_monitoring&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Synthetic monitoring&lt;/a&gt; is a technique where you run scripted interactions against your application. They simulate the behavior of a user. You execute them continuously at specified intervals. This monitoring doesn’t rely on real traffic to detect issues, thus the term &lt;em&gt;synthetic&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;The individual scripts, which we call synthetic transactions, come in different shapes and flavors. You can run browser-based tests, in which you record interactions performed by a user during a core flow in your application. These are the closest way you have to reproduce user behavior in a controlled fashion.&lt;/p&gt;
&lt;p&gt;If you’re exposing a public API as part of your system, you can go down one level of abstraction and write synthetic tests for it. That way, you have more granular checks. Given that API contracts tend to be more stable than layouts, these tests are less likely to break.&lt;/p&gt;
&lt;p&gt;Lastly, there are some more specialized synthetic test types. You can monitor parts of your infrastructure like DNS servers, SSL certificates, or even WebSocket endpoints through synthetic tests. Again, the added granularity aids debugging.&lt;/p&gt;
&lt;h2&gt;The Value of Synthetic Monitoring&lt;/h2&gt;
&lt;p&gt;Let’s focus on the value of synthetic monitoring. I aim to answer this question: what are the benefits of using this tool?&lt;/p&gt;
&lt;p&gt;By simulating the interactions from real users, you know that your system works correctly, at least for the flows that you test. In a sense, this is akin to &lt;a href=&quot;https://www.browserstack.com/guide/end-to-end-testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;end-to-end tests&lt;/a&gt; that run continuously in production, thus ensuring you get reliable metrics about your system’s availability.&lt;/p&gt;
&lt;p&gt;A key aspect of synthetics is that they run globally. If you use a tool like &lt;a href=&quot;https://www.site24x7.com/synthetic-monitoring.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Site24x7&lt;/a&gt;, any synthetic test that you define runs from a configurable pool of locations distributed across the globe. If your application has a global presence, it’s not enough to know that things work correctly from wherever your office is. There might be issues related to one specific region. If you want to keep your customers happy, I’m sure you’re keenly interested in knowing about this.&lt;/p&gt;
&lt;p&gt;Synthetics also help to measure service-level agreements (&lt;a href=&quot;https://en.wikipedia.org/wiki/Service-level_agreement&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SLAs&lt;/a&gt;). You might use SLAs as an internal tool to measure performance or provide them as a contract with your users. One way or another, it’s valuable to extract SLA measurements from these monitors. With the right tool, this happens automatically without extra effort.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e34b4e0c04d9a27fa70a1d42fc251963/2bef9/availability.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADGElEQVR42k2SS3MbVRCF56cBcZIFOxas+SsU2LBwEopKEXakKBZs2PBYhDJYthyj2JIsS7JN4pRl2QGPxpr3XM19zkfNWHYxVadud8/pvre7j9dNTjm+mjAPIvzgmkUp0VpjnUMp1eD2q6oKay3Oucavz6IoEEI0ds31LJZ5nHD09xuiJEdqQzi/ZnJ2RpqmGK2IopDLywvKhajLYq0hTROqyjV+MPO5mJ6jpMQTpSXJJFd+SLV8iXEgNLilLw1khcbYG99WIEp39z8XGj+IWUiDl19uk7z+GeFvsDhtIf95gYk3EXs/sXjbRse7mGATF3UwUQ8928AEG7j4FSbaR1/9hp53UEEbGR/jmfAA82+d+Bdy0kFdtVBRG9H/leLtLjbrNeTFbBeTDJGzFum7LS5ebzG/7CL8DsX1mDwYkF2f4olUUGQL8lRQSkFeaJJEkStLvlAsSkuclpSquluOUhVxmOEnmqKsyIVCGSjrlpM4aoYahnOULKmcbYburMFojVIS52yDyjm0kogix5/5TC+mTCZnxHHcXKSNxruVQC2JqqJZTLVcTy2fIAgwy23UnDCKyOIY/3DAu14PfzQkOX1DdnZGEYZ4xphlsap5gbOWqsYy1hSqtafVnS+FIDoaE58cU5yfk0+n5JMJYj7H01o1Ira2wmiLUbqBNTexugFZaoqswFVgrKMsFUoblNJ3qHOzXODpeprLRqG29RKOWyVKVzILk+VK6phdcs3/cioOzgO8MCl58UfOUb+i/0ox3JccdiT9juGobxl1HXvdgu9/uWB7SzE+sAx7lnHfMuhaTgaO44HldAA/tKZ4cVnw0bebvPdZmwdftni41uLhaouVL7a5//kOH6xu8+H6Dh9/9zv3Hv3JytoOK2tt7q/ucK/hvOTB2kve/7TNJz928EpjeXYyZn20z9Nxj29G+zwb7fNk1OXxuEaPr4ddng8P+epowONRlyfjHuvDvcauz0fDPdZHezwdjvCiPCdLc4pMkCU5aZIRRQlFWvsZQZA1os/ilOT6hpfGOaWQaGlQpUaVBq0sohD8B/NiVb6dLojqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Availability&quot; title=&quot;&quot; src=&quot;/static/e34b4e0c04d9a27fa70a1d42fc251963/1d69c/availability.png&quot; srcset=&quot;/static/e34b4e0c04d9a27fa70a1d42fc251963/4dcb9/availability.png 188w,
/static/e34b4e0c04d9a27fa70a1d42fc251963/5ff7e/availability.png 375w,
/static/e34b4e0c04d9a27fa70a1d42fc251963/1d69c/availability.png 750w,
/static/e34b4e0c04d9a27fa70a1d42fc251963/2bef9/availability.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Examples of Synthetic Monitors&lt;/h2&gt;
&lt;p&gt;There are plenty of use cases for synthetic tests. Let’s mention some examples:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;User can log in&lt;/em&gt;: Ensuring that users have access to their accounts is crucial. A synthetic can go to the login page, log in, and check that you get to your account profile in a reasonable time frame.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Add items to a shopping cart&lt;/em&gt;: In an e-commerce site, the cart is probably the most important component. A test that simulates browsing through products and adding them to the cart covers that core flow.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Monitor the expiry of the main domain’s SSL certificate&lt;/em&gt;: Even &lt;a href=&quot;https://www.bleepingcomputer.com/news/google/recent-google-voice-outage-caused-by-expired-certificates/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Google&lt;/a&gt; forgets about certificates sometimes.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Things to Consider&lt;/h2&gt;
&lt;p&gt;When writing synthetic tests, there are a few aspects worth considering.&lt;/p&gt;
&lt;p&gt;The practices that you use when writing end-to-end tests apply here. If you need to select elements, pick selectors that are robust and won’t break if somebody slightly modifies the layout. Build assertions to prove that things work correctly, but keep them generic enough to remain resilient.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f35315cd50e67022f322e306b545cdba/2bef9/synthetic-steps.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABSElEQVR42pVSi26DMAzk//9x0opU0IAAeTgJfd107lKlqFI7pJPjxJzts5t1XTGbCbMxcJIQYoYNCU4yti3jer3icrm8BeNOpxMa5xz6acWPsRiWAGMDJEZITEgpIef8MWKMaHwI6IzD6kUvRKISFfDuEzBWRNAEEYyrwIeInNMT2X+hhNM04eu7hXVeNXvVZv3T25bvJcsjOKWItMxIIcB5jy1nFf18PisofJ2otkq4z65nJfRYrYW1Fhwct4FvJNxX+0RojMHxeNT+Gbxt20MPnuuW6Ncgwd5vvPdKwI+7dLvd1B/HSS39ck9bgyTlzHcmbZZlQd/34HBKRSXjuyHsO6iGct+jeZ4xDAPGcXxI8AqMYyHlv6e1YQCnx2zUk8G0zFg03bdaBsW3OpG2XLJ1XYfD4YC2bRWUwP5NeQ/GUqZSQOGg/wsmYPAgL357TgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Synthetic Steps&quot; title=&quot;&quot; src=&quot;/static/f35315cd50e67022f322e306b545cdba/1d69c/synthetic-steps.png&quot; srcset=&quot;/static/f35315cd50e67022f322e306b545cdba/4dcb9/synthetic-steps.png 188w,
/static/f35315cd50e67022f322e306b545cdba/5ff7e/synthetic-steps.png 375w,
/static/f35315cd50e67022f322e306b545cdba/1d69c/synthetic-steps.png 750w,
/static/f35315cd50e67022f322e306b545cdba/2bef9/synthetic-steps.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you write tests that change the state of the system, what happens afterward? Perhaps you need to roll back purchases done by synthetics? Undo certain transactions? Some organizations eschew synthetic tests that change the state of the application. It can be limiting, but it’s a valid option if you don’t have the means to revert modifications.&lt;/p&gt;
&lt;p&gt;Flakiness is the sworn enemy of any journey-based test. If your monitoring fails randomly due to, for example, unpredictable login times, developers will slowly lose trust in the monitoring until they ignore it altogether. &lt;a href=&quot;https://www.atlassian.com/incident-management/on-call/alert-fatigue&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Alert fatigue&lt;/a&gt; is a real risk here. Therefore, it’s better to scale back the amount of synthetic testing if that makes it more reliable.&lt;/p&gt;
&lt;p&gt;For many applications, the interesting stuff happens once you log in to your account. That means that the synthetics need to log in with some credentials. Managing credentials carelessly is a great way to end up with an embarrassing security leak. If you need to use test users, make sure to store the credentials securely and limit the permissions of these users as much as possible.&lt;/p&gt;
&lt;p&gt;Another risk is letting the artificial traffic influence some of your KPIs. Depending on the volume of requests you get, a synthetic that runs every minute from multiple locations can skew the numbers you see in &lt;a href=&quot;https://analytics.google.com/analytics/web/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Google Analytics&lt;/a&gt; or any similar tool. Make sure you work together with the rest of your organization to tag the users and prevent this from happening.&lt;/p&gt;
&lt;h2&gt;Finding a Place for Synthetics in the Monitoring Ecosystem&lt;/h2&gt;
&lt;p&gt;Now that we’ve covered synthetic monitoring itself, I want to touch on one last topic: where does this kind of monitoring fit in your monitoring ecosystem?&lt;/p&gt;
&lt;p&gt;The list of &lt;a href=&quot;https://www.bmc.com/blogs/it-monitoring/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;types of monitoring&lt;/a&gt; is constantly growing. With so many different tools, it’s easy to get lost and struggle to find the right use case for synthetics. I believe the &lt;a href=&quot;https://martinfowler.com/bliki/TestPyramid.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;testing pyramid&lt;/a&gt; presents a useful analogy in this case. Synthetic monitoring sits at the top of the pyramid. It’s a high-level, &lt;a href=&quot;https://en.wikipedia.org/wiki/Black-box_testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;black box&lt;/a&gt;–style type of monitoring. Thus, it follows that you should cover critical user flows with it and avoid using it for low-level metrics that are better suited for other monitoring tools. For example, don’t try to monitor the response time of a single server with synthetics when you can do it with bespoke infrastructure monitoring instead.&lt;/p&gt;
&lt;p&gt;Consider another type of monitoring that sits close to the customer: real user monitoring (&lt;a href=&quot;https://en.wikipedia.org/wiki/Real_user_monitoring&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RUM&lt;/a&gt;). RUM is a tool where you follow sessions based on what every customer is doing in your application. With RUM, you can get a broader perspective on what’s happening in terms of where your users come from, the time they spend on different pages, and the errors they get. If you use an integrated monitoring tool, it should mark the sessions created by synthetic tests appropriately. That way, you won’t extract the wrong conclusions from the data.&lt;/p&gt;
&lt;p&gt;In summary, synthetic monitoring is the cherry on top of your monitoring. You shouldn’t replace base monitoring metrics with it, but rather enhance them with extra tests that cover core business capabilities.&lt;/p&gt;
&lt;h2&gt;Set up Some Synthetics!&lt;/h2&gt;
&lt;p&gt;In this article, I’ve introduced you to synthetic monitoring, a way of simulating user behavior. As you’ve seen, codifying user flows as reproducible tests helps you continuously monitor your application more effectively. While browser-based interactions are the most popular facet, let’s not forget about how you can test APIs, certificates, and other endpoints.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.site24x7.com/learn/guide-to-synthetic-monitoring.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Site24x7&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Applications Instead of Libraries]]></title><description><![CDATA[Using module federation to implement micro frontends]]></description><link>https://hceris.com/applications-instead-of-libraries/</link><guid isPermaLink="false">https://hceris.com/applications-instead-of-libraries/</guid><category><![CDATA[Architecture]]></category><category><![CDATA[React]]></category><category><![CDATA[Micro frontends]]></category><category><![CDATA[JavaScript]]></category><pubDate>Sat, 20 Nov 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bde962ad076eb191a1a8127873ceedb5/7f61c/cover.webp&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRrQAAABXRUJQVlA4WAoAAAAQAAAAEwAADgAAQUxQSB4AAAABF6AgbQOmO64nfjYiIr6CINumGdn92Q4Q0f8IewFWUDggcAAAAPADAJ0BKhQADwA+0VSkS6gko6GwCAEAGglmALsAId9nyVKIvzIqRwAA/u5ncWrG34ByKMWbv6f2BwCmtdAMeJx9cNgczYWvBX1Ew9FmCUl1emJpw/K1zv1eNvyoqkL9P09mJFp2mxbJtwDmV5hwAAA=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Cover&quot; title=&quot;&quot; src=&quot;/static/bde962ad076eb191a1a8127873ceedb5/7f61c/cover.webp&quot; srcset=&quot;/static/bde962ad076eb191a1a8127873ceedb5/7b30e/cover.webp 188w,
/static/bde962ad076eb191a1a8127873ceedb5/f3a60/cover.webp 375w,
/static/bde962ad076eb191a1a8127873ceedb5/7f61c/cover.webp 400w&quot; sizes=&quot;(max-width: 400px) 100vw, 400px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;Contributors: Ben Barnett, Diego Fiore, Verónica Machado, and Will Conover.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In our &lt;a href=&quot;https://www.aboutwayfair.com/careers/tech-blog/applications-instead-of-libraries-part-1&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;previous post&lt;/a&gt;, we talked about the reasons that led us to consider a micro frontend architecture for Partner Home, the supplier portal for Wayfair. Now it’s time to dive into the details.&lt;/p&gt;
&lt;p&gt;In this post, we’re going to talk about how we leveraged Module Federation to implement decoupled applications to improve the experience of our suppliers. An application has a frontend and backend, and it owns a complete flow within our Partner Home portal. We’ll cover how to set up host applications that consume remote ones and how we’ve built micro frontends using this pattern. Lastly, we’ll talk about how we made the setup production-ready.&lt;/p&gt;
&lt;h2&gt;A Start Full of Hope&lt;/h2&gt;
&lt;p&gt;There are multiple ways of implementing &lt;a href=&quot;https://martinfowler.com/articles/micro-frontends.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;micro frontends&lt;/a&gt;, and each has tradeoffs. We decided to use Webpack’s new &lt;a href=&quot;https://webpack.js.org/concepts/module-federation/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Module Federation feature&lt;/a&gt;. These are some of our considerations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;At this point, a good chunk of our traffic still goes to the monolith. We don’t have many decoupled applications to support, yet. Thus, new technology isn’t a huge issue&lt;/li&gt;
&lt;li&gt;We know that every application uses React, which allows us to gear our solution towards it&lt;/li&gt;
&lt;li&gt;Changing the bundling of applications is something that we can control and enforce&lt;/li&gt;
&lt;li&gt;We don’t need to support server-side rendering. React 18 brings &lt;a href=&quot;https://github.com/reactwg/react-18/discussions/37&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;some changes&lt;/a&gt; for that&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With these factors in mind, the seamless integration that you get using federated modules becomes very appealing.&lt;/p&gt;
&lt;p&gt;What we aim for is: Two applications, a host and a remote, integrated to provide a unified experience. It’s important to note that these are independent applications. They have their repository and they have their CI/CD pipeline; and two separate teams are likely responsible for them. This &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;repository&lt;/a&gt; presents a scaled-down version of our solution that illustrates the structure that we follow internally.&lt;/p&gt;
&lt;p&gt;Now, on to the code!&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/6914c0ba13799f168521ac23878676be/6f92b/remote-application.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 81.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADG0lEQVR42oWS/U9aVxjH+df2y/bD1v2wJkuWtZpommVZTNtldHV1ZMtMmyxZFbWKXMApBIcvdFsVqk2bpbajXVPxrV4QuAWkoh2VC1zuhXPPeb4LyGxdbXeST57nvH3ynBeLuhk7kXoamcoVn7v21bKnoKqeglpqcZBn87ue7b29Zv/v4rG4C2ppsqCWPrDoWvVKVdeg12ooVaooljWozVhBWdNRq5vQa6xJIz8Oo85g1OqoGrVeiyDqwUHTOa8zZlYZM/XDyLnBBNWacGEwk78OkTAaAiFEt4ULbiMCiARL781TYmeclN1JSuX9pOz6Sc54KRr30LLsprXEz83xf2msi+fGSNVSvCE0uXnpUCiIs+TOFN15/A3Cf36FmxErFiJW3IxcQOieFXN3rQjft2LhwYUmiw++bs7dXbGRqsVbQtYQisMKUzszFLzzOfyhDgQWzmAy3AnffDu8c+3wXG+Dd/4lvlA7xm+cRuj+eSpVk0eFB+fnLJWfobWnA1iIXMTc0nncfvQt5KwTcmoUcaWB85CY0hh3YkMZoP1K7HihsjtL0eRVOKdPwu59DxPh09halaB5ZvHCPYXtkYkmmeFxPJf80KXrSC866YUhv0GYbwj7MPbrJ3AEPoT/VgeSj10w+qdQ+cmHykAA2nAQ+0PTUEdmwK79jtyciwrHCunlkf9Y/g63/7qEpY0fsBV1I3nWhuipDmQvXkb2bA9S57oxO9oF90gbHs1fprKReHOFK6k+jAXbMOQ9icnFM3jy0IVElw3Ln3ZCsfYi3XkOyc+6MOz6GD2Od3AvbKOKnnq7cND7Eb6/+i6cwVOQH0qo2n9Bud8HbSiAkt0P1e6DLPUjOvwjYiE7FY0j34a/8srTtKr0YebWF5j4rQM3lr6EnHYgvubE1rp0EJtIUFY9yKyMY1MepH3t6B32tP6hruSDbCN9jcnbLhbblthm1smeZEbZRs7xGuu5Ebb+zMHWMoOsWEkYLWG3RQhxhRpGAFzUYXL9PxgwzbfAdRDx1n7Ra+GcnxBCBIQgJxHcANygV8D/QwRJCOE3OX//H2yyQ22tAk7oAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Remote application&quot; title=&quot;&quot; src=&quot;/static/6914c0ba13799f168521ac23878676be/1d69c/remote-application.png&quot; srcset=&quot;/static/6914c0ba13799f168521ac23878676be/4dcb9/remote-application.png 188w,
/static/6914c0ba13799f168521ac23878676be/5ff7e/remote-application.png 375w,
/static/6914c0ba13799f168521ac23878676be/1d69c/remote-application.png 750w,
/static/6914c0ba13799f168521ac23878676be/78797/remote-application.png 1125w,
/static/6914c0ba13799f168521ac23878676be/aa440/remote-application.png 1500w,
/static/6914c0ba13799f168521ac23878676be/6f92b/remote-application.png 1501w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Exporting Modules from an Application&lt;/h2&gt;
&lt;p&gt;Let’s start from the beginning. A remote application provides some components. Another team wants to benefit from those. A tale as old as time.&lt;/p&gt;
&lt;p&gt;The first step to export a module is the Webpack configuration. Do you avoid Webpack configurations like the plague? Do you stick to &lt;a href=&quot;https://reactjs.org/docs/create-a-new-react-app.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CRA&lt;/a&gt; as much as possible? I don’t blame you, but this time there is no way around some Webpack trickery. Luckily, the configuration to export a component is pretty manageable.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModuleFederationPlugin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;remote&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;remoteEntry.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;exposes&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string-property property&quot;&gt;&apos;./Welcome&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./src/Welcome&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;react&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;react&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;@applications-instead-of-libraries/shared-library&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@applications-instead-of-libraries/shared-library&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;../shared-library/package.json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;@material-ui/core&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;@material-ui/core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Full configuration is &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/master/remote/webpack.config.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dependencies are a tricky side of micro frontends. You don’t want to force the users to download React multiple times when loading a page. On the other hand, strong coupling between applications defeats the approach’s purpose.&lt;/p&gt;
&lt;p&gt;In our case, we use shared dependencies. Shared dependencies are a critical bit of configuration to ensure applications work as expected, and are resilient to upgrades in the future.&lt;/p&gt;
&lt;p&gt;Shared dependencies prevent duplication, version mismatching and provide a common internal state. For example, we ensure that React is configured as a singleton, meaning there can be only one instance running at a time. This is true for a bunch of other libraries, such as our component libraries too.&lt;/p&gt;
&lt;p&gt;In a nutshell, we offer all dependencies as potentially shared dependencies. This means that the part of the application to hit the dependency first will load it, and then &lt;a href=&quot;https://stackoverflow.com/questions/65634232/how-does-module-federation-choose-which-dependency-version-to-use&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;make it available&lt;/a&gt; for any other components that might need it later. In practice, this has an additional benefit of progressively loading dependencies, thus reducing initial bytes required.&lt;/p&gt;
&lt;h2&gt;Integrating a Remote Module in an Application&lt;/h2&gt;
&lt;p&gt;Our remote application is live and ready to go. Now it’s time to import some components into the host application. Just like in the previous section, it all starts with a Webpack configuration:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ModuleFederationPlugin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;host&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;remotes&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;remote@http://localhost:3002/remoteEntry.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;react&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;react&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;@applications-instead-of-libraries/shared-library&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@applications-instead-of-libraries/shared-library&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;../shared-library/package.json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;@material-ui/core&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;requiredVersion&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; deps&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;@material-ui/core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token literal-property property&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Full configuration is &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/5442b9c4cbb996bcab0ef9a056be896ecfc3d900/host/webpack.config.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Simple enough, yet highly problematic. Can you spot the issue? That pesky, hardcoded URL! Our applications don’t have one source of truth, as we have multiple environments. Moreover, we need to consider other factors like the locale or the branding. All in all, different permutations are pointing to separate URLs.&lt;/p&gt;
&lt;p&gt;To make it even more challenging, the locale is only available at runtime for us. Our solution is a bespoke component that builds the right URL and fetches the correct modules right before using them. Let’s call it a RemoteComponent.&lt;/p&gt;
&lt;p&gt;Loading modules dynamically requires &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/tree/master/shared-library/src/RemoteComponent&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;quite a bit of code&lt;/a&gt; to find the right bundle through Webpack. There’s a &lt;a href=&quot;https://www.npmjs.com/package/external-remotes-plugin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;module in the community&lt;/a&gt; to enable dynamic loading that looks quite promising.&lt;/p&gt;
&lt;p&gt;Once we have the setup sorted out, it’s time to use a component in our code. We chose to use a dynamic import within a &lt;a href=&quot;https://reactjs.org/docs/code-splitting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React Suspense&lt;/a&gt; wrapper. We have a thin wrapper around Suspense which provides consistent UX patterns for loading and error states.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LazyModule&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDerivedStateFromError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; error &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// log error&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;componentDidCatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;_error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errorInfo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; errorFallback &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isValidElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errorFallback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; errorFallback
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; errorFallback &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;errorFallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Suspense fallback&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;delayed &lt;span class=&quot;token operator&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Suspense&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See the full component &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/master/shared-library/src/LazyModule/LazyModule.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The need for all of this abstraction will become apparent shortly.For now, our hard work is paying off because our component loads dynamically in the browser! You can see how remote modules are loaded afterward here:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ad2fb3d44403abd9fd9c35ecd4a87a11/fad48/remote-loading.webp&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 84.57446808510639%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRlwAAABXRUJQVlA4IFAAAADwAwCdASoUABEAPtFepE6oJSMjKAqpABoJaRLgAACRAgUqXB/2b1KAAP7yUYdPUT4np9NrdtA3GZKIL4o4t6P2th35AkGgtfDaZQe5BUAAAA==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Remote loading&quot; title=&quot;&quot; src=&quot;/static/ad2fb3d44403abd9fd9c35ecd4a87a11/08b4d/remote-loading.webp&quot; srcset=&quot;/static/ad2fb3d44403abd9fd9c35ecd4a87a11/7b30e/remote-loading.webp 188w,
/static/ad2fb3d44403abd9fd9c35ecd4a87a11/f3a60/remote-loading.webp 375w,
/static/ad2fb3d44403abd9fd9c35ecd4a87a11/08b4d/remote-loading.webp 750w,
/static/ad2fb3d44403abd9fd9c35ecd4a87a11/5543b/remote-loading.webp 1125w,
/static/ad2fb3d44403abd9fd9c35ecd4a87a11/293e0/remote-loading.webp 1500w,
/static/ad2fb3d44403abd9fd9c35ecd4a87a11/fad48/remote-loading.webp 1600w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Beyond Single Components: A Frame Application&lt;/h2&gt;
&lt;p&gt;Loading simple components has its value, but it’s not quite micro frontends, is it? There are established ways of sharing UX components (picture &lt;a href=&quot;https://material-ui.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Material-UI&lt;/a&gt;) with, frankly, less overhead.&lt;/p&gt;
&lt;p&gt;The value surfaces as the components evolve toward full-fledged applications. A component that has its state and fetches data from a backend. However, we’ve faced many questions about ownership: If the component needs data, who passes the data? Is the host application responsible? Who owns that backend?&lt;/p&gt;
&lt;p&gt;This is how we ended up with micro frontends. We want to treat a remote application as an entity with its lifecycle. We call them frame applications. It’s a wrapper that encapsulates the remote components until they form a proper application. It looks something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useContext&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;WelcomeFrame&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[private]&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Card variant&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;outlined&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;CardHeader title&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;WelcomeFrame&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;CardHeader&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;CardContent&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Welcome &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;CardContent&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Card&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See the full file &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/master/remote/src/WelcomeFrame.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In our experience, the &lt;a href=&quot;https://reactjs.org/docs/context.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Context API&lt;/a&gt; works beautifully to allow frame applications to handle their state in a lightweight way. It’s important to note that this state is hidden from the host application, providing encapsulation.&lt;/p&gt;
&lt;p&gt;A frame application might want to fetch some data. We want to ensure strong encapsulation so that the host application can’t inadvertently influence this. We use &lt;a href=&quot;https://www.apollographql.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Apollo&lt;/a&gt; to connect with our backends, but this applies to any way of interacting with APIs.&lt;/p&gt;
&lt;h2&gt;Testing a Frame Application&lt;/h2&gt;
&lt;p&gt;You might be asking, &lt;em&gt;“All this sounds great, but how do you test it?”&lt;/em&gt;  Glad we’re on the same page. Testing is crucial. We’re not distributing it as a library, but rather deploying it immediately as an application. If we break something, the mess propagates rapidly. Nobody wants that.&lt;/p&gt;
&lt;p&gt;We follow the &lt;a href=&quot;https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;testing trophy&lt;/a&gt; for our frontend-based tests. The first layer is composed of unit tests. &lt;a href=&quot;https://github.com/testing-library/jest-dom&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jest-dom&lt;/a&gt; can’t handle remote module loading, so we need to mock it.&lt;/p&gt;
&lt;p&gt;We want to confirm that the remote modules load correctly. To do so, we have a thin layer of end-to-end tests on top, built with &lt;a href=&quot;https://www.cypress.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Cypress&lt;/a&gt;. They enhance our unit tests and increase our peace of mind.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Integrated Application&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;shows the integrated remote component&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    cy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;visit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://localhost:3001&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    cy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Host Application&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;exist&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    cy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;The selected locale is de-DE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;should&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;exist&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Where do these tests run? This is where we encounter a slight ownership conflict. The host application and the frame application might be developed by two different teams. Without a clear boundary, expensive handovers are unavoidable.&lt;/p&gt;
&lt;p&gt;To mitigate the issue, we configure each Frame Application to consume its modules remotely so that it works as both host and remote at the same time. We deploy it to our test environment and test against that. That provides the independence we’re seeking.&lt;/p&gt;
&lt;p&gt;This setup has another usage: local development. Iteration speed is paramount, and that’s easier to achieve if we strip all the integrations while a developer is working locally. Our &lt;code class=&quot;language-text&quot;&gt;RemoteComponent&lt;/code&gt; handles that.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8699f404c9d7b0bb549e06065429d573/fad48/remote-application-local.webp&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 81.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRsIAAABXRUJQVlA4WAoAAAAQAAAAEwAADwAAQUxQSCsAAAABL6CQbQQ4dB/W3C4igrAcaiJJYZ5gBSHJAYN/Nd9SR/R/AnKo79H4QA51AFZQOCBwAAAAkAMAnQEqFAAQAD7RVqRLqCSjobAIAQAaCWwAAFvpBEs/ZeGBwAD+ypUOsnKHqzoCOhzC1X1Mf1obvn6PMDqzg/BzXv+GwPX0v+Od9SZ534fQuC79v6h959R6km0335cvGJtC2sEFIRD+fQnawScAAA==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Local development&quot; title=&quot;&quot; src=&quot;/static/8699f404c9d7b0bb549e06065429d573/08b4d/remote-application-local.webp&quot; srcset=&quot;/static/8699f404c9d7b0bb549e06065429d573/7b30e/remote-application-local.webp 188w,
/static/8699f404c9d7b0bb549e06065429d573/f3a60/remote-application-local.webp 375w,
/static/8699f404c9d7b0bb549e06065429d573/08b4d/remote-application-local.webp 750w,
/static/8699f404c9d7b0bb549e06065429d573/5543b/remote-application-local.webp 1125w,
/static/8699f404c9d7b0bb549e06065429d573/293e0/remote-application-local.webp 1500w,
/static/8699f404c9d7b0bb549e06065429d573/fad48/remote-application-local.webp 1600w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Watch Out for Coupling&lt;/h2&gt;
&lt;p&gt;It is important to repeat that this approach is supposed to increase autonomy. Anything that brings coupling back is a significant risk that we have to assess carefully.&lt;/p&gt;
&lt;p&gt;And yet, it seems that there are some natural points of integration. For instance, we have a custom logger that we use throughout every application which ensures that logs make it to our centralized logging system in a consumable format. We don’t want this to be reimplemented per application, as it’s a platform-shared concern.&lt;/p&gt;
&lt;p&gt;So we built a provider (see &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/master/shared-library/src/LanguageProvider.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this one&lt;/a&gt; as an inspiration). It’s part of the shared dependencies of the host and frame application.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LanguageProvider&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;de-DE&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Box&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RemoteComponent&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;component&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;WelcomeFrame&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;delayed&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Loading...&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Box&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LanguageProvider&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We expect this provider to be there. Every page renders it at the top, guaranteed. If it’s not, Frame Applications are allowed to bail with a nasty error. This is a contract that we make with all the applications that participate in the ecosystem. It works well because we keep the surface area as small as possible. Still, we’re fully aware that this integration point can easily go awry if we aren’t careful.&lt;/p&gt;
&lt;h2&gt;“It Works” is not the same as “Production-Ready”&lt;/h2&gt;
&lt;p&gt;Our Frame Application started as a proof of concept to test its viability. However, being viable does not  mean“releasable”. Before going to production, we have to ensure it’s solid.&lt;/p&gt;
&lt;p&gt;Testing is the first step. A strong test suite that accounts for the remote loading part is not negotiable. Good start, but not enough.&lt;/p&gt;
&lt;p&gt;Remember our custom &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries/blob/master/shared-library/src/LazyModule/LazyModule.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LazyModule&lt;/a&gt;? Well, we want to monitor these components. If they blow up, it has to be a controlled demolition. And we want to hear about it. For that reason, our LazyModule makes heavy use of &lt;a href=&quot;https://reactjs.org/docs/error-boundaries.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;error boundaries&lt;/a&gt; to prevent a cascading failure. We attach a logger to the boundary to get detailed telemetry.&lt;/p&gt;
&lt;p&gt;The way you monitor an application is highly dependent on its implementation. It’s harder to set concrete expectations, rather than do it. We have been using &lt;a href=&quot;https://www.datadoghq.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DataDog&lt;/a&gt;, but, to be fair, many monitoring tools provide similar functionality. We particularly like using &lt;a href=&quot;https://www.datadoghq.com/product/real-user-monitoring/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RUM&lt;/a&gt; to stay on top of everything that happens inside our clients. We like it so much that we initialize it automatically as part of our provider so that every team can benefit from it.&lt;/p&gt;
&lt;h2&gt;The Beginning of a Journey&lt;/h2&gt;
&lt;p&gt;Micro frontends aren’t a silver bullet. As we often say, you can’t solve organizational problems with technology alone.&lt;/p&gt;
&lt;p&gt;However, the early results are promising, and we plan to use module federation to decouple our different applications. This is just the beginning of the journey. Our examples show that there is still much to do and there is no substitute for running things in production to compile valid data. If you’re intrigued, check out the &lt;a href=&quot;https://github.com/sirech/example-applications-instead-of-libraries&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;example repository&lt;/a&gt;. Let us know about your experience!&lt;/p&gt;
&lt;p&gt;As for the future, we’re focused on scaling this solution to support multiple remote applications in the most transparent way possible. Stay tuned for follow-up articles!&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.aboutwayfair.com/careers/tech-blog/applications-instead-of-libraries-part-2&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Wayfair&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Staff Engineer]]></title><description><![CDATA[Staff engineer is about understanding tech leadership in the context of BigTech companies]]></description><link>https://hceris.com/book-review-staff-engineer/</link><guid isPermaLink="false">https://hceris.com/book-review-staff-engineer/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Leadership]]></category><category><![CDATA[Team Organization]]></category><category><![CDATA[Architecture]]></category><pubDate>Tue, 16 Nov 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 313px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/26f558202241d32de1b2593ae72e0e46/aa65c/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 159.5744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAgABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHsxWZsIJbRQB//xAAbEAACAwADAAAAAAAAAAAAAAABMQACERASIf/aAAgBAQABBQKxwdoFaFhWOcBGe4F//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGRAAAwADAAAAAAAAAAAAAAAAARARACEx/9oACAEBAAY/Aq9MnKHxf//EABoQAQEBAQADAAAAAAAAAAAAAAEAETFBUWH/2gAIAQEAAT8hhK+S0NpMWOwDEcJBs9SadLhDfGzw4bhf/9oADAMBAAIAAwAAABDg0gH/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhMUFhUf/aAAgBAQABPxBJJpCOA1peLjMSp5kY0C38xyCb18HPgRMFi0JcheS98x1r0wA9PMaTAE08woC1nc//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Staff Engineer&quot; title=&quot;&quot; src=&quot;/static/26f558202241d32de1b2593ae72e0e46/aa65c/cover.jpg&quot; srcset=&quot;/static/26f558202241d32de1b2593ae72e0e46/bc01b/cover.jpg 188w,
/static/26f558202241d32de1b2593ae72e0e46/aa65c/cover.jpg 313w&quot; sizes=&quot;(max-width: 313px) 100vw, 313px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://staffeng.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Staff Engineer&lt;/a&gt; is a recent book that covers a topic that interests me a lot. For engineering positions, the difference between a developer and a senior developer is relatively well understood. But, what comes next? Let’s say you want to progress in your career without taking a more managerial position. What are the expectations?&lt;/p&gt;
&lt;p&gt;This is the question that this book answers. It’s a treaty on the staff engineer position, a tech leadership position. It’s a must-read if you want to understand it in more depth. It not only contains a lot of information but also quite a few interviews with senior tech leaders from various well-known companies.&lt;/p&gt;
&lt;h2&gt;The Uncertainty of Tech Leadership&lt;/h2&gt;
&lt;p&gt;I touched on this in my article about &lt;a href=&quot;../software-team-lead-responsibilities/&quot;&gt;a Team Lead’s responsibilities&lt;/a&gt;. It seems every organization has its understanding of these roles and their domains. &lt;a href=&quot;https://en.wikipedia.org/wiki/Big_Tech&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;BigTech&lt;/a&gt; (and similar) companies use a dual ladder:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The management part is owned by an &lt;em&gt;Engineering Manager&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;The technology belongs to a &lt;em&gt;Staff Engineer&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Boundaries are never quite so clear in practice. Still, it’s a departure from organizations that pigeonhole experienced folks as managers, whether they like it or not.&lt;/p&gt;
&lt;p&gt;I particularly like talking about &lt;a href=&quot;https://en.wikipedia.org/wiki/Servant_leadership&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;servant leadership&lt;/a&gt;. A technical leader helps create technology, processes, and practices that make those around them more effective. If you see your contribution as something restricted to yourself, the organization might not see you as a staff engineer.&lt;/p&gt;
&lt;h2&gt;Getting to Staff&lt;/h2&gt;
&lt;p&gt;Getting a position is a process that usually starts years before any promotion. You need to work on the right things, build the right package, maybe even change companies in between. It’s a path full of implicit context and unstated assumptions. It’s cool to see some actionable steps written down.&lt;/p&gt;
&lt;p&gt;Keep this in mind: there are no guarantees! Having enough years of experience or tenure won’t ensure your promotion to staff. You have to be active in getting there.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;This book crystalizes what the Staff Engineer role is about. It’s especially important if you’re part of an organization copying the BigTech model. Nowadays, that covers most of the high-prestige positions in the software industry, which makes it quite relevant.&lt;/p&gt;
&lt;p&gt;Status aside, it’s just a pretty interesting read. Tech leadership is a hard concept to define. Don’t settle for a categorical statement like &lt;em&gt;telling other developers what to do&lt;/em&gt;. If it lacks nuance, it’s probably flawed. It’s nice to see the experience from folks that have significantly different backgrounds and experiences. It gets ⭐⭐⭐⭐⭐ stars from me.&lt;/p&gt;
&lt;p&gt;An added plus is that most of the resources are available online so that you can come back to them every time you want.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Secure a Rails API with Auth0]]></title><description><![CDATA[Learn how to secure an API written using Ruby On Rails]]></description><link>https://hceris.com/secure-a-rails-api-with-auth0/</link><guid isPermaLink="false">https://hceris.com/secure-a-rails-api-with-auth0/</guid><category><![CDATA[Ruby]]></category><category><![CDATA[Rails]]></category><category><![CDATA[OAuth]]></category><category><![CDATA[Security]]></category><category><![CDATA[Auth0]]></category><pubDate>Sat, 09 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bcba8b98d6e5a2b4686f581e1e16e388/9bbaf/cover.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 89.89361702127661%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVR42p2QT0zTUBzHe5on06HrNvq6tX2DrRqxxXWSre2vbwkw2NqxItw9qeGA8aQmHoweNMZ4M8YEEq4ejBhj1AiKAaPESDRRI8qYgv8OxMSTfy41qwxEnBo/+R7e+73v9/1++VEAYJr/LnPlDABU3TAA8WTCX8JrIKaZhep7mkC6mq5ezVp0hV87gwnEq6rEyAL0ZUhfhmQNSBEDlkf4w9gAhlc9vT33iC8ucE456kw1FY8rnQBggPd1vTCYoAOMNue/BJylxt5FtlQO5Oc2d1fY4vDWLh2Mup2zYCaJfqql8zPjLHBOJWTPoZ5Kx/4X+QMPY85Tzj7c2pEiBoHfhavzGDATtZcaeyvhYpnf9fHcpa+vP7w9NvwY9kyz+YvxghdZt20CZtqE/jSZ50qLnPMyZL0bPOO67uKR8/c2mnd5a5K3rwmFnjTJmECgtm1N03RdNzR9p55x2ozZSKnClZ6x9qcb067rPukanGK77+CeW1HrslAotOltumboVTRNo1RVTXmoKTWVTE6K1nzYniUD394vua77fN+JiVDnTdEei1gjOJdKJlf9qkrJsqx47JCVJnnboYQxj0oPmntfnRx5MzQ603/wemPuCl8Yi1p7pUxCaWldtiuyLFOSJG2pIUmJuJQ4i7OzkdL9Te0T/ux4ODcetW9Hi0cxxBPxtWaJwhjHYjVhzGNREMUBQb2Ac1exNcrnh/j23UJSEAVeFGM/mTHGFGIRh7gfQoiLII5FiGZDiGUVJCpIRCzbgMIsWrXVzIhiGCa4jlAwGGAYPxPwM4EAw4S8IhNc42QYhqJp2l+HBk/1oGma8vl8G/4Ln8/3HfcXCp9RghyoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Ruby on Rails&quot; title=&quot;&quot; src=&quot;/static/bcba8b98d6e5a2b4686f581e1e16e388/9bbaf/cover.png&quot; srcset=&quot;/static/bcba8b98d6e5a2b4686f581e1e16e388/4dcb9/cover.png 188w,
/static/bcba8b98d6e5a2b4686f581e1e16e388/5ff7e/cover.png 375w,
/static/bcba8b98d6e5a2b4686f581e1e16e388/9bbaf/cover.png 588w&quot; sizes=&quot;(max-width: 588px) 100vw, 588px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you want to expose an API publicly on the Internet, authorization will be a requirement for you sooner or later. You want to verify that the client consuming the API has the appropriate permissions.&lt;/p&gt;
&lt;p&gt;This guide is exactly about that. We’ll be securing an API written using &lt;a href=&quot;https://rubyonrails.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Ruby On Rails&lt;/a&gt;, with &lt;a href=&quot;https://auth0.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt; as the authorization server.&lt;/p&gt;
&lt;p&gt;There’s a repository with the code so that you can follow along in &lt;a href=&quot;https://github.com/sirech/example-jwt-validation-rails&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Github&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Securing an API&lt;/h2&gt;
&lt;p&gt;I didn’t explain what I mean by securing an API yet. Essentially, we’re ensuring that protected routes are accessible only for the users with enough rights.&lt;/p&gt;
&lt;p&gt;When it comes to security, it’s generally considered a bad idea to roll your own bespoke implementation. Instead, I’m using &lt;a href=&quot;https://auth0.com/docs/protocols/protocol-oauth2&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth&lt;/a&gt;, a battle-tested and widely used authorization framework for web applications.&lt;/p&gt;
&lt;p&gt;In this context, Auth0 fulfills the role of the &lt;em&gt;Authorization Server&lt;/em&gt; and abstracts a significant part of the work away from us. That way, we can focus on delivering value to our users.&lt;/p&gt;
&lt;p&gt;Without getting into too many details on how OAuth works, we assume that calls to our API will include a bearer token, using the industry-standard &lt;a href=&quot;https://jwt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JWT&lt;/a&gt; format. The token contains a series of claims regarding the its issuer, how long is it valid, and what rights are granted by it. Let’s have a look at a sample token:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;iss&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://yourTenant.eu.auth0.com/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;sub&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zHwnsh0j2sTj4u3ss6YedSFrzyb2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;aud&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://targetAudience.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;iat&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1621369130&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;exp&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1791455530&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;azp&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ThEkgdG1NndLlWoNMcEdEr2KJIs9vKad&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scope&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;openid profile read:admin-messages&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;permissions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;read:admin-messages&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re going to implement verification for that token, and reject requests that don’t have the required permissions.&lt;/p&gt;
&lt;h2&gt;Getting Started&lt;/h2&gt;
&lt;p&gt;We’re getting started with our base application, bootstrapped with Rails 6. This &lt;a href=&quot;https://github.com/sirech/example-jwt-validation-rails/tree/starter&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;branch&lt;/a&gt; is a good starting point. You can download it by running the following command in a terminal window:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone &lt;span class=&quot;token parameter variable&quot;&gt;-b&lt;/span&gt; starter --single-branch https://github.com/sirech/example-jwt-validation-rails.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The API has three endpoints with different levels of protection:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/api/messages/public&lt;/code&gt;: Public route.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/api/messages/protected&lt;/code&gt;: Requires a valid access token.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/api/messages/admin&lt;/code&gt;: Requires a valid access token. Since Auth0 uses JWT as its access token format, we can inspect it and make sure it has a &lt;code class=&quot;language-text&quot;&gt;permissions&lt;/code&gt; claim that contains the scope &lt;code class=&quot;language-text&quot;&gt;read:admin-messages&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Running the Application&lt;/h3&gt;
&lt;p&gt;To run the application, we first need the correct ruby version. The easiest way to do so is to use a version manager like &lt;a href=&quot;https://github.com/rbenv/rbenv&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;rbenv&lt;/a&gt;. Once you install it, run this command inside the repository to install the right version of ruby:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;rbenv &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Install the dependencies for the application:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;bundle &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And finally, run the application:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;bin/rails s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can verify that the application is working correctly with &lt;code class=&quot;language-text&quot;&gt;curl&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:6060/api/messages/public&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The command will return a 200 code, plus the message:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;The API doesn&apos;t require an access token to share this message.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Creating an API on Auth0&lt;/h3&gt;
&lt;p&gt;To secure the API with Auth0, you need an Auth0 account. If you haven’t one, you can &lt;a href=&quot;https://auth0.com/signup&quot; data-amp-replace=&quot;CLIENT_ID&quot; data-amp-addparams=&quot;anonId=CLIENT_ID(cid-scope-cookie-fallback-name)&quot;&gt;sign up for free&lt;/a&gt; right now. In the &lt;em&gt;APIs&lt;/em&gt; section of the &lt;a href=&quot;https://manage.auth0.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0 dashboard&lt;/a&gt;, click &lt;em&gt;Create API&lt;/em&gt;. Provide a name and an identifier for your API. You will use the identifier as an &lt;code class=&quot;language-text&quot;&gt;audience&lt;/code&gt; later, when you are configuring the access token verification. Leave the &lt;em&gt;Signing Algorithm&lt;/em&gt; as RS256.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2e8975e4dc9a1ac72728fdb559f9af02/baae1/create-api.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 71.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACNElEQVR42p2Sy08UMRjAe+JPMPFgIicTDxAf/yNeTThMSIhZkHgzPFYPcpaAxAPsDGx0d0ZDgF12Hu10pu1MH5/56spD2Yud/NJO2+/3fW1KPm28fxAef17uD7+t/Dw7C84vzoMfSRJEURQMh8MgTpIgjuOZJEkS9Pv9lYODg9e7u7sPydu19cWr0SVkeQYZzSHNUrgaj2E8GgEtCuBleU3J2O/xtPf/jAGjFEYXF/Ch231J1jqdhTLPpeDc1KxsZV1rZ60G57S1VjvntBTCg/PWGA9+oqp0xVgrq8rQLCt3NjefkfVOZ4HmeVuXJVSMOVnXDgCctdZjjHFaaz/+u+FenqWuzjPIx2Oxs7393AtZlt0WAjajNTRNAyXOVxUYY8Bae4NzgHt5kTtBKRSTK7GztTUV3q3QC6WUXog9Ctu2BefcHSnuxRjBORRpeiOk91SIDSVFUXgopcAY83LOuU+mUEipF+aTyWwhHk+3LWitfYVKNSCV8glmVZjfrvD6yJQ6zIrBWIlSyt+hUdKjplegpvKZwllHxotvmwbOSuVxt6rz9zxLWKRpgwucUiM4t0ZrqzU+N2PREsTSLg+lBWf83B9wL8ZgMflkUvl3+G5jYxEztFJ6GiFAIXV9jRE1GCn82n1gXFkU5mO3+4K8Wlp6sr+3d/Jlfz/+eng4iHq9QXh87Dnp9QanYTg4CUPfn0bRv4Th934UxeHRUe/N6upTQgiZI4Q8IoTME0Ie/yfzU8fcL7YkrQflDKgOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Create the API&quot; title=&quot;&quot; src=&quot;/static/2e8975e4dc9a1ac72728fdb559f9af02/1d69c/create-api.png&quot; srcset=&quot;/static/2e8975e4dc9a1ac72728fdb559f9af02/4dcb9/create-api.png 188w,
/static/2e8975e4dc9a1ac72728fdb559f9af02/5ff7e/create-api.png 375w,
/static/2e8975e4dc9a1ac72728fdb559f9af02/1d69c/create-api.png 750w,
/static/2e8975e4dc9a1ac72728fdb559f9af02/78797/create-api.png 1125w,
/static/2e8975e4dc9a1ac72728fdb559f9af02/aa440/create-api.png 1500w,
/static/2e8975e4dc9a1ac72728fdb559f9af02/baae1/create-api.png 2424w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Once you’ve created the API. Go to the &lt;em&gt;Permissions&lt;/em&gt; tab in the API details and add a permission called &lt;code class=&quot;language-text&quot;&gt;read:admin-messages&lt;/code&gt;.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/41c5d99a5b694e1fc3473ca02464396c/e8649/configure-permissions.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgklEQVR42o1Sa2/CMAzsLx7jORCwCe1fsk8UGBv0QRKapG2Sm2ygFLRJs2Q1je3zneNoOl9g/vaO6WyBzvOI/akz5G+vP0FvMEG3N25i5N3+GMOXGUbjOQajKQbDKfqDCUbjV0RSWpyUQ9uqqoa1FlVVQWuDEAL+a5HWVFTBe4cQPJxzSLMc3997rFYxlssPrOIYQiqcTgUKreG95ybeB/gQbmfvEQkhkSQJpKREcJCYXYucA7stLaRU0MZwrHZnVeECePUoy3JkWYI4LqALToG1JcqyhDEWSpF0z8X0TwqY0QNQAyiEQJpmDEBGBfF6gzheY7PZsuf5kePEjPwvY8A0TUEs2/RpViTPudtjERDdKaVQ13UzEvKyrBpCDLjbfTUXlEgN9ocD9vuzkwICp8Ffc9oy28wjKtxuP7nrNfl4FDgKASkln2ksWmue4aPk9kqx5DzPURTFXVAqBXr9ur7fT2MM7+Xj6/KrXwhF1JkAXWsNCMhYy2NoF7aZ/CaZGP4AUzI+vaq5qWcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Configure Permissions&quot; title=&quot;&quot; src=&quot;/static/41c5d99a5b694e1fc3473ca02464396c/1d69c/configure-permissions.png&quot; srcset=&quot;/static/41c5d99a5b694e1fc3473ca02464396c/4dcb9/configure-permissions.png 188w,
/static/41c5d99a5b694e1fc3473ca02464396c/5ff7e/configure-permissions.png 375w,
/static/41c5d99a5b694e1fc3473ca02464396c/1d69c/configure-permissions.png 750w,
/static/41c5d99a5b694e1fc3473ca02464396c/78797/configure-permissions.png 1125w,
/static/41c5d99a5b694e1fc3473ca02464396c/aa440/configure-permissions.png 1500w,
/static/41c5d99a5b694e1fc3473ca02464396c/e8649/configure-permissions.png 2968w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: While you are in the Auth0 Dashboard, take note of your Auth0 domain. You will need it soon. This is a string in the form &lt;code class=&quot;language-text&quot;&gt;YOUR-TENANT-NAME.auth0.com&lt;/code&gt; where &lt;code class=&quot;language-text&quot;&gt;YOUR-TENANT-NAME&lt;/code&gt; is the name you provided when you created your account with Auth0. For more information, &lt;a href=&quot;https://auth0.com/docs/getting-started/the-basics#domains&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;check the documentation&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Preparing the Application for Validation&lt;/h2&gt;
&lt;p&gt;Alright, our application is ready to go and in dire need of some &lt;em&gt;security&lt;/em&gt;. Before that, we need to add some configuration.&lt;/p&gt;
&lt;p&gt;You dutifully stored the &lt;code class=&quot;language-text&quot;&gt;domain&lt;/code&gt; and the &lt;code class=&quot;language-text&quot;&gt;audience&lt;/code&gt; after creating the API, right? Let’s use them. In the &lt;em&gt;Rails&lt;/em&gt; world, the convention is to add this in the &lt;code class=&quot;language-text&quot;&gt;config&lt;/code&gt; folder, using &lt;a href=&quot;https://yaml.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;YAML&lt;/a&gt;. The file is called &lt;code class=&quot;language-text&quot;&gt;config/auth0.yml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We don’t want to store credentials in our code, so we’ll export the values as environment variables, named &lt;code class=&quot;language-text&quot;&gt;AUTH0_DOMAIN&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;AUTH0_AUDIENCE&lt;/code&gt;. The configuration uses those values, and keeps them safely away from source control!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;development&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;issuerUri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &amp;lt;%= ENV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;AUTH0_DOMAIN&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; %&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;audience&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &amp;lt;%= ENV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;AUTH0_AUDIENCE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; %&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, set &lt;code class=&quot;language-text&quot;&gt;AUTH0_DOMAIN&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;AUTH0_AUDIENCE&lt;/code&gt; environment variables to the &lt;code class=&quot;language-text&quot;&gt;domain&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;audience&lt;/code&gt; values for your API.&lt;/p&gt;
&lt;p&gt;With this, the application is ready to connect with Auth0. Let’s move on to the implementation.&lt;/p&gt;
&lt;h2&gt;Validating the Access Token&lt;/h2&gt;
&lt;p&gt;Before we get started, let’s talk for a second about authentication frameworks for rails. There are a bunch of alternatives in the ecosystem, such as &lt;a href=&quot;https://github.com/CanCanCommunity/cancancan&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CanCanCan&lt;/a&gt;, or &lt;a href=&quot;https://github.com/heartcombo/devise&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;devise&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;However, our case is an awkward fit for those. We don’t want to take over user management. We only want to validate tokens issued by the authorization server. In this case, using a framework won’t bring us as much benefit as something like, say, &lt;a href=&quot;https://spring.io/projects/spring-security&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spring Security&lt;/a&gt;. That’s why we only rely on an extra gem, &lt;a href=&quot;https://github.com/jwt/ruby-jwt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jwt&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The code implementing the authorization check lives in the &lt;a href=&quot;https://github.com/sirech/example-jwt-validation-rails/tree/add-authorization&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;add-authorization&lt;/a&gt; branch. Let’s see how it works!&lt;/p&gt;
&lt;h3&gt;Utilizing the JWT Library&lt;/h3&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;jwt&lt;/code&gt; library brings a whole lot of functionality to make our API able to validate and manage tokens in JWT formats as the ones issued by Auth0. We need to do three things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We need to fetch the &lt;a href=&quot;https://auth0.com/docs/tokens/json-web-tokens/json-web-key-sets&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JWKS&lt;/a&gt; configuration from &lt;em&gt;Auth0&lt;/em&gt;, so that we know what is the public key to verify the access token signature&lt;/li&gt;
&lt;li&gt;With the public key, the issuer, and the audience, we want to verify the token&lt;/li&gt;
&lt;li&gt;After verifying the token, we’re decoding it to access the &lt;code class=&quot;language-text&quot;&gt;permissions&lt;/code&gt; claim (or any other information contained in the token, really)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Decoding the Token&lt;/h3&gt;
&lt;p&gt;Let’s get down to business. We’re implementing the verification/decoding logic in the &lt;code class=&quot;language-text&quot;&gt;lib&lt;/code&gt; folder, in a file called &lt;code class=&quot;language-text&quot;&gt;json_web_token.rb&lt;/code&gt;. We’re starting by fetching the &lt;em&gt;JWKS&lt;/em&gt; data:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/json_web_token.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;jwt&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;net/http&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JsonWebToken&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;algorithm&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;RS256&apos;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;key&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      jwks_hash&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;kid&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;jwks_hash&lt;/span&gt;&lt;/span&gt;
      jwks_raw &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Net&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get &lt;span class=&quot;token constant&quot;&gt;URI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;issuer&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.well-known/jwks.json&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      jwks_keys &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwks_raw&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;keys&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      jwks_keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;k&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          k&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;kid&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          OpenSSL&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;X509&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Certificate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Base64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode64&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x5c&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;public_key
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_h
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;issuer&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auth0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;issuerUri&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, through the &lt;code class=&quot;language-text&quot;&gt;issuerUri&lt;/code&gt; we know where to look for the data. Then, we parse the key so that we can consume it in the library.&lt;/p&gt;
&lt;p&gt;The next step is to add an extra method to the class, &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt;, that verifies and decodes the token at the same time:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/json_web_token.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JsonWebToken&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token constant&quot;&gt;JWT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;decode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# Verify the signature of this token&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;algorithm&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; algorithm&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;iss&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auth0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;issuerUri&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;verify_iss&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;aud&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auth0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;audience&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;verify_aud&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;header&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
        key&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;# ... existing code ...&lt;/span&gt;
    
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is all the code that we need for the actual verification. Neat, isn’t it? But our controllers are still insecure. Not for long, though.&lt;/p&gt;
&lt;h2&gt;Protecting the Endpoints&lt;/h2&gt;
&lt;p&gt;To make it as convenient as possible, we’re creating a hook that we’re going to run before any route that needs authentication. To make it available for every controller, it lives in the &lt;code class=&quot;language-text&quot;&gt;app/controllers/application_controller.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# app/controllers/application_controller.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;json_web_token&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApplicationController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ActionController&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;API&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;authorize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
    valid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;raw_token&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    head &lt;span class=&quot;token symbol&quot;&gt;:unauthorized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;unless&lt;/span&gt; valid

    &lt;span class=&quot;token variable&quot;&gt;@token&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||=&lt;/span&gt; result
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    payload&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; JsonWebToken&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;verify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;rescue&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;JWT&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;DecodeError &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; e
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;raw_token&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;present&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We take the token from the standard &lt;em&gt;Authorization&lt;/em&gt; header. Then, we verify it with the code from the previous section. There are two possible paths after running &lt;code class=&quot;language-text&quot;&gt;authorize!&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If the token isn’t there, or it’s invalid for any reason, the processing stops right there, and the call returns a 401&lt;/li&gt;
&lt;li&gt;If the token is valid, we continue the execution and store the token in &lt;code class=&quot;language-text&quot;&gt;@token&lt;/code&gt; so that it’s available&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We’re protecting both the &lt;code class=&quot;language-text&quot;&gt;protected&lt;/code&gt; and the &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt; routes with this hook, thanks to &lt;a href=&quot;https://api.rubyonrails.org/v6.1.4/classes/AbstractController/Callbacks/ClassMethods.html#method-i-before_action&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;before_action&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# app/controllers/api/messages_controller.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Api&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MessagesController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ApplicationController
    before_action &lt;span class=&quot;token symbol&quot;&gt;:authorize!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;%i[public]&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Custom Error Messages&lt;/h3&gt;
&lt;p&gt;Don’t you feel better knowing that the application is not exposing private stuff anymore? I definitely do. But we got to help our users. A blank 401 message might not give them enough information to debug the issue. Let’s extend the hook to return something more explicit:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# app/controllers/application_controller.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApplicationController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ActionController&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;API&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;authorize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
     valid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verify&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;raw_token&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

     &lt;span class=&quot;token comment&quot;&gt;# 👇 old code&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# head :unauthorized unless valid&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# 👇 new code&lt;/span&gt;
     render json&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; result &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_json&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:unauthorized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;unless&lt;/span&gt; valid

     &lt;span class=&quot;token variable&quot;&gt;@token&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||=&lt;/span&gt; result
   &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we get a message that’s more helpful than an HTTP code without a body.&lt;/p&gt;
&lt;h2&gt;Testing the Protected Endpoints&lt;/h2&gt;
&lt;p&gt;Let’s test the protected endpoint:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:6060/api/messages/protected&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The command will return a 401, because we’re not authorized. We need to get a valid token from Auth0.&lt;/p&gt;
&lt;p&gt;The simplest way is to access the &lt;a href=&quot;https://manage.auth0.com/#/apis&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;API section of your Auth0 Dashboard&lt;/a&gt; again, select the API that you created before and click the &lt;em&gt;Test&lt;/em&gt; tab. In this section, you can get a temporary token to test your Web API by clicking the &lt;em&gt;Copy Token&lt;/em&gt; icon as shown in the following picture:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/36856b8a44f677802262d5736ff93d42/89896/copy-token.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1klEQVR42o1S20obURQ9/9N3UxQpVqYoiL/QPjWNgjWNfRCh1TSUaKuoRXMx3t58qIL4BwULYsyk9q0t1BtmZmLG1MzFuWXJ2WPURCtuWOw5s9dZe2avzVLpJcwm5pFIZuowNZ3A+MQXwuTUDJKpG5yEn9Nzi8jML2Mus4RUeoEycxz8N2zbhqZp0HUdDw2mqqcolcowTQeu68JxXDiuS2L87HkewTRNVCoa1W2bcxx65pybYKpagiSp0DWPOlSrVcq8UaEgQZJkSLJMZ1lWoJ6W4bp+Ey5Q4/PMwYrFExiGXveSh2EYKJf/wbIswn1Ru0O/rChFnJ1Vbgn++v0HW9kcdvK72BZ/YGtHvEI2JyIn5pHf/YmSqtaJMkVRaPCNgoPvRxB4KuBJVzdaO7vQLHQg0CagqU3A4/ZnaBE68SjQjNX1DeI7l+4yTdNpFo2CfF5/9/ZxcHSE/YNDwvFxAbKi0Ewl2c+6btR/YaNYrTA9m8SLYA9C4QEEX4fxsq8fwf43CIUjeBWOoCfyFs9Dvfi2+Z34NYMYX4+7BFe+rmFoJIbhj3G8i8URjX9GND52hQ+jnzAUjSEr5n1Bz98SxpfWsmxUG9zizpqGSbXz8/td9rzrlbsAEcEO73fz9JAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Test Token&quot; title=&quot;&quot; src=&quot;/static/36856b8a44f677802262d5736ff93d42/1d69c/copy-token.png&quot; srcset=&quot;/static/36856b8a44f677802262d5736ff93d42/4dcb9/copy-token.png 188w,
/static/36856b8a44f677802262d5736ff93d42/5ff7e/copy-token.png 375w,
/static/36856b8a44f677802262d5736ff93d42/1d69c/copy-token.png 750w,
/static/36856b8a44f677802262d5736ff93d42/78797/copy-token.png 1125w,
/static/36856b8a44f677802262d5736ff93d42/aa440/copy-token.png 1500w,
/static/36856b8a44f677802262d5736ff93d42/89896/copy-token.png 2966w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Let’s attach the token to the request:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TOKEN&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;the-test-token
&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:6060/api/messages/protected &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Authorization: Bearer &lt;span class=&quot;token variable&quot;&gt;$TOKEN&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The request works now!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;The API successfully validated your access token.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Checking for permissions&lt;/h2&gt;
&lt;p&gt;There’s one requirement pending. As you might recall, for &lt;code class=&quot;language-text&quot;&gt;/api/messages/admin&lt;/code&gt; a valid token isn’t enough. Rather, we expect the correct permission in the &lt;code class=&quot;language-text&quot;&gt;permissions&lt;/code&gt; claim. This extra check allows us to define more granular access criteria for our endpoints. This functionality is implemented in the &lt;a href=&quot;https://github.com/sirech/example-jwt-validation-rails/tree/add-rbac&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;add-rbac&lt;/a&gt; branch.&lt;/p&gt;
&lt;p&gt;We’re adding a new method in the &lt;code class=&quot;language-text&quot;&gt;application_controller&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;check_permissions&lt;/code&gt;. It takes the decoded token and looks for a given permission:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# app/controllers/application_controller.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;json_web_token&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApplicationController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ActionController&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;API&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# ... existing code ...&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;can_read_admin_messages&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
    check_permissions&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;read:admin-messages&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;check_permissions&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; permission&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    permissions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; token&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;permissions&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    permissions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_a&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;unless&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permission&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      render json&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Access is denied&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_json&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;token symbol&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:unauthorized&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;# ... existing code ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We use a &lt;code class=&quot;language-text&quot;&gt;before_action&lt;/code&gt; again to protect the &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt; endpoint:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# app/controllers/api/messages_controller.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Api&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MessagesController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ApplicationController
    before_action &lt;span class=&quot;token symbol&quot;&gt;:can_read_admin_messages!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;%i[admin]&lt;/span&gt;&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;# ... existing code ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this, each route in our sample application is safe the way we wanted.&lt;/p&gt;
&lt;h3&gt;Testing Permissions&lt;/h3&gt;
&lt;p&gt;If you try to call the &lt;code class=&quot;language-text&quot;&gt;/api/messages/admin&lt;/code&gt; endpoint with the token we generated before, it will return a 401. Our token is valid, but doesn’t have the necessary permissions. Let’s create a new one!&lt;/p&gt;
&lt;p&gt;Back in your &lt;a href=&quot;https://manage.auth0.com/#/apis&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;API configuration page on the Auth0 Dashboard&lt;/a&gt;, select the &lt;em&gt;Machine to Machine Applications&lt;/em&gt; tab. You’ll get a list of applications, some of them with the &lt;em&gt;(Test Application)&lt;/em&gt; label in the name. These applications are automatically created by Auth0 when you create an API there. They are meant as test clients from your API. One of them should have the &lt;em&gt;Authorized&lt;/em&gt; switch on. Click the dropdown next to it and check the &lt;code class=&quot;language-text&quot;&gt;read:admin-messages&lt;/code&gt; permission:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/503da7b19db94a2eae6705ad50ee4fee/e8649/assign-writing-permissions.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcUlEQVR42o2S2W4bMQxF5//RJnVtxwuSflZQoCjQt8Z2pNFop7ZbSErczLgPJXBBQBIPSZHDbv+E9eaI9WY/0/1qi0+fV7i73+DL6gFf1ztstoem9ze7/SMOx2/YH56wfTg2PwTCPy3GBGMsJimhlIa1Dv9jA+ccjAl4F5FSQkyp+QqwzsFaAlGA9x7eU1MI4U095qMGxhlefnNonVuGUkrzxloIIaC1aUCiDqv+XYEIJZdrXNVwubzCWjs7rFaDtbat0gqM8a2D2EUhQHmHlPMceD5fIKW6ASrlwJjEOApwLtqb+qc1gXMek1T4xV9BMd4Ca1tLoJQSp9MZjI3gowDj3dcBKW169doihgVQa91aWQLHccLL6QKpNLSxfeKTghAaSpl2XsFxWeES1nkFziVMgiAlIaWeJOfSh1D+rkle/mEd/7K6GkGUEUNpAQ1UbtXv5tsxGNPXolyhHfj9OeHnj4CcCc7RdQfn8h++q8f/AStuRv9iqYj0AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Adding Permissions&quot; title=&quot;&quot; src=&quot;/static/503da7b19db94a2eae6705ad50ee4fee/1d69c/assign-writing-permissions.png&quot; srcset=&quot;/static/503da7b19db94a2eae6705ad50ee4fee/4dcb9/assign-writing-permissions.png 188w,
/static/503da7b19db94a2eae6705ad50ee4fee/5ff7e/assign-writing-permissions.png 375w,
/static/503da7b19db94a2eae6705ad50ee4fee/1d69c/assign-writing-permissions.png 750w,
/static/503da7b19db94a2eae6705ad50ee4fee/78797/assign-writing-permissions.png 1125w,
/static/503da7b19db94a2eae6705ad50ee4fee/aa440/assign-writing-permissions.png 1500w,
/static/503da7b19db94a2eae6705ad50ee4fee/e8649/assign-writing-permissions.png 2968w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Then, click the &lt;em&gt;Update&lt;/em&gt; button, move again to the &lt;em&gt;Test&lt;/em&gt; tab, and copy the new token that has been generated for you. Let’s try again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TOKEN&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;the-new-test-token
&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:6060/api/messages/admin &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Authorization: Bearer &lt;span class=&quot;token variable&quot;&gt;$TOKEN&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The request works now!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;The API successfully recognized you as an admin.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this guide, we’ve added authorization to a Rails API by using Auth0 as an authorization server. Thanks to the &lt;code class=&quot;language-text&quot;&gt;jwt&lt;/code&gt; gem, we don’t have to invest much effort. We use the library to decode the bearer token that the API receives. After that, it’s a matter of checking the relevant routes before each request.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://auth0.com/blog/secure-rails-api/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Synthetic Transactions and Monitoring in Testing]]></title><description><![CDATA[Synthetic transactions is a way of monitoring a system from the perspective of the users interacting with it. Let's learn about its benefits.]]></description><link>https://hceris.com/synthetic-transactions/</link><guid isPermaLink="false">https://hceris.com/synthetic-transactions/</guid><category><![CDATA[Monitoring]]></category><category><![CDATA[Alerts]]></category><pubDate>Sun, 26 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f16f24bc3e0db7f25661ad9ae090cc68/ac99c/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBP/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFvlokk0//EABoQAAMBAAMAAAAAAAAAAAAAAAECAwQREyL/2gAIAQEAAQUCzzUpProHn7WpRRpbhmJP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAEREgIx/9oACAEBAAY/Am2qTGehkidPEU//xAAbEAADAQEAAwAAAAAAAAAAAAAAAREhMVFh0f/aAAgBAQABPyGzJcLFUbH9F48o/SPJGGlpehnrun//2gAMAwEAAgADAAAAEHQP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARMSFBYf/aAAgBAQABPxAlJ8scyW2D0I1tepSmgVA5LiGtPhBYQgcVFuRdgOE//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Synthetic Transactions&quot; title=&quot;&quot; src=&quot;/static/f16f24bc3e0db7f25661ad9ae090cc68/acb04/cover.jpg&quot; srcset=&quot;/static/f16f24bc3e0db7f25661ad9ae090cc68/bc01b/cover.jpg 188w,
/static/f16f24bc3e0db7f25661ad9ae090cc68/bf173/cover.jpg 375w,
/static/f16f24bc3e0db7f25661ad9ae090cc68/acb04/cover.jpg 750w,
/static/f16f24bc3e0db7f25661ad9ae090cc68/ec605/cover.jpg 1125w,
/static/f16f24bc3e0db7f25661ad9ae090cc68/c58a3/cover.jpg 1500w,
/static/f16f24bc3e0db7f25661ad9ae090cc68/ac99c/cover.jpg 1536w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Monitoring is a must-have for any serious application. You can’t hope to run a highly available system if you don’t have real-time information about its state. In this day and age, it’s almost negligent to forsake this &lt;a href=&quot;https://en.wikipedia.org/wiki/Non-functional_requirement&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cross-functional requirement&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Monitoring has many facets that can be covered by using slightly different tools. Some of these tools focus specifically on technical aspects. One example is the state of the infrastructure or the errors observed in a microservice. That’s unquestionably important, but it’s also something that doesn’t say much about the way users engage with your software. That’s why you want to enhance your monitoring capabilities with tools that look at your application from the user’s perspective. It’s a valuable view that uncovers many hidden issues.&lt;/p&gt;
&lt;p&gt;In this post, I want to talk about synthetic transaction monitoring. It’s a way of monitoring a system by simulating actions from real users.&lt;/p&gt;
&lt;h2&gt;What Are Synthetic Transactions?&lt;/h2&gt;
&lt;p&gt;The term “synthetic transaction” isn’t one that you hear every day. So let’s talk about this before we move to the monitoring part. A &lt;a href=&quot;https://www.sciencedirect.com/topics/computer-science/synthetic-transaction&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;synthetic transaction&lt;/a&gt; is a script or a tool that simulates the actions of a user in an application.&lt;/p&gt;
&lt;p&gt;Let’s assume we’re talking about a web application. It can run against an API. Most modern applications expose some APIs publicly, and those are natural candidates to check. A user doesn’t typically interact with your APIs directly, although there are cases where you want to save a sequence of calls that come from real activity.&lt;/p&gt;
&lt;p&gt;In general, users access your application from a real browser. Thus, a synthetic transaction has to run in this environment as well. In this case, the script simulates actions performed by a user in her browser. These actions, from beginning to end, fulfill a flow in your system.&lt;/p&gt;
&lt;p&gt;One way or the other, you want to store these actions in a format that lets you run them repeatedly. Then you can execute them again at your leisure.&lt;/p&gt;
&lt;h2&gt;Monitoring on Top of Synthetic Transactions&lt;/h2&gt;
&lt;p&gt;As you might have guessed already, &lt;a href=&quot;https://en.wikipedia.org/wiki/Synthetic_monitoring&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;synthetic monitoring&lt;/a&gt; is about using the synthetic transactions we just discussed to monitor your system. Essentially, your monitoring tool runs the scripts that you defined from different locations at regular intervals. Then it compiles the results and aggregates the data for you.&lt;/p&gt;
&lt;p&gt;When you use this type of monitoring, there are a few things that you’re going to observe:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You know if these transactions are working or not.&lt;/li&gt;
&lt;li&gt;You have a history. It keeps track of when every run happened and its result.&lt;/li&gt;
&lt;li&gt;You have access to the timing information for each run with detailed granularity.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Compared to other monitoring mechanisms, there is a crucial difference: The monitoring itself is the one triggering traffic in your application.&lt;/p&gt;
&lt;h2&gt;Synthetic Monitoring is Pretty Useful&lt;/h2&gt;
&lt;p&gt;Now that we know what this kind of monitoring does, it’s time to ask about its value. What’s in it for you? Is it worth incorporating this method into your ecosystem?&lt;/p&gt;
&lt;p&gt;I briefly alluded to this already. The most significant value that you get out of synthetic monitoring is a new perspective. Given that you simulate actual interactions, the results are close to how your users experience your application, which is a powerful signal. Think of it from a business perspective: your stakeholders might not particularly care about the memory usage of the servers, but I’ll bet they are keenly interested in knowing if your checkout process remains operational.&lt;/p&gt;
&lt;p&gt;So that’s the first benefit. You ensure that your core flows are still running. That sounds basic, but you wouldn’t believe how often organizations don’t know for sure if their application, you know, &lt;em&gt;works&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Additionally, you get detailed performance information. All these runs that your monitoring system stores show how fast your application is for real-world flows. Remember that performance &lt;a href=&quot;https://www.gigaspaces.com/blog/amazon-found-every-100ms-of-latency-cost-them-1-in-sales&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;matters&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Last, you get the opportunity to transition to an alert-based approach. If core flows of the application are failing, that sure sounds like a problem you want to fix ASAP, doesn’t it? You probably want to connect these alerts to your &lt;a href=&quot;https://en.wikipedia.org/wiki/Incident_management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;incident management&lt;/a&gt; software to ensure that whoever is on call is notified quickly.&lt;/p&gt;
&lt;h2&gt;Setting Up Synthetic Monitoring&lt;/h2&gt;
&lt;p&gt;Setting up this monitoring varies, depending on the monitoring tool of your choice, although there are some similarities between them. If you monitor APIs, it’s about configuring the calls to the right endpoints plus passing the appropriate headers and parameters. It looks a lot like using &lt;a href=&quot;https://www.postman.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Postman&lt;/a&gt;. If you’re checking authenticated routes, you need to provide credentials using, for instance, &lt;a href=&quot;https://oauth.net/2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth2&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Meanwhile, browser-based tests typically use an interface where you combine several navigation steps, assertions, and other primitives to build a user’s journey through your website. If you prefer staying close to the code, they tend to support custom scripting through &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JavaScript&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Blurry Line Between Testing and Monitoring&lt;/h2&gt;
&lt;p&gt;I don’t know about you, but to me, these synthetic transactions sound suspiciously like &lt;a href=&quot;https://www.browserstack.com/guide/end-to-end-testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;end-to-end testing&lt;/a&gt;. When does testing end and monitoring start?&lt;/p&gt;
&lt;p&gt;That’s a blurry line! Look at it through two lenses:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In terms of time, testing happens &lt;strong&gt;before&lt;/strong&gt; a release and monitoring &lt;strong&gt;after&lt;/strong&gt; the release.&lt;/li&gt;
&lt;li&gt;In terms of intention, you test to prevent errors from getting to your users, and you monitor to find errors as quickly as possible.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is a good mental model, but the faster you get as an organization, the harder it is to tell them apart. If you follow the principles behind &lt;a href=&quot;https://itrevolution.com/accelerate-book/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Accelerate&lt;/a&gt;, one of the &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/four-key-metrics&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;four key metrics&lt;/a&gt; is the Mean Time to Restore (MTTR). Optimizing that metric requires rapid detection of a faulty deployment, which is close to impossible without precise and reliable monitoring.&lt;/p&gt;
&lt;p&gt;It feels to me that as you get faster, both end up being different sides of the same coin. You run synthetic transactions everywhere, depending on the context they are testing or monitoring.&lt;/p&gt;
&lt;h2&gt;The Place of Synthetic Monitoring in a Comprehensive Monitoring Setup&lt;/h2&gt;
&lt;p&gt;Synthetic monitoring coexists with other types of monitoring. If you are thoroughly monitoring your application, there are multiple monitoring flavors in your toolbelt:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Application Performance Monitoring (&lt;a href=&quot;https://en.wikipedia.org/wiki/Application_performance_management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;APM&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Real User Monitoring (&lt;a href=&quot;https://en.wikipedia.org/wiki/Real_user_monitoring&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RUM&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Infrastructure Monitoring&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are plenty more, but you get the point. Where does synthetic monitoring fit in this picture? If we come back to testing for a second, I see some similarities with the &lt;a href=&quot;https://martinfowler.com/bliki/TestPyramid.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;testing pyramid&lt;/a&gt;:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e3aeaa2a08e561d1793d59aa593574a3/2bef9/monitoring-pyramid.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 98.40425531914893%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADQklEQVR42pWU7YocRRSGa9I3oGCQSCCIqOQCBPWqZP/ljwRRCESDSUSDV2FuQcQfy0ow0zM7mZ7+7p7Z7urdPvXRX1MzdeT0DhIj0WzDYc7UeevleWummrHXPIjIpq7L3NmMTafTt6au+/ZsPh+/0+zKj7WWSSkdIQQrOX9Qcn6feiGE0/f91cyIIE3TydLz2Hw+vw4AAgBq13XfWSwWLEmSyZUoSay1dpTWjHP+jZQSqTjnXymlmdLa2V/FMMvziR8EbOX774EQF0prpAIhqhee96638lmaZW9GOdJJ6SgpWFmW90Rdo6hrcygsi+JrKYApIZw3MsyybLLMcrZI05s6S2FbnOFQ8T0V9SpLz+dxfGORJOM5/y9d2zSOajtWVtV3w9kaUYLZhz7uowBRCkNrJef3ZNOwpmn+m5LOLgxDFvr+rVoIOazXaEu+361Wdhf4lvphs8EaAHzPu0nnTIleS9d1ndO2Las4fyiVxm6zNLt8iqb07Fj5FLszz9CMc/5t0zSsbdt/Uz56/JjleT6JoogFQfA+AGjatAXPol7aPf8dbXWMqFd2AG9PMwCQvu/fokT/oPR9f/zs+97puo5VVfVIKfrfabOrPUTlWTz/A/H82djTGs1Iw6vqe0pEyf6m/OXpU7Zer6/FcczCMPwAABqlFCqlLb8IbVF7WECIBQRY1EvkF5GlGWkoCSWiZJRwNPzy7l22HQZnGAai+4mEUknTSIVuA/ZkK/HPrRrrmVE4a8DSjDSkrarqB7rblHA0JLo0TVkURR8DQH8wpE123gIeG4G/thx/6yo82Uk8bQG1lJY0B8o2jKIPKWG+Xl9jxhhnu90S3c+jmZSG7m2jlH0B5/hcC3S1wKkW+FwB0ppWigxH7YHyCVEOw+DQnWRxHN8GgOFgaKVUViuJq1zgadbgLAacxwIXeYurHFCPZsqS9kDZR1H0UZIkjL1C110SKqOUMEHRmKA05tiNzclpZsJqZ8KiMUqKUXNI0x0ofxzfk3mefyaEwMtf9rKkUhQLww1gWPYY8wFj3o99tBGXhC/pqcgjy7JP6GX5Oef8Duf8C8750cu12ZwdhVFyFMVU6VEYJ+Paq7rD3jtJknz6F1GrB3htA/mqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The monitoring pyramid&quot; title=&quot;&quot; src=&quot;/static/e3aeaa2a08e561d1793d59aa593574a3/1d69c/monitoring-pyramid.png&quot; srcset=&quot;/static/e3aeaa2a08e561d1793d59aa593574a3/4dcb9/monitoring-pyramid.png 188w,
/static/e3aeaa2a08e561d1793d59aa593574a3/5ff7e/monitoring-pyramid.png 375w,
/static/e3aeaa2a08e561d1793d59aa593574a3/1d69c/monitoring-pyramid.png 750w,
/static/e3aeaa2a08e561d1793d59aa593574a3/2bef9/monitoring-pyramid.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The analogy isn’t perfect, but I think it gives a pretty good indication of where these tests reside.&lt;/p&gt;
&lt;p&gt;Synthetic transactions aren’t a tool for observing basic building blocks, in my opinion. There’s too much noise in the signal, and other tools fulfill that purpose more adequately anyway. However, offering a high-level overview of your system is where this concept truly shines. After all, you’re simulating the actions of real users, aren’t you? It’s the cherry on top of your delicious monitoring cake!&lt;/p&gt;
&lt;h2&gt;Enhance Your Monitoring Capabilities&lt;/h2&gt;
&lt;p&gt;Let’s finish by recapping what we’ve learned. Synthetic transactions simulate the actions of a user in an application. We build monitoring with those transactions at the core. We these scripts over and over and gather data about the results and their performance. It’s extremely useful as you add a layer of monitoring to your setup that’s very close to the way your customers experience your application.&lt;/p&gt;
&lt;p&gt;Synthetics are only one piece and belong to a bigger monitoring ecosystem. Combined with other monitoring variants, they provide observability and peace of mind for the folks operating your platform. If you’re intrigued by this, why not test &lt;a href=&quot;https://www.netreo.com/platform/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Netreo’s&lt;/a&gt; approach? Investing in monitoring is key to build resilient systems.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.netreo.com/blog/synthetic-transactions/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Netreo&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Understanding a Software Team Lead's Responsibilities]]></title><description><![CDATA[What are the software team lead responsibilities? In this blog, let's define them from the perspective of servant leadership.]]></description><link>https://hceris.com/software-team-lead-responsibilities/</link><guid isPermaLink="false">https://hceris.com/software-team-lead-responsibilities/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Agile]]></category><category><![CDATA[Team Organization]]></category><pubDate>Sun, 29 Aug 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/404daad021c9f857000b43bfa4aa5f86/8b983/cover.jpg.webp&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRngAAABXRUJQVlA4IGwAAACQAwCdASoUAA0APtFUo0uoJKMhsAgBABoJZwAAQx5UTzLYl0oAAP7rvJ/H8oZBN/cJgdFlpQjLn//3bf3iCApKGvZ10GOqvcCUzJRb5XazbicbgO2kz+64h6SREeuJQNnRahST45S4+o7DAAA=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Team Lead&quot; title=&quot;&quot; src=&quot;/static/404daad021c9f857000b43bfa4aa5f86/08b4d/cover.jpg.webp&quot; srcset=&quot;/static/404daad021c9f857000b43bfa4aa5f86/7b30e/cover.jpg.webp 188w,
/static/404daad021c9f857000b43bfa4aa5f86/f3a60/cover.jpg.webp 375w,
/static/404daad021c9f857000b43bfa4aa5f86/08b4d/cover.jpg.webp 750w,
/static/404daad021c9f857000b43bfa4aa5f86/8b983/cover.jpg.webp 768w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Technical leadership is a broad subject. Authors like &lt;a href=&quot;https://randsinrepose.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Michael Lopp&lt;/a&gt; have spent years talking about leadership. Yet they still have plenty of things to &lt;a href=&quot;https://www.oreilly.com/library/view/the-art-of/9781492045687/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;say&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;At first glance, you’d think this is a straightforward question: &lt;em&gt;What does a technical leader do?&lt;/em&gt; Once you start digging, you realize there isn’t a clear and concise answer to that. It’s problematic because the unstated expectation for many senior engineers is that they’ll eventually transition to a leadership position. And when that finally happens, they struggle because nobody prepared them for that moment.&lt;/p&gt;
&lt;p&gt;Every organization needs to consider what they expect from their technical leaders lest they promote people who are unprepared for a role that they don’t actually want. In this post, I want to talk about technical leadership in the context of an agile team.&lt;/p&gt;
&lt;h2&gt;Different Names for Technical Leaders&lt;/h2&gt;
&lt;p&gt;If you scroll through enough job postings on LinkedIn, you’ll notice that tech leadership positions don’t have consistent names. The ones I’ve encountered the most are&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Engineering manager&lt;/li&gt;
&lt;li&gt;Team lead&lt;/li&gt;
&lt;li&gt;Tech lead&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While every company has its unique understanding of these positions, you can safely make some assumptions about what to expect. Usually, an engineering manager will focus more on the people side, whereas a tech lead will have a stronger focus on technical aspects. The team lead falls in the middle of the spectrum.&lt;/p&gt;
&lt;p&gt;A tech lead is responsible for the technical output of the team: technology choices, architecture decisions, system design, and so on. Even if there’s a tech lead in the team, it doesn’t mean that the rest of the development team doesn’t own this part.&lt;/p&gt;
&lt;p&gt;The people side is about personal development, enabling the growth of others on the team. Some companies make that explicit by having them report to the technical leader and see the role as a manager rather than as an individual contributor. Honestly, I don’t think it makes that big of a difference. Whether you’re officially a people manager or not, your behavior shouldn’t vary much. I’ll get to that when I speak about servant leadership.&lt;/p&gt;
&lt;p&gt;For the rest of this article, I’ll assume that a technical leader has both responsibilities. Let’s talk about them.&lt;/p&gt;
&lt;h2&gt;Three Circles of Responsibility&lt;/h2&gt;
&lt;p&gt;A technical leader’s main job is to ensure that a team delivers successfully. Technology is a tool to deliver business results, and that has to be the first thing on your mind once you move to a leadership position.&lt;/p&gt;
&lt;p&gt;That remains a bit too generic! I still haven’t answered the crucial question: &lt;em&gt;What does a technical leader do?&lt;/em&gt; Let’s split the question into smaller parts. A helpful model is &lt;a href=&quot;https://www.thekua.com/atwork/2015/06/tech-lead-circles-of-responsibility/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Pat Kua’s circles of responsibility.&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/dd0e24e198007dceb3776ffd2c1cd2c5/0955e/circles.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 88.82978723404256%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEF0lEQVR42nXSyW/cdBQH8DdpQqkQnIpaEBJwKGq5cK5UVUIIDtz5FxAIQaBCqD2wH2gPZVFVUIUUSBtF6YWUNIXshKRZZ8tMZsbLLPaM7RmP7cxiz+L199DPGTZVtfSVny35o/fezwCDi11tQnbRgNh0LQJwHlrlAL58fX4kOl07FZ2unZn9mn3MPkCYu8YDv94aKsc7oKT78NAr/qtKE7n9aQoQEcRYZ1TjXL4pBm6zHLg678pSsnv51kfxY8nZeojm77ceDm5OyeGdYkq6P9GqELQURFM+DK3bEkE1Z2/duZJ7fPnHEqTn9MgPb24+iFHEyHtHNM4FMdoZpZipoNuWiN+WCBkkMGW0Ka6kejcwQEAfh268vfUgmJxV4dK5GXj/pduP6LybHXRDMdoZ6ShIKBSiCqJe8KzYb/XnmQkJomvNoes7bRiLm4cYUUtQ2rUjqSUf8vdbp4yiZ5uHIEVIvdBFmsEzdhT0zDJBea11Lp7uAZpk+OeEGbnLdiFZtQE8iQEjXRwW/tyH9QnlaaPgeoMOCe1OyjVR2NfRkgm2K0gUMQgKJQ8Xo+Ynby0aJ+m6Lq814S7bHdqq9AG6zPZQL7sExurYU2Yu+Uuj0KP7+3tvaFUR+zVEVQxwT3BIUrExU3dIVnMwUbXdlVJv6tLCwYnJlAWzbHcIastTIN0bO+mImSJqJWwV9KBVoTsj4anSzlQhwHjZxpzhEM5wCau7yOou4XQXaTbLfe7C78aTn680Dk+4X0hMoiYi6qLtKSU0uDaGqIJoyYgpwcGs7tCPCaM5/wuruzZFV4q9cWqBtjb9rCexfdTLSOoCQaNMsF4hltBCU/RQLvi4pzjIGS4ymkM7Q/7Ap6FYiPKGizHZtr7ZaD0Djej8K0QtUSxAvUzaxQyp52JYy+xgt8ChKqgYV2zkD8fEbK2H0YKGO7xK6xBldSfIqA7eTFrnoBldOE/UIhJNDMGOmCO1TBSV/V30qyxpqzImFJvuiwxAEi8ZIZpV/wXTqoO39qyzoMzdPOFVmMZgZIoiNiSCDZnQuqMIJKV0fdbw/MHOwnH5gyCsGc0J6Mi7sq1dXDg4DthvQ4+LXiV1AVETbVIXfAoHaikI6oKPmuAVKhr9VeiheIzmUDgYxOd016a7nc/3rmgdHyD9/UVYfu+1o3ZxbylEaYf/Tb2EbS4xvpDvTuS0EP0ntDP6blXoz8EbmZEXvpWAHkqkujgJky8/Mdxltj/zKkzRV3jLV3jTreQYM7PxgYgIiCWYYTof7ko2m6zaFs2ubOfvcd2P4fj6kS/+aMBPCTMCndwWNGOLkb3vLoCv8LD87qvH9I2ZF7X1O6e/OgrDtpiF0RAE2JH6AGfjI9e226ev77TPwDvco3HFhueuVmA8aUVmmC78BQZ0Oi0hfy/SAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Circles of responsibility&quot; title=&quot;&quot; src=&quot;/static/dd0e24e198007dceb3776ffd2c1cd2c5/1d69c/circles.png&quot; srcset=&quot;/static/dd0e24e198007dceb3776ffd2c1cd2c5/4dcb9/circles.png 188w,
/static/dd0e24e198007dceb3776ffd2c1cd2c5/5ff7e/circles.png 375w,
/static/dd0e24e198007dceb3776ffd2c1cd2c5/1d69c/circles.png 750w,
/static/dd0e24e198007dceb3776ffd2c1cd2c5/0955e/circles.png 901w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;As a technical leader embedded in a team, you’re going to wear three different hats. Each is equally important, and it’s up to you to keep the right balance at all times. Nobody said being a leader is easy!&lt;/p&gt;
&lt;h3&gt;Developer&lt;/h3&gt;
&lt;p&gt;First of all, you’re still, to some extent, a &lt;strong&gt;developer&lt;/strong&gt; on the team. I strongly believe that a technical leader is more effective if she’s involved in the team’s day-to-day activities. Those include implementing features and reviewing code. So you’ve got to remain hands-on to a certain extent. Every situation is different, but you should aim to devote at least 30 percent of your time to that.&lt;/p&gt;
&lt;p&gt;Sitting in meetings all day atrophies your technical instincts, slowly but &lt;a href=&quot;https://wiki.c2.com/?ArchitectsDontCode&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;inexorably&lt;/a&gt;. Software development evolves rapidly. It’s annoying to be told how to do things by somebody who’s long ceased to be technical. Don’t be that person.&lt;/p&gt;
&lt;h3&gt;Architect&lt;/h3&gt;
&lt;p&gt;The next hat you wear is as an &lt;strong&gt;architect&lt;/strong&gt; for the team. A team needs to have a technical vision based on its business goals, a vision that is known and shared by everybody on the team. It evolves as requirements change and new information becomes available. Architecture is a word that reminds developers of heavyweight documentation and committees. It doesn’t have to be that way, though. Developing an &lt;a href=&quot;https://evolutionaryarchitecture.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;evolutionary architecture&lt;/a&gt; is your best bet to keep alignment between business and technology.&lt;/p&gt;
&lt;p&gt;I’ve said it before, but it bears repeating: being responsible for the architecture doesn’t mean you have to do it yourself. It means that you have to make sure it happens. Keep in mind the difference. If the team doesn’t have any input in establishing this architecture, they won’t see it as theirs.&lt;/p&gt;
&lt;h3&gt;Coach&lt;/h3&gt;
&lt;p&gt;This is the last hat, and it’s the fuzziest one. I prefer to think of this responsibility as being a &lt;strong&gt;coach&lt;/strong&gt; instead of a manager or a boss. It puts you in the right mindset.&lt;/p&gt;
&lt;p&gt;You might be the manager of part or all of the team. Nevertheless, it’s more productive to consider how you can enable others to become better. Their growth is a positive outcome for the team. You’re less of a bottleneck as they take extra ownership, thus boosting their confidence. It’s a virtuous cycle that leads to a more resilient team that doesn’t rely on heroic individual efforts to succeed.&lt;/p&gt;
&lt;p&gt;In my view, the most important thing to do in this role is &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/accelerate-employee-s-growth-fostering-cultivation-culture&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;foster a cultivation culture&lt;/a&gt;. Some skills that will help are&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Active listening&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.thoughtworks.com/insights/blog/5-ways-faster-and-more-effective-feedback&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Giving actionable feedback&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Facilitating discussions instead of owning them&lt;/li&gt;
&lt;li&gt;Being creative in finding growth opportunities&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;There’s Not Enough Time for Everything&lt;/h3&gt;
&lt;p&gt;After seeing this long list of things you’re responsible for, you might be thinking, &lt;em&gt;“There is no way I’ll have time for all this stuff!”&lt;/em&gt; You are completely right. Most newly anointed leads overburden themselves by trying to do everything. They feel responsible for every outcome and involve themselves in every discussion.&lt;/p&gt;
&lt;p&gt;Rest assured, there aren’t enough hours in a day. Learning to delegate is of paramount importance to keep your sanity. Moreover, it’s an antidote against micromanagement.&lt;/p&gt;
&lt;h2&gt;Servant Leadership&lt;/h2&gt;
&lt;p&gt;We went over the blocks that form the job of a technical leader in the previous section. How do you approach implementing them, though? I think that there is one answer for that: &lt;a href=&quot;https://en.wikipedia.org/wiki/Servant_leadership&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Servant leadership&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The idea of servant leadership is that &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/leadership-agile-environment&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;high-performing agile teams&lt;/a&gt; run on their own for the most part. The best technical leaders I’ve observed stay in the background, saying relatively little. However, if you look under the hood, their impact is undeniable. Let’s go over some anti-patterns that are a sign that something is going seriously wrong.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You’re regularly telling others what to do. Giving guidance is fine, especially in a junior team. But if that’s the norm, people won’t think for themselves.&lt;/li&gt;
&lt;li&gt;Seniority and title is a decisive factor in discussions.&lt;/li&gt;
&lt;li&gt;You handle mistakes with punishment instead of as an opportunity to learn.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You don’t need a fancy title to be a leader. In fact, anybody in the team can contribute by taking ownership of part of the delivery. Instead of waiting for a promotion, you should actively start demonstrating and building those skills.&lt;/p&gt;
&lt;h2&gt;Tech Leadership Is a Journey&lt;/h2&gt;
&lt;p&gt;Tech leadership doesn’t have a clearly defined start and end. If you read the book &lt;em&gt;&lt;a href=&quot;https://www.patkua.com/media/books/talking-with-tech-leads/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Talking with Tech Leads&lt;/a&gt;&lt;/em&gt;, you’ll notice that people from very different backgrounds and levels of experience end up in a tech leadership position. It’s not an easy transition, and it’s normal to be lost. I’ve been leading software delivery teams for six years, and I still regularly find myself in situations where I don’t know what to do.&lt;/p&gt;
&lt;p&gt;The right decision depends so much on the concrete setup and the context. It’s frustrating that giving concrete advice is so challenging. One thing that has helped me a lot is learning from the experiences of others. I’ve listed a couple of resources throughout the article. Additionally, I suggest &lt;a href=&quot;https://linearb.io/dev-interrupted-podcast-2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LinearB’s Dev Interrupted Podcast&lt;/a&gt; as another source of inspiration for aspiring technical leaders. Each episode features a senior leader from a well-known company sharing their knowledge about topics like leadership or engineering practices. At around thirty minutes each, the episodes are easily digestible and packed with actionable advice.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://linearb.io/blog/software-team-lead-responsibilities/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LinearB&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How Do You Structure an Engineering Team?]]></title><description><![CDATA[An engineering team structure is about finding a way to provide autonomy, mastery, and purpose to its team members. Let's explore more.]]></description><link>https://hceris.com/how-do-you-structure-an-engineering-team/</link><guid isPermaLink="false">https://hceris.com/how-do-you-structure-an-engineering-team/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Agile]]></category><category><![CDATA[Team Organization]]></category><pubDate>Sat, 31 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ba8d38505b34a3658849a3fbab7b5ceb/6389a/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQL/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHrZVDWJE//xAAaEAEAAgMBAAAAAAAAAAAAAAACAAEDEhNB/9oACAEBAAEFAugqWzU92rHWV7kNA//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAEDAQE/AUf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8BbX//xAAaEAACAgMAAAAAAAAAAAAAAAAAAREhMWGB/9oACAEBAAY/AlRBoxPRNUJH/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBYf/aAAgBAQABPyHaaD2IXFryLaQpclJtQwht9glDO7P/2gAMAwEAAgADAAAAENcf/8QAFxEBAQEBAAAAAAAAAAAAAAAAATEAsf/aAAgBAwEBPxCFyK93/8QAGREBAAIDAAAAAAAAAAAAAAAAAQARITGx/9oACAECAQE/EAt1AMHJ/8QAHRAAAgICAwEAAAAAAAAAAAAAAREAMSFBUWGBkf/aAAgBAQABPxA4GtBZfkSygjZDnwQx+IfcIZiOXyZptwou3NSzxAVJC23yf//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Engineering Team&quot; title=&quot;&quot; src=&quot;/static/ba8d38505b34a3658849a3fbab7b5ceb/acb04/cover.jpg&quot; srcset=&quot;/static/ba8d38505b34a3658849a3fbab7b5ceb/bc01b/cover.jpg 188w,
/static/ba8d38505b34a3658849a3fbab7b5ceb/bf173/cover.jpg 375w,
/static/ba8d38505b34a3658849a3fbab7b5ceb/acb04/cover.jpg 750w,
/static/ba8d38505b34a3658849a3fbab7b5ceb/ec605/cover.jpg 1125w,
/static/ba8d38505b34a3658849a3fbab7b5ceb/6389a/cover.jpg 1325w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;In my &lt;a href=&quot;../choosing-an-engineering-organizational-structure/&quot;&gt;previous piece&lt;/a&gt;, I talked about choosing an engineering organizational structure. Once you have this structure in place, the internal structure of the engineering teams comes next. What does a high-performing engineering team look like?&lt;/p&gt;
&lt;p&gt;Organization and team building are similar but not the same. The design of an organization focuses on the interactions between teams and high-level areas of ownership, whereas building a team involves thinking about the interactions of individual contributors.&lt;/p&gt;
&lt;p&gt;In this post, I want to discuss how to enhance a scalable organization model with agile, cross-functional teams that practice &lt;a href=&quot;https://continuousdelivery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;continuous delivery&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Think Products, Not Projects&lt;/h2&gt;
&lt;p&gt;A common mistake in some older approaches is treating teams as fungible. Management decides to build something, forms a team for half a year, then disbands it. This approach doesn’t work for long-lived software applications. &lt;a href=&quot;https://en.wikipedia.org/wiki/Agile_software_development&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Agile development&lt;/a&gt; relies on constant iteration. A project-based team won’t have enough time to gel. With little cohesion, it will struggle.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.interaction-design.org/literature/topics/product-thinking&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Product thinking&lt;/a&gt; has replaced this approach. Long-term teams based around products (or at least &lt;a href=&quot;https://teamtopologies.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;streams of work&lt;/a&gt;) enable the people working on it to iterate and collaborate effectively. Over time, they acquire a deep knowledge of their domain to the point where they are best equipped to make decisions about the product.&lt;/p&gt;
&lt;h2&gt;Agile Cross-Functional Teams&lt;/h2&gt;
&lt;p&gt;A cross-functional setup formed around a defined product is the most effective way of building software development teams. Before getting into team composition details, let’s mention three principles. They are an excellent guide to forming this kind of team based on the research of Daniel H. Pink, compiled in his book &lt;em&gt;&lt;a href=&quot;https://www.danpink.com/books/drive/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Drive&lt;/a&gt;&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Autonomy&lt;/em&gt;. To be effective, a team has to be autonomous. Dependencies are the blight of high-speed delivery. Empowered contributors with ownership over their work are much more likely to be effective than somebody who is just there to execute other’s people ideas.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Mastery&lt;/em&gt;. The team needs all the necessary skills to deliver their product. If the team misses some skills, a culture of continuous improvement helps cover the gaps.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Purpose&lt;/em&gt;. Knowing the big picture is crucial to making good decisions. Clear, measurable, team-wide goals prevent unnecessary politics. Additionally, people like to know the context and reasoning behind the goals and the decisions of the organization.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Keep these principles in your mind at all times as they’ll guide you toward building teams that require little oversight.&lt;/p&gt;
&lt;h2&gt;Team Composition&lt;/h2&gt;
&lt;p&gt;First of all, teams can’t be too big. Fred Brooks wrote about this in &lt;em&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/The_Mythical_Man-Month&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;The Mythical Man-Month&lt;/a&gt;&lt;/em&gt; as early as 1975. Pairwise interactions grow quadratically with the number of team members to the point where communication degrades. As a rule of thumb, five to eleven people per team is a reasonable number.&lt;/p&gt;
&lt;p&gt;You need all the necessary roles in a team if you want it to be cross-functional. Here are some typical ones:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Developer&lt;/li&gt;
&lt;li&gt;Product owner&lt;/li&gt;
&lt;li&gt;Business analyst&lt;/li&gt;
&lt;li&gt;UX&lt;/li&gt;
&lt;li&gt;QA specialist&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This list is not comprehensive because it greatly depends on the mission of the team and the type of work they tackle.&lt;/p&gt;
&lt;p&gt;What about more specialized roles? For instance, infrastructure experts, security specialists, or data scientists. A team might not need such people full-time, but some of their skills are surely needed occasionally. In this case, my recommendation is to treat them as advisors. These folks provide advice and enablement so the team can integrate the related cross-functional requirements in their flow.&lt;/p&gt;
&lt;p&gt;Involving external parties is a sensible idea. However, it’s important to note that a team shouldn’t relinquish the ownership of its product. Having an external security team that tells the team what they can or can’t do is a common anti-pattern. While their advice is invaluable, you shouldn’t let them be gatekeepers.&lt;/p&gt;
&lt;h2&gt;Generalists vs Specialists&lt;/h2&gt;
&lt;p&gt;Did you notice that I said “developers?” No mention of front end or back end whatsoever. I’m a strong believer in having full-stack engineers on a team. Users don’t care about the division anyhow. It’s my experience that separating developers strictly across technologies encourages siloing. Ensuring that everybody is working on the most impactful chunk of work is much harder if parts of the product are only known to one of two people, a problem known as the &lt;a href=&quot;https://en.wikipedia.org/wiki/Bus_factor&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;bus factor&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Some people think the full-stack mindset means every developer has to know everything. That’s not the point! It’s pretty much impossible anyway. Modern software engineering has so many moving parts that you can’t hope to learn them all. People tend to be more familiar with or more interested in certain parts, and that’s fine. Aim to be &lt;a href=&quot;https://en.wikipedia.org/wiki/T-shaped_skills&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;T-shaped&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is a controversial point in some organizations, so be prepared to make compromises. Don’t give up the fight to avoid and break silos.&lt;/p&gt;
&lt;h2&gt;Technological Leadership of an Agile Team&lt;/h2&gt;
&lt;p&gt;How do you handle the role of a technical leader of an autonomous team? Funny you should ask. I recently wrote an &lt;a href=&quot;https://linearb.io/blog/software-team-lead-responsibilities/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;article&lt;/a&gt; about that. There’s much to say about this topic, but I’ll limit myself to three points:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Leadership isn’t restricted to a role. Everybody can and should show leadership on a team. Taking ownership of parts of the delivery is a perfect example of leadership.&lt;/li&gt;
&lt;li&gt;Having said that, bringing a person to the team to fill a dedicated leadership role is often beneficial. Those skills are different than just having more experience or more tenure.&lt;/li&gt;
&lt;li&gt;Putting a tech lead on a team doesn’t mean abdicating collaborative decision-making. On the contrary, a &lt;a href=&quot;https://www.patkua.com/blog/the-definition-of-a-tech-lead/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;good tech lead&lt;/a&gt; should enhance that aspect by practicing servant leadership.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;A Set of Rituals&lt;/h2&gt;
&lt;p&gt;We’ve talked about principles and team composition. But a team isn’t a static entity. A team is defined not only by &lt;em&gt;what&lt;/em&gt; it does but &lt;em&gt;how&lt;/em&gt; it goes about it as well.&lt;/p&gt;
&lt;p&gt;The ways of working on a team are fundamental parts of its identity. I’m sure you know these agile rituals: a daily standup, regular retrospectives or reviews. Those are tools to &lt;a href=&quot;https://blog.codinghorror.com/sharpening-the-saw/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sharpen your saw&lt;/a&gt;, make you more effective as a team, share information, and broadcast the team’s output to the outside.&lt;/p&gt;
&lt;p&gt;Agile rituals don’t guarantee success. Just because you do a daily in the morning doesn’t mean that you’re getting anything out of it. Think critically and go past the surface to ensure that collaboration or autonomy aren’t just buzzwords in your day to day. While I don’t think a team needs an agile coach to practice agile, it may make sense for a less mature team to get support from a specialist until they’re ready to roll on their own.&lt;/p&gt;
&lt;h2&gt;Measuring the Effectiveness of a Team&lt;/h2&gt;
&lt;p&gt;If teams have clear, measurable goals, everybody has an easier time deciding how to invest their time effectively with little outside guidance. Objectives and key results (&lt;a href=&quot;https://www.whatmatters.com/faqs/okr-meaning-definition-example&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OKRs&lt;/a&gt;) are a popular framework to set actionable goals. Honestly, it’s not about the framework. It’s about the commitment to set goals for a team and evaluating the team and the goals regularly.&lt;/p&gt;
&lt;p&gt;I’ve been part of teams that had completely unreasonable targets set by management without any transparency. If you’re trying to demotivate your engineers, that’s exactly the way to go.&lt;/p&gt;
&lt;p&gt;Be very careful with goals. Ask if they’re forcing team members to choose between their and the team’s best interests. If that happens, it’s a failure, and it’s the fault of the people setting up the organizational structure.&lt;/p&gt;
&lt;h2&gt;Seek Feedback&lt;/h2&gt;
&lt;p&gt;To summarize, structuring engineering teams is about continuing the work that you begin when you structure your engineering organization as a whole. My advice is to have &lt;em&gt;autonomy&lt;/em&gt;, &lt;em&gt;mastery&lt;/em&gt;, and &lt;em&gt;purpose&lt;/em&gt; as your guiding principles. Start from there and iterate constantly.&lt;/p&gt;
&lt;p&gt;Do you need inspiration from the community? I like this &lt;a href=&quot;https://www.slideshare.net/patkua/building-a-high-performing-team-72975599&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;deck&lt;/a&gt; from Pat Kua. LinearB’s &lt;a href=&quot;https://linearb.io/dev-interrupted-community/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Dev Interrupted Community&lt;/a&gt; is a place to share experiences and learn from the successes (and the failures!) of others.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://linearb.io/blog/engineering-team-structure/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LinearB&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Choosing an Engineering Organizational Structure]]></title><description><![CDATA[To scale an engineering organization, it helps to have a engineering organizational structure that encourages autonomy and collaboration.]]></description><link>https://hceris.com/choosing-an-engineering-organizational-structure/</link><guid isPermaLink="false">https://hceris.com/choosing-an-engineering-organizational-structure/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Agile]]></category><category><![CDATA[Team Organization]]></category><pubDate>Fri, 16 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e55cb06986db680daeab62aa25bf43f2/d1ad8/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABRuc1THAVC//EABoQAAIDAQEAAAAAAAAAAAAAAAECAxITADH/2gAIAQEAAQUCgZdbAh1itH7pVD3/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIRIVH/2gAIAQEABj8Cc5SMNsa6VSo0/8QAGRABAQEBAQEAAAAAAAAAAAAAAREhADFB/9oACAEBAAE/ITPDcJ7xSWdbbruPWhhGvKjkJO0/Xf/aAAwDAQACAAMAAAAQ8y//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QxX//xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAgEBPxBJ/8QAGhABAQEAAwEAAAAAAAAAAAAAAREAMUFRkf/aAAgBAQABPxBTDSKW7jJVd3CUZbiRda4whWXjAvdhx91Kpfr5v//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Org Structure&quot; title=&quot;&quot; src=&quot;/static/e55cb06986db680daeab62aa25bf43f2/acb04/cover.jpg&quot; srcset=&quot;/static/e55cb06986db680daeab62aa25bf43f2/bc01b/cover.jpg 188w,
/static/e55cb06986db680daeab62aa25bf43f2/bf173/cover.jpg 375w,
/static/e55cb06986db680daeab62aa25bf43f2/acb04/cover.jpg 750w,
/static/e55cb06986db680daeab62aa25bf43f2/ec605/cover.jpg 1125w,
/static/e55cb06986db680daeab62aa25bf43f2/c58a3/cover.jpg 1500w,
/static/e55cb06986db680daeab62aa25bf43f2/d1ad8/cover.jpg 1621w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Do you belong to an organization that is experiencing rapid growth? Are you shoring up your software development capabilities because &lt;a href=&quot;https://a16z.com/2011/08/20/why-software-is-eating-the-world/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;software is eating the world&lt;/a&gt;? Congratulations, that’s a nice problem to have! But it’s a problem nonetheless.&lt;/p&gt;
&lt;p&gt;Delivering software quickly, reliably, and safely (also known as &lt;a href=&quot;https://continuousdelivery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;continuous delivery&lt;/a&gt;) is no easy task. Surprisingly, the challenge is more about people than technology. Choosing the right structure reduces friction and leads to better outcomes, as books like &lt;em&gt;&lt;a href=&quot;https://itrevolution.com/book/accelerate/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Accelerate&lt;/a&gt;&lt;/em&gt; by Nicole Forsgren show.&lt;/p&gt;
&lt;p&gt;In this post, I’m going to talk about different types of organizational structures. I’ll talk about some older models and some more modern alternatives.&lt;/p&gt;
&lt;h2&gt;Why You Need an Organizational Structure&lt;/h2&gt;
&lt;p&gt;According to &lt;a href=&quot;https://en.wikipedia.org/wiki/Conway%27s_law&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Conway’s Law&lt;/a&gt;, the software that an organization produces mirrors its shape. Or, as Eric S. Raymond said, “If you have four groups working on a compiler, you’ll get a 4-pass compiler.” Technical leaders spend a lot of time thinking about software architecture, for good reason. There are countless horror stories about companies where progress came to a grinding halt due to an impenetrable architecture.&lt;/p&gt;
&lt;p&gt;If the team’s structure has an impact on the architecture, it follows that it’s worth investing effort in building that structure the way you want it. This is known as the &lt;a href=&quot;https://www.thoughtworks.com/de/radar/techniques/inverse-conway-maneuver&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Inverse Conway maneuver&lt;/a&gt;. Moreover, a structure is a tool to enhance alignment as well.&lt;/p&gt;
&lt;h2&gt;Think About What You’re Trying to Accomplish First&lt;/h2&gt;
&lt;p&gt;Before you get all excited and start drawing diagrams, stop and think for a second. Mindless reorganizations done by clueless management are an endless source of &lt;em&gt;Dilbert&lt;/em&gt; comic material.&lt;/p&gt;
&lt;p&gt;Thus, let’s try to think about successful cases. You want teams that deliver quickly without breaking things. And you want to retain that speed as your organization scales in size. Teams need a certain level of independence. Otherwise, they’ll spend most of their time waiting for others. They have to be autonomous.&lt;/p&gt;
&lt;p&gt;Autonomy is desirable but insufficient. You need teams to be aligned as well. If they don’t move in one direction, their speed will be just a local optimization that won’t lead to a company-wide outcome.&lt;/p&gt;
&lt;h2&gt;Old-School Structures&lt;/h2&gt;
&lt;p&gt;Let’s have a look at some older structures. People don’t consider them the blueprint to follow nowadays. Regardless, understanding their shortcomings is a valuable exercise.&lt;/p&gt;
&lt;h2&gt;Technology-Based Teams&lt;/h2&gt;
&lt;p&gt;A classical way of setting up teams is grouping people by their function. So you have something like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1d64d8d9c2038f34150af92330bce665/129e9/tech-based-structure.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVR42o2P309SYRzG3/+gi7bspptmN110UcyrNmATyaYhwSngyBShZUJoU9NZQlTWUmktxRt0bLqpuFXKaku5oM0NsQ4cOV6I5mFk2hEqYa0Uz3Z628sBYyaui8+e9/v7ecHau7ZTX/wWLeO3qhi/Vc34LWperVcZv6X285z1dPTx+eNxp7w6MShXJZxydcJZpU44ZVlFMcpXadf6LxaDzYDNtkX2wORCjl5eSZ44+cS+2SfV/hrVwO0xHG7ndKz6bzzK67ehy50gPv/AmgzbYSpsZ1PUM+7H0iCXWnzOJcO9u6mwHSYWenrijnLtzng1TLu1bHoc59IvrnG7nkYu/fI6l4ndWhbVv7uUdwETsFm2yG6IXGZY6M29f/MOu7s3+6Wan3lOMppxl4s1EP3g65CiAySn64o2fC2l675W8YavVbzuaxFn36INX6v0k/fmiWhD0RGmX1rK9EnFPGVipk+S1b1cabLrzDFQN7ekMBCrXgNBTxoI2pOPnqCn6j8sT9cTEa8uFJvSkzGPgYx59P8yqSdj3rr3K3Jgml981BRahk1kIVZgO7UK28Ir8BbqC0UKYgpQ94ExQHWZQxFYiEZyGd6hVmE79RE2HtKHaAhQNmCcj2DmID1rDkbfmoPRmYNoIOgZI0HPFKrzs/SsMRBRANHTs0clDmGJxCE8J3EIBfspcwgFFwZEAumASHBQPQuaLUG7gGwYtynHa6HSXRgFqv9Hz6VhvBNUjeAWpVsHsQndDjahY/NRuGtY3aSJNb25zd543czWvDJmcvv70CxaKhvBO5DDh4ddxtCxPQ53KRvG74FyJ1Zc4VJpKl0qrNKlurKfijwqC4OhHeVO7OQf5Nu11oZ0tCQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Tech based structure&quot; title=&quot;&quot; src=&quot;/static/1d64d8d9c2038f34150af92330bce665/1d69c/tech-based-structure.png&quot; srcset=&quot;/static/1d64d8d9c2038f34150af92330bce665/4dcb9/tech-based-structure.png 188w,
/static/1d64d8d9c2038f34150af92330bce665/5ff7e/tech-based-structure.png 375w,
/static/1d64d8d9c2038f34150af92330bce665/1d69c/tech-based-structure.png 750w,
/static/1d64d8d9c2038f34150af92330bce665/78797/tech-based-structure.png 1125w,
/static/1d64d8d9c2038f34150af92330bce665/129e9/tech-based-structure.png 1161w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;You have groups like front end, back end, infrastructure, and mobile. Developers work with other developers using the same tools, which in theory allows them to collaborate more closely without having to learn too many distinct technologies.&lt;/p&gt;
&lt;p&gt;The problem is that a product doesn’t have such clear boundaries. Your users couldn’t care less how your back end is structured. They’re interested in how your product works. To deliver any useful feature, it needs to go through multiple teams. Each jump adds coordination effort and delays, thus increasing friction. This setup fosters silos, leading developers to worry about their domain only. In the end, the barriers between teams become higher.&lt;/p&gt;
&lt;h2&gt;Matrix Organization&lt;/h2&gt;
&lt;p&gt;To address this issue, somebody invented the matrix organization. You have the functional groups from the previous setup, but this time you pick people from each area to form project-based teams. These teams work together for the duration of the project and then disband. The cycle happens again for subsequent projects.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d7c528a6fe32d587e0cbe399ca3cb333/129e9/matrix-orga.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 93.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEEklEQVR42pXUa0ybVRgH8Idi4mJiQgyJ8YsaL5kfTGQZTuOHYZwJTFkpvdH2baHAZAO2djAjsqnJdMBGhqO2U5imQN9ewWGm0RGDi9EpUNIWBwVKofRC7bi0Fkdv0L6PaaEJwhbnSX75/895kyc558MLudkPQ04WDU5XCjNf2wO0g49C5vn6mkxEhKRAMAj/aw00szMQAU7U12XVnj33/LHGc8/VNzY+hjiSMdSST/NdLab5Ouj/6c8OOs2leAtgCgB8xj6YDiFzNRb3/B2LL9rDyL5rvQEzYgBfJ/3BdNDBKT8MMPtV2eNT1bS9Toe1DbeWe37y01sseMZ9lZPrkOXvc3x2eFOy31uOQ5a/33bpUDasdJe0hFVMDAx3bWxQmKAQE38Nd1Gh7iKM6EUY1gowrOVvEWBYR+wS0RHx5LcVJes8BHp4rREVE8MWdewX8x389XYAIxZ1PNTNWI8aSlNi1yXrsW8lm3s9sR7VC3eKRPVCDHSxm2G5m6dYIzkYGFai806YcixuJAJDSrzbw8SQoQzXdKJUhgxiDOlFqf1Ooa1cVnLaAa8cfBE/zmatTAx2pd8wYB3swTN7jmBnHoGKV3gof3mT4gAvtd+tBBUHRNj20gtQavK8UWB0Nxk8wYH0wF5P8Me8IdcHpWPeFp7Z28QxLTRxTQtNfLP3fj7hm72XuKPuPJCOjCuqR61IOn244g9Ta6vRhNrlw3dGJrDePI115ilsGLPhexZbqp+6H9MUnhy+3Q4S40Rb1egUaj1Lid9NC5TR5KU07kWsNE5inWUGT1ls+OH4HJ4Zn0WpxYYSiy2VO0nMNqwdGW8FqXGyoWrUtqyeX1yORjcwEYujZn7RX2GcdtRZZl0Ss915wmR3njTbncku3crtpGa7Q2K2+2tHrKfh2LX27CcuCPbecrsupt/wN4+rFRoKnhX3X85l6Vr2cfUXUpKdqW3eTdecw9Q27y9Uns0CJil6v6CHGbxi1PjTAz83aoKHuoo8XH2Zt1hLeBkagZehFaQ6Uye8FzdTK1yl9/DeBbZG3Pa2ho8dZm3COhOgHPMhqtOixXySi9y+Siz9pgarvqvDyutSFPVXI9sgRk5vBXJ6y7ejkskghReBpSmTFWp4KB9V4fRckJpzhCi5UYUFJBdLeiuQ13cURf3HUXjtOPL7jm4ONJSncqcikmgDFllW8PqXhXLV2Pc301dW//HDz69+kd/K0YrldFIgK1TxZEdUfFmyM9RCGYMkZAxSuN1lBkl0FipL3gQgALrHvoalCFbHExQmEhT6o1hzwz4AjzQ9DUy9COhaAop0BBTrS4HTWw5sg/hf0mdFJAHw0U8KWvLPPOhaenLSH2FP+iOcm+7lp5JnjYOtD7EN5Zlsg/iBFJFExj/ro4yPpmcJLQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Matrix based organization&quot; title=&quot;&quot; src=&quot;/static/d7c528a6fe32d587e0cbe399ca3cb333/1d69c/matrix-orga.png&quot; srcset=&quot;/static/d7c528a6fe32d587e0cbe399ca3cb333/4dcb9/matrix-orga.png 188w,
/static/d7c528a6fe32d587e0cbe399ca3cb333/5ff7e/matrix-orga.png 375w,
/static/d7c528a6fe32d587e0cbe399ca3cb333/1d69c/matrix-orga.png 750w,
/static/d7c528a6fe32d587e0cbe399ca3cb333/78797/matrix-orga.png 1125w,
/static/d7c528a6fe32d587e0cbe399ca3cb333/129e9/matrix-orga.png 1161w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;According to Wikipedia, it comes from the &lt;a href=&quot;https://en.wikipedia.org/wiki/Matrix_management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aerospace industry&lt;/a&gt;, back in the 50’s. Aviation is not the first thing that comes to mind when you think of agility, so we’re already off to a bad start. I see two main problems with the model.&lt;/p&gt;
&lt;p&gt;The first drawback is that in this model individual contributors end up having two different managers. If they’re not aligned, they’ll pull those poor developers in two different directions and introduce all kinds of dysfunction in the teams. One hierarchy is messy enough, let alone two.&lt;/p&gt;
&lt;p&gt;The second drawback is treating software delivery as a project. You don’t build a piece of software in one go and then hand it over. It requires constant iteration, and teams greatly benefit from the familiarity of working together in the same system for a while. This approach is now out of favor, with &lt;a href=&quot;https://www.martinfowler.com/articles/products-over-projects.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;product thinking&lt;/a&gt; as an alternative.&lt;/p&gt;
&lt;h2&gt;Modern Approaches&lt;/h2&gt;
&lt;p&gt;I don’t like technology-based splits or project-based teams. What is the alternative then? What is the correct type of team to deliver software?&lt;/p&gt;
&lt;p&gt;A team should be cross-functional and autonomous. This ideal team has people with all the required skills. End-to-end responsibility minimizes handovers. By staying together over a longer period, the team members can iterate frequently and attain a high level of context.&lt;/p&gt;
&lt;p&gt;Additionally, following &lt;a href=&quot;https://www.agilealliance.org/agile101/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;agile practices&lt;/a&gt; is the best way to deliver software. Quick iteration and constant feedback are a repeatable way of achieving results.&lt;/p&gt;
&lt;h2&gt;Spotify Model&lt;/h2&gt;
&lt;p&gt;The Spotify model is somehow best known for &lt;a href=&quot;https://www.agility11.com/blog/2020/6/22/spotify-doesnt-use-the-spotify-model&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;not being in use at Spotify&lt;/a&gt; anymore. Nevertheless, it gets many things right.&lt;/p&gt;
&lt;p&gt;In essence, it’s a refinement of the matrix model. Instead of agile teams, they call them squads. Those squads group into tribes based around a domain. To prevent isolation and teams fixing the same problems multiple times, you form chapters that contain developers working on similar things. (Others call it &lt;a href=&quot;https://adaptmethodology.com/communities-of-practice-tools/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;communities of practice&lt;/a&gt;). A core aspect of Spotify’s implementation is that teams are autonomous and highly independent.&lt;/p&gt;
&lt;p&gt;If you read about Spotify’s experience, you’ll see that they struggled with the dual hierarchy problem from the matrix model. While teams were able to function individually, their interactions were messy. At a certain scale, not every team is working on user-facing applications. It makes sense for an organization to fix cross-cutting concerns. The last model in this article addresses this situation.&lt;/p&gt;
&lt;h2&gt;Team Topologies&lt;/h2&gt;
&lt;p&gt;The book &lt;em&gt;&lt;a href=&quot;https://teamtopologies.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Team Topologies&lt;/a&gt;&lt;/em&gt; by Matthew Skelton and Manuel Pais builds on the concept of autonomous, cross-functional teams. Its key insight is that one team type doesn’t serve all the needs of a growing organization. The authors identify four different kinds of teams:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Stream-aligned team.&lt;/em&gt; Owns an entire slice of the business domain end to end. Similar to a product team.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Enabling team.&lt;/em&gt; Helps stream-aligned teams acquire capabilities they lack.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Complicated subsystem team.&lt;/em&gt; Owns a system that requires deep and specific expertise.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Platform team.&lt;/em&gt; Provides an internal product. Stream-aligned teams use this product as a service to accelerate development.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In a typical organization, most teams are stream-aligned and get support from the other specialized teams where necessary. The second major insight from &lt;em&gt;Team Topologies&lt;/em&gt; is that the interactions between teams are well defined.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Collaboration.&lt;/em&gt; Teams work together for a while. It can be to establish practices or new technologies or discovery.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;X-as-a-Service.&lt;/em&gt; One team provides a service to other teams. It’s treated as a regular product and consumed internally.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Facilitation&lt;/em&gt;: One team works with another team until they build a certain capability.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I don’t remember reading about structured interaction models before, but it makes a lot of sense. If I think about my previous experience, I can picture many examples of teams not managing to work together because they didn’t have a clear agreement on how they would interact.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/615a1b65cfff8f9c2dbce668cd7fabc5/2bef9/topologies.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 27.127659574468087%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABdUlEQVR42h3DbU8SAQDA8XufW05tNZeNVjzY8SDIURJw3HlHBsgUd0fqApIJJwyQUzmZHrlaD1vWfFObX6F3rdaL3HrV9/q3+dt+glZtUerYGPUhpumwaQyoaRUaz7fZbzep1jY4//SO0y/fUOtNTMvBNBzWyzYv1Ap1bZN29RXd/g5bW2WERUlG1xWSGZ1EJs+SukpCW+exXsYf05mcjbLXd+l0R0zeCiBGM4jxFNXdNq2DETGlyCMpx4Ogcl0Qowqx+RUCIRk5Z5DNGUjJPL5gCm8wxdSsSP9wTO/oNRPTARoVjTM7x5vDIu+dAmf7q4ysBh5/BH8ki7CQLVF6aRFfXkN9ZqKsmCSVNaRUgfjTPHPeBD3bZW9wwtRNL71+A/fS4fjCxrkYcPp1yPCzw33xCb6wjFCoWRTcMWG1xHxERlxcxhtKc9sT5e5DiRszPrq2y/jtOXfuLVD88JHOvyuaf37SuvqF9fc3Oz++4wmn8YfS/AepksPmhqRtbgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Team Topologies&quot; title=&quot;&quot; src=&quot;/static/615a1b65cfff8f9c2dbce668cd7fabc5/1d69c/topologies.png&quot; srcset=&quot;/static/615a1b65cfff8f9c2dbce668cd7fabc5/4dcb9/topologies.png 188w,
/static/615a1b65cfff8f9c2dbce668cd7fabc5/5ff7e/topologies.png 375w,
/static/615a1b65cfff8f9c2dbce668cd7fabc5/1d69c/topologies.png 750w,
/static/615a1b65cfff8f9c2dbce668cd7fabc5/2bef9/topologies.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I like this model a lot because it’s actionable and provides a blueprint to organize multiple teams effectively. It’s much more flexible than something like &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/safe&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SAFe&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Find the Approach That Works for You&lt;/h2&gt;
&lt;p&gt;The biggest mistake that you can make is copying what somebody else did without considering your circumstances. It’s unlikely to work. It’s basically a &lt;a href=&quot;https://en.wikipedia.org/wiki/Cargo_cult&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cargo cult&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A more sensible approach is to take a set of general principles like agility or autonomy and build a structure that makes sense for you. If you want to hear about the experiences of others on this journey, I’ve provided a bunch of resources that might be useful for you. Another place to find advice is LinearB’s &lt;a href=&quot;https://linearb.io/dev-interrupted-community/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Dev Interrupted Community&lt;/a&gt;. It’s a &lt;a href=&quot;https://discord.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Discord&lt;/a&gt; community where technical leaders hang out. Having a place to ask other practitioners directly is very valuable to learn from their successes (and their mistakes).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://linearb.io/blog/engineering-organizational-structure/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LinearB&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Monitoring Alerts That Don't Suck]]></title><description><![CDATA[If you've been part of an On-Call rotation, you know how a bad setup will leave you (literally) sleepless. Let's work on fixing that]]></description><link>https://hceris.com/monitoring-alerts-that-dont-suck/</link><guid isPermaLink="false">https://hceris.com/monitoring-alerts-that-dont-suck/</guid><category><![CDATA[Monitoring]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Alerts]]></category><category><![CDATA[On-Call]]></category><pubDate>Fri, 02 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a41e9cd0b8e834da1989e7ec7b9e4791/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgX/2gAMAwEAAhADEAAAAenPXhmOwwFf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAEQMhIv/aAAgBAQABBQJtKjktUqwMfc//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFxEAAwEAAAAAAAAAAAAAAAAAEBIhIv/aAAgBAgEBPwHK0f/EABoQAAICAwAAAAAAAAAAAAAAAAERAhAAEiH/2gAIAQEABj8CJzWQXLZk6//EABkQAQEBAQEBAAAAAAAAAAAAAAERACExYf/aAAgBAQABPyFfIMH6VW5xoHIK54ck03//2gAMAwEAAgADAAAAEIA//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EKa//8QAGBEBAAMBAAAAAAAAAAAAAAAAAQARIUH/2gAIAQIBAT8QAKm8mz//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFRgf/aAAgBAQABPxA3S8gevINFU+iNNTJC0JImxzRo+Ro7Z//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alert&quot; title=&quot;&quot; src=&quot;/static/a41e9cd0b8e834da1989e7ec7b9e4791/acb04/cover.jpg&quot; srcset=&quot;/static/a41e9cd0b8e834da1989e7ec7b9e4791/bc01b/cover.jpg 188w,
/static/a41e9cd0b8e834da1989e7ec7b9e4791/bf173/cover.jpg 375w,
/static/a41e9cd0b8e834da1989e7ec7b9e4791/acb04/cover.jpg 750w,
/static/a41e9cd0b8e834da1989e7ec7b9e4791/ec605/cover.jpg 1125w,
/static/a41e9cd0b8e834da1989e7ec7b9e4791/c58a3/cover.jpg 1500w,
/static/a41e9cd0b8e834da1989e7ec7b9e4791/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  On-Call me maybe
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Have you ever been part of an &lt;a href=&quot;https://www.pagerduty.com/resources/learn/call-rotations-schedules/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;On-Call&lt;/a&gt; rotation?&lt;/p&gt;
&lt;p&gt;If so, you know how annoying it is to have monitoring alerts that you can’t trust. If they don’t trigger, you’ll live in fear of missing an incident. If they trigger too much, they won’t let you sleep. Neither case sounds great.&lt;/p&gt;
&lt;p&gt;Over the past year and a half, I’ve been part of projects that practice On-Call. You’d be surprised how easily people get used to situations that are so clearly dysfunctional. In this post, I want to talk about how I’ve tried to improve the quality of our alerts.&lt;/p&gt;
&lt;h2&gt;What Is the Goal of Alerting?&lt;/h2&gt;
&lt;p&gt;Simply put, to detect problems in your application before your customers do. Highly available systems can’t afford to wait for a human operator to check if everything looks good. That’s too slow in case of an incident. You want the responsible people to know that something is wrong immediately.&lt;/p&gt;
&lt;p&gt;Converting monitoring systems into alerts is a natural transition. In fact, platforms like &lt;a href=&quot;https://www.datadoghq.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DataDog&lt;/a&gt; or &lt;a href=&quot;https://www.splunk.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Splunk&lt;/a&gt; include these capabilities as part of their offerings.&lt;/p&gt;
&lt;p&gt;Let’s say you read one of the &lt;a href=&quot;https://sre.google/books/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SRE books&lt;/a&gt;, and you’re now all about SLAs, error budgets, and all the good stuff. How to distill an alert to its base essence? An alert &lt;strong&gt;has&lt;/strong&gt; to fulfill two conditions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It triggers when there’s a problem (avoids false negatives)&lt;/li&gt;
&lt;li&gt;Non-issues don’t cause it to trigger (avoids false positives)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When you put it like that, it kind of sounds trivial. Well, you wouldn’t believe how often one of the conditions doesn’t hold, though. Or both. Let’s explore how you end up in this situation.&lt;/p&gt;
&lt;h2&gt;The Slow Descent Into Unreliability&lt;/h2&gt;
&lt;p&gt;As Tolstoy &lt;a href=&quot;https://en.wikipedia.org/wiki/Anna_Karenina_principle&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;said&lt;/a&gt;, each unhappy alerting setup is unreliable in its own way. I bet every developer has a story about an error that &lt;em&gt;just&lt;/em&gt; wouldn’t go away.&lt;/p&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f06baa975d50ea549df948d01f8fd425/eea4a/ruins.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABhafYY5B//8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAERAxQf/aAAgBAQABBQJRZ627gOP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAEAAwAAAAAAAAAAAAAAAAABACBx/9oACAEBAAY/AjY1/8QAGBABAAMBAAAAAAAAAAAAAAAAAQARQTH/2gAIAQEAAT8hGz3Uw24QdVBGxL7Fbn//2gAMAwEAAgADAAAAEP8AP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EIf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARITFBUXGx/9oACAEBAAE/EAkDkeyeSh25ZOLgUEXrUOsRAtERSzP/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Ruins&quot; title=&quot;&quot; src=&quot;/static/f06baa975d50ea549df948d01f8fd425/acb04/ruins.jpg&quot; srcset=&quot;/static/f06baa975d50ea549df948d01f8fd425/bc01b/ruins.jpg 188w,
/static/f06baa975d50ea549df948d01f8fd425/bf173/ruins.jpg 375w,
/static/f06baa975d50ea549df948d01f8fd425/acb04/ruins.jpg 750w,
/static/f06baa975d50ea549df948d01f8fd425/ec605/ruins.jpg 1125w,
/static/f06baa975d50ea549df948d01f8fd425/eea4a/ruins.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  A bit of tech debt
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are many causes of untrustworthy alerts: Unstable infrastructure, spikes in traffic, legacy applications that time out randomly. Every failure has an origin buried deeply somewhere.&lt;/p&gt;
&lt;p&gt;In my experience, it’s not like you get to this point suddenly. Rather, it’s a slow decay. You don’t calibrate the conditions properly, which leads to occasional activation. It progressively gets worse over time while people get used to it. At some point, it’s as if things were &lt;em&gt;always&lt;/em&gt; like that. If there’s one thing to take from this article: Don’t let this happen.&lt;/p&gt;
&lt;p&gt;One way or another, we need to consider the possibility of flakiness when designing alerts for our systems.&lt;/p&gt;
&lt;h2&gt;Monitoring a Microservice&lt;/h2&gt;
&lt;p&gt;A comprehensive monitoring setup is a topic for a book, not a blog post. Let’s say we’re starting small. I want to monitor a single microservice. Keep in mind that these are technical metrics. We’re not measuring business outcomes (yet), as we seek to have a solid base before that. With that in mind, I’m borrowing the &lt;a href=&quot;https://www.weave.works/blog/the-red-method-key-metrics-for-microservices-architecture/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RED method&lt;/a&gt;. These are the metrics we want to monitor.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Rate&lt;/em&gt;: Number of requests&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Error Rate&lt;/em&gt;: % of failed requests&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Duration&lt;/em&gt;: Time to fulfill a request. You see it as &lt;em&gt;latency&lt;/em&gt; as well.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That’s about it. These three metrics provide a meaningful view into the state of this hypothetical microservice. There are plenty of alert combinations to cover them, though.&lt;/p&gt;
&lt;h3&gt;A Reasonable Set of Alerts for Reasonable People&lt;/h3&gt;
&lt;p&gt;I won’t claim that this works in every situation. Still, I’ve had success lately using alert pairs instead of a single alert.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Flatline Alert&lt;/em&gt;: Catch extreme conditions through an absolute threshold, like a service receiving no traffic.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Change% Alert&lt;/em&gt;: Catch rapid changes in a metric, like the error rate spiking.&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3a914bafce322c65c55b3177c674253b/c1b63/alert.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 33.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7klEQVR42p2P607CQBBG+/5PJmKhCE3lYioFjVagxqbd+x6zBQL2h4lscnI230xmdiMhBE3T8FIVZOWC/G1JsV2QViuy3ZJsv+p4OrnP/DtnXucs6qMjgFZIknVKXCTMnhOyecLd64R4+8hwkzDcTLgvLh4UYwbrcef4Y8qonPHwPmX0mZ4GlnvafUUla2SjQR3wUuMN/z7R7vCFVBbnDMpqrLX4YGc7nHc9/J9EYYB1Du99tyGEyvrLypB7f6z3fL5f592Xw1BtDMY5hLY0ynRLbiE6v0xqQ6s0QmlksFQobZBa/+aqLlToueSh/web2BsFX8hMLwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alert&quot; title=&quot;&quot; src=&quot;/static/3a914bafce322c65c55b3177c674253b/1d69c/alert.png&quot; srcset=&quot;/static/3a914bafce322c65c55b3177c674253b/4dcb9/alert.png 188w,
/static/3a914bafce322c65c55b3177c674253b/5ff7e/alert.png 375w,
/static/3a914bafce322c65c55b3177c674253b/1d69c/alert.png 750w,
/static/3a914bafce322c65c55b3177c674253b/78797/alert.png 1125w,
/static/3a914bafce322c65c55b3177c674253b/c1b63/alert.png 1200w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;For each of the RED metrics, you deploy a pair of alerts. For instance, to cover the rate, you have a flatline for zero or close-to-zero requests and a change alert if traffic drops something like 50% within 15 minutes (tune numbers based on situation).&lt;/p&gt;
&lt;p&gt;There’s quite a bit of overlap between all these alerts, but at the same time, they provide &lt;a href=&quot;https://en.wikipedia.org/wiki/Defense_in_depth_(computing)&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;defense in depth&lt;/a&gt;. Any decent incident management system can handle grouping, anyway. The sum of a threshold and a change percentage means that you don’t have to be too precise in tuning these values.&lt;/p&gt;
&lt;p&gt;I like to keep the priorities simple and use one or two different priorities at most. It’s tempting to be overly granular, but that can backfire by introducing extra cognitive load.&lt;/p&gt;
&lt;h2&gt;Some Ideas to Keep in Mind&lt;/h2&gt;
&lt;p&gt;There’s a lot to say about how to set the alerts and tune them. It’s also something that’s is dependent on your tools, and how you set up your systems. I’m going to pivot away from these details and talk about good practices and anti-patterns. I believe these are broadly applicable in different contexts.&lt;/p&gt;
&lt;h3&gt;Fight Alert Fatigue&lt;/h3&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9397844f0444d9983f3490d9382ee17f/eea4a/fatigue.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.93617021276595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIB/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABVO42SR//xAAXEAEBAQEAAAAAAAAAAAAAAAABABEg/9oACAEBAAEFAhLThv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAVEAEBAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQAGPwKL/8QAGhAAAwADAQAAAAAAAAAAAAAAAAERITFBwf/aAAgBAQABPyFjwJlUWBTqhELpsf/aAAwDAQACAAMAAAAQhz//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QGP/EABsQAQACAwEBAAAAAAAAAAAAAAEAESExQVHw/9oACAEBAAE/EEG6Jj19qLXyeXvyWF2njsghkHByA4MYIAxAn//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Fatigue&quot; title=&quot;&quot; src=&quot;/static/9397844f0444d9983f3490d9382ee17f/acb04/fatigue.jpg&quot; srcset=&quot;/static/9397844f0444d9983f3490d9382ee17f/bc01b/fatigue.jpg 188w,
/static/9397844f0444d9983f3490d9382ee17f/bf173/fatigue.jpg 375w,
/static/9397844f0444d9983f3490d9382ee17f/acb04/fatigue.jpg 750w,
/static/9397844f0444d9983f3490d9382ee17f/ec605/fatigue.jpg 1125w,
/static/9397844f0444d9983f3490d9382ee17f/eea4a/fatigue.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Too many alarms in one night
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Alerts should trigger for conditions that require immediate attention and for that only. I can’t stress this enough. &lt;a href=&quot;https://en.wikipedia.org/wiki/Alarm_fatigue&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Alarm fatigue&lt;/a&gt; slowly creeps in, and before you know it, you’ve internalized that people get paged twenty times a day, and it was never any different.&lt;/p&gt;
&lt;p&gt;Be decisive. If an alert is noisy, change it or delete it. Don’t get used to the situation.&lt;/p&gt;
&lt;h3&gt;Start Simple&lt;/h3&gt;
&lt;p&gt;Yes, the latest talk from somebody at &lt;a href=&quot;https://en.wikipedia.org/wiki/Big_Tech&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;FAANG&lt;/a&gt; mentions an intricate setup. I can promise you there was a ton of iteration to get there. Don’t get Big Tech envy. Start simple. It’s never too late to introduce extra complexity.&lt;/p&gt;
&lt;h3&gt;Multiple Angles&lt;/h3&gt;
&lt;p&gt;I see people making the mistake of trying to find the perfect alert that exactly covers their service. One such alert will be hard to tune if that’s possible at all. Instead, a combination of alerts does the job as well, and it’s simpler to maintain. Let your tools handle the grouping.&lt;/p&gt;
&lt;h3&gt;Have A Playbook&lt;/h3&gt;
&lt;p&gt;An alert is just the first step. You need to give whoever picks it an actionable playbook. Don’t make assumptions about their knowledge. Somebody reacting to an alert might not have enough information to handle it. Make their life easier and they’ll thank you.&lt;/p&gt;
&lt;h3&gt;Seek the Right Metrics&lt;/h3&gt;
&lt;p&gt;Raw numbers aren’t descriptive on their own. An error rate (errors / requests) says more than a count of errors. Similarly, a &lt;a href=&quot;https://www.elastic.co/blog/averages-can-dangerous-use-percentile&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;percentile&lt;/a&gt; says more about your users’ experience than an average.&lt;/p&gt;
&lt;h3&gt;Test your Alerts&lt;/h3&gt;
&lt;p&gt;Testing alerts isn’t always practical. Much like when you do &lt;a href=&quot;https://martinfowler.com/bliki/TestDrivenDevelopment.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TDD&lt;/a&gt;, you want to prove that they actually do something. It’s awkward to realize that a pristine alert won’t ever activate.&lt;/p&gt;
&lt;h2&gt;Avoid Doing This&lt;/h2&gt;
&lt;p&gt;Surely there’s some situation where you can argue that the following practices make sense. Maybe? I think it’s a good idea to stay away from them.&lt;/p&gt;
&lt;h3&gt;Absolute Thresholds&lt;/h3&gt;
&lt;p&gt;Absolute thresholds are risky. They’re hard to get right, especially if your traffic is spiky or unpredictable. If you somehow manage to get a value that works &lt;em&gt;now&lt;/em&gt;, that doesn’t mean it’ll work in the future.&lt;/p&gt;
&lt;p&gt;I’d leave absolute thresholds for unequivocal triggers. It’s hard to argue that a service getting no requests whatsoever is healthy (unless it’s deactivated?).&lt;/p&gt;
&lt;h3&gt;Creating Alerts Manually&lt;/h3&gt;
&lt;p&gt;Creating and tuning alerts manually doesn’t scale. The more alerts you create, the more visible it becomes. Using &lt;a href=&quot;https://www.hashicorp.com/resources/what-is-infrastructure-as-code&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Infrastructure as Code&lt;/a&gt; is a much sustainable approach. &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; has providers for most of the monitoring players.&lt;/p&gt;
&lt;h3&gt;Alerts for Services with Low Traffic&lt;/h3&gt;
&lt;p&gt;Services that don’t have a lot of traffic are not suited for classical alerts. For instance, using a p50 latency in a service that gets 30 requests per hour is per definition flaky. One or two slow calls are enough to skew the metric so that it triggers an alert. By creating such alerts, you’re expecting your downstream dependencies to have a consistency that they might be unable to offer.&lt;/p&gt;
&lt;p&gt;My recommendation is to stick to flatline alerts for these types of services. Alternatively, filter the metrics to include events that you can trust.&lt;/p&gt;
&lt;h2&gt;Keep Your Sanity&lt;/h2&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/da5390a00ed3da32a6e36dc797ca9bb9/f93b5/thisisfine.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAAB2W2fFVS8D//EABsQAAEEAwAAAAAAAAAAAAAAAAIAAQMSEBEy/9oACAEBAAEFAjhFlQKtGOj5iFsf/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AYiI/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAISARH/2gAIAQIBAT8BVtnpbH//xAAYEAACAwAAAAAAAAAAAAAAAAAAMiAhMf/aAAgBAQAGPwLBbFh//8QAGhABAAMAAwAAAAAAAAAAAAAAAQARIVFhof/aAAgBAQABPyEfPUHA1rzDg13bDaGWKrLjmE//2gAMAwEAAgADAAAAELjf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAFh/9oACAEDAQE/ELZi/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERMUH/2gAIAQIBAT8QrM8L9P/EABkQAQEBAQEBAAAAAAAAAAAAAAERACExUf/aAAgBAQABPxB4yEUVMhfNdEDtAv33QJYdorgCUjzJTuDFuBIAfDf/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;This is fine&quot; title=&quot;&quot; src=&quot;/static/da5390a00ed3da32a6e36dc797ca9bb9/f93b5/thisisfine.jpg&quot; srcset=&quot;/static/da5390a00ed3da32a6e36dc797ca9bb9/bc01b/thisisfine.jpg 188w,
/static/da5390a00ed3da32a6e36dc797ca9bb9/f93b5/thisisfine.jpg 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Alerts are music to my ears
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I firmly believe that it’s better to have a more modest setup that your engineers fully trust than a complex one that drives them nuts.&lt;/p&gt;
&lt;p&gt;Alerts &lt;strong&gt;aren’t&lt;/strong&gt; stationary but rather evolve constantly. If you have a solid foundation you can refine triggers quickly. If you have a dumpster fire it’s hard enough for the whole thing not to collapse.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[From Redux to the Context API: A Practical Migration Guide]]></title><description><![CDATA[Let's migrate a React application built with Redux to the Context API and see how it looks like]]></description><link>https://hceris.com/redux-to-context-practical-migration-guide/</link><guid isPermaLink="false">https://hceris.com/redux-to-context-practical-migration-guide/</guid><category><![CDATA[React]]></category><category><![CDATA[Redux]]></category><category><![CDATA[Context API]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[State Management]]></category><pubDate>Mon, 14 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In my previous post, &lt;a href=&quot;https://auth0.com/blog/starting-a-new-app-with-redux-consider-context-api-first/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;strong&gt;Starting a New App With Redux? Consider Context API First&lt;/strong&gt;&lt;/a&gt;, I wrote about the &lt;a href=&quot;https://reactjs.org/docs/context.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Context API&lt;/a&gt; as a viable alternative to &lt;a href=&quot;https://redux.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Redux&lt;/a&gt;. In this post, I want to show how a React application using Redux looks when using the Context API.&lt;/p&gt;
&lt;h2&gt;First Considerations&lt;/h2&gt;
&lt;p&gt;I’m assuming that my previous article intrigued you enough that you’re considering migrating away from Redux. You have to ask yourself: Is a migration worth it? The approach based on the Context API might be simpler, but that’s not enough of an argument on its own to rewrite perfectly functional code.&lt;/p&gt;
&lt;p&gt;I can’t tell you if your situation merits the change or not. You have to consider your circumstances and decide based on that. Here are some helpful questions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Is this application &lt;strong&gt;likely&lt;/strong&gt; to change? The benefits of a simpler codebase become apparent when people are regularly working on it.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Is this application &lt;strong&gt;safe&lt;/strong&gt; to change? Without a solid base of tests to rely on, a major refactoring is doomed to fail.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Does it make sense from a &lt;strong&gt;business perspective&lt;/strong&gt;? I get it. Developers love to work on restructuring their applications. But without alignment with your stakeholders, they may perceive it as technology for the sake of technology.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;A General Approach&lt;/h2&gt;
&lt;p&gt;Alright, you’re still here. You might be thinking: &lt;em&gt;Let’s do this!&lt;/em&gt;. What is the plan? You need &lt;em&gt;one&lt;/em&gt;. I strongly recommend an incremental approach. Whatever you do, don’t do a Big Bang release. Work on small chunks of functionality, and release them bit by bit. You’ll thank me later.&lt;/p&gt;
&lt;p&gt;Also, be realistic. If your application is big enough, this isn’t going to be an immediate transition. In my experience, people often fail to account for the transition period during a migration.&lt;/p&gt;
&lt;h2&gt;Enough Talking, Show me the Code!&lt;/h2&gt;
&lt;p&gt;This article is a practical guide with a working example. I’ve built a small application bootstrapped with &lt;a href=&quot;https://github.com/facebook/create-react-app&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;create-react-app&lt;/code&gt;&lt;/a&gt;. It implements a simplified shopping cart. This shopping cart has a preconfigured list of products. You can add and remove these products to your cart. The total price gets updated after each operation. Additionally, you can switch between two user interface themes. Here is a screenshot that shows how the application looks like:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/6ab0929861e97fa6319004ffe6699ff7/8d9a9/shopping-cart.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.61702127659575%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsUlEQVR42o2R327aMBTGIyEegAtegAskXoH34q12gWgEUiSkdasGCRqdIEr3p4Um0AAhcYITJ85i+1SJh8Q6qex3ZR+fz5+/Y6XVanU6nXa73Ww2lWvU6/VGo1Gr1brdbq/XU/r9/k3FcDi8uWAwGKiq+qFCVVVZVFVV07TRaKRp2ng8VlzX3W63m82mKAo4IyoAACHk+76sXJ7KhQIAu91O1/UwDIUQjLHlcjmbzQghAJAkCcZYCMHPIIQwxpRShJAihDBN8+PtrW3bAEApNQzjy2QSBAEAEELiOIYLhBBFUQRBEIZh6Wzb9uLb/Hg8AkBRFN8fLMtcSk2SJGmawt9I/z9inOZ3vzzOuQyzPkT3diD7KKVZlsE/nE4njLEiAFiSxU8HQXNeiXM/JmsPzjN7h9I5I2Tn2IwxzjkABJ53eHmp3iHezPnNd5Ti1Wo11XXP82TmxWLxdT7HVeb3zUuxZVl3nz85jlOGzPOZYUynE4TQf4nd/X5uWtEpkt2P62fr52Oe53CNUpymv++fImBcDmwfZD82uLrompiDYAlhzy7PKBei3PoRc/aMsavTfgWOEuKsKIM2hwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;A screenshot of the shopping cart&quot; title=&quot;&quot; src=&quot;/static/6ab0929861e97fa6319004ffe6699ff7/1d69c/shopping-cart.png&quot; srcset=&quot;/static/6ab0929861e97fa6319004ffe6699ff7/4dcb9/shopping-cart.png 188w,
/static/6ab0929861e97fa6319004ffe6699ff7/5ff7e/shopping-cart.png 375w,
/static/6ab0929861e97fa6319004ffe6699ff7/1d69c/shopping-cart.png 750w,
/static/6ab0929861e97fa6319004ffe6699ff7/78797/shopping-cart.png 1125w,
/static/6ab0929861e97fa6319004ffe6699ff7/aa440/shopping-cart.png 1500w,
/static/6ab0929861e97fa6319004ffe6699ff7/8d9a9/shopping-cart.png 2244w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The source code is &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;. The state management uses Redux. I’ve included a new branch (&lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/tree/context-api&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;context-api&lt;/a&gt;) to show how I converted the project to leverage the Context API. To run it, do the following and it’ll be available under &lt;a href=&quot;http://localhost:3000&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;http://localhost:3000&lt;/a&gt;:&lt;/p&gt;
&lt;!-- context-migration-start --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yarn
yarn start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are three main areas worth talking about (theming, products, cart). Let’s discuss them.&lt;/p&gt;
&lt;h3&gt;Introducing Theming&lt;/h3&gt;
&lt;p&gt;Many websites today allow users to change the theme, like &lt;a href=&quot;https://github.com/settings/appearance&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Github&lt;/a&gt;. You don’t want to implement two separate versions of your site, right? A better approach is to define a &lt;em&gt;theme&lt;/em&gt;, which is a collection of settings such as a color palette, stylings for primary and secondary actions, font sizes, and things like that. You propagate these settings through the application, then style your components accordingly.&lt;/p&gt;
&lt;p&gt;A theme is a classic example of state that influences almost every component throughout the app. Moreover, it doesn’t change very often unless you have very undecided users. It’s an ideal scenario for the Context API.&lt;/p&gt;
&lt;p&gt;I’m theming the &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/header/Header.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Header&lt;/a&gt; component. This component styles itself based on two properties, &lt;code class=&quot;language-text&quot;&gt;foreground&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;background&lt;/code&gt;.&lt;/p&gt;
&lt;!-- context-migration-header --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; PropTypes &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;prop-types&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; cx &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;classnames&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; styles &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Header.module.css&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foreground&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; background&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toggle &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;header&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        styles&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;foreground&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        styles&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;background&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-bg&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;heading&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Shopping Cart&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Foreground: &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;foreground&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt;
        &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;button&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          styles&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;background&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          styles&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;foreground&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-bg&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token attr-name&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toggle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        Toggle
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Header&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;propTypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;foreground&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When using Redux, the theme resides in the state. The &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt; is connected to the store, and there’s a &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/header/reducer.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;reducer&lt;/a&gt; that flips &lt;code class=&quot;language-text&quot;&gt;foreground&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;background&lt;/code&gt; when the user clicks the toggle button.&lt;/p&gt;
&lt;!-- context-migration-toggle-theme --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// action&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOGGLE_ACTION&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;theme:toggle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;toggleAction&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOGGLE_ACTION&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// reducer&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;foreground&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;black&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; theme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;produce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;draft&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOGGLE_ACTION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; tmp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foreground&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foreground &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;background&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;background &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tmp&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; theme&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// connected component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;theme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;toggle&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toggleAction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Header&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sweet! How does the Context API version look in comparison? In this case, we’re building an extra component, &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/context-api/src/themeProvider/ThemeProvider.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ThemeProvider&lt;/a&gt;. It holds the state and makes it available for downstream components through a &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;. Concretely, using a custom hook &lt;code class=&quot;language-text&quot;&gt;useTheme&lt;/code&gt;. This custom hook is a wrapper around the handy &lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#usecontext&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useContext&lt;/a&gt; hook provided by React. It’s an elegant way for the consumers to get access to the data.&lt;/p&gt;
&lt;!-- context-migration-theme-provider --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; useState &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ThemeProvider&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;theme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; setTheme&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;foreground&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;black&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foreground&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; background &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; theme&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;toggle&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;setTheme&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;foreground&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; background&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; foreground &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; theme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toggle &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useTheme&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; ThemeProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What about the &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt; component? It doesn’t change much, except it’s not connected anymore. Instead, we use the &lt;code class=&quot;language-text&quot;&gt;useTheme&lt;/code&gt; hook that we’ve created:&lt;/p&gt;
&lt;!-- context-migration-simple-header --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Header&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; theme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toggle &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useTheme&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foreground&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; background &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; theme
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One thing I like about this implementation is that we get a cleaner set of props. There is a clear difference between the two types of props: The ones passed by the parent and the ones belonging to the provider.&lt;/p&gt;
&lt;p&gt;The purpose of a component like &lt;code class=&quot;language-text&quot;&gt;ThemeProvider&lt;/code&gt; is to enable theming for &lt;em&gt;every&lt;/em&gt; component. Much like the header does, every other component can access the settings through &lt;code class=&quot;language-text&quot;&gt;useTheme&lt;/code&gt; and style itself, without changes in intermediate components. In fact, this is how libraries like &lt;a href=&quot;https://styled-components.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;styled-components&lt;/a&gt; do it. Unsurprisingly, &lt;em&gt;styled-components&lt;/em&gt; supports theming out of the box.&lt;/p&gt;
&lt;h3&gt;List of Products as a Provider&lt;/h3&gt;
&lt;p&gt;Next comes the list of products. This application is fetching the list of available products using a service. For simplicity, the list is hardcoded. In real life, there’d be a backend delivering these results.&lt;/p&gt;
&lt;p&gt;Fetching data from a downstream service is an asynchronous operation. Once completed, I include it in the application’s state. One way of doing asynchronous operations in Redux is by using &lt;a href=&quot;https://github.com/reduxjs/redux-thunk&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;redux-thunk&lt;/a&gt;. When the component is mounted, it triggers the thunk. The thunk runs asynchronously. After finishing, it modifies the state through an action. I know it sounds confusing, so let’s have a look at a diagram:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2024e83cd78c018477fb3709533a5086/bb7dd/thunk-flow.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB13uglHE//8QAGRABAAIDAAAAAAAAAAAAAAAAAgABESAx/9oACAEBAAEFAgEZXMXp/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAQQDAAAAAAAAAAAAAAAAAAECERIgITH/2gAIAQEABj8CdZ1pNSh3D//EABsQAQACAgMAAAAAAAAAAAAAAAEAESAhMVGh/9oACAEBAAE/IUGo4HUNkgbNecP/2gAMAwEAAgADAAAAENg//8QAFhEBAQEAAAAAAAAAAAAAAAAAABFB/9oACAEDAQE/EMR//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAh/9oACAECAQE/EDWb/8QAHBAAAgICAwAAAAAAAAAAAAAAASEAESBBMXGR/9oACAEBAAE/EG06P3Q9m4jbZL4cJI0DQoaw/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;How a thunk ends up modifying the state&quot; title=&quot;&quot; src=&quot;/static/2024e83cd78c018477fb3709533a5086/acb04/thunk-flow.jpg&quot; srcset=&quot;/static/2024e83cd78c018477fb3709533a5086/bc01b/thunk-flow.jpg 188w,
/static/2024e83cd78c018477fb3709533a5086/bf173/thunk-flow.jpg 375w,
/static/2024e83cd78c018477fb3709533a5086/acb04/thunk-flow.jpg 750w,
/static/2024e83cd78c018477fb3709533a5086/ec605/thunk-flow.jpg 1125w,
/static/2024e83cd78c018477fb3709533a5086/c58a3/thunk-flow.jpg 1500w,
/static/2024e83cd78c018477fb3709533a5086/bb7dd/thunk-flow.jpg 2101w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/products/Products.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Products&lt;/a&gt; component is both the start and the end of this flow.&lt;/p&gt;
&lt;!-- context-migration-products --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; PropTypes &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;prop-types&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; fetchProducts &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./actions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Product &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Product&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; styles &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Products.module.css&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Products&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fetchProducts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Product List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ul className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;list&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;product&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Product key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ul&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The action and the reducer aren’t particularly interesting. It’s only triggering an asynchronous call and putting the result as-is in the state.&lt;/p&gt;
&lt;p&gt;If you think about it, there is a bit too much indirection for what is a fairly simple operation. I want to trigger the request, wait for it, and reflect that update in the state. We’re using a more direct approach with the Context API.&lt;/p&gt;
&lt;p&gt;I like to use &lt;a href=&quot;https://github.com/streamich/react-use&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;react-use&lt;/a&gt; for this use case. It’s a collection of &lt;a href=&quot;https://reactjs.org/docs/hooks-intro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;hooks&lt;/a&gt; that provide a thin layer of abstraction on top of the standard &lt;code class=&quot;language-text&quot;&gt;useState&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt;. Let’s see how to fetch the data with the help of &lt;a href=&quot;https://github.com/streamich/react-use/blob/master/docs/useAsync.md&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useAsync&lt;/a&gt;. Again, we’re extracting the data fetching to a provider. Planning ahead, other components are going to be interested in the list of products as well. You can find it &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/context-api/src/productsProvider/ProductsProvider.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;!-- context-migration-products-provider --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useContext &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useAsync &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-use&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; fetchProducts &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./fetchProducts&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ProductsProvider&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fetchProducts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;loading&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Loading&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Error&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useProducts&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; ProductsProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The structure is similar to the &lt;code class=&quot;language-text&quot;&gt;ThemeProvider&lt;/code&gt;. Notice that we don’t render the children until we have the data. That way, there’s no need to account for the empty state in the children components.
Simple, isn’t it?&lt;/p&gt;
&lt;p&gt;As a bonus, I get two extra variables in my local state, &lt;code class=&quot;language-text&quot;&gt;loading&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;error&lt;/code&gt;. My component provides feedback to the user in these two cases at little extra cost. I’ve implemented this behavior in the past in Redux. To get the same functionality, I had to add extra actions to trigger in the thunk, as well as extend the reducer. It’s cumbersome, and it doesn’t benefit from Redux’s controlled state transitions.&lt;/p&gt;
&lt;h3&gt;A Shopping Cart as a Provider&lt;/h3&gt;
&lt;p&gt;The last part is the shopping cart. The &lt;code class=&quot;language-text&quot;&gt;Cart&lt;/code&gt; itself receives the list of items and the total price. There’s no logic here. This &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/cart/Cart.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;component&lt;/a&gt; is purely representational.&lt;/p&gt;
&lt;!-- context-migration-cart --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; PropTypes &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;prop-types&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Heading &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Heading&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Item &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Item&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Summary &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Summary&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Cart&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; total &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Cart&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;section className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;table&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; data&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;testid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;cart&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Heading boxed&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Heading&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Item key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Item&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Summary boxed price&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;total&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Summary&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;section&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;propTypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;cart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;arrayOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;quantity&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;number&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;total&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;string&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isRequired&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are two actions, adding a product to a cart and removing it. The trigger is in the product list, so they’re attached to the individual products.&lt;/p&gt;
&lt;!-- context-migration-simple-product --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Product
  key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  onAdd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addToCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  onRemove&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;removeFromCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/cart/reducer.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;reducer&lt;/a&gt; is trickier. Adding an element to the cart means looking for it in the list or adding a new element if it didn’t exist. Then we increase the quantity. You want to avoid duplicating state, so you don’t add any details that we store in the list of products, such as the price.&lt;/p&gt;
&lt;!-- context-migration-cart-reducer --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; produce &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;immer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ADD_TO_CART&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;REMOVE_FROM_CART&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./actions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; cart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initialState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cart &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;findOrAdd&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;quantity&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;remove&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity &lt;span class=&quot;token operator&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; reducer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;produce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;draft&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ADD_TO_CART&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findOrAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;REMOVE_FROM_CART&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; initialState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; reducer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There’re two interesting details here to mention:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The state &lt;strong&gt;has&lt;/strong&gt; to be immutable. A library like &lt;a href=&quot;https://github.com/immerjs/immer&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;immer&lt;/a&gt; simplifies the code quite a bit.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;All the code handling the list part is awkward. An alternative is using &lt;a href=&quot;https://github.com/paularmstrong/normalizr&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;normalizr&lt;/a&gt; and storing our data in the state in a way that’s easier to manipulate.
The last part is the &lt;a href=&quot;https://medium.com/@matthew.holman/what-is-a-redux-selector-a517acee1fe8&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;selector&lt;/a&gt;. The state contains all the information that we need to represent the cart. But it can’t be used directly by the component. We need to combine the &lt;code class=&quot;language-text&quot;&gt;products&lt;/code&gt; and the &lt;code class=&quot;language-text&quot;&gt;cart&lt;/code&gt; to get the prices. The selector is &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/master/src/cart/selectors.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- context-migration-selector --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createSelector &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reselect&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;enrich&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; products&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; product &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; products&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; price &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseFloat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;price&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; price &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fullCartSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
    cart
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;enrich&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; products&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;cart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; total &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;acc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; acc &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parseFloat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;price&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; total&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; totalSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fullCartSelector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;cart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The selectors contain some logic that we don’t want to run more often than necessary. &lt;a href=&quot;https://github.com/reduxjs/reselect&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;reselect&lt;/a&gt; is a standard library to create performant selectors in React.&lt;/p&gt;
&lt;h4&gt;How about a Cart full of Context?&lt;/h4&gt;
&lt;p&gt;And now, let’s see how the cart looks using the Context API. Instead of a reducer, we have a &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/context-api/src/cartProvider/CartProvider.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CartProvider&lt;/a&gt;:&lt;/p&gt;
&lt;!-- context-migration-cart-provider --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useContext &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useImmer &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;use-immer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;CartProvider&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateCart&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useImmer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;addToCart&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;productName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;updateCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;draft&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; productName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; productName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;quantity&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;removeFromCart&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;productName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;updateCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;draft&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; draft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; productName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quantity &lt;span class=&quot;token operator&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider value&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; addToCart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; removeFromCart &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;useCart&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; CartProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The logic is similar to the reducer from before. I’m even using &lt;a href=&quot;https://github.com/immerjs/use-immer&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;use-immer&lt;/a&gt;, a hook that integrates &lt;em&gt;immer&lt;/em&gt;.
The &lt;code class=&quot;language-text&quot;&gt;Cart&lt;/code&gt; combines the information from two providers, &lt;code class=&quot;language-text&quot;&gt;ProductsProvider&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;CartProvider&lt;/code&gt;. As there’s no store, these aren’t exactly selectors. The &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context/blob/context-api/src/cart/Cart.js&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;concept&lt;/a&gt; is close enough, though:&lt;/p&gt;
&lt;!-- context-migration-cart-memo --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Cart&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; products &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useProducts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cart &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; extendedCart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fullCart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    cart&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; price &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMemo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;total&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;products&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cart&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Cart&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h2&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;section className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;table&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; data&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;testid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;cart&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Heading boxed&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Heading&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;extendedCart&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Item key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Item&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Summary boxed price&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;price&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Summary&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;section&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; Cart&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’ll notice that I’m wrapping the selector functions with &lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#usememo&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useMemo&lt;/a&gt;. The function gets called only when one of the dependencies changes, avoiding unneeded rendering. Doing this won’t prevent every re-render issue when using the Context API, but it helps mitigate it.&lt;/p&gt;
&lt;p&gt;To be honest, this is the type of composite state with actions across different parts of the page where Redux starts making a bit of sense. There’s one more hook to keep in mind for cases like this. With &lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#usereducer&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useReducer&lt;/a&gt;, reducers are available to you without having to introduce Redux. If you end up building an application complex enough, a migration will be a smaller jump.&lt;/p&gt;
&lt;h2&gt;Lightweight Redux&lt;/h2&gt;
&lt;p&gt;While I’ve talked quite a bit about the benefits of the Context API, it’s fair to mention that Redux hasn’t stood still these past few years. There’re ways of improving readability and maintainability.&lt;/p&gt;
&lt;p&gt;First, you have ways of making Redux code more lightweight. Newer versions of Redux do have support for &lt;a href=&quot;https://react-redux.js.org/api/hooks&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;hooks&lt;/a&gt;. Thanks to &lt;code class=&quot;language-text&quot;&gt;useSelector&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;useDispatch&lt;/code&gt; you get a simpler integration than by using the old &lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt; function, although simple state transitions still end up being verbose.&lt;/p&gt;
&lt;p&gt;Secondly, there is a library called &lt;a href=&quot;https://redux-toolkit.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Redux Toolkit&lt;/a&gt; that brings, in their own words:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The official, opinionated, batteries-included toolset for efficient Redux development
It provides support to simplify creating a store, reducers, and actions according to well-established patterns. As you see, you have options to beat your code into shape. This underlines once again the need to consider carefully what’s the best solution for your situation.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;To recap, should you migrate your existing application built with Redux to use the Context API and hooks? Maybe? It depends! Make sure to think it through and evaluate what you expect to get out of it.
If you decide to move forward, let this &lt;a href=&quot;https://github.com/auth0-blog/example-redux-to-context&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;repository&lt;/a&gt; be a source of inspiration. Remember that you don’t need a complete rewrite. Perhaps just using hooks is enough of an improvement for you. Maybe some parts of your application benefit from Redux. These are decisions to make having all the context in mind.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://auth0.com/blog/redux-to-context-practical-migration-guide/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Story Points in Depth: Everything You Need to Know]]></title><description><![CDATA[Story points create a measurement that represents the amount of time it takes to complete a task. They provide a view of the expected return on investment.]]></description><link>https://hceris.com/story-points-in-depth-everything-you-need-to-know/</link><guid isPermaLink="false">https://hceris.com/story-points-in-depth-everything-you-need-to-know/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Agile]]></category><pubDate>Thu, 03 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fe489d925b0ef6012ab275e6d65f6105/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABznrdAgP/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIQETH/2gAIAQEAAQUCVNmnSUcP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAARAAIkFx/9oACAEBAAY/AkLYxyf/xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhQTFhcf/aAAgBAQABPyGCRrjcpgxdIULJL03FqM//2gAMAwEAAgADAAAAELc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAIDAQEBAAAAAAAAAAAAAQARIUFhMXHR/9oACAEBAAE/EAhQ0ZT5AJLZWkq2MYopQRR3EAHePyEcsOvMy73Yecn/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Story Points&quot; title=&quot;&quot; src=&quot;/static/fe489d925b0ef6012ab275e6d65f6105/acb04/cover.jpg&quot; srcset=&quot;/static/fe489d925b0ef6012ab275e6d65f6105/bc01b/cover.jpg 188w,
/static/fe489d925b0ef6012ab275e6d65f6105/bf173/cover.jpg 375w,
/static/fe489d925b0ef6012ab275e6d65f6105/acb04/cover.jpg 750w,
/static/fe489d925b0ef6012ab275e6d65f6105/ec605/cover.jpg 1125w,
/static/fe489d925b0ef6012ab275e6d65f6105/c58a3/cover.jpg 1500w,
/static/fe489d925b0ef6012ab275e6d65f6105/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Story points are a source of endless debate in agile teams. Every team I’ve been part of has discussed the role of story points in retrospectives, usually numerous times.&lt;/p&gt;
&lt;p&gt;Having a common understanding of what story points bring to your team prevents many fruitless arguments. It helps everybody work toward the same goal.&lt;/p&gt;
&lt;p&gt;So, let’s talk about story points.&lt;/p&gt;
&lt;h2&gt;What Are Story Points?&lt;/h2&gt;
&lt;p&gt;Software projects are unpredictable. This isn’t news to anybody in the industry. &lt;em&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/The_Mythical_Man-Month&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;The Mythical Man-Month&lt;/a&gt;&lt;/em&gt;, published in 1975, already explores this problem in depth. Estimating the duration of a whole project is difficult, if not impossible. As such, one of the core tenets of agile is accepting this as a fact and dealing with it. Concretely, you break a bigger work package into smaller chunks, called user stories, and estimate them. For that, you use story points. That still doesn’t answer the question of what story points are, though. Let’s have a look at a &lt;a href=&quot;https://www.workfront.com/project-management/methodologies/agile/story-points&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;definition&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A story point is a measurement unit that represents the amount of effort required to complete a task.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So, a story point indicates the effort required to complete a piece of work. Different teams use different approaches. Usually, story points are an estimation of either time or complexity. The meaning of this number is vague on purpose. Story points aren’t a universal metric, and there’s no formula to convert them into hours spent. The number of story points is not an absolute number. Estimations in story points are relative to other items in the team’s backlog. It’s common to use a &lt;a href=&quot;https://rgalen.com/agile-training-news/2019/12/5/reference-stories-amp-story-points&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;reference story&lt;/a&gt; with a known size to calibrate the numbers. Even if the numbers don’t translate to days of work, they’re consistent with one another. That way, the product owner can compare the effort involved in different stories. Whatever metric you use, always keep in mind that this is a rough estimation. It’s not a commitment. I’ll come back to this when I talk about the limitations of story points. To make the lack of accuracy more transparent, you should use &lt;a href=&quot;https://en.wikipedia.org/wiki/Fibonacci_number&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Fibonacci numbers&lt;/a&gt; so that higher numbers correlate to bigger stories to reflect the uncertainty of the process.&lt;/p&gt;
&lt;h2&gt;The Role of the Team in Estimating Stories&lt;/h2&gt;
&lt;p&gt;The agile team that’s going to implement the stories is responsible for the estimations as well. After all, the team members are the ones who understand the scope of the work. If an external stakeholder tries to push estimations onto the team, reject them. That’s no longer an estimation but an order. If you want to go in this direction, make deadlines clear and be aware that what you’re doing isn’t really agile development anymore. Assigning story points to stories happens in a &lt;a href=&quot;https://www.agilealliance.org/glossary/backlog-grooming/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;refinement meeting&lt;/a&gt; with the whole team involved. Everybody provides estimations independently, and then they discuss the results until they come to a satisfactory agreement.&lt;/p&gt;
&lt;h2&gt;The Benefits of Sizing Stories&lt;/h2&gt;
&lt;p&gt;Sizing stories using story points is very established in the agile world, and it’s here to stay. I think it’s a useful practice, although not in the way that some people think about it. I’ll get to that. In my view, there are two main benefits that you extract from sizing a story:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You get a shared understanding within the team. Everybody needs to have a similar picture of the scope of a story. A big disparity in the estimations indicates that people’s thinking isn’t aligned on that. Sizing a story is not bargaining for the smallest number but rather an exercise in getting more clarity.&lt;/li&gt;
&lt;li&gt;Through the discussion, you get the opportunity to surface possible risks and challenges. Mitigating risks at this stage helps make delivery more predictable, as you’ll find fewer surprises later that block the team.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The numbers are a nice output, but in my view, the more important outcome is the process that helps you figure out this number.&lt;/p&gt;
&lt;h2&gt;Understand the Limitations of Story Points&lt;/h2&gt;
&lt;p&gt;My issue with story points is that people misconstrue them as something they’re not. First of all, a story point is a rough approximation. Building detailed release plans based on them is bound to be imprecise. Story points aren’t an excuse for going back to waterfall development. A second challenge is that people sometimes take a number of story points as a binding commitment and want to hold teams accountable for inherently unpredictable situations. Have a look at these two stories:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/99365183a7689cf57e756a4b1c02cbf8/2bef9/unpredictable-stories.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADT0lEQVR42p1TbUxTZxQ+t7cFLJUPW8F5Gz8Ss5gmLmGBH4sxOp2ORGOi6LIBGUKcdiAONQa/YtolsP1xLsTE+YkY0Yg6imRlpbRAWzLXQm9vr4gf0fbWXqKmBS/3rkbiOMu9yNwPw489yZPnvOfkPO/JSQ5IsS4TJl37xh7cqLWdP77I3/kzNNZXEAAAurmZssCumi/JmrodaRd7S+Dw0YMEgFJ+P1Ds3T360I4321tG8d5PekxdhZPWb6cNMwxg3mCHbNijMmo/y/y1//ssfINEzjyd0kuS5HsMJ50fjgRt6O1vQ5xyFiG6If7ASXo8HqLHYyPCPgHOtO/StToPVl3u2lfZ/Ptu6HCfIgcGBgiv10v4fL5/tampCcB9/ceP77pPnx0NXWl+Ge1cnuQ8kEghJBIJQERw/nkWfrFVrbxkrz0kv4W/nsPr1JRSn+H4+DjE43GFUFNtnpP1QUE2YjeIj5th+G44JxZ7aohGo3qO4/SRaEQ/KWE2Imbg35ibSkn6eJzXz9Rl5Xk+l2XZRS6XSwtlX+9M+3xjSd72crNBnoDjOIsoiiOiKPpFURyUJGlwbCw5FItxQY7jhiKRyKAgCEpenJgYmhAEWhTFO4Ig8NFodCs8GXZpcKwvD190Uh0tP+hcfd4chgkZGYahQqEQFQ6HqUAgQPX09Ch0OBxUkKYpJkgb2aex/BHEXPbJ47wQTZtCDJMN+KK7Uoo7pICnNei+fGxJwHEJphAhmUwqlPfD8zywLAvhcBhomoYJRHh47SbcWrpC37tu8yctugW6+3aHsnNA/GPVSKgTr9668hLRtxDxGdjbz5ENDQ2EzMbGRkWtVqtCi8VCtFV/px4u3gb9JeWF/i8q+pxbvlr6qGgtXCivVAHb3fTRI39rhGPaXk3yt9eg4AS/8xQJs8BcUETQO2vhWkmpoWVb6fLfSquybACwiVpMwI0zx6nWkwcK2K4TS6TEHbU89oZPC2FWzEkHBACDpZ5cVlGaKfcMd3VPn49xxXpN4epN8zWLi9PLduxXKUlV2qx+mv+YQt03UKzKUPLpKhKgwXpMU7e3OnfvHvO8I0fqNfJvRoqa1ZAgpofJz88Hk8lEaLVaUKvVb08P8d0Zvo1nGv4P/gGpZ82TEnWmBwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Unpredictable stories&quot; title=&quot;&quot; src=&quot;/static/99365183a7689cf57e756a4b1c02cbf8/1d69c/unpredictable-stories.png&quot; srcset=&quot;/static/99365183a7689cf57e756a4b1c02cbf8/4dcb9/unpredictable-stories.png 188w,
/static/99365183a7689cf57e756a4b1c02cbf8/5ff7e/unpredictable-stories.png 375w,
/static/99365183a7689cf57e756a4b1c02cbf8/1d69c/unpredictable-stories.png 750w,
/static/99365183a7689cf57e756a4b1c02cbf8/2bef9/unpredictable-stories.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve seen this situation happen many times. Both stories have identical sizes, yet one took much longer than the other to finish. Why is that? There are many valid reasons. The team underestimated the complexity or missed an undiscovered dependency. It’s completely normal, and it happens sometimes. If you make a big fuss out of that, the team gets more conservative and defensive as a result. So, this cycle leads to story point inflation and meaningless conversations that don’t mitigate any risk. That doesn’t help anybody. Last, here’s the biggest problem of story points: Story points say nothing about value. A story point measures effort (or some definition of effort). But effort on its own doesn’t lead to results. A team delivering loads of story points each iteration might be creating no business value whatsoever. People optimize for what you measure.&lt;/p&gt;
&lt;h2&gt;Let’s Talk About Value Instead&lt;/h2&gt;
&lt;p&gt;The focus on story points misses the forest for the trees. You need a better abstraction that takes value created into account. So, let me suggest thinking in terms of &lt;a href=&quot;https://www.plutora.com/blog/value-stream-management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;value streams&lt;/a&gt;. The development stage in the software development cycle is another step in the journey of delivering value to your customers. Instead of focusing on story points, it’s important to have the value created in mind. Now, you need the right tools if you want to visualize value streams. If all you track are story points, your conversations won’t go past that. A platform like &lt;a href=&quot;https://www.plutora.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Plutora&lt;/a&gt; enables value stream management for your organization. Consider this dashboard:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a36d6255b582974ccedf7c59b0ad7c37/2bef9/lead-time.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABAElEQVR42mWR2W4kMQwD+/+/dZHpbl86XQt7JskkeSAEGBRBlQ/xZJjDnMw3ZT6nqnJfF+Plm798nxIRaq0cao6I7kVXxVSZ8Cs8UXdUDVXBVZ6+PyWSIyKYmT+Ub5oztznccRnfb5lvYfk1j9WutoFoMMSRocQKyIl7YJ5bfQxKqfRat28s/9ob67qgi2ORHLpuPy/aXWjl3rzOx8l13dy1czfBzFEZSO+bU6uVel+Uj3/Ux8cuVGvHRDhWzdBOSCN6xVtDS8FHw+qFl5OQvv6MdCPX2aOTo5HhpAlWTrw8SNcV+IQZL3kEZraZxZpmuNkX9IXh07c+Mjee134E/wGt7CWj0XJNaQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Lead time&quot; title=&quot;&quot; src=&quot;/static/a36d6255b582974ccedf7c59b0ad7c37/1d69c/lead-time.png&quot; srcset=&quot;/static/a36d6255b582974ccedf7c59b0ad7c37/4dcb9/lead-time.png 188w,
/static/a36d6255b582974ccedf7c59b0ad7c37/5ff7e/lead-time.png 375w,
/static/a36d6255b582974ccedf7c59b0ad7c37/1d69c/lead-time.png 750w,
/static/a36d6255b582974ccedf7c59b0ad7c37/2bef9/lead-time.png 1024w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://www.plutora.com/blog/lead-time-vs-cycle-time-whats-the-difference&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Lead time&lt;/a&gt; is one of the &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/four-key-metrics&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;four key metrics&lt;/a&gt; to measure high-performing organizations. If you have an accurate view of it, then you make informed decisions and react quickly to changes. That requires up-to-date data that matches the reality on the ground. A dashboard for lead time, or other metrics, is useful for development teams and stakeholders within your company. You can also tie these metrics to your tactical and strategic goals with a framework like &lt;a href=&quot;https://www.plutora.com/blog/okr-executive-handbook&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OKRs&lt;/a&gt; if you want.&lt;/p&gt;
&lt;h2&gt;What’s the Role of Story Points in Value Stream Mapping?&lt;/h2&gt;
&lt;p&gt;Don’t get me wrong, story points are a useful tool. You don’t need to go the #NoEstimates route if you’re not comfortable with that. Instead, focus on getting lightweight estimations for your tasks, and combine them with the value you expect to create by implementing each unit of work. That gives you a view of the expected return on investment for the stories in your backlog that’s an invaluable help to decide the correct priority. Picking the right stories will set you on the right path toward delivering more value to your customers.&lt;/p&gt;
&lt;h2&gt;Going Beyond Story Points&lt;/h2&gt;
&lt;p&gt;So, what should you make of story points? I think they’re a useful abstraction to assign a rough size to the pieces of work for an agile team. But that’s about it. They’re low fidelity estimations. You have to treat them as such. I despair every time I see people trying to read too much into the numbers, leading to unrealistic expectations. Moreover, story points say nothing about value. Creating a continuous stream of value that you deliver to your customers is a far better way to approach software delivery. If you want to read more about value stream management, check out &lt;a href=&quot;https://go.plutora.com/mastering-software-delivery-with-value-stream-management&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Plutora’s e-book&lt;/a&gt; on the topic.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.plutora.com/blog/story-points-in-depth-everything-you-need-to-know&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Plutora&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Scalable Architecture: A Definition and How-To Guide]]></title><description><![CDATA[Using cloud technologies, it's possible to quickly build a solution with scalable architecture that works in almost any situation.]]></description><link>https://hceris.com/scalable-architecture-a-definition-and-how-to-guide/</link><guid isPermaLink="false">https://hceris.com/scalable-architecture-a-definition-and-how-to-guide/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[Software Engineering]]></category><pubDate>Tue, 18 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e41703add0cbf01614792addd57b0512/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABQAD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAcUC0Ysmzj//xAAaEAACAgMAAAAAAAAAAAAAAAABAwIhADEy/9oACAEBAAEFAkwtwJiY2nbuTn//xAAWEQEBAQAAAAAAAAAAAAAAAAAAIUH/2gAIAQMBAT8B1H//xAAXEQEAAwAAAAAAAAAAAAAAAAAAASFB/9oACAECAQE/Aclb/8QAGBAAAwEBAAAAAAAAAAAAAAAAARBxABH/2gAIAQEABj8C7hGIv//EABoQAQACAwEAAAAAAAAAAAAAAAEAERAhMXH/2gAIAQEAAT8hTQkMCj3K+iJesctz/9oADAMBAAIAAwAAABBA/wD/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EHiDdYf/xAAYEQADAQEAAAAAAAAAAAAAAAAAAREhMf/aAAgBAgEBPxBXQSjp/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARIUFRMf/aAAgBAQABPxAIERcvGMZgtIVDw7AI4uk9h+WUTDkRduz/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Scalable Architecture&quot; title=&quot;&quot; src=&quot;/static/e41703add0cbf01614792addd57b0512/acb04/cover.jpg&quot; srcset=&quot;/static/e41703add0cbf01614792addd57b0512/bc01b/cover.jpg 188w,
/static/e41703add0cbf01614792addd57b0512/bf173/cover.jpg 375w,
/static/e41703add0cbf01614792addd57b0512/acb04/cover.jpg 750w,
/static/e41703add0cbf01614792addd57b0512/ec605/cover.jpg 1125w,
/static/e41703add0cbf01614792addd57b0512/c58a3/cover.jpg 1500w,
/static/e41703add0cbf01614792addd57b0512/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Software applications are more global than ever. A massive upswing in traffic is a lucky tweet away.&lt;/p&gt;
&lt;p&gt;For that reason, teams building platforms have to prepare to ramp up on short notice, and that means building applications with scalable architecture in mind.&lt;/p&gt;
&lt;p&gt;In this post, I’m talking about scalability in software architectures, what it is, and things to keep in mind, such as statelessness, loose coupling, and asynchronous processing.&lt;/p&gt;
&lt;h2&gt;What Is a Scalable Architecture?&lt;/h2&gt;
&lt;p&gt;Scalability is a common &lt;a href=&quot;https://en.wikipedia.org/wiki/Non-functional_requirement&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cross-functional requirement&lt;/a&gt;. Let’s see what &lt;a href=&quot;https://en.wikipedia.org/wiki/Scalability&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Wikipedia has to say about it&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scalability is the property of a system to handle a growing amount of work by adding resources to the system.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In other words, a scalable architecture supports higher workloads without any fundamental changes to it. Notice the part about adding resources: Scalability doesn’t mean that an application magically handles extra traffic with the same resources. People associate scalability with cloud computing. Why’s that? Well, for one, there are some well-known examples of hyperscaling in the cloud, &lt;a href=&quot;https://netflixtechblog.com/hyper-scale-vpc-flow-logs-enrichment-to-provide-network-insight-e5f1db02910d&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;like Netflix&lt;/a&gt;. Apart from that, a cloud provider gives you a level of flexibility that on-premises infrastructure just &lt;a href=&quot;https://www.scalyr.com/blog/dont-fight-the-cloud/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;can’t match&lt;/a&gt;. You don’t need to plan ahead, as you can spin up infrastructure in a matter of minutes. Provisioning this infrastructure through code using a tool like &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; has many benefits. It allows you to move fast, experiment, and find the solution that suits your needs. I think relying on the cloud is the default approach for many organizations.&lt;/p&gt;
&lt;h2&gt;Why Not Scale Vertically?&lt;/h2&gt;
&lt;p&gt;Throwing money at the problem by buying bigger hardware is a valid solution in many situations. That’s called vertical scalability, where you add more computing power to your existing resources. While simple, it has the drawback that it might become very expensive. It’s possible to hit a hard limit where no bigger hardware is even available. That’s why adding more copies of the same hardware has become the norm. This is called &lt;a href=&quot;https://www.scalyr.com/blog/horizontal-scalability-software/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;horizontal scalability&lt;/a&gt;. The techniques I’m presenting next are based on this principle.&lt;/p&gt;
&lt;h2&gt;Tenets of a Scalable Architecture&lt;/h2&gt;
&lt;p&gt;If you pick a modern architecture book, like &lt;em&gt;&lt;a href=&quot;https://www.oreilly.com/library/view/fundamentals-of-software/9781492043447/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Fundamentals of Software Architecture&lt;/a&gt;&lt;/em&gt;, you’ll quickly realize one thing: There’s no such thing as one architecture model. Architectures evolve organically over time. That’s why it’s pointless to provide a detailed blueprint of what makes an architecture scalable that won’t match reality. Nevertheless, some principles apply in most situations. Let’s talk about those.&lt;/p&gt;
&lt;h3&gt;Statelessness&lt;/h3&gt;
&lt;p&gt;A system without state is much easier to scale. Imagine you have a web server serving requests. If you follow &lt;a href=&quot;https://restfulapi.net/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RESTful&lt;/a&gt; principles, these servers will be stateless. That means that you scale up horizontally by adding extra instances. You send traffic to each by putting a load balancer in front. That’s a proven and effective strategy that will take you far. To name another example, let’s consider containers. Container technologies, such as &lt;a href=&quot;https://www.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docker&lt;/a&gt; and &lt;a href=&quot;https://kubernetes.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes&lt;/a&gt;, are everywhere. Spinning up a ton of containers based on automated triggers is something that Kubernetes excels at, especially if there’s no need to hold state. Now, a completely stateless application isn’t very useful. Think of a social media platform that loses all your messages every time you reload your browser. Not great! However, it’s a sensible idea to contain that state as much as possible. In a multitier architecture, you split the application into different layers—for example, presentation, back end, and data layer. Then, you keep the state in the data layer as much as possible. It doesn’t make the problem disappear, but it reduces the impact.&lt;/p&gt;
&lt;h3&gt;Loose Coupling&lt;/h3&gt;
&lt;p&gt;Loose coupling means that the distinct subsystems are not strongly connected. Therefore, you modify single components without having to touch their dependencies too much. This is a common pattern in software engineering. What does this have to do with scalability? It simplifies the problem quite a bit! If you have to rework a big chunk of an application, the cost will be prohibitive and wasteful. Besides, not every component in a system has the same requirements regarding scalability. Targeted, granular changes are much more likely to succeed. They are easier to split among teams as well, which is an aspect of scaling that you shouldn’t forget. There’s a limit to how much a single team can accomplish, after all. This brings us to the topic of &lt;a href=&quot;https://www.scalyr.com/blog/monolith-vs-microservices-how-to-evolve/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;microservices&lt;/a&gt;. Let me be clear: You don’t need microservices to scale. But used judiciously, this architecture pattern offers loose coupling in a way that’s difficult to replicate in a monolith. There’s a challenge, though. Reasoning about distributed systems is hard. I find the concepts of &lt;a href=&quot;https://martinfowler.com/tags/domain%20driven%20design.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;domain-driven design&lt;/a&gt; very helpful to deal with this complexity.&lt;/p&gt;
&lt;h3&gt;Asynchronous Processing&lt;/h3&gt;
&lt;p&gt;Even if you partition your system into multiple smaller chunks, they’ll still have to communicate with one another. This communication introduces dependencies. Dependencies are bad news. Let’s say you have blazingly fast web servers that want to trigger some processing that happens to be slow. Using synchronous communication, they need to wait for this slow process, becoming slow themselves. The solution is to communicate asynchronously. Use events instead of direct calls:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A producer sends events to a message queue.&lt;/li&gt;
&lt;li&gt;A consumer processes the events at its own pace.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a result, there’s no more waiting, and the producer and consumer remain loosely coupled. This pattern is called &lt;a href=&quot;https://aws.amazon.com/event-driven-architecture/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;event-driven architecture&lt;/a&gt;. If events are so good, why not use asynchronous communication from the beginning, then? Well, reasoning about asynchronous communication is hard. It’s also harder to test. You see the pattern. Architecture involves trade-offs, and there’s no free lunch.&lt;/p&gt;
&lt;h3&gt;Leverage Managed Infrastructure&lt;/h3&gt;
&lt;p&gt;An underrated way to scale your system is to let others do the work for you. Have you decided to use Kubernetes to run your applications? That’s fine. Instead of operating clusters, pick a managed service like &lt;a href=&quot;https://aws.amazon.com/eks/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS EKS&lt;/a&gt;. Amazon has a lot of practice running software at scale. That leaves you more time to focus on your core business capabilities. Managed infrastructure shines when you consider data stores. &lt;a href=&quot;https://cloud.google.com/spanner&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Distributed SQL&lt;/a&gt; databases, &lt;a href=&quot;https://aws.amazon.com/dynamodb/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;NoSQL&lt;/a&gt;, or just &lt;a href=&quot;https://aws.amazon.com/s3/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;object storage&lt;/a&gt; are all waiting for you. Operating scalable data stores is a hairy problem fraught with pitfalls. I wouldn’t recommend it except for technologically mature organizations. For everyone else, it’s more cost-effective to delegate the work. A similar approach applies to tools and frameworks. There’s a lot of open-source software out there that’s battle-tested and available right now. Don’t build an internal event-streaming platform when you can use &lt;a href=&quot;https://kafka.apache.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kafka&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Let’s Mention Some Antipatterns&lt;/h2&gt;
&lt;p&gt;In your journey toward a more scalable architecture, there are a few things to avoid:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Predicting requirements far in the future. If you build something for what might happen in a few years, you’ll spend a lot of effort on something you may never need. It’s notoriously difficult to foresee requirements in advance.&lt;/li&gt;
&lt;li&gt;Going for a Big Bang release. Change things incrementally, one at a time. Small releases minimize risk.&lt;/li&gt;
&lt;li&gt;Using your gut feeling to make decisions. Gather data to confirm your hypothesis. If you don’t have good data, build prototypes to get it.&lt;/li&gt;
&lt;li&gt;Experimenting. It’s easy to become overly conservative. Trying things out is crucial to figuring out what works and what doesn’t.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;The Role of Observability in a Scalable System&lt;/h2&gt;
&lt;p&gt;Observability is another cross-functional requirement. There’s &lt;a href=&quot;https://www.scalyr.com/blog/observability-production-systems-why-how/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;plenty to say&lt;/a&gt; about the topic. Simply put, it measures your ability to observe the system from the outside and understand its current state. What does this have to do with scalability? Quite a bit, in fact. Scaling a system requires understanding its behavior, ideally based on reliable data. Logs, metrics, and traces all give you the information you need to draw conclusions and act when necessary. Building the tooling required for observability is an additional effort that takes you away from your focus. Using an existing solution, like &lt;a href=&quot;https://app.scalyr.com/help/how-scalyr-works&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Scalyr&lt;/a&gt;, is often a better investment.&lt;/p&gt;
&lt;h2&gt;An Architecture Needs to Evolve&lt;/h2&gt;
&lt;p&gt;As I said in the beginning, software architecture isn’t set in stone. It’s not something that’s ever finished, even if your scalability requirements stay consistent for a while. The best advice I can give you is to develop an &lt;a href=&quot;https://evolutionaryarchitecture.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;evolutionary architecture&lt;/a&gt; and react quickly to new findings. That’s the agile way.&lt;/p&gt;
&lt;h2&gt;Toward a Scalable System&lt;/h2&gt;
&lt;p&gt;Having to scale is a good problem to have because it means that your application is being used heavily. There’s not a single solution to get there. Instead, I recommend breaking down your architecture into smaller, loosely connected components that communicate asynchronously, for the components that require it. Using cloud technologies, it’s possible to quickly iterate and build a solution that works in almost any situation.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.scalyr.com/blog/scalable-architecture/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Scalyr&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Starting you new React application with Redux? Consider a simpler approach using the Context API]]></title><description><![CDATA[Traditionally, starting a new React application means adding Redux for state management. Let's talk about the Context API as an alternative]]></description><link>https://hceris.com/starting-a-new-app-with-redux-consider-context-api-first/</link><guid isPermaLink="false">https://hceris.com/starting-a-new-app-with-redux-consider-context-api-first/</guid><category><![CDATA[React]]></category><category><![CDATA[Redux]]></category><category><![CDATA[Context API]]></category><category><![CDATA[Architecture]]></category><pubDate>Tue, 11 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If you’re bootstrapping a new &lt;a href=&quot;https://reactjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React&lt;/a&gt; application today, ingrained habits might lead you to pick &lt;a href=&quot;https://redux.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Redux&lt;/a&gt;. After all, you &lt;strong&gt;need&lt;/strong&gt; to manage the state. &lt;em&gt;Should you start with Redux, though?&lt;/em&gt; That has become a valid question. The latest versions of React have improved their offerings for state handling massively. In this post, I want to talk about a simpler approach, using the Context API instead.&lt;/p&gt;
&lt;h2&gt;Let’s Reminisce: Why Did We Embrace Redux?&lt;/h2&gt;
&lt;p&gt;A structured approach to state transitions in frontend applications wasn’t always the norm. I remember trying to update multiple places in an application back when we were still using jQuery. That wasn’t a pleasant experience.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b48b22586b51805871b25ed0f28bb493/a82e6/cascade.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAC4jAAAuIwF4pT92AAABtklEQVR42o2TwW7UMBCG8zZ9F56AV2q5c0CII+JAe0acWgkhDiBxgVW2m2wSx7E99rjZdlFRFO1fOYnZlK5WPXyacWLPjP3PJOT8GTl+Rc4/G2N5YO4by2fk/ElCzuMYxjKMDT4Pvqb4bSTssXwT976PAf+S852x3EU7h1ywvrPsu83duCdg+aaTynSlkPd1Y0Kci4RCFnI9Wd7NMz8mVMGoasbV1R2UYUhlIKRG3eidkKoPa3L+Y2J8C7PZ9rH8/68R0WSQLi3evb2HkISiEsjWFRpN4Uw8f57YooT/8b2fBwvZ0usMq7xAmq1RKwOpCJY9fMuDjYkqqZAXog92CHh7/gG7ly96tS6QCYmirFFUNX4tllgsVyjTHEoo6Onqc1HiTTS5XpObKsxz+K9fekMOytjwc6joOi9QZCVe//6GT2UK1g50oEIhFQoh+7rRY8DhDW//9E/axTFabvFm/ROf6xU21mGxpPEN68dvqIzdVxhVNjOVaSbQljdoXQuaVL68fKpy3ei9ysf6kCx3euJfH24P9+EU8CI5NiH7SeFpUvzBSZkxTMopOT4d7fMwlgfm/sTJAx17ryCRKB3QAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;A change in the application triggers a cascade of updates that is very hard to track&quot; title=&quot;&quot; src=&quot;/static/b48b22586b51805871b25ed0f28bb493/1d69c/cascade.png&quot; srcset=&quot;/static/b48b22586b51805871b25ed0f28bb493/4dcb9/cascade.png 188w,
/static/b48b22586b51805871b25ed0f28bb493/5ff7e/cascade.png 375w,
/static/b48b22586b51805871b25ed0f28bb493/1d69c/cascade.png 750w,
/static/b48b22586b51805871b25ed0f28bb493/78797/cascade.png 1125w,
/static/b48b22586b51805871b25ed0f28bb493/aa440/cascade.png 1500w,
/static/b48b22586b51805871b25ed0f28bb493/a82e6/cascade.png 3334w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;A change in one place leads to an update somewhere else. Now we need to patch that code as well. But then, there is a third area of the page that depends on the first two. At this point, the logic is convoluted and complex, and the snowball is just getting started.&lt;/p&gt;
&lt;p&gt;Compared to that, Redux was eye-opening:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The complete state of the User Interface (UI) is represented as an object.&lt;/li&gt;
&lt;li&gt;Any action that can modify the state is an object that contains data.&lt;/li&gt;
&lt;li&gt;Pure functions (reducers) ingest those actions and morph the state.&lt;/li&gt;
&lt;li&gt;Through selectors, we shape the data in the state for easy consumption for our components.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It seems self-evident now. But it was magical at the time.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ac1742118db42c59383f7a0570490275/a82e6/redux-flow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAC4jAAAuIwF4pT92AAACJklEQVR42n1TTYsTQRDNv9m/IiwIigrKgiIeggYkoqIuKyp4iDmp60oUr17cXbMJ8SKCiODBGNxVE/NBspoQZ/prZszGmel8POnOzCQh6KGo6qpXr19Xd8cIE/cI42nCRGQmnawNwtJdg6R/mVR7tQ7rJp3HTnjEUowwgciogEknsUk5uGWj7/ro9V30XQ/ccnR+Up9iZ+x5LGj2TMolYUIqbxAmheXIL9++y2urt+TN23fljbU7cu9rRQrb0fVZvEm5G5BvhwqHhImx2p1yC0zYsOwDVKr7uL+ewcONJ3jwKINytQVuH+i6wgVqx0E/COWbocJheJRO10DrRxv1RhsG4ZDDETw5hD8YaYJ6s4PmflvjwtGo/kDY1hyh2vnK9TWcOHkay4ePYSPzDE6vj5+dLnr9P1h//BSHlo/g6PEVXLq6CmH/jggDQVsLCsvVOkrFXRRLu6g1WtHRlK81mvhY+oxPxT2UK7WotkAYzkAlhdOD7/rw/QE8OYhuVql3fQlfHd8dwHJ60Y2r/n8q7BoEufwrZLN5vHiZR6Xa0M1K7XaugOxOAbmdAtpd4/8KTcrHCqDmFU8kcT6RxKmVM3j95i28wQjv3n/A2XNxJC5eRvxCEtVGM1Q/JtNL2QwJvfBNKc8tR8eMcckolaZhaE8JneSFLSm3Zt+iSxife4czP4BP4zBP2ey85jHzef1TUoTxlEl5SsXKL5jOL9ZCvOrXMeNLfwFMGZaUm0tzJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;How changes flow through an application using Redux&quot; title=&quot;&quot; src=&quot;/static/ac1742118db42c59383f7a0570490275/1d69c/redux-flow.png&quot; srcset=&quot;/static/ac1742118db42c59383f7a0570490275/4dcb9/redux-flow.png 188w,
/static/ac1742118db42c59383f7a0570490275/5ff7e/redux-flow.png 375w,
/static/ac1742118db42c59383f7a0570490275/1d69c/redux-flow.png 750w,
/static/ac1742118db42c59383f7a0570490275/78797/redux-flow.png 1125w,
/static/ac1742118db42c59383f7a0570490275/aa440/redux-flow.png 1500w,
/static/ac1742118db42c59383f7a0570490275/a82e6/redux-flow.png 3334w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;All the reasons that brought us here still apply. But the context has changed.&lt;/p&gt;
&lt;h2&gt;Should Redux Be the Default When Starting a Project?&lt;/h2&gt;
&lt;p&gt;React’s ecosystem has evolved quite a bit lately. Two additions have transformed the landscape and opened new possibilities:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://reactjs.org/docs/hooks-intro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Hooks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://reactjs.org/docs/context.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Context&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With those two, managing state across a hierarchy tree and triggering side effects is easier than ever. So easy that I claim that Redux is no longer necessary in many cases.&lt;/p&gt;
&lt;p&gt;Most frontend applications don’t have the rich flow of data that justifies introducing Redux. If you’re only fetching some data from an API plus some basic interactions, then Redux is probably overkill.&lt;/p&gt;
&lt;h3&gt;The over-abstraction trap&lt;/h3&gt;
&lt;p&gt;Forms are an example that hit close to home. I’ve built complex forms using Redux, helped by some supporting libraries. As complexity grows, things get messy. And for what? In the end, the state contained in a form tends to be fairly local. There is little need of exporting a detailed representation of the current state of a bunch of input controls.&lt;/p&gt;
&lt;p&gt;Modeling something like a form with Redux can lead to a path of pain. Is the state truly global? A specialized library will often do the job just fine. Nowadays I recommend &lt;a href=&quot;https://formik.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Formik&lt;/a&gt; for this problem. It’s built for that purpose and will cover most requirements you can think of.&lt;/p&gt;
&lt;h2&gt;An Alternative: Leveraging the Context API&lt;/h2&gt;
&lt;h3&gt;What is the Context API?&lt;/h3&gt;
&lt;p&gt;Let’s go to the source to find out:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Context provides a way to share values between components without having to explicitly pass a prop through every level of the tree.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The Context API is meant to solve the &lt;a href=&quot;https://kentcdodds.com/blog/prop-drilling/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;prop drilling&lt;/a&gt; problem. You have a component that owns some state. A child component wants to access it. If you pass it through &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt; every intermediate component becomes aware of it, even if it’s not being used at that level. That adds coupling between the different components that form that part of the page.&lt;/p&gt;
&lt;p&gt;I’ve seen Redux used to handle the challenge of providing state access to components that are further away from the source. For this scenario, the Context API is a valid alternative. One that doesn’t need an extra library, bootstrapping code, and further complexity.&lt;/p&gt;
&lt;h3&gt;How does it work?&lt;/h3&gt;
&lt;p&gt;The Context API has two main components. First, we have a &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; where we keep the relevant state. It is equivalent to the store in Redux. It can be statically initialized or fetched dynamically. Combined with the &lt;code class=&quot;language-text&quot;&gt;useState&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;useEffect&lt;/code&gt; hooks, we can build the logic we need to keep it up-to-date with little effort.&lt;/p&gt;
&lt;p&gt;The second part is the &lt;code class=&quot;language-text&quot;&gt;Consumer&lt;/code&gt;. Any component that is rendered below the &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; has access to the information stored in it thanks to it. Another hook, &lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#usecontext&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useContext&lt;/a&gt; makes the syntax even more lightweight. Consumers get re-rendered on updates to the state.&lt;/p&gt;
&lt;p&gt;Essentially, we’re reproducing the store and connecting to the store, which is what we’d do in Redux. But we have far less code and abstractions involved.&lt;/p&gt;
&lt;h3&gt;One example: High-level configuration&lt;/h3&gt;
&lt;p&gt;Let’s say we’re storing information that is relevant for the whole application. For example, the theme that dictates how other components are displayed. In general, a configuration that influences most components. That probably won’t change during the lifetime of the application. If we put it in a &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;, every component that needs it can access this state easily.&lt;/p&gt;
&lt;p&gt;Theming is such a clear use of Context that it’s basically the canonical scenario. It’s the example mentioned in React’s official documentation as well.&lt;/p&gt;
&lt;h3&gt;Another example: Fetching information from a REST API&lt;/h3&gt;
&lt;p&gt;Imagine you divide your application into subpages, each with its separate URL. The data transfer between pages is limited. Each subpage is practically a small independent application. When you render one of these pages, it needs to fetch data from an API.&lt;/p&gt;
&lt;p&gt;However, inside the subpage, the data might be used everywhere. There is no clear component that can assert ownership over the data. I like handling this scenario with the Context API as well. We have a &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; that wraps the page and fetches the data asynchronously by contacting a &lt;a href=&quot;https://samnewman.io/patterns/architectural/bff/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;backend for frontend&lt;/a&gt;. That information is stored in the provider. After this, every component on the page uses the data without having to worry about the remote interaction. Thus, we contain that to a component that we test dedicatedly, making the others more independent.&lt;/p&gt;
&lt;p&gt;As mentioned, the use of hooks reduces the complexity significantly. Moreover, we avoid having to deal with lifecycle methods, which is a common source of subtle errors.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/280765138b08e28b4831bdeb71b7f919/a82e6/page-state.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAC4jAAAuIwF4pT92AAACCUlEQVR42l1SPW8UMRDdX0PBj6SEa7KioqJCSFGEgEhUdHSgCIEIIlzua9efa3ts34WAElmnG+Q5+1iuGI0/3hu/eZ7GQZhYHyeuhIVAGcKawjs/8dZNwMeJj5sDpsYR70HjIKDzkcKWdc5CDRQs3iDb/EFpAIXUqA0QBsKaImMrz0E8bZzPm3DvICQLITkfkxpsktqmfHb77lW6e/EsDdNpks4npQ3hVr1IPZeEdz7elaLnTVG0dT7u6kuDBVx2HLlUyM/e4+LpKYqra5wzgT0TOJ11+OniEi8+f0ELced83Bbum8YCtbsdt6wGh0xqtAD4/CXioyeI368CaqORCY1cGip6PV9i5Rfu26b4tx17kRVm/6Q2OJ/1OP2xoCL5TA324N3I+72gccGxwhxCGVIppEIlBK251Gicp4IVXzh7QblgOaySURtHxOyhMg4BAoLd/2yXPeSSlI8novLtccv5ZaENrnqOi44hFwqdcZhHK9uw6gV2TFI+GrWt3e//Kay/nNVlEucKgUmMQN4c2ss+ZqVDUW0h7KqHDuiX6YX7OlvLniclh/SxW6TH3z6k1z+/pgDxvxntmEjLjiWpTYKwznd3RfF5M/Yi/6AcLPnYDwNeSo4zpajl8QQQTpuxyprPsoethdA6H08grNscLqzbGDbt7/ir3cSb1nq6r7j2gNufneRc4uFfYXisvBIu+ekAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;A provider retrieves data from a remote endpoint, stores it, and makes it available for consumers&quot; title=&quot;&quot; src=&quot;/static/280765138b08e28b4831bdeb71b7f919/1d69c/page-state.png&quot; srcset=&quot;/static/280765138b08e28b4831bdeb71b7f919/4dcb9/page-state.png 188w,
/static/280765138b08e28b4831bdeb71b7f919/5ff7e/page-state.png 375w,
/static/280765138b08e28b4831bdeb71b7f919/1d69c/page-state.png 750w,
/static/280765138b08e28b4831bdeb71b7f919/78797/page-state.png 1125w,
/static/280765138b08e28b4831bdeb71b7f919/aa440/page-state.png 1500w,
/static/280765138b08e28b4831bdeb71b7f919/a82e6/page-state.png 3334w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;Caveat: The Context API is not for every use case&lt;/h3&gt;
&lt;p&gt;The Context API is a convenient tool that has a low barrier to adoption. But we have to be aware of its limitations. If the data stored as a value in a &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; changes, the whole tree under it will be re-rendered. If you save state that frequently mutates high up in your component hierarchy, that’ll lead to flickering. It may compromise the experience of the application. Measuring the performance of your application regularly helps to prevent nasty surprises.&lt;/p&gt;
&lt;p&gt;Apart from that, we have to consider how to mutate the state. We can enhance our state stored in the &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt; with a function to change the state. That way, the components are not merely passive consumers. And closing the cycle, we might long at some point for Redux’s Action -&gt; Reducer -&gt; State loop. We can do this as well without Redux.&lt;/p&gt;
&lt;h2&gt;Reducers Without Redux&lt;/h2&gt;
&lt;p&gt;You might be used to Redux’s model by now. Modeling state transitions through reducers has become a well-understood problem. It’s supported by high-quality libraries like &lt;a href=&quot;https://github.com/immerjs/immer&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;immer&lt;/a&gt;. This idea of forsaking Redux sounds scary and revolutionary.&lt;/p&gt;
&lt;p&gt;Do not despair, though. You can benefit from Redux’s ideas without using Redux the library. The &lt;a href=&quot;https://reactjs.org/docs/hooks-reference.html#usereducer&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;useReducer&lt;/a&gt; hook brings the power of reducers. Once again, the hook syntax makes the code less dense and easier to follow. You keep using reducers as you were before. As an added benefit, it comes in React out of the box.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This article is not about rejecting Redux. The ideas behind Redux are as valid as ever. Using Redux makes sense if your application is sufficiently complicated. But considering your circumstances is crucial when making an informed decision. React is constantly improving, and it’s getting easier to do state management natively.&lt;/p&gt;
&lt;p&gt;Developers tend to have a hard time predicting the evolving needs of a system. Given this fact, I advise &lt;a href=&quot;https://evolutionaryarchitecture.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;building an evolutionary architecture&lt;/a&gt;. Try to start simple. If your code is structured thoughtfully, there is always the possibility of adding Redux later, as the requirements become clearer. Likely, you’ll never reach this point. This approach thus saves you time and lets you iterate faster in reaching your goals. That is a better alternative than introducing technology for the sake of technology.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://auth0.com/blog/starting-a-new-app-with-redux-consider-context-api-first/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Management 3.0]]></title><description><![CDATA[Management in the context of Agile. How does it even work? This book is about building high performing teams and leading them]]></description><link>https://hceris.com/book-review-management-3-dot-0/</link><guid isPermaLink="false">https://hceris.com/book-review-management-3-dot-0/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Agile]]></category><pubDate>Sun, 09 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 260px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0e5a7c83b4cd2274727a989950b11bfb/ab8e0/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 130.31914893617022%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAQL/xAAXAQADAQAAAAAAAAAAAAAAAAAAAgQB/9oADAMBAAIQAxAAAAGXh3hVOSNIz0steuYRJ//EAB0QAAEEAgMAAAAAAAAAAAAAAAMAAQIQETMSITH/2gAIAQEAAQUCoPQqDrUZ4Q35Qb1A1f/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABgRAAMBAQAAAAAAAAAAAAAAAAACMQEQ/9oACAECAQE/ARrxrp//xAAYEAADAQEAAAAAAAAAAAAAAAAAARAxof/aAAgBAQAGPwKKbwVTqP/EAB4QAAIBBAMBAAAAAAAAAAAAAAABESExQbEQYXGh/9oACAEBAAE/IWq3IFgyJtZ+CbLKKzcesNz6dycuxs//2gAMAwEAAgADAAAAEMvmTP/EABcRAAMBAAAAAAAAAAAAAAAAAAABMRD/2gAIAQMBAT8QHcdP/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAERITFxof/aAAgBAgEBPxAe+yWsHcf/xAAfEAEAAgICAgMAAAAAAAAAAAABABEhMUFRgaFhcbH/2gAIAQEAAT8QG1Jz1L3zEAvt9sUqoH3YukGM/KBLVuc+WLZT33DAAFALlMgZYNbhL+YB0cT3/wBJ/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Management 3.0&quot; title=&quot;&quot; src=&quot;/static/0e5a7c83b4cd2274727a989950b11bfb/ab8e0/cover.jpg&quot; srcset=&quot;/static/0e5a7c83b4cd2274727a989950b11bfb/bc01b/cover.jpg 188w,
/static/0e5a7c83b4cd2274727a989950b11bfb/ab8e0/cover.jpg 260w&quot; sizes=&quot;(max-width: 260px) 100vw, 260px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Agile development has a complex relationship with management. Some old school organizations want to call themselves agile, without changing anything substantive. So they maintain the same hierarchies as before and keep decisions out of the team. But they use story points. Others react to this and go the opposite way: They have teams where every single thing is supposed to be decided in a “democratic” way. It tends to lead to a lot of meetings and few if any actual decisions.&lt;/p&gt;
&lt;p&gt;So, there seems to be still plenty of space for books like this one. This book intends to give you a better toolbox to engage in agile leadership. It’s not about a concrete set of steps. If you’re looking for a recipe to follow, you’re going to be disappointed.&lt;/p&gt;
&lt;p&gt;The book talks about many different aspects of what some call &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/leadership-agile-environment&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;servant leadership&lt;/a&gt;. These are some chapters in the book:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How to energize people&lt;/li&gt;
&lt;li&gt;How to empower teams&lt;/li&gt;
&lt;li&gt;How to develop competence&lt;/li&gt;
&lt;li&gt;How to grow structure&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each chapter gives you plenty of different thoughts and ideas. You can then consider and adapt for your organization. As I said, it doesn’t get very concrete, so you’ll have to do your homework if you want to translate the ideas into actions. It might not be the first book you want to read about agile development.&lt;/p&gt;
&lt;h2&gt;Pragmatism&lt;/h2&gt;
&lt;p&gt;The thing I like the most is the pragmatism throughout the content. Agile development materials are sometimes a bit &lt;em&gt;naive&lt;/em&gt;. If you call yourself a &lt;em&gt;self-enabled&lt;/em&gt; team, everything will be fine! Or so goes the thinking. But some people don’t argue in good faith. Or they’re not that motivated. Or something else. That’s a reality that many choose to ignore willfully. And it might lead to frustration.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;There are things to learn from this book. It’s an interesting view on agile, and it covers a lot of ground on how to organize teams effectively. However, it ends up being a bit too long. I think more aggressive editing would’ve helped. There’s a bit too much rambling for my taste in some parts. That’s why I score it with ⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Why Is Refactoring Your Code Important in Agile?]]></title><description><![CDATA[Learn why refactoring your code is important. Foster experimentation and lightweight solutions, not excessive planning and fear of change.]]></description><link>https://hceris.com/why-is-refactoring-your-code-important-in-agile/</link><guid isPermaLink="false">https://hceris.com/why-is-refactoring-your-code-important-in-agile/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Software Engineering]]></category><category><![CDATA[Agile]]></category><category><![CDATA[Refactoring]]></category><pubDate>Sun, 02 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/35d53117f59a5ec3480b55711a9b02f4/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAD/9oADAMBAAIQAxAAAAHWpxyoJZv/xAAZEAADAQEBAAAAAAAAAAAAAAAAAQISERP/2gAIAQEAAQUCxCGo41Pd0bZ6Wf/EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwGMv//EABYRAQEBAAAAAAAAAAAAAAAAAAATAf/aAAgBAgEBPwGqmP/EABoQAAICAwAAAAAAAAAAAAAAAAAxARARISL/2gAIAQEABj8C6k1kcjpn/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERITFBYdH/2gAIAQEAAT8hWDl6EqpdGiQi22GvkdPJ/9oADAMBAAIAAwAAABCc/wD/xAAXEQEAAwAAAAAAAAAAAAAAAAAAARFR/9oACAEDAQE/EJys/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQBBcf/aAAgBAgEBPxAGjd7/xAAdEAEAAwACAwEAAAAAAAAAAAABABEhcYExQWGR/9oACAEBAAE/ENE6PHTGyvyW+bFqO41fIJc9wcsOA7RmK8Cf/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Refactoring&quot; title=&quot;&quot; src=&quot;/static/35d53117f59a5ec3480b55711a9b02f4/acb04/cover.jpg&quot; srcset=&quot;/static/35d53117f59a5ec3480b55711a9b02f4/bc01b/cover.jpg 188w,
/static/35d53117f59a5ec3480b55711a9b02f4/bf173/cover.jpg 375w,
/static/35d53117f59a5ec3480b55711a9b02f4/acb04/cover.jpg 750w,
/static/35d53117f59a5ec3480b55711a9b02f4/ec605/cover.jpg 1125w,
/static/35d53117f59a5ec3480b55711a9b02f4/c58a3/cover.jpg 1500w,
/static/35d53117f59a5ec3480b55711a9b02f4/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Refactoring is a powerful tool that is an integral part of every developer’s repertoire. It’s especially important if you work in an agile environment.&lt;/p&gt;
&lt;p&gt;Refactoring helps keep the code nimble and maintainable as you constantly iterate and pivot.&lt;/p&gt;
&lt;p&gt;In this post, I’m going to provide you with an overview of code refactoring, how it works, and its benefits.&lt;/p&gt;
&lt;h2&gt;What Is Refactoring?&lt;/h2&gt;
&lt;p&gt;For a proper definition, I’m quoting &lt;a href=&quot;https://martinfowler.com/books/refactoring.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Martin Fowler’s &lt;em&gt;Refactoring&lt;/em&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Refactoring (noun): a change made to the internal structure of software to make it easier to understand and cheaper to modify without changing its observable behavior.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You refactor to improve the internal structure of the code without changing any functionality. From the outside, there isn’t any noticeable difference before and after the refactoring. “If nothing changes, why do it at all?” your stakeholders might ask you. Let’s give them an answer.&lt;/p&gt;
&lt;h2&gt;3 Reasons Why Refactoring Is Important&lt;/h2&gt;
&lt;p&gt;Now that we understand what refactoring is, let’s take a look at why we should refactor code in an agile environment.&lt;/p&gt;
&lt;h3&gt;1. Refactoring Makes Your Code Easier to Modify&lt;/h3&gt;
&lt;p&gt;Simply put, you refactor to improve the design of your software. Any application under active development is a moving target. As you add new functionality, cohesion decreases. Abstractions aren’t as clean anymore. By refactoring regularly, you update the code so that it reflects an improved understanding of the domain. This alignment enables easier modification.&lt;/p&gt;
&lt;h3&gt;2. Refactoring Makes Your Code Easier to Understand&lt;/h3&gt;
&lt;p&gt;Thanks to an improved design, you also make the code easier to understand. It’s a well-known fact that developers &lt;a href=&quot;https://devblogs.microsoft.com/oldnewthing/20070406-00/?p=27343&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;read code much more often than they write it&lt;/a&gt;. Thus, it’s in your best interest to keep it as understandable as possible, which greatly increases maintainability. People going over it in the future will thank you.&lt;/p&gt;
&lt;h3&gt;3. Refactoring Is Sharing Knowledge&lt;/h3&gt;
&lt;p&gt;Finally, refactoring is a way of sharing knowledge. After refactoring a piece of code, you gain a deeper understanding of what it does, even if you didn’t originally write it. Spreading knowledge is crucial when you’re &lt;a href=&quot;https://www.coscreen.co/blog/even-10x-engineers-work-best-in-a-team/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;working as a team&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Role of Refactoring in Agile Development&lt;/h2&gt;
&lt;p&gt;The usefulness of refactoring is more apparent in an agile environment. When you do agile, you work in short iterations, continuously releasing small chunks of functionality that bring value. Fast feedback is paramount for a quick loop. Under these circumstances, it won’t be possible to design the whole system in advance. Many organizations spend a lot of time trying to plan everything upfront only to realize later on that their assumptions were wrong. Instead, you need to embrace change and build &lt;a href=&quot;https://www.thoughtworks.com/evolutionary-architecture&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;an evolutionary architecture&lt;/a&gt; that you constantly improve. Refactoring is a key part of the process as you align the code with the architecture, keeping both in sync.&lt;/p&gt;
&lt;h2&gt;The Cadence of Refactoring&lt;/h2&gt;
&lt;p&gt;Many teams struggle to integrate the refactoring step into their workflow. I strongly believe that refactoring is part of working on any user story. Don’t split it into a technical story that you’ll schedule later on, if ever. For me, implementing a story includes leaving the code in a better state than before (&lt;a href=&quot;https://wiki.c2.com/?BoyScoutRule&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the boy scout rule&lt;/a&gt; from &lt;a href=&quot;https://en.wikipedia.org/wiki/Robert_C._Martin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Uncle Bob&lt;/a&gt;). Whatever you do, don’t build an arbitrary distinction between business value (building the feature) and technical value (keeping the code accessible). Does this mean that you have to stop and refactor every bit of code that you write? No! Let’s be pragmatic. Maybe the first time you go over it, you won’t have enough context to improve it. If you touch it a second or a third time, then consider how to improve it. In the end, this is a balancing act. You want to continuously do small refactorings that never stop the delivery rhythm of the team.&lt;/p&gt;
&lt;h2&gt;The Anatomy of a Refactoring&lt;/h2&gt;
&lt;p&gt;Performing a refactoring is a bit like a kata. Each refactoring has a goal, centered around fixing a &lt;a href=&quot;https://martinfowler.com/bliki/CodeSmell.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;code smell&lt;/a&gt;. You implement it through a list of small steps. You run them in order, and the end result is improved code. Typical goals include organizing data, handling generalization, or simplifying method calls. As a reference, Fowler’s book &lt;em&gt;Refactoring&lt;/em&gt; consists of a catalog of many different refactorings. Depending on your situation, you pick the one that suits best in that scenario. And then you repeat the process. There are many tools in the market that support you in this cycle. For example, in the Java ecosystem, the IntelliJ IDEA IDE supports automating many refactorings. This might be a bit too high level. Maybe an example will make it clearer.&lt;/p&gt;
&lt;h3&gt;A Sample Refactoring&lt;/h3&gt;
&lt;p&gt;Let’s have a look at a classic: &lt;a href=&quot;https://refactoring.guru/extract-method&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Extract Method&lt;/a&gt;. In this refactoring, the goal is to group a code fragment in a separate method, making the original method smaller and easier to read. Essentially, this is the recipe:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a new method named after its intention.&lt;/li&gt;
&lt;li&gt;Copy the extracted code from the source into the new method.&lt;/li&gt;
&lt;li&gt;Call the new method from the source, passing the necessary variables.&lt;/li&gt;
&lt;li&gt;Ensure the code works as before.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s assume you have this block of code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;splitNumbers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// convert each string to a number&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; numbers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; split&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; numbers
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’m going to extract part of it into a new method, bit by bit. In the interest of space, I’ll skip the intermediate steps and show you the result:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;splitNumbers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; split &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertStringToNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertStringToNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you check the initial code, you’ll notice that the method is doing two things at once, which makes the code more confusing. The comment is a smell that the responsibilities are not cleanly separated. So, I’ve extracted that into its own method, called &lt;strong&gt;convertStringToNumber&lt;/strong&gt;. I’m passing the unprocessed list from the main method as an argument. Finally, the intermediate variable &lt;strong&gt;numbers&lt;/strong&gt; is no longer needed. Instead, I’m inlining the auxiliary method call, as the &lt;strong&gt;splitNumbers&lt;/strong&gt; method’s intention is clear now. Simple, isn’t it? I’ve made the code easier to maintain with little effort. Notice how I replaced a comment that’ll likely go out of sync with a meaningful method name that describes the block’s purpose instead.&lt;/p&gt;
&lt;h2&gt;Refactoring Best Practices&lt;/h2&gt;
&lt;p&gt;There are certain things to keep in mind when you’re refactoring code if you want to extract all the value from this practice:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Only refactor code that has tests. Refactoring code without tests is, frankly, gambling. There’s no way to be sure that you didn’t break the code if you don’t have tests that confirm that the before and after are equivalent. No matter how disciplined you are, you’ll introduce bugs sooner or later.&lt;/li&gt;
&lt;li&gt;Use incremental steps. Change a bit of code, then check if everything works. Then, commit before continuing. Always be on the lookout for &lt;a href=&quot;https://www.hanselman.com/blog/yak-shaving-defined-ill-get-that-done-as-soon-as-i-shave-this-yak&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;yak shaving&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Keep refactorings small. The bigger a change, the riskier it is. Split it into multiple smaller chunks. You mitigate risks, and you get flexibility.&lt;/li&gt;
&lt;li&gt;Remember the rules. Don’t start adding functionality in the middle of a refactoring. A refactoring doesn’t change the output of the system. Finish it first, then continue with the next task.&lt;/li&gt;
&lt;li&gt;Avoid the &lt;a href=&quot;https://www.behavioraleconomics.com/resources/mini-encyclopedia-of-be/sunk-cost-fallacy/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sunk cost fallacy&lt;/a&gt;. If you go down a route that leads you nowhere, abandon the whole thing. Given that you are working in small steps, you won’t lose much.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Refactoring is all about constant practice and discipline. If you do it often, it’ll become second nature to you.&lt;/p&gt;
&lt;h2&gt;What If I Still Don’t Want to Refactor My Code?&lt;/h2&gt;
&lt;p&gt;Let’s be honest. If you still don’t want to refactor your code, you’ll be the one who gets harmed the most. If you only add code without improving its internal structure, you’ll hit a wall. At some point, it’ll take you a ridiculous amount of effort to add a minor feature. Your stakeholders won’t be happy, and appeasing them by talking about &lt;a href=&quot;https://en.wikipedia.org/wiki/Technical_debt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tech debt&lt;/a&gt; won’t do you any good. Should you ask them for permission to work on these refactorings? I don’t think so. You, as a developer, are the expert here. If you’re concerned, make sure to follow the steps above. If you’re delivering a steady stream of value, I’m sure that they won’t have a problem with you investing in the health of the codebase.&lt;/p&gt;
&lt;h2&gt;Don’t Fly Solo&lt;/h2&gt;
&lt;p&gt;Refactoring is an activity that benefits greatly from collaboration. If you do any amount of &lt;a href=&quot;https://www.coscreen.co/blog/love-or-hate-pair-programming-here-to-stay/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pair programming&lt;/a&gt;, you’ll likely work on areas that either your pair or you don’t fully understand. Refactoring this code together is a great way to gain a shared understanding, transfer knowledge, and develop a codebase that looks like it was written by a single person. Collaboration doesn’t stop just because you’re not in the office with your teammates anymore. Distributed teams working remotely have the same need for effective teamwork. If you’re interested in learning more about remote agile, check out this guide: &lt;a href=&quot;https://www.coscreen.co/blog&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Distributed Agile Teams: A [N] Step Guide to Success.&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Refactoring Is Essential to Agile&lt;/h2&gt;
&lt;p&gt;Refactoring consists of changing the internal structure of the code in a way that doesn’t modify its behavior. This makes the code more maintainable and easier to understand. It enables the developers in the team to keep complexity under control. In my opinion, you can’t do agile without a healthy culture of refactoring. You want to encourage experimentation and lightweight solutions, not excessive planning and fear of change. For that, you need to improve the code continuously through small modifications. If you don’t tend your garden, it’ll decay over time until every feature takes forever to build. You’ll be left wondering how it ended up like this.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://www.coscreen.co/blog/refactoring-your-code-in-agile/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CoScreen&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[What Is Code Duplication? A Definition and Overview]]></title><description><![CDATA[Code duplication makes software less maintainable and reduces our ability to iterate fast. Learn what duplication is and how to prevent it]]></description><link>https://hceris.com/what-is-code-duplication-definition-and-overview/</link><guid isPermaLink="false">https://hceris.com/what-is-code-duplication-definition-and-overview/</guid><category><![CDATA[Practices]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[Software Engineering]]></category><pubDate>Sun, 18 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0aec3c59d41499eeb9f628eb8f87779c/0f98f/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABlv6ahGgP/8QAGRABAQADAQAAAAAAAAAAAAAAAQIEEBET/9oACAEBAAEFAsf1mqyZameAcGR1/8QAFhEAAwAAAAAAAAAAAAAAAAAAAhAh/9oACAEDAQE/ARi//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAIRIv/aAAgBAgEBPwGelP/EABwQAAICAgMAAAAAAAAAAAAAAAABESEQEiMxUf/aAAgBAQAGPwLjk16hnpRaTx//xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhQRBhcf/aAAgBAQABPyGh0OnGa9fQZluoFAA9Re/uHj//2gAMAwEAAgADAAAAEP8A3//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQMBAT8Q09eyrf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8QYc5ADL//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMRBhQYHR/9oACAEBAAE/EEwVJjxd/YKWADG3VZ78kEFsbVK9QMZaBRBiEbE2uP/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Duplication&quot; title=&quot;&quot; src=&quot;/static/0aec3c59d41499eeb9f628eb8f87779c/acb04/cover.jpg&quot; srcset=&quot;/static/0aec3c59d41499eeb9f628eb8f87779c/bc01b/cover.jpg 188w,
/static/0aec3c59d41499eeb9f628eb8f87779c/bf173/cover.jpg 375w,
/static/0aec3c59d41499eeb9f628eb8f87779c/acb04/cover.jpg 750w,
/static/0aec3c59d41499eeb9f628eb8f87779c/ec605/cover.jpg 1125w,
/static/0aec3c59d41499eeb9f628eb8f87779c/c58a3/cover.jpg 1500w,
/static/0aec3c59d41499eeb9f628eb8f87779c/0f98f/cover.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Code duplication is a common ailment in many codebases throughout the software industry.&lt;/p&gt;
&lt;p&gt;Many projects are declared to be of poor quality due to excessive duplication, and developers lament the state of affairs.&lt;/p&gt;
&lt;p&gt;In this post, I’m going to talk about what code duplication is and why it’s a drain on quality. After that, I’ll explain what you can do to prevent and fix it.&lt;/p&gt;
&lt;h2&gt;What Is Code Duplication?&lt;/h2&gt;
&lt;p&gt;Simply put, it’s when a snippet of code appears multiple times throughout a codebase. It happens for many reasons:&lt;/p&gt;
&lt;ul&gt;
 	&lt;li&gt;Somebody wanted to reuse a function in a different class, and copy-paste was the quickest solution.&lt;/li&gt;
 	&lt;li&gt;People independently developed the same functionality in two places simultaneously.&lt;/li&gt;
 	&lt;li&gt;A class evolved in functionality until it covered most of what another class does.&lt;/li&gt;
&lt;/ul&gt;
Regardless of the reason, the consequence is that you have the same code in more than one spot.
&lt;p&gt;People without a background in software development might wonder: &lt;em&gt;So what?&lt;/em&gt; However, this isn’t just a stylistic matter. There are real downfalls associated with code duplication.&lt;/p&gt;
&lt;p&gt;Before we talk about those problems, let’s have a look at an example.&lt;/p&gt;
&lt;p&gt;Let’s say you’re keeping track of the stories assigned to a developer. You’re applying some logic to format those IDs. Now, there’s a different entity, &lt;strong&gt;Operator&lt;/strong&gt;, that follows the same logic. To save time, a developer reused the code, thus generating duplication.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Developer&lt;/span&gt;
  attr_reader &lt;span class=&quot;token symbol&quot;&gt;:assigned_stories&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;stories&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@assigned_stories&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stories
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;/span&gt;
    assigned_stories
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;lt&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;story-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Operator&lt;/span&gt;
  attr_reader &lt;span class=&quot;token symbol&quot;&gt;:assigned_stories&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stories&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@assigned_stories&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stories
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;/span&gt;
    assigned_stories
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;lt&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;story-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, the same functionality exists in two places. And as you introduce other entities in your domain, this duplication might spread even more.&lt;/p&gt;
&lt;h2&gt;The Issue With Code Duplication&lt;/h2&gt;
&lt;p&gt;As Robert C. Martin (“Uncle Bob”) eloquently explains in his book, &lt;em&gt;Clean Code&lt;/em&gt;:&lt;/p&gt;
&lt;blockquote&gt;Duplication may be the root of all evil in software.&lt;/blockquote&gt;
Duplication greatly decreases the maintainability of your code. Ideally, introducing a change in business logic should require your team to change one class or function, and no more. Otherwise, a developer has to spend extra effort hunting down all these extra occurrences. Additionally, there&apos;s the risk of &lt;em&gt;forgetting&lt;/em&gt; some of them. Now your application behaves inconsistently because your team didn&apos;t apply the change uniformly!
&lt;p&gt;Code duplication is enough of a challenge in the industry that one of the best-known software engineering practices is Don’t Repeat Yourself (&lt;a href=&quot;https://en.wikipedia.org/wiki/Don%27t_repeat_yourself&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DRY&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Do you need to be worried about code duplication? I say yes.&lt;/p&gt;
&lt;ul&gt;
 	&lt;li&gt;Having to change the same code multiple times harms your [cycle time](https://linearb.io/cycle-time).&lt;/li&gt;
 	&lt;li&gt;If you have to apply a change in multiple places, then implementing that change will take longer.&lt;/li&gt;
 	&lt;li&gt;If the duplication is pervasive enough, it&apos;ll lead to a decreased delivery speed.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We aren’t talking about technical preferences anymore. Slower delivery is a business outcome you’ll definitely want to avoid. So, code duplication isn’t just a nuisance but a business risk as well.&lt;/p&gt;
&lt;h2&gt;How to Measure Code Duplication&lt;/h2&gt;
&lt;p&gt;Teams often measure code duplication qualitatively, based on the perception of the members of the team. It’s a limited approach due to subjectivity. Still, it works as a first check.&lt;/p&gt;
&lt;p&gt;There are tools to help you if you’re aiming for concrete numbers. For instance, &lt;a href=&quot;https://www.sonarqube.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SonarQube&lt;/a&gt; inspects a codebase and computes quality metrics, including code duplication. In this case, duplication means syntactically identical fragments, with some tolerance allowed for comments and variable names, for instance. In other words, blocks that are very similar but not identical still count.&lt;/p&gt;
&lt;h2&gt;How Much Duplication Is Too Much?&lt;/h2&gt;
&lt;p&gt;You might think that it’s sensible to define an upper limit of the amount of duplication you want to tolerate and fail the build if you surpass it. But trying to define arbitrary cutoff values is difficult, as you always need context when interpreting these numbers.&lt;/p&gt;
&lt;p&gt;I prefer observing trends instead. If you store this data over time and notice a marked increase, it’s probably time to bring the team together to discuss how to handle it.&lt;/p&gt;
&lt;p&gt;Additionally, measuring something close to a developer’s heart, like duplication, is a great way to move toward a more &lt;a href=&quot;https://linearb.io/blog/how-to-introduce-data-driven-culture-to-your-dev-team/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;data-driven culture&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;How to Avoid Code Duplication&lt;/h2&gt;
&lt;p&gt;Duplication is a sign that the same&lt;em&gt; concept&lt;/em&gt; is appearing multiple times throughout the codebase. It suggests that the system’s architecture hasn’t been defined cleanly.&lt;/p&gt;
&lt;p&gt;You have the opportunity to avoid duplication before a single line of code is written if you stop and think about the architecture of your application. You don’t want to waste time creating a big, comprehensive architecture up front, though. Instead, try to use lightweight paradigms that guide you without slowing you down. I have two in mind.&lt;/p&gt;
&lt;h2&gt;Domain-Driven Design&lt;/h2&gt;
&lt;p&gt;Domain-driven design (DDD) is a broad subject with a bigger scope than just avoiding duplication. If you zoom in, &lt;a href=&quot;https://martinfowler.com/bliki/BoundedContext.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;bounded contexts&lt;/a&gt; are an excellent way to identify subsystems that are separated from each other. The ultimate goal is to figure out which business entities form your system and create clear boundaries between them.&lt;/p&gt;
&lt;p&gt;If you break up the domain, it’s less likely that you’ll re-create the same object, class, or function multiple times. If you do, it may indicate that you’re in fact dealing with two things that look alike but are different. I’ll mention this again when I get to fixing duplication.&lt;/p&gt;
&lt;h2&gt;DRY (and a bit of SOLID)&lt;/h2&gt;
&lt;p&gt;If there’s one takeaway from this article, it’s this: A modification of the business logic should lead to changing &lt;em&gt;one&lt;/em&gt; class or function. That’s a pretty good indication of the health of your code. That’s the idea behind DRY. You shouldn’t represent a concept more than once in your code. If you do, it’ll bring trouble.&lt;/p&gt;
&lt;p&gt;In addition, you can bring &lt;a href=&quot;https://en.wikipedia.org/wiki/SOLID&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SOLID principles&lt;/a&gt; to enhance your architecture further. SOLID is an acronym that refers to five principles to structure software. Let’s focus on the S. It stands for &lt;a href=&quot;https://en.wikipedia.org/wiki/Single-responsibility_principle&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;single-responsibility principle&lt;/a&gt;. It’s defined as the idea that one class should have only one reason to change.&lt;/p&gt;
&lt;p&gt;While this principle doesn’t address duplication directly, when combined with DRY, it leads to a stronger design. Through DRY, you need to change only one class or function for every business change. And then, by using SRP classes, you have only one responsibility. The combination of both simplifies identifying and applying changes to a system. That’s because you know there will be exactly one place to modify, and that change by definition won’t impact any other area.&lt;/p&gt;
&lt;h2&gt;How to Fix Code Duplication&lt;/h2&gt;
&lt;p&gt;Once duplication is in your code, you have to move from prevention to action. The canonical way of getting rid of duplication is through &lt;a href=&quot;https://refactoring.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;refactoring&lt;/a&gt;. Much is available on the topic. The most important thing to remember: Before refactoring code, you must ensure that it’s covered by tests. Without them, you’re just praying that the result will work.&lt;/p&gt;
&lt;p&gt;Coming back to the previous example, you’ve defined your expectations through this test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;describe Developer &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  let&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:subject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Developer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  it &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;filters ids past 100&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    expect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;format&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not_to &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;story-101&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  it &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;formats the ids into story ids&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    expect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;format&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;story-1&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For this scenario, the most natural way of getting rid of the duplication is by extracting the method to a shared concern. It corresponds loosely to the &lt;a href=&quot;https://refactoring.com/catalog/pullUpMethod.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pull-up method&lt;/a&gt; of refactoring. You can do that and let both classes use it.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Formatter&lt;/span&gt;
  attr_reader &lt;span class=&quot;token symbol&quot;&gt;:assigned_stories&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;/span&gt;
    assigned_stories
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;lt&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;story-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token content&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Developer&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; Formatter

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;stories&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@assigned_stories&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stories
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Operator&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; Formatter

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stories&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@assigned_stories&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stories
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, the code implementing your logic is present in only one place. If you have to change it in the future, you have one unique place to modify.&lt;/p&gt;
&lt;p&gt;This change will have a positive impact on the &lt;a href=&quot;https://linearb.io/dev-team-metrics/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;rework ratio&lt;/a&gt;. Why? Well, you need to modify only one function instead of two. And the same applies if you need this functionality elsewhere. You can reuse it as many times as needed because they all refer back to the canonical implementation.&lt;/p&gt;
&lt;h2&gt;Beware of Code That Looks Similar But Isn&apos;t&lt;/h2&gt;
&lt;p&gt;There’s one important caveat to mention. Just because two snippets of code look similar, it doesn’t necessarily mean they represent the same concept. If the team follows a consistent approach, they’ll naturally use similar structures for different business domains. I consider this to be a good thing, as it makes the code more consistent.&lt;/p&gt;
&lt;p&gt;It’s tempting to try to eliminate &lt;em&gt;any&lt;/em&gt; duplication by abstracting every possible block. However, this leads to increased coupling. You’re introducing dependencies between entities that exist separately, which makes it harder to change them, decreasing your maintainability again.&lt;/p&gt;
&lt;p&gt;Every time you refactor code, ask yourself if the duplication you’re trying to change is incidental or indicates a design problem. Being too zealous might create a different issue.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Duplication looks simple on the surface. Yet, it has a surprising amount of depth associated with it. Your goal is to make sure that any application is evolvable and maintainable. You’ll want to be able to make changes quickly so that you remain able to iterate quickly.&lt;/p&gt;
&lt;p&gt;To handle duplication, you need to recognize it first and refactor the code continuously to keep it healthy. However, you also need to be careful not to over-abstract things and end up with a harder system to maintain.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post was published initially in &lt;a href=&quot;https://linearb.io/blog/code-duplication/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LinearB&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How not to do a take-home coding assignment]]></title><description><![CDATA[A bad experience in a take-home coding assignment can ruin how a candidate perceives your company. Let's talk about some anti-patterns]]></description><link>https://hceris.com/how-not-to-do-a-take-home-coding-assignment/</link><guid isPermaLink="false">https://hceris.com/how-not-to-do-a-take-home-coding-assignment/</guid><category><![CDATA[Interviews]]></category><category><![CDATA[Coding Challenge]]></category><pubDate>Mon, 05 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f4a99f951012fe95bd5eb7bc622b9675/0f98f/interview.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAME/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAYxmhyhP/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQIDESIAEBL/2gAIAQEAAQUCHSS7B0mz01Of/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgMBAQAAAAAAAAAAAAAAAREAAhASIf/aAAgBAQAGPwIclRpZV+y4z//EABsQAQACAgMAAAAAAAAAAAAAAAEAIRDhQZGx/9oACAEBAAE/IVStbNRdwR5irH6aKuVvD//aAAwDAQACAAMAAAAQ5N//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBAJ//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPxAVf//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExQVFhcfD/2gAIAQEAAT8QCwUW5a5XD4lBU3olb+9xS1Y1hkg7WTfBunMYJXU//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Interview&quot; title=&quot;&quot; src=&quot;/static/f4a99f951012fe95bd5eb7bc622b9675/acb04/interview.jpg&quot; srcset=&quot;/static/f4a99f951012fe95bd5eb7bc622b9675/bc01b/interview.jpg 188w,
/static/f4a99f951012fe95bd5eb7bc622b9675/bf173/interview.jpg 375w,
/static/f4a99f951012fe95bd5eb7bc622b9675/acb04/interview.jpg 750w,
/static/f4a99f951012fe95bd5eb7bc622b9675/ec605/interview.jpg 1125w,
/static/f4a99f951012fe95bd5eb7bc622b9675/c58a3/interview.jpg 1500w,
/static/f4a99f951012fe95bd5eb7bc622b9675/0f98f/interview.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Tell me about your biggest flaw
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Technical interviews are a &lt;a href=&quot;https://www.google.com/search?q=tech+interviews+suck&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;contentious&lt;/a&gt; topic, to say the least. It applies both as a candidate and as an interviewer. It feels that you end up sinking a lot of time into it, often with little to show for it.&lt;/p&gt;
&lt;p&gt;More concretely, it seems that take-home coding assignments are becoming more and more the norm in the tech industry. Do you have opinions about them? I surely do! In this post, I want to talk about some practices I’ve observed lately that make companies look bad and poison the goodwill essential for a successful interaction between candidates and companies.&lt;/p&gt;
&lt;h2&gt;What is a Take-home Coding Assignment, anyways?&lt;/h2&gt;
&lt;p&gt;It’s a programming exercise that a candidate completes on her own time. Some examples are:&lt;/p&gt;
&lt;p&gt;Building a small application from scratch.
Fixing a provided application, or extending it with new functionality.
Sketching the architecture for a system.&lt;/p&gt;
&lt;p&gt;The main justification behind giving homework is that it allows the candidate to work at her own pace, without the pressure of an interview setting. Many candidates struggle to code live, and they sometimes get rejected because they couldn’t showcase their knowledge within the strict boundaries of an interview. Fair enough.&lt;/p&gt;
&lt;p&gt;There is another benefit for the companies that they like to downplay: The candidate has to invest time, and the company doesn’t. Even if you discard the submitted code, it still counts as labor in my book. I’ve never heard of any organization that pays for that time, by the way. Let’s call it like it is, this is working for free. Being forthcoming and honest about this is crucial to design an exercise that gives the company the information they need without putting undue pressure on a candidate. Let’s go over some antipatterns that are sadly all-too-common.&lt;/p&gt;
&lt;h2&gt;Taking the Candidate’s Time for granted&lt;/h2&gt;
&lt;p&gt;If somebody is going to do some work for you, you have to respect their time. There are two aspects to it:&lt;/p&gt;
&lt;h3&gt;Deadline&lt;/h3&gt;
&lt;p&gt;Are you going to set a deadline of, like, one week without actually checking with the candidate? Great news, you just planned their weekend for them. I love when companies do that. I’m sure people with family commitments appreciate it.&lt;/p&gt;
&lt;h3&gt;Time Investment&lt;/h3&gt;
&lt;p&gt;How much time should you invest in it? Set clear boundaries. Is it two hours maximum, or two days? The candidate has no idea what you’re expecting. And I mean realistic expectations. Setting up an application from scratch takes some time, even if you have some sample code to help with the bootstrapping. The asymmetry of information will lead people to invest much more than what you had in mind.&lt;/p&gt;
&lt;p&gt;A related point is &lt;em&gt;reciprocity&lt;/em&gt;. How long are your engineers going to spend going over the code? I know for a fact certain organizations send out exercises that take multiple hours to complete. Then, an engineer might spend five minutes at best going over the code before rejecting it. That’s just demeaning. I mean, come on.&lt;/p&gt;
&lt;h2&gt;Putting this Step Way too Early in the Process&lt;/h2&gt;
&lt;p&gt;There is a balance here. As a company, you might have multiple steps in the recruitment process. You don’t want to set up a panel for somebody who can’t show any technical proficiency whatsoever. That’s understandable.&lt;/p&gt;
&lt;p&gt;On the other hand, your responsibility is to explain the position well enough so that a candidate can make an informed decision. It feels silly to write this, but I’ve seen it happen. A company congratulating a candidate for having the privilege of taking part in this challenge. But they couldn’t bother to explain what the role entails. Let alone how the rest of the process looks like (another pet peeve of mine!).&lt;/p&gt;
&lt;h2&gt;Vague Instructions&lt;/h2&gt;
&lt;p&gt;A home exercise is not the place to show the world how smart and cunning you are. Be specific! Do you want to see tests? Say it so. You prefer a vertical slice that’s not production-ready, or do you want to see a smaller part that is finished? What is important for you?&lt;/p&gt;
&lt;p&gt;Now, somebody will surely object to this and say that real-life problems are vague and that as a candidate you need to navigate unclear requirements. Then, do a proper coding exercise, where the candidate has the opportunity to ask questions and clarify the requirements. You went for the asynchronous route, it’s your job to make it clear and explicit.&lt;/p&gt;
&lt;p&gt;I have the theory that some companies leave requirements vague to have plausible deniability to reject whatever they don’t like. Which I find terribly unfair.&lt;/p&gt;
&lt;h2&gt;Expect Over-specific Knowledge&lt;/h2&gt;
&lt;p&gt;Having been a consultant for some time, I’ve noticed that people in many organizations assume that everybody else has the same context about their problems as they do. Then, they design their challenge as if somebody who doesn’t know the deep details of an API is not worth talking to.&lt;/p&gt;
&lt;p&gt;Are you sure you want to be that person? Are the finer details of &lt;a href=&quot;https://www.baeldung.com/spring-dependency-injection&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot’s dependency injection&lt;/a&gt; the difference between success and failure in your organization? &lt;em&gt;Really&lt;/em&gt;? I find that hard to believe. I’ve been guilty of this myself, and I think the only thing it accomplishes is reducing your candidate pool. Unless you’re a big brand that can afford it, it’s likely not in your best interest.&lt;/p&gt;
&lt;h2&gt;Not giving actual Feedback&lt;/h2&gt;
&lt;p&gt;After having somebody invest their time in building something for you, you owe them some useful feedback so that they can improve their craft. In Germany, many companies won’t give feedback to candidates at all. Or if they do, it will be so soulless, generic, and corporate that it might as well be read in a robot’s voice.&lt;/p&gt;
&lt;p&gt;I get that rejection is never easy, and it might expose a company to some liability. But seriously, giving feedback about source code ought to be doable. If you’re afraid of doing it, maybe your criteria are more arbitrary than what you’d care to admit.&lt;/p&gt;
&lt;h2&gt;In Summary, Empathy!&lt;/h2&gt;
&lt;p&gt;Are take-home coding assignments here to stay? I’d guess so. They bring some benefits, after all. When you’re setting one up for a position, keep one word in mind: &lt;strong&gt;Empathy&lt;/strong&gt;. Show a bit of empathy toward the people that are considering your organization as a possible destination. Don’t assume infinite time, instant availability, or people reading your mind to understand exactly what you want. It really grinds my gears when somebody treats my time as if it’s worthless.&lt;/p&gt;
&lt;p&gt;If not for general decency, do it for branding reasons. Good candidates have options. A thoughtful recruitment process is a signal that you’re better than other organizations out there that only want fresh meat in. I’m personally willing to listen a lot more when I feel that a company respects my time.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to Anna and Vicky for the feedback.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Authorization Code Flow with PKCE (OAuth) in a React application]]></title><description><![CDATA[SPAs implementing OAuth should pick Authorization Code Flow with PKCE for maximum security. Let's implement it in React with help of Auth0]]></description><link>https://hceris.com/oauth-authorization-code-flow-pkce-for-react/</link><guid isPermaLink="false">https://hceris.com/oauth-authorization-code-flow-pkce-for-react/</guid><category><![CDATA[Auth0]]></category><category><![CDATA[OAuth]]></category><category><![CDATA[React]]></category><pubDate>Mon, 29 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/dd0790d7774c3b701ca4d48909e4aa05/c08c5/lock.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHnmxVUyf/EABkQAQEAAwEAAAAAAAAAAAAAAAEAAhARIf/aAAgBAQABBQI5roRY+yl//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAEQMREicf/aAAgBAQAGPwIs2WWdij//xAAcEAADAQACAwAAAAAAAAAAAAABESEAMUFRYfH/2gAIAQEAAT8hV0/BzEJEun1jJI5eZgOBi+tIxo6m/9oADAMBAAIAAwAAABDAz//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAEDAQE/EEf/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAgEBPxBX/8QAHRAAAwEAAgMBAAAAAAAAAAAAAREhAEFRMYHB0f/aAAgBAQABPxBGPCe0/NGBXY5gLRhB/ecuizI0uAFwsRxqAvU17ZAIlXvDE2AGk6+b/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Lock&quot; title=&quot;&quot; src=&quot;/static/dd0790d7774c3b701ca4d48909e4aa05/c08c5/lock.jpg&quot; srcset=&quot;/static/dd0790d7774c3b701ca4d48909e4aa05/bc01b/lock.jpg 188w,
/static/dd0790d7774c3b701ca4d48909e4aa05/bf173/lock.jpg 375w,
/static/dd0790d7774c3b701ca4d48909e4aa05/c08c5/lock.jpg 640w&quot; sizes=&quot;(max-width: 640px) 100vw, 640px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve been working with OAuth a lot lately. Just recently, I wrote about setting it up for &lt;a href=&quot;../setting-up-oauth-for-grafana-with-auth0/&quot;&gt;grafana&lt;/a&gt;. Today, I want to talk about the recommended flow for Single Page Applications, &lt;em&gt;Authorization Code Flow with PKCE&lt;/em&gt;. I’m going to add authorization to a React application leveraging &lt;a href=&quot;https://auth0.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt; as an Identity Provider.&lt;/p&gt;
&lt;p&gt;I mention Auth0 so often around here, you’d think I’m getting a referral bonus. I promise you I’m not! It’s deserved praise. The UI is easy to navigate, is conveniently provisioned with Terraform, and has powerful libraries for most programming languages. I wrote about verifying JWTs from a &lt;a href=&quot;../authorize-spring-backend-with-jwt-in-kotlin/&quot;&gt;SpringBoot backend&lt;/a&gt; in the past. Now it’s time to talk about the frontend.&lt;/p&gt;
&lt;h2&gt;Choosing the right flow&lt;/h2&gt;
&lt;p&gt;OAuth is not a monolithic entity. There are so many &lt;a href=&quot;https://nordicapis.com/8-types-of-oauth-flows-and-powers/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;flows&lt;/a&gt; it’s no wonder people still succumb to the temptation of Basic Auth. The first step always is &lt;a href=&quot;https://auth0.com/docs/authorization/which-oauth-2-0-flow-should-i-use&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;choosing the right one&lt;/a&gt;. Given that an SPA can’t store a secret id (the source code is sent to the browser, you know), we have two possibilities.&lt;/p&gt;
&lt;h3&gt;Implicit Flow&lt;/h3&gt;
&lt;p&gt;Traditionally, SPAs tended to use the &lt;a href=&quot;https://developer.okta.com/blog/2018/05/24/what-is-the-oauth2-implicit-grant-type&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;implicit flow&lt;/a&gt;, also known as the implicit grant type. You make a request to the &lt;code class=&quot;language-text&quot;&gt;authorize&lt;/code&gt; endpoint with &lt;code class=&quot;language-text&quot;&gt;response_type=token id_token&lt;/code&gt;. It looks like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 683px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e6cd79dd35e8a7aff9c3e5910c3f071a/bca35/implicit-flow-request.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.212765957446805%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNUlEQVR42n1SWU5DMQzMkTkJZ+EIHIBvVNGPVkKgtslbsjh92d4guwvtUyHSyE4ymTjjKOscvPcYhgGj1vBGo9ca2hiMxsBpDcMwRqAl79DrA4aux/NrxNNLwMe3RQwOatx/wQ1GRCMRgncgCiAiUAjwzp1y3gsB0zQhpYSck8T3XcHbZ4FzhHIkqBg8YiTM8yxoHAHJU84Scd6THEApBfF4xO+YgZox5wS1PxwQY0Rr7XSIY5tlnoJHnabrBRewYM5ZOLU1lNrQakUrBWq1WqHrOiFgcdBZC28MKhES44az5M6nOqG22614I7fVeoeJPbMWmUgq52oe8W6hNpvNn4LEP2AY4MZRmsYN4fGv4Hq9hrX2vvwzRmvlq3R9L5F57Dd7ePV8AcWqjwg8X65fXnFpyiPBH1+XvODD5hwLAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Implicit Flow Request&quot; title=&quot;&quot; src=&quot;/static/e6cd79dd35e8a7aff9c3e5910c3f071a/bca35/implicit-flow-request.png&quot; srcset=&quot;/static/e6cd79dd35e8a7aff9c3e5910c3f071a/4dcb9/implicit-flow-request.png 188w,
/static/e6cd79dd35e8a7aff9c3e5910c3f071a/5ff7e/implicit-flow-request.png 375w,
/static/e6cd79dd35e8a7aff9c3e5910c3f071a/bca35/implicit-flow-request.png 683w&quot; sizes=&quot;(max-width: 683px) 100vw, 683px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  When using OAuth, it&apos;s key to ask things nicely
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Typically, you lack authentication for the first request, so you’ll land in a login screen artfully presented by Auth0. Afterward, the response is a redirect (302) with an &lt;code class=&quot;language-text&quot;&gt;access_token&lt;/code&gt; and an &lt;code class=&quot;language-text&quot;&gt;id_token&lt;/code&gt; appended to the URL as query parameters. The &lt;code class=&quot;language-text&quot;&gt;access_token&lt;/code&gt; is a JWT similar to this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f923392ce8dc4af86278e33143ce0c67/9fc4b/decoded-token.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 87.7659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42p2UC5OaQBCE/f//MJXUnY87CSqcoIZ99ne1uxgxWskRqGa2hqF3Hs0u6rqmqir6vud4PGbbdV22l8uFGCMhhC9jMQwDgzE473HO4UIo1jm895lwDhaECD6ABDGCcWX9H5ckFhGhw7Gg6dC3FTIWjQFfxW/C/OHuA+1aZB0azPzMxkfJcLDodYvWP9GmRqsaLSv0vkfL0bfdo1WFtg2qEg7Fv9mVeGMnJTtfMsu99AXOl75OkXwp5trzhBBu/b8S5gDdUtf1lh7X07498ecpN21Lwul0ylLRTJk8yOZ8PmeypMc73YURcwkVuJU8jktj8XCVxM33L/ksoiK+Ff4owlnYN7AV2DXYDYQOogV5iObvmh91KHwD/iBCL4bvwr4Lu07kwqyEeRUuve+EwvNM7wlb8I0IJ2FeCtIGcSi++Eso6iEbJoK+JzyA/1AmNUsx/CjrFCdXiBNpthdl35T0KaHdlpJTeYnQbEa7Em5fNsi9bgv5n2Xf/hSfdobQQ5q4LMRLGUA4pQxnnjbBB6R05kTiaKdIvjk6/ASur4ow5I15mgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Decoded Token&quot; title=&quot;&quot; src=&quot;/static/f923392ce8dc4af86278e33143ce0c67/9fc4b/decoded-token.png&quot; srcset=&quot;/static/f923392ce8dc4af86278e33143ce0c67/4dcb9/decoded-token.png 188w,
/static/f923392ce8dc4af86278e33143ce0c67/5ff7e/decoded-token.png 375w,
/static/f923392ce8dc4af86278e33143ce0c67/9fc4b/decoded-token.png 583w&quot; sizes=&quot;(max-width: 583px) 100vw, 583px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Now that you’ve learned about this flow, you can pretty much forget about it. Implicit flow is no longer considered the best option for SPAs. Instead, if you’re implementing a new application you’re advised to use the &lt;a href=&quot;https://auth0.com/docs/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Code Flow with PKCE&lt;/a&gt; because it’s more secure. Don’t you love the &lt;em&gt;argument by security&lt;/em&gt;?&lt;/p&gt;
&lt;h3&gt;Code Flow with PKCE&lt;/h3&gt;
&lt;p&gt;This is an enhanced version of the Code Flow that doesn’t require a client secret (remember, no secret in SPA code). Like before, we use the &lt;code class=&quot;language-text&quot;&gt;authorize&lt;/code&gt; endpoint, this time with a different &lt;code class=&quot;language-text&quot;&gt;response_type&lt;/code&gt;. We include a &lt;code class=&quot;language-text&quot;&gt;code_challenge&lt;/code&gt; as well.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 683px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9a477989f159788401bbfc15c7e290fc/bca35/code-flow-pkce-request.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVR42m1SW27DIBDkmr1av3uVqneInH7VUg0Yhzc2mKmWhMpOizRa7N0ddgbYTRtorbEsC5TgsIJDcQ4hJZSUMIJDCPEHnAtYrfD67vDyZvExGER3A/NKwmsF7z1iCPDOIQSPEAKss3DWtn2MEc45bNuGlFL7V3KGsAWfssAYj+I0GJ++oW8LaNVasdfaIiEagxIjas/te6sjUiKs6KsCeUVdE9jXODa567r+EtX93ryldP/ubQ9SirRoTygUH3VsGAZM03QmfMBYi2QMsnNtWpLaiZ5r+2Hser1CKfU7wRGJ/FMKSevmbynlNOUzKM/GcYS19iSpN0TvYbW+wzkYYxpyzqfaYw+7XC5NMt1in6B7RJJnpZrHUsoWCXQp/ylqhDThPM/t2VDhMdmfC/lL/nUcD34m/AF9TbuZTt1YWAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Code Flow PKCE Request&quot; title=&quot;&quot; src=&quot;/static/9a477989f159788401bbfc15c7e290fc/bca35/code-flow-pkce-request.png&quot; srcset=&quot;/static/9a477989f159788401bbfc15c7e290fc/4dcb9/code-flow-pkce-request.png 188w,
/static/9a477989f159788401bbfc15c7e290fc/5ff7e/code-flow-pkce-request.png 375w,
/static/9a477989f159788401bbfc15c7e290fc/bca35/code-flow-pkce-request.png 683w&quot; sizes=&quot;(max-width: 683px) 100vw, 683px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Find the differences
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;If you’re authorized, the response is a redirect again. This time, we are getting a &lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt; appended to the URL as a query parameter. To obtain the token, we need to make another request to the &lt;code class=&quot;language-text&quot;&gt;oauth/token&lt;/code&gt; endpoint (a &lt;em&gt;POST&lt;/em&gt; this time) with the &lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt; we got and the &lt;code class=&quot;language-text&quot;&gt;code_verifier&lt;/code&gt; we used to generate the challenge.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 631px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d6e020ae13415cc7c35c38416f260f4c/4597d/code-flow-pkce-token.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 29.25531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVR42nWQa2rDMBAGfbUerZfoVXqHnqF/S7AdW5YtabV6TZBDQ0moYNCyaIf9NMzXmW3bmOcZM47YcWSaJq7LcvafMcacrKshHJb3z4O3D8vX90Y4DEMIARHBOYd4j/cOZxaOZUJCuPdjJHZCoNb6oLVGSA0rDRWh+oOhP+zC8+5DvRZBJaAaUVWSKhojReND1KmtQatAo5VMjcKgOZP6lutKDh6/O2SzJO9JzhGcsHullD7IQ/bCqYUhpozsO/ZyYb1u/Iw7l8lith4/4jpBiZppf+I+06U5Z4ZcCiVnailoLqRU7lFeTvt/u98vqJUbElTSDh5ENwMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Code Flow PKCE Token&quot; title=&quot;&quot; src=&quot;/static/d6e020ae13415cc7c35c38416f260f4c/4597d/code-flow-pkce-token.png&quot; srcset=&quot;/static/d6e020ae13415cc7c35c38416f260f4c/4dcb9/code-flow-pkce-token.png 188w,
/static/d6e020ae13415cc7c35c38416f260f4c/5ff7e/code-flow-pkce-token.png 375w,
/static/d6e020ae13415cc7c35c38416f260f4c/4597d/code-flow-pkce-token.png 631w&quot; sizes=&quot;(max-width: 631px) 100vw, 631px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;This call returns the &lt;code class=&quot;language-text&quot;&gt;access_token&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;id_token&lt;/code&gt; as part of the body, ensuring that we don’t store tokens in our browser history.&lt;/p&gt;
&lt;h2&gt;Using the right library&lt;/h2&gt;
&lt;p&gt;Alright, we’re getting in the &lt;em&gt;flow&lt;/em&gt;. Our next step is extending our application to actually use OAuth. Implementing it by hand is error-prone and cumbersome. Spare yourself the trouble and use a library instead. Auth0’s seems to be trying to corner the market, as they have three different JavaScript libraries. I’ve worked with all three in some capacity, but as of today, I endorse &lt;a href=&quot;https://github.com/auth0/auth0-react&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;auth0-react&lt;/a&gt; as the most convenient one. Let’s see some code samples.&lt;/p&gt;
&lt;h3&gt;Auth0 provider&lt;/h3&gt;
&lt;p&gt;This library uses the &lt;a href=&quot;https://reactjs.org/docs/context.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Context API&lt;/a&gt;. We have to instantiate a component called &lt;code class=&quot;language-text&quot;&gt;Auth0Provider&lt;/code&gt; with the parameters for our connection with Auth0 that we get from the &lt;a href=&quot;https://auth0.com/docs/applications&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;application associated with the UI&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;REACT_APP_HOST&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;redirectUri&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/callback&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BrowserRouter&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Auth0Provider&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;domain&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;{{auth0_domain}}&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;clientId&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;{{client_id}}&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;openid profile create:recipes&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;audience&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;{{application_domain}}&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token attr-name&quot;&gt;redirectUri&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;redirectUri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Auth0Provider&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BrowserRouter&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Triggering the login flow&lt;/h3&gt;
&lt;p&gt;In our code, we use a &lt;a href=&quot;https://reactjs.org/docs/hooks-intro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;hook&lt;/a&gt; to interact with Auth0. We get a whole bunch of stuff from the hook. For our example, we’re interested in knowing if the user is authenticated. We need login and logout functions as well.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;Navigation&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;FC&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    loginWithRedirect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    logout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    isAuthenticated&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useAuth0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AppBar&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;data-testid&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;navigation&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Toolbar&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;

        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isAuthenticated &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Login&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;loginWithRedirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        
        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;isAuthenticated &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Logout&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;logout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;localOnly&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;

      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Toolbar&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AppBar&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you have worked with hooks already, you’ll have seen this pattern. Once we click on the login button, the OAuth dance begins. We land on a form like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 422px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bd3099230b189938fc54bb836db72d20/fa5c1/auth0-screen.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 102.1276595744681%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrElEQVR42q1S207CQBDt1+ubP+CD0SefjfELjD4aYxQCpbTbBYqYgGGhl70cM9uFFiiIhk2ms9vZOXvOzHg48fL2BYwxa2+M3jqbvwPWQZse+T9DrSC5D/U1/BVsL6CVpZXd56+PEDfnENdnMMv5/xjWAbOnByzvLiFuL45i6TWCUYLzlLq4v0L+9mz3RuuDoN6xDTk25m2PQ30s+mGIVqsNzhg45wjDCEKInfv1s3foxc/JBK12G0HQR68XwPd7mM2+DzLeYCilhFLK+qIoGh+if3SH4uTJNhiukggkjBiGoxFGowRRxOD3AutJetDvW6aDwRCcD8BijpgPrIo6Ka+JBYFHLEYYRRaQQJIkQcw5IsYwnc72NmtdQxoG7WhrrS2oVApal2dl93pnT/F6cyzDguqQZjCyQCHdZXdBqRK8TASUA5TOyppXtfS0G9Sw84JkMsN4nKDT9W1XSS55Fsfo+j7eP1qYz0WjVLkGJIlKY5ovsKDOSYksy6yl5PMchZRI0xRzISybVRmqEugKkD6WJUmioJO7Npdc1qmSTCB126jhqdZGl09hxPAHrCQhJkihTA8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Auth0 screen&quot; title=&quot;&quot; src=&quot;/static/bd3099230b189938fc54bb836db72d20/fa5c1/auth0-screen.png&quot; srcset=&quot;/static/bd3099230b189938fc54bb836db72d20/4dcb9/auth0-screen.png 188w,
/static/bd3099230b189938fc54bb836db72d20/5ff7e/auth0-screen.png 375w,
/static/bd3099230b189938fc54bb836db72d20/fa5c1/auth0-screen.png 422w&quot; sizes=&quot;(max-width: 422px) 100vw, 422px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Welcome, for the love of God, don&apos;t build this yourself
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;After the authentication, Auth0 redirects back to the URL defined in the &lt;code class=&quot;language-text&quot;&gt;redirectUri&lt;/code&gt; specified above. I put a &lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt; component under that route that waits for the process to finish. That appears to work better than waiting on the main component directly.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;Callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;FC&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isLoading &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useAuth0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isLoading &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Redirect&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Waiting for log in to be confirmed&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Subsequently, &lt;code class=&quot;language-text&quot;&gt;isAuthenticated&lt;/code&gt; is true, and we have access to the user data. You can configure the provider to store the token in &lt;code class=&quot;language-text&quot;&gt;localStorage&lt;/code&gt;, but that’s apparently a security risk so forget I mentioned this.&lt;/p&gt;
&lt;h3&gt;Making API calls&lt;/h3&gt;
&lt;p&gt;Displaying the user’s data is nice, but the crucial part is making sure that we include our token when querying the backend. This token is then &lt;a href=&quot;../authorize-spring-backend-with-jwt-in-kotlin/&quot;&gt;verified&lt;/a&gt;, and then actual useful things ensue.&lt;/p&gt;
&lt;p&gt;Again we make use of the &lt;code class=&quot;language-text&quot;&gt;useAuth0&lt;/code&gt; hook. I’m after the &lt;code class=&quot;language-text&quot;&gt;getAccessTokenSilently&lt;/code&gt; method, which returns the token if present or makes a silent request if not.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;Submitter&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FC&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Props&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; = ({ history }: Props) =&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; getAccessTokenSilently &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useAuth0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Formik
      initialValues&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;initialValues&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      validationSchema&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;validationSchema&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      onSubmit&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RecipeForm&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; accessToken &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAccessTokenSilently&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newRecipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token literal-property property&quot;&gt;Authorization&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Bearer &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;accessToken&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token function&quot;&gt;fold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Error happened: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/recipes/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Formik&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The token needs to be included as a bearer token in any API request that requires authorization. We might get fancy by passing different scopes to the &lt;code class=&quot;language-text&quot;&gt;getAccessTokenSilently&lt;/code&gt; method if we need granular permissions. That’s too much for this simple app, though.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;I’ve seen some nasty, bespoke approaches to handle authz/authn, especially when frontend code is involved. Do not roll your home-cooked solution, it’s likely to be much more complex and probably a lot more insecure. With Auth0 most of the work is already done for you. You might as well use it!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Signing your commits in git]]></title><description><![CDATA[Signing your commits with a gpg key adds a layer of integrity to your code contributions. Not only that, but it's quite easy to set up]]></description><link>https://hceris.com/signing-your-commits-in-git/</link><guid isPermaLink="false">https://hceris.com/signing-your-commits-in-git/</guid><category><![CDATA[Security]]></category><category><![CDATA[git]]></category><category><![CDATA[gpg]]></category><pubDate>Mon, 22 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/654382f4a08cd04837d237fc787f0acb/eea4a/signature.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABrWWVQcSL/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAESEwIRIf/aAAgBAQABBQJorxK9kmSbE+f/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwGH/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bp//EABgQAAMBAQAAAAAAAAAAAAAAAAABMREg/9oACAEBAAY/Aoa0Xj//xAAaEAEBAQEAAwAAAAAAAAAAAAABAEEhETGh/9oACAEBAAE/IfL7+IEyOSeuoPbRMT//2gAMAwEAAgADAAAAEMTP/8QAFhEBAQEAAAAAAAAAAAAAAAAAACEB/9oACAEDAQE/EMpX/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAECAQE/EE2l/8QAGhABAQACAwAAAAAAAAAAAAAAAREAITFRYf/aAAgBAQABPxA3AbiwZBvE9TIVNNNucS06d4lah0awQCh45//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Signature&quot; title=&quot;&quot; src=&quot;/static/654382f4a08cd04837d237fc787f0acb/acb04/signature.jpg&quot; srcset=&quot;/static/654382f4a08cd04837d237fc787f0acb/bc01b/signature.jpg 188w,
/static/654382f4a08cd04837d237fc787f0acb/bf173/signature.jpg 375w,
/static/654382f4a08cd04837d237fc787f0acb/acb04/signature.jpg 750w,
/static/654382f4a08cd04837d237fc787f0acb/ec605/signature.jpg 1125w,
/static/654382f4a08cd04837d237fc787f0acb/eea4a/signature.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  We&apos;ll need your signature, mister
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve gotten into the habit at work of signing my commits in &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; with my &lt;a href=&quot;https://gnupg.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;GPG key&lt;/a&gt;. It adds an extra layer of integrity to the source code, as it enables us to know who produced each commit (if the practice is followed widely).&lt;/p&gt;
&lt;p&gt;It requires some initial configuration, but after that, it adds very little overhead.&lt;/p&gt;
&lt;p&gt;Even if your organization doesn’t have a policy requiring it, I think it’s still worth setting up. Let’s see how to do it.&lt;/p&gt;
&lt;p&gt;Even if it’s not required by your organization’s policies, I think it’s still worth setting up. Let’s see how to do it.&lt;/p&gt;
&lt;h2&gt;What do I need?&lt;/h2&gt;
&lt;p&gt;At the risk of being obvious, you need a &lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; key. You might have one already if you sign your emails or store secrets in &lt;a href=&quot;../storing-passwords-with-gopass/&quot;&gt;gopass&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If not, you need to create one first. Don’t worry, it’s free and not too painful. I learned from a colleague to keep my key in a Yubikey. &lt;a href=&quot;https://support.yubico.com/hc/en-us/articles/360013790259-Using-Your-YubiKey-with-OpenPGP&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Check this guide&lt;/a&gt; if you want to know how to do this.&lt;/p&gt;
&lt;h2&gt;Setting up the git configuration&lt;/h2&gt;
&lt;p&gt;I’m keeping work-related repositories in a different folder, using a &lt;a href=&quot;https://github.com/sirech/shell/blob/master/git/gitconfig#L173-L174&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;conditional configuration&lt;/a&gt;. I recommend it because you split cleanly between work and personal stuff. &lt;a href=&quot;https://heiber.im/posts/git-client-configurations-for-multiple-identities/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;This post&lt;/a&gt; contains extra details.&lt;/p&gt;
&lt;p&gt;My configuration, imported from the main &lt;code class=&quot;language-text&quot;&gt;~/.gitconfig&lt;/code&gt;, resides in &lt;code class=&quot;language-text&quot;&gt;~/work/gitconfig&lt;/code&gt;. It enables commit signing for every repository in that folder.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  email &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; my@work-email.com
  signingkey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 7C58C79F397ED302595958045F0F068E59529E71
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;commit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  gpgsign &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The email needs to match with the one assigned to the key. You can see the id of your key by running &lt;code class=&quot;language-text&quot;&gt;gpg --list-keys&lt;/code&gt;. Try to commit something: you’ll get asked for the passphrase of your &lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; key.&lt;/p&gt;
&lt;h2&gt;Visualizing signatures&lt;/h2&gt;
&lt;p&gt;There is a flag for &lt;code class=&quot;language-text&quot;&gt;git log&lt;/code&gt; that displays whether a commit is correctly signed (&lt;code class=&quot;language-text&quot;&gt;%G?&lt;/code&gt;). I use the following alias:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;lg = log --pretty=format&apos;:%C(yellow)%h%Cred%d%Creset %C(green)%G?%Creset %s %C(cyan) %an, %ar%Creset&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;An excerpt of the commit history looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;43d4e36 (HEAD -&gt; master) N fix typo  Mario Fernandez, 13 hours ago
b433463 (origin/master, origin/HEAD) N add on call talk  Mario Fernandez, 4 days ago
aae0b0c U Merge pull request #870 from sirech/dependabot/npm_and_yarn/eslint-7.22.0  dependabot-preview[bot], 7 days ago&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is a single letter after the commit hash and branch that provides information about the signature. &lt;code class=&quot;language-text&quot;&gt;N&lt;/code&gt; means unsigned, and &lt;code class=&quot;language-text&quot;&gt;U&lt;/code&gt; means good signature with unknown validity. You can also show the signatures as part of the log output for extra details:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[log]
    showSignature = true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Github&lt;/h3&gt;
&lt;p&gt;You can visualize this information in Github directly. You can add your &lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; key following &lt;a href=&quot;https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;these instructions&lt;/a&gt;. It will end up looking like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/deb6b708179c50ff7fccea056f319853/1cfc2/github-config.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50.53191489361703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR42o1Sy47UMBCc//8IvoADd05w43FAghujZVfs7NiTZJLYbj9jF+pOJmLgspZatpPuclVXH0IIGIYr5nlGaw2lFCil0Q+D3F+z3h3f482Pt5iTxcF7D2sd6lZcawWRh3MER7Tu+9lJcP7tbIxBylnqmcDB+4Dr9YpWGygRUslIJeEyXKCVxjwbGGMhDzMIEZZlkYf34HspK+AqeRAWta0JMSeMZsK5U9DDBd3Yw5HDNM3IOf8nueSEFPzGMAT0fY+U0i455yKFPma4UOFCEYbko9ytL1iWKgD1nz5vkkcYa3cJ1lph/FpTvqrv+PD7M3wJqyncWAbixf3RWqPrOmF9C2YcY7wL/s77p9M3fHz+AsobIBezc2VZhJXI9R7jOGE2qyn8n/v9N2AIUSbiTnJwVuaQnWZ2vIgILy9n/Dwe8fj0hIdfj3g+naCUgtIa4zTJg7f8nCIiERoaDjxL57PaJfPODecCdpXZ8aiwUffsggC2bf64jl3+A/DzB/hifPF7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;A configured GPG key on Github&quot; title=&quot;&quot; src=&quot;/static/deb6b708179c50ff7fccea056f319853/1d69c/github-config.png&quot; srcset=&quot;/static/deb6b708179c50ff7fccea056f319853/4dcb9/github-config.png 188w,
/static/deb6b708179c50ff7fccea056f319853/5ff7e/github-config.png 375w,
/static/deb6b708179c50ff7fccea056f319853/1d69c/github-config.png 750w,
/static/deb6b708179c50ff7fccea056f319853/1cfc2/github-config.png 900w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Github displays information about verified commits directly on its UI. It does a good of making this information visual and accessible.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a4eeeba1d4ba380a87f7f5eaeba622aa/c6bbc/github-verified.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 32.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPElEQVR42mWR227bMBBE9f8fWKBJo9S2LhR1oUSLong9hRmjSdoF5m33YGa2UuvGpjXmOHHec7oPuad8iMSYiCkTrCVc3kkxEjKcIRFzxsdMiJGUEtWP1xu3pqURC03Xc7m19INEyIlODKx6x57+QzFj61/cf9fITnB9u6C6HiUm7rsthqqX946uaxnkjBzHom3b2I3hOA5CCOScPwVsUnJtGuprzU10mHHBHpYYI9XrEygGiZQjg5SodS0w731Z+grLIbAPI/OsGUfFYQx2Vk9gonqpW/q+R06KcZyYl4Xd7Oy7QWuNc+67w5yJu+HcNu7LjF0UetGlkuLw51tL2zYIIUpcfb+TcuLr/At8zOMZhz+xzqPNo2NXHlNduwkph+JsXTcWpUrUx2FK+T/YX5cp4rwru/YMeB9K5D/+KRuIkMhQRgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Checking a verified commit on Github&quot; title=&quot;&quot; src=&quot;/static/a4eeeba1d4ba380a87f7f5eaeba622aa/1d69c/github-verified.png&quot; srcset=&quot;/static/a4eeeba1d4ba380a87f7f5eaeba622aa/4dcb9/github-verified.png 188w,
/static/a4eeeba1d4ba380a87f7f5eaeba622aa/5ff7e/github-verified.png 375w,
/static/a4eeeba1d4ba380a87f7f5eaeba622aa/1d69c/github-verified.png 750w,
/static/a4eeeba1d4ba380a87f7f5eaeba622aa/c6bbc/github-verified.png 910w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;That’s it?&lt;/h2&gt;
&lt;p&gt;Yes! If you don’t already have a &lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; key, there is a bit of work involved. Honestly, you should probably have one. Adding some extra configuration and separating your config a bit is a good investment. Let’s make our delivery a bit more secure, a small step at a time.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Accelerate]]></title><description><![CDATA[Accelerate is the book you need to read if you want to understand why continuous delivery is a tool for companies to deliver better results]]></description><link>https://hceris.com/book-review-accelerate/</link><guid isPermaLink="false">https://hceris.com/book-review-accelerate/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Team Organization]]></category><category><![CDATA[Continuous Delivery]]></category><pubDate>Sun, 07 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 404px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ff96e8788dc4deefed09b9eb53abfc43/e75d0/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 151.06382978723406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIFBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAAB5q7s6MpS28qGiBj/AP/EAB0QAAICAgMBAAAAAAAAAAAAAAECABIQEQMhIjH/2gAIAQEAAQUCAGqrG+nhWrKRjqrvsy255x//xAAYEQACAwAAAAAAAAAAAAAAAAABEAIRUf/aAAgBAwEBPwG0I6v/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwEp/8QAHxAAAgECBwAAAAAAAAAAAAAAAAEQITEREiIyQVFx/9oACAEBAAY/Arm4oUVe0cw2sq9LxqxZaP/EAB8QAQACAQMFAAAAAAAAAAAAAAEAESEQYXExQVGR8P/aAAgBAQABPyF4XPifIgDLZG+yYvVU3NFdFd2ExYbaPVSS/JOJ/9oADAMBAAIAAwAAABAcAkz/xAAXEQEBAQEAAAAAAAAAAAAAAAABIRAx/9oACAEDAQE/EAvZgFpz/8QAFhEBAQEAAAAAAAAAAAAAAAAAEAFB/9oACAECAQE/EC4P/8QAHxAAAgMAAQUBAAAAAAAAAAAAAREAITFBEGFxgZGh/9oACAEBAAE/EEwy0AqlW9q+RHIoFkKLR0wK/Ih+S3KOiQGmih7AlUD2SB+wl7cYTVAk4IHX9NhTNlw5/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Accelerate&quot; title=&quot;&quot; src=&quot;/static/ff96e8788dc4deefed09b9eb53abfc43/e75d0/cover.jpg&quot; srcset=&quot;/static/ff96e8788dc4deefed09b9eb53abfc43/bc01b/cover.jpg 188w,
/static/ff96e8788dc4deefed09b9eb53abfc43/bf173/cover.jpg 375w,
/static/ff96e8788dc4deefed09b9eb53abfc43/e75d0/cover.jpg 404w&quot; sizes=&quot;(max-width: 404px) 100vw, 404px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;This seminal book aims to answer one simple yet fundamental question: What makes an organization that develops software successful? This is a topic that has been explored in depth by many, many authors. The key difference is the comprehensive body of research that the authors have compiled. Like, they’re using actual science for this, man.&lt;/p&gt;
&lt;p&gt;As could be expected, it is a mixture of product development, practices, organizational alignment, and technical practices. The book is not exploring the topics comprehensively, but it’s definitely a good start.&lt;/p&gt;
&lt;p&gt;It comes down to &lt;a href=&quot;https://continuousdelivery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Continuous delivery&lt;/a&gt;, in the end. Who would’ve thought? Rapid iteration, automation, loose coupling, enablement. You might be familiar with some, or all of these concepts already. However, the key message that I took out of this book is that Continuous delivery is a &lt;em&gt;business artifact&lt;/em&gt;. It’s not about figuring how what makes developers happy. It’s about delivering more value, using practices that are repeatable.&lt;/p&gt;
&lt;h3&gt;The four key metrics&lt;/h3&gt;
&lt;p&gt;The research they conducted shows a direct link between organizational performance and software delivery performance. Assessing an organization boils down to &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/four-key-metrics&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;four key metrics&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lead time&lt;/li&gt;
&lt;li&gt;Deployment frequency&lt;/li&gt;
&lt;li&gt;Mean time to restore&lt;/li&gt;
&lt;li&gt;Change fail percentage&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Any organization doing well in all four is able to deliver quickly in a safe and sustainable way. Intuitively, it was always clear to me that this was the case, but this book brings strong evidence to confirm it. Measuring these metrics in some way is something that any team can do.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;This book is an absolute must-read if you have any interest in delivering value through software for an organization. It’s a compact and digestible book. I not only recommend reading it but advocate for it to be read across any organization that you’re part of. It’s a clear ⭐⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Be a good Kubernetes citizen and use Pod Disruption Budgets]]></title><description><![CDATA[Pod Disruption Budgets offer a way to protect the uptime of an application in Kubernetes during node maintenance, in a decoupled fashion]]></description><link>https://hceris.com/be-a-good-k8s-citizen-with-pod-disruption-budgets/</link><guid isPermaLink="false">https://hceris.com/be-a-good-k8s-citizen-with-pod-disruption-budgets/</guid><category><![CDATA[Kubernetes]]></category><category><![CDATA[Operations]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Terraform]]></category><pubDate>Thu, 18 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5419b9f2e801717e0bde2acaf0558e4a/0f98f/disruption.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 60.1063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABFVLjTJUH/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAECERITITH/2gAIAQEAAQUCcUjRiHFSLFVc/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREv/aAAgBAwEBPwGs0z//xAAXEQADAQAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/AYjKP//EABgQAAMBAQAAAAAAAAAAAAAAAAAhMQEQ/9oACAEBAAY/AqPSj7//xAAcEAEBAQACAwEAAAAAAAAAAAABEQAhMUFRYXH/2gAIAQEAAT8hWKuesUch9nGGlLPzIHppqUJ14c5n/9oADAMBAAIAAwAAABAr3//EABURAQEAAAAAAAAAAAAAAAAAABBh/9oACAEDAQE/ELB//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxAj/8QAGxABAQADAAMAAAAAAAAAAAAAAREAMUFRYaH/2gAIAQEAAT8QERXPbBDa3D6wMJCjiQHsjN4KAAUuzyYpAE4TXM//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Disruption&quot; title=&quot;&quot; src=&quot;/static/5419b9f2e801717e0bde2acaf0558e4a/acb04/disruption.jpg&quot; srcset=&quot;/static/5419b9f2e801717e0bde2acaf0558e4a/bc01b/disruption.jpg 188w,
/static/5419b9f2e801717e0bde2acaf0558e4a/bf173/disruption.jpg 375w,
/static/5419b9f2e801717e0bde2acaf0558e4a/acb04/disruption.jpg 750w,
/static/5419b9f2e801717e0bde2acaf0558e4a/ec605/disruption.jpg 1125w,
/static/5419b9f2e801717e0bde2acaf0558e4a/c58a3/disruption.jpg 1500w,
/static/5419b9f2e801717e0bde2acaf0558e4a/0f98f/disruption.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Be careful of the debris
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The appeal behind using &lt;a href=&quot;https://kubernetes.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes&lt;/a&gt; is that you abstract the details of &lt;em&gt;where&lt;/em&gt; your applications run and leave it in k8s’s hands. It’ll schedule containers following some given constraints, and restart them if they crash.&lt;/p&gt;
&lt;p&gt;However, a Kubernetes cluster is not a perfect abstraction. That is especially visible as an operator. Even if you use a managed solution like &lt;a href=&quot;https://aws.amazon.com/eks/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS EKS&lt;/a&gt;, you still have to perform some maintenance yourself.&lt;/p&gt;
&lt;p&gt;As an operator, I want this maintenance to happen regularly, to avoid stagnation and prevent failure. As a developer, I avoid unwanted interruptions for my applications. A Pod Disruption Budget (PDB) is a resource in Kubernetes that harmonizes both needs. I want to talk about how to use it in this article.&lt;/p&gt;
&lt;h2&gt;Pod Disruption Budgets to the rescue&lt;/h2&gt;
&lt;p&gt;A classical maintenance scenario in the world of Kubernetes is the replacement of a worker node. There are many reasons: A version upgrade, a new AMI being rolled out, or an adjustment in the instance size. When the old node is replaced, the Pods running there will get evicted and rescheduled. In k8s parlance, this is called a &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#voluntary-and-involuntary-disruptions&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;voluntary disruption&lt;/a&gt;. If your application gets an unplanned, unwanted downtime you’ll think of it as pretty damn involuntary. Swearing might happen.&lt;/p&gt;
&lt;p&gt;Luckily, somebody has thought of this. With a PDB you define how many Pods have to remain available at all times in a Deployment (or similar). If you replace worker nodes one by one, the scheduler ensures that the application still runs some Pods in the remaining nodes throughout the process, avoiding the dreaded downtime.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/6f9cf940cb70a7e21c63a51b8614b70f/d4c13/node-replacement.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 40.95744680851064%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtklEQVR42mWS22oTURSG5wW8EqSXofhEvpEPICJ44RsoeKVIAg2pluZgaqa1LZrmeJGaJiETm5nJ7Nmz1+GXmQniYcFis/nZ3/p/1vZqJ5uX1yNzCVBbrOuoI1/TrIpN58HxRfTKH5prgNvOUYeILqy1b8399KDuR7Xhj9QH+LNz1CaiqzRNn3vdy7A5XTrkJQA0b5YQt/7Dr+OkO55nhaZaHGDmWRjMDs9HJrrb0F+ac+6jB6U6yEES63Qbk0YJQHz3/ch/BPBJ+UCdqtIe2B+PJxVAF3uNcn0PrHpiXUOJgXDHiI1okkKJ53jseYA08umqYC0CKIhoMJlMKiyyKp2pqCrvgTVPbdYoJwuTSGleOXp/unm62GRTaM4RESEpg2EwGg0qIrraO/wPWM8vROxy6GK25Xxo9SzGzcwW0vKeOAjZRfESk1m3H6xsRUT+jJz9jqyZaxUOhZExcPyuj/XaFOsRKU19ujLoDTPMl1+wCqa3P9fuUFRi/FPFUjQ2L+DonNOsSSZtmSjp0s4cbYPwyS4xr621vXiXNPMG0GPGm/7NtwPn3AciOiOiFhGd5l/KGPPsF74WTxyaPG6uAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Node Replacement&quot; title=&quot;&quot; src=&quot;/static/6f9cf940cb70a7e21c63a51b8614b70f/1d69c/node-replacement.png&quot; srcset=&quot;/static/6f9cf940cb70a7e21c63a51b8614b70f/4dcb9/node-replacement.png 188w,
/static/6f9cf940cb70a7e21c63a51b8614b70f/5ff7e/node-replacement.png 375w,
/static/6f9cf940cb70a7e21c63a51b8614b70f/1d69c/node-replacement.png 750w,
/static/6f9cf940cb70a7e21c63a51b8614b70f/d4c13/node-replacement.png 825w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The cool part is that it’s enough to define it as an extra resource and apply it as part of your application release. It’s decoupled from any operational action, which makes it very convenient to use. Here is the &lt;a href=&quot;https://kubernetes.io/docs/tasks/run-application/configure-pdb/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;official documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Do you actually need to use PDBs?&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e69798add9760d2c7729e951aad0e517/55feb/sad-dog.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 71.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAEkwMr20//EABsQAAIDAAMAAAAAAAAAAAAAAAIDAAEEERIi/9oACAEBAAEFAjaQtV3nuabFZ5zs3Nvg/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAHxAAAQMDBQAAAAAAAAAAAAAAAAEhMQIDESJRgZKh/9oACAEBAAY/Alopbcxc4Gz2IhDU6ojE+H//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhQTFRgf/aAAgBAQABPyHzxcdxUlqKvG4w7o/Ey1Hdbe4KHQt3MVD4OHP/2gAMAwEAAgADAAAAEG/P/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEhEf/aAAgBAwEBPxCKmo//xAAXEQEAAwAAAAAAAAAAAAAAAAAAEVFh/9oACAECAQE/EMSt/8QAHxABAAIBAwUAAAAAAAAAAAAAAQARITFBUWFxgZHh/9oACAEBAAE/EAFbUTdVZH1KxRLmzr5+QsDu17NzLANoEMrND4i0NFgqvJ23lNA2JiKC08T/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sad Dog&quot; title=&quot;&quot; src=&quot;/static/e69798add9760d2c7729e951aad0e517/55feb/sad-dog.jpg&quot; srcset=&quot;/static/e69798add9760d2c7729e951aad0e517/bc01b/sad-dog.jpg 188w,
/static/e69798add9760d2c7729e951aad0e517/bf173/sad-dog.jpg 375w,
/static/e69798add9760d2c7729e951aad0e517/55feb/sad-dog.jpg 475w&quot; sizes=&quot;(max-width: 475px) 100vw, 475px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  He wouldn&apos;t do it
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This is a fair question. PDBs should be reserved for applications that &lt;strong&gt;need&lt;/strong&gt; to remain online.&lt;/p&gt;
&lt;p&gt;If your application can allow some minor downtime, it might be easier to let it happen instead of putting an unfair burden on the operators of your cluster.&lt;/p&gt;
&lt;p&gt;As we’ll see in a bit, if you misconfigure a PDB nodes can’t be drained, making these nameless operators mad at you. Nobody wants to be the blocker. Let’s not do that.&lt;/p&gt;
&lt;h2&gt;Creating a PDB&lt;/h2&gt;
&lt;p&gt;Alright, so let’s get down to basics and create one such PDB. Usually, you’ll have one Deployment that you want to protect from downtimes.&lt;/p&gt;
&lt;h3&gt;A simple deployment&lt;/h3&gt;
&lt;p&gt;Let’s show some &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; code.&lt;/p&gt;
&lt;!-- deployment --&gt; 
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;locals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;app&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello-world&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nginx:1.14.2&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;kubernetes_namespace&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;-namespace&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;kubernetes_deployment&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;-deployment&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; kubernetes_namespace.this.metadata.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;name
    &lt;span class=&quot;token property&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.app
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;spec&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;replicas&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;selector&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;match_labels&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.app
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.app
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;spec&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.app
          &lt;span class=&quot;token property&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.image

          &lt;span class=&quot;token keyword&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;container_port&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.port
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is a simplified deployment of an NGINX image. We are running two replicas to ensure availability. Now, let’s create a PDB for this deployment.&lt;/p&gt;
&lt;h3&gt;The PDB&lt;/h3&gt;
&lt;p&gt;The PDB is another resource in Kubernetes. As of the date of this post, its &lt;code class=&quot;language-text&quot;&gt;apiVersion&lt;/code&gt; is still &lt;code class=&quot;language-text&quot;&gt;policy/v1beta1&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You need a target. It uses the same &lt;code class=&quot;language-text&quot;&gt;selector&lt;/code&gt; as the deployment, which we reuse. The Pods created by our previous Deployment are subject to this PDB.&lt;/p&gt;
&lt;p&gt;The crucial part of this resource is specifying how many Pods you want to keep up at all times. You have to provide one of &lt;code class=&quot;language-text&quot;&gt;maxUnavailable&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;minAvailable&lt;/code&gt;, but not both. They do what you’d expect. In my example, I want to ensure that there is always at least one instance running.&lt;/p&gt;
&lt;!-- pdb --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;kubernetes_pod_disruption_budget&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.app
    &lt;span class=&quot;token property&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; kubernetes_namespace.this.metadata.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;name
    &lt;span class=&quot;token property&quot;&gt;labels&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; kubernetes_deployment.this.metadata.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;labels
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;spec&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;min_available&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1&quot;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;selector&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;match_labels&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; kubernetes_deployment.this.spec.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;selector.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;match_labels
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And that’s it. Once I’ve applied this resource, Kubernetes respects the constraint when draining a node. Now we can replace these nodes knowing that my application won’t experience downtime in the process. I mean, as long as we don’t destroy all nodes at once, you know.&lt;/p&gt;
&lt;h2&gt;Don’t block maintenance!&lt;/h2&gt;
&lt;p&gt;When you are using PDBs, you have to be mindful of not creating impossible scenarios. For instance, if you have a Deployment with only one replica, setting &lt;code class=&quot;language-text&quot;&gt;minAvailable = 1&lt;/code&gt; will ensure that the Pod is never voluntarily evicted.&lt;/p&gt;
&lt;p&gt;This is bad! Node maintenance is necessary. Your Pods should be flexible coming in and out of the system. Besides, a PDB doesn’t prevent &lt;em&gt;involuntary&lt;/em&gt; evictions. If the EC2 hosting a node goes down, you’re screwed. Don’t do this.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;By adding a Pod Disruption Budget resource we make sure that our application remains online during maintenance windows. It saves a lot of coordination effort between people operating the system, and people running applications that should remain online.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Team topologies]]></title><description><![CDATA[Team topologies is a book that proposes four ways of organizing teams that aim to empower them to build better software]]></description><link>https://hceris.com/book-review-team-topologies/</link><guid isPermaLink="false">https://hceris.com/book-review-team-topologies/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Team Organization]]></category><pubDate>Mon, 08 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 342px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5a4e6afeb4d6590001443a4557fae5af/f928b/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 149.468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAH0Dc2yizo87zKuwz//xAAbEAEBAAIDAQAAAAAAAAAAAAACAQADERIhIv/aAAgBAQABBQLYvoPiC+bKIp0RhkmwKIHidspudHcM8//EABcRAAMBAAAAAAAAAAAAAAAAAAEQESH/2gAIAQMBAT8BpR1f/8QAGhEBAAEFAAAAAAAAAAAAAAAAABIBAhExQf/aAAgBAgEBPwGN21E+Mv/EABwQAAICAwEBAAAAAAAAAAAAAAABESECEDEyQf/aAAgBAQAGPwKsoLZ2bOSysbKobSlMnL7qmetf/8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFBYXH/2gAIAQEAAT8hYo1NxG2xlP0VEQvtCxwOM3gJ4tBGcE0CGOKjW6rmSIxO/k//2gAMAwEAAgADAAAAEAgTAf/EABgRAQEBAQEAAAAAAAAAAAAAAAEAESEx/9oACAEDAQE/EEDGVexR7Zl//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxDWBHNLSwKlT//EABwQAQEBAQEBAAMAAAAAAAAAAAERADEhQVGR0f/aAAgBAQABPxBbwIU9cM1Xoof3M5WkB/W6wbM8y+zonNOGiy5gCLVUfw6P8wdxTw+V9ySH8fMgSXPb3CAS8W7/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;team topologies&quot; title=&quot;&quot; src=&quot;/static/5a4e6afeb4d6590001443a4557fae5af/f928b/cover.jpg&quot; srcset=&quot;/static/5a4e6afeb4d6590001443a4557fae5af/bc01b/cover.jpg 188w,
/static/5a4e6afeb4d6590001443a4557fae5af/f928b/cover.jpg 342w&quot; sizes=&quot;(max-width: 342px) 100vw, 342px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://teamtopologies.com/book&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Team topologies&lt;/a&gt; is a book about software delivery that doesn’t mention technology. Rather, it’s about how to organize teams.&lt;/p&gt;
&lt;p&gt;It’s almost impossible to work in the software industry and not hear regularly about &lt;a href=&quot;https://en.wikipedia.org/wiki/Conway%27s_law&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Conway’s law (It’s not actually a law)&lt;/a&gt;. It turns out that the way an organization is set up will influence the software architecture that it produces. Everybody is mindlessly using &lt;a href=&quot;https://microservices.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;microservices&lt;/a&gt; regardless of fit. But if I’m allowed to quote myself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;All the fancy technology in the world won’t fix an organizational problem.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That’s pretty much the point of this book. Fast flow is easier to achieve if the teams are set up in a way that favors autonomy, and easy communication. Architecture will follow organization (See &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/inverse-conway-maneuver&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the inverse Conway maneuver&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;The core premise&lt;/h2&gt;
&lt;p&gt;This book essentially boils down to four team templates to use throughout an entire organization:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Stream-aligned team&lt;/li&gt;
&lt;li&gt;Enabling team&lt;/li&gt;
&lt;li&gt;Platform team&lt;/li&gt;
&lt;li&gt;Complicated subsystem team&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Stream-aligned&lt;/em&gt; teams are what others call product teams. Teams aligned along the lines of a product, a stream, or a feature. They should be able to work independently for the most part without handing their artifacts over to another team. It requires a proper cross-functional setup.&lt;/p&gt;
&lt;p&gt;Certain services are too complex to handle for a team of generalists. That’s where &lt;em&gt;complicated subsystem&lt;/em&gt; teams come in. Those can take ownership over these systems while they are (hopefully) refactored or replaced.&lt;/p&gt;
&lt;p&gt;Stream teams rely on infrastructure that is handled by &lt;em&gt;Platform&lt;/em&gt; teams. A platform team treats other teams as customers and offers them a product they can consume to make their life easier. I want to get into this in more depth, as I’ve spent the last year working in such a team and have seen many challenges arise.&lt;/p&gt;
&lt;p&gt;Lastly, &lt;em&gt;enabling&lt;/em&gt; teams help upskilling other teams that don’t have the time to dig into certain areas themselves. It can be focused on a concrete technology, or agile practices, or any skill that is required by those teams.&lt;/p&gt;
&lt;h2&gt;Models of communication&lt;/h2&gt;
&lt;p&gt;The last part of the book is dedicated to the communication patterns between the different types of teams. There are three: collaboration, X-as-a-service, and facilitation. I really like the idea of creating a vocabulary to talk about the different ways that teams use to interact with each other.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;In my view, the value of this book becomes clearer if you have seen how difficult it can get when the boundaries between teams are messed up. There are many examples:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An operations team working in a ticket based model, blocking everybody else. Just renaming them to DevOps doesn’t fix anything, by the way.&lt;/li&gt;
&lt;li&gt;A strong separation between backend, frontend, and QA teams means that any simple feature goes through multiple teams to reach a customer.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As as I said in the beginning, no amount of microservices is going to fix that. And I like this book for providing a clear and explicit set of recommendations, and a language to talk about it. It gets ⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[So, what does the NGINX ingress controller actually do?]]></title><description><![CDATA[If you run a lot of applications in a Kubernetes cluster, you probably use an Ingress controller. Let's dive into how it actually works]]></description><link>https://hceris.com/what-does-the-nginx-ingress-controller-actually-do/</link><guid isPermaLink="false">https://hceris.com/what-does-the-nginx-ingress-controller-actually-do/</guid><category><![CDATA[Kubernetes]]></category><category><![CDATA[Ingress]]></category><category><![CDATA[NGINX]]></category><pubDate>Sat, 30 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e1f4332eef160aade85d75fa5de6a3c5/eea4a/traffic-control.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 57.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABQAB/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/2gAMAwEAAhADEAAAAVsMhUiqP//EABoQAAIDAQEAAAAAAAAAAAAAAAECAxESEyH/2gAIAQEAAQUC7pvsKik2mRbKKXwf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGxAAAgMAAwAAAAAAAAAAAAAAAAECETEQYYH/2gAIAQEABj8CUb1aS6dFsR7x/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFRcf/aAAgBAQABPyHhHQtNvl30zlRsEs2ii49Z6gBCf//aAAwDAQACAAMAAAAQ5z//xAAYEQACAwAAAAAAAAAAAAAAAAAAIQERMf/aAAgBAwEBPxBWTqP/xAAXEQEBAQEAAAAAAAAAAAAAAAARAQAh/9oACAECAQE/EOhpCG//xAAcEAEAAgMAAwAAAAAAAAAAAAABABEhMUFRkfD/2gAIAQEAAT8QEogjKDSY9Nxw+5t5o0n3IN0litajKVd5R4l59tupCKwT/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Traffic Control&quot; title=&quot;&quot; src=&quot;/static/e1f4332eef160aade85d75fa5de6a3c5/acb04/traffic-control.jpg&quot; srcset=&quot;/static/e1f4332eef160aade85d75fa5de6a3c5/bc01b/traffic-control.jpg 188w,
/static/e1f4332eef160aade85d75fa5de6a3c5/bf173/traffic-control.jpg 375w,
/static/e1f4332eef160aade85d75fa5de6a3c5/acb04/traffic-control.jpg 750w,
/static/e1f4332eef160aade85d75fa5de6a3c5/ec605/traffic-control.jpg 1125w,
/static/e1f4332eef160aade85d75fa5de6a3c5/eea4a/traffic-control.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  The ingress police is watching
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It seems hard to believe, but I had never written about &lt;a href=&quot;https://kubernetes.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes&lt;/a&gt; before. It feels impossible to hold a conversation about technology for more than five minutes without coming to the topic of &lt;em&gt;k8s&lt;/em&gt;. Let’s fix that. I have to publish a couple of articles centered around Kubernetes to catch up.&lt;/p&gt;
&lt;p&gt;If you operate a Kubernetes cluster with any significant usage, chances are you’re using &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;an Ingress Controller&lt;/a&gt;. It just seems the thing to do. I’ve had a thing for &lt;a href=&quot;/setting-up-traefik/&quot;&gt;Traefik&lt;/a&gt; for a while. However, the path of least resistance is to use the &lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;NGINX Ingress Controller&lt;/a&gt;. That’s the one I’m familiar with and the one I will be deconstructing in this post.&lt;/p&gt;
&lt;h2&gt;An introduction&lt;/h2&gt;
&lt;p&gt;What is an Ingress Controller? Essentially, it makes connectivity for applications easier. You can have one entrypoint into the cluster and let different applications define the URLs they serve. Moreover, you don’t need to change the controller when you add new applications, keeping the whole thing nicely decoupled.&lt;/p&gt;
&lt;p&gt;It’s pretty easy. For the applications, I mean. The complexity doesn’t disappear, it just moves somewhere else.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/dafa0f8b4370f7ceb57399a19fe1718e/906b5/basics.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyElEQVR42pWPW0gUURjH/zNKF4SKoIciQiSxRVdLky6Ki7RdlM2ynZ2Z3VnX3ZnZ1Zx1Wy3dsXUTS8tICA2CXroRkUH0EkRBBd3Ipwh6Kqmdy5pB0A26iZ0YUx+ih/rgx/n4vnN+/A/wR7GSPo1HtM4xq/ezkn6GlXSJld9Qs3uLfypWMuARNZqVNOvRSY+oEyakEY+oEVbSz1pzj5im/kOoT1/2Row8JqR9C0YNoh5+8z2gGFOWmA/rhTMJ6b8KMo1tc4w1JcCIJs2IJviwYXOHtEk5bk4dOv52MtJu/nAHLaFRxojWLwzaU5CAvzRJzWD1gNnYBiMQp1837KMygTgtpJ6DEGCL+zM4OX2Dk3Uyh5R+0HP0CdXTfwvtJyfgKzlIz4q8a9VpOTKh/dDZvXhRWY+MrxWWrTk5Sj+43bJAij1dyoTSg5ykPWJC6WEp9mz56D1xfrLvThYhBFyhikhVX05oU09ePly/E05IHbQhtA4YvtZRU4jtntoexKWhoUWH+kayhZabcLAjuHiZW+j0XQHfdAcHe69mD50YXrwCXnBFarG3WB3j7SrxFqtX/KXJeTD8MW5c6SYTiWPElDvePWzrXkkA3AVgZzfC5gp2Fe1sfGlzBbsLuGV49/4DpJpeKyHduCF1TXEeI13cqa/hqsPEV9LlgRnaX5tpSZLxaIpkIolXmjuSQ0auY4mTxeodvrWVgkLcsRSp8Ckkv0Yoza8VUOM8kB3dPgC5svd8c3U/iW4b+BlxHCGB8pQLptwJw6tIhi96wfBGy3R/DMe9LVmFrgBsrkCuoyH2aavYThwNsS9FdcG8dXtk1DjjWWxhJ5g1Hat4u3qft6sfeXti8IRyDsjUh6F7mqExTTB4BZrQSj0OtmM9E6bK3DJynayjoNZ/OtfJVZezEVQICtW5eRBcUSfFrOlAAerQXN2fsysvDt6u4hcZB0aqzuFqGAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Basic parts&quot; title=&quot;&quot; src=&quot;/static/dafa0f8b4370f7ceb57399a19fe1718e/1d69c/basics.png&quot; srcset=&quot;/static/dafa0f8b4370f7ceb57399a19fe1718e/4dcb9/basics.png 188w,
/static/dafa0f8b4370f7ceb57399a19fe1718e/5ff7e/basics.png 375w,
/static/dafa0f8b4370f7ceb57399a19fe1718e/1d69c/basics.png 750w,
/static/dafa0f8b4370f7ceb57399a19fe1718e/906b5/basics.png 950w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  You&apos;ll notice that the sum of the three smaller circles is bigger than the original one
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are three somewhat distinct components involved:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.nginx.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;NGINX&lt;/a&gt;: Proxies requests to the right application.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/cluster-administration/networking/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Ingress&lt;/a&gt;: Allows defining endpoints for applications.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/architecture/controller/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Controller&lt;/a&gt;: Ensures that the ingresses we defined end up configured in NGINX.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Even though they only make sense together, I find it easier to understand if we consider each part separately.&lt;/p&gt;
&lt;h3&gt;A quick word on tooling&lt;/h3&gt;
&lt;p&gt;There is a &lt;a href=&quot;https://github.com/kubernetes-sigs/krew&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;krew&lt;/a&gt; plugin for &lt;code class=&quot;language-text&quot;&gt;kubectl&lt;/code&gt;, called &lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/kubectl-plugin/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ingress-nginx&lt;/a&gt;. It simplifies interactions significantly. Go get it.&lt;/p&gt;
&lt;h2&gt;NGINX&lt;/h2&gt;
&lt;p&gt;NGINX is the Swiss Army Knife of delivering content. It serves static assets. It works as a reverse proxy. It can be modded with &lt;a href=&quot;https://blog.cloudflare.com/pushing-nginx-to-its-limit-with-lua/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Lua&lt;/a&gt;. It can probably run on toasters.&lt;/p&gt;
&lt;p&gt;Naturally, there are a million different configuration options. Let’s focus on what we need. We’re using NGINX as a reverse proxy. This means we want to route an HTTP request to an application, based on the domain and the path. We need an entrypoint (a &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;) that can specify URLs, a way of defining downstream applications (an &lt;code class=&quot;language-text&quot;&gt;upstream&lt;/code&gt;), and a connection between the two of them (the &lt;code class=&quot;language-text&quot;&gt;proxy_pass&lt;/code&gt;). A simplified configuration looks like this:&lt;/p&gt;
&lt;!-- nginx-config --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# The target service&lt;/span&gt;
&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;upstream&lt;/span&gt; upstream_target&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; upstream:4003 max_fails=1 fail_timeout=15s&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Domain under which the service is reachable&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server_name&lt;/span&gt; upstream.domain.io&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;# https is used&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt; ssl http2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; [::]:443 ssl http2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# we need a certificate to terminate https&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl_certificate&lt;/span&gt;           /cert/live/upstream.domain.io/fullchain.pem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl_certificate_key&lt;/span&gt;       /cert/live/upstream.domain.io/privkey.pem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl_trusted_certificate&lt;/span&gt;   /cert/live/upstream.domain.io/chain.pem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; /etc/nginx/includes/ssl-settings.conf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# Proxy to the target service&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; ^~ /rest/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; http://upstream_target&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; X-Forwarded-For &lt;span class=&quot;token variable&quot;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; Host &lt;span class=&quot;token variable&quot;&gt;$http_host&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_redirect&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;off&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is not quite the configuration that the Ingress Controller uses. A real one for one of the clusters in my project is 12K lines long. And a lot of calls to Lua functions. For your sanity, start with the simpler example.&lt;/p&gt;
&lt;h3&gt;Checking the actual configuration&lt;/h3&gt;
&lt;p&gt;If you still want to check that monstrous config file, use the plugin I mentioned above:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl ingress-nginx conf --namespace $NAMESPACE --pod $POD &gt; /tmp/nginx.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Inspect the dynamically handled backends:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl ingress-nginx backends --namespace $NAMESPACE --pod $POD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Ingress&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/ingress/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Ingress&lt;/a&gt; resource is a way of declaratively defining how to reach an application. On its own, it does nothing. The controller ensures it’s reachable by creating an appropriate NGINX configuration. That configuration points to the &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/service/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Service&lt;/a&gt; associated with the ingress. I prefer using &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; for that, though it’s not a requirement.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;variable&lt;span class=&quot;token type variable&quot;&gt; &quot;host&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;upstream.domain.io&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;kubernetes_ingress&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;metadata&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.name
    &lt;span class=&quot;token property&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.namespace

    &lt;span class=&quot;token property&quot;&gt;annotations&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;kubernetes.io/ingress.class&quot;&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nginx&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;cert-manager.io/cluster-issuer&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;letsencrypt&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;spec&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;tls&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;hosts&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; var.host &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;secret_name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;-tls&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;rule&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.host

      &lt;span class=&quot;token keyword&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;

          &lt;span class=&quot;token keyword&quot;&gt;backend&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;service_name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.service_name
            &lt;span class=&quot;token property&quot;&gt;service_port&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.service_port
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Certificates are handled by another controller, the &lt;a href=&quot;https://cert-manager.io/docs/tutorials/acme/ingress/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cert-manager&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;How is the application getting the requests?&lt;/h3&gt;
&lt;p&gt;An Ingress is a nice abstraction, but it looks a bit like magic, doesn’t it? What’s the journey of a request from the beginning until it reaches the application? Let’s go down the rabbit hole.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3bcd958f569b5d750a3a63a9e1c2dd81/906b5/request-flow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 87.7659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD5klEQVR42n2Ua2gcVRTHzyaFGiUWRK32i1EExQ8VihQEv0kRrBHakPoOMWk2aUnWZBOCsdZSNFLFYoONxuZt05S0liYhheZlg6iotMbmYXYn3Ww22ffs7M7uPO887pGZbOIHkxz4cc4wzJ/7n3v/F2CTqmhh4eZt2TH+lwyfD6RKvr7Of/bhdwu79Iw/38MsPbi0tCm7GIbJ20wPSs+yMPm3nDMxLUNTT3Lk/HAaQ6zCmQbhFFVNqipJEvIfqqqyhBBdEISrsFWVNk87YO8Q5B8YfeheSPUjIlKKSLN9syKE/AT1r9yBT14bhyuH34W5t3eC9/jjuYuugh0zJ/Y7LGEDERDNmew3OiKaa1CT0g0066WqqqPQ+PofcG4nB61uFyAAMMd2A+MqgGApwJcftDuGvth/34UbnKdjVEBN043LUxnsnRA2VkXXMLKCY1D/Xq/jVzgIXQ1lgE+Bg6l8pMh7fI8rcPT+x6ADc0daSx5tbI8yDR0pTGdks2Uwhaf6eDQpxUyKRz7BYYrlDCHFoyRKY+B+ee75pkNTTzf53Ts6647s8dQ9k/KffBHvuvcetlb8JkAuz6dn+YxoW44n0maC423b8WCEdo9EseXHuLGyHEFZFEahprjrybq32nafffZ9uOHcl+epfqKHqX9ueqGm4AVPsb0/OaahedfMWbZkJKpiz1w0hl8NxOiJrrgeXImhIolTUO46mF9WXZjnPvMOuCvL4KXiygcOFB56ePBkIQC4ABEhlVF+R6RB0zQZWVF9KtF8pmkusuEY8XnuoXd+0UiEo5jm0xehzPUqlNUUwrGPiwAQofmjBkf3tVuOO/PxnIVVHZoH+O/PD3H+W38GqpNsuCq06quNR5ZrgsFgZSgQirKhMCbDYTO8EqbLfv8RcDqdNtXOcjjtLAIoR8DTAP1jsZzWYQ5q29hma1cF2bRtBiIShljVnhORGDJMlN6eiepsOIaCIE7+P3YVFVB1tATecHXaz5Zl09TnLAHT1I2qb1hqoaiERlYCtOVqBMtbksY/nijqqji2ZVIGr3SvjzlpkcynJessa8bPsxKdmpGszFAuEqWTv61i13DQCK9GURK3ETz37Q+AxP6tUNsWn6+9kMS0qBmICqIh2ZbZCIvh5WUMLS0abCSGorCNYHvnRUDvmuClicR873gKdV0zvEENLexDqelIiI1h6AYqirK1YE9318ZMFHHW1FVEqpNTfUn908u8TjSqZ7NtQbLRu7m1YE/PxqwbRmA9u3d9Is741izT7LWz3lVV/WVbQbRvGoRMJnNGkqRrsqJcktKxfgtZUfolSeqXZdnqfbIsX+d5vvFfIf1uy0/kIKoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Request Flow&quot; title=&quot;&quot; src=&quot;/static/3bcd958f569b5d750a3a63a9e1c2dd81/1d69c/request-flow.png&quot; srcset=&quot;/static/3bcd958f569b5d750a3a63a9e1c2dd81/4dcb9/request-flow.png 188w,
/static/3bcd958f569b5d750a3a63a9e1c2dd81/5ff7e/request-flow.png 375w,
/static/3bcd958f569b5d750a3a63a9e1c2dd81/1d69c/request-flow.png 750w,
/static/3bcd958f569b5d750a3a63a9e1c2dd81/906b5/request-flow.png 950w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;This is the setup: We have a cluster with a bunch of nodes, with a &lt;em&gt;Load Balancer&lt;/em&gt; in front. The NGINX Controller runs as a &lt;em&gt;DaemonSet&lt;/em&gt; in every node. Our application is configured as a &lt;em&gt;Deployment&lt;/em&gt;. To reach it, there is a &lt;em&gt;Service&lt;/em&gt; and an &lt;em&gt;Ingress&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Let’s assume we start our request from a &lt;a href=&quot;../understanding-vpc-endpoints/&quot;&gt;VPC Endpoint&lt;/a&gt;. What happens next?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We reach the Load Balancer. As I explained in my article about &lt;a href=&quot;../provisioning-a-network-load-balancer-with-terraform/&quot;&gt;NLBs&lt;/a&gt;, a target group points to individual instances. In this case, the worker nodes of the cluster.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(1st Load Balancing)&lt;/em&gt; The Load Balancer picks one of the nodes.&lt;/li&gt;
&lt;li&gt;The request reaches a Node. Through a Service of type &lt;code class=&quot;language-text&quot;&gt;NodePort&lt;/code&gt;, there are &lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; set up so that the request goes to the right place.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(2nd Load Balancing)&lt;/em&gt; &lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/service/#proxy-mode-iptables&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;kube-proxy&lt;/a&gt; selects one of the instances of the NGINX controller.&lt;/li&gt;
&lt;li&gt;NGINX does its magic, and it forwards the request to the correct Service.&lt;/li&gt;
&lt;li&gt;The Service for the application is of type &lt;code class=&quot;language-text&quot;&gt;ClusterIP&lt;/code&gt;. All the Pods in the Deployment appear as targets.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;(3rd Load Balancing)&lt;/em&gt; One of the Pods is chosen.&lt;/li&gt;
&lt;li&gt;The application Pod finally receives the request.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Whew! That was a perilous trip! I got tired by typing all this, and you can argue that I missed many details. Isn’t Kubernetes wonderful? What’s interesting is that will all these routing decisions, you can never guarantee who is going to process or receive a particular request.&lt;/p&gt;
&lt;h2&gt;Controller&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://kubernetes.io/docs/concepts/architecture/controller/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;controller&lt;/a&gt; pattern is widely used in the Kubernetes ecosystem. It’s based on the idea of a &lt;em&gt;control loop&lt;/em&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Figure out the target state, as defined by some resources defined in the cluster&lt;/li&gt;
&lt;li&gt;Determine the current situation&lt;/li&gt;
&lt;li&gt;If 1 and 2 diverge, change the system so that they match&lt;/li&gt;
&lt;li&gt;Repeat the loop&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Coming back to networking, the Ingress Controller handles the relationship between Ingress resources and the NGINX configuration. You declare what you expect to have, and the controller goes to work to morph that into a functioning reverse proxy.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d560c7be466042e541f880b40979721e/906b5/controller.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADjklEQVR42n2SX0xbZRjGX1rGokMFvduFJkaj3rgbb5RdmCyGdF6YODUhRpvBTHQS2OLUBKeFlgHDkZjpAHGIErZs/BFEoKOk5Y8is8AidkApDlpKFw6c9nznnPY7PS3tYw5R55VP8uV9vid5f9+bvB/R30pduECiYQBiwF72HNF9RJRbf/58frXNlm+32/c3fd5I4QUvufzhHMfPgdy6X1Zz7VOB3FbvHROQon+VamoiADkACKr6hRqLRRKSFMkIwttG1t/Ts9/hcDz42vF3CNBoJvQn1U6vUPVUgM5OrFDj1DIBwn+A587dA0rScU2S2tKy3AJRPCxHIrS9vm6qq6vPF24MEO4Gc4dW/E9+Num3nZ1Yqa3y+BurPYvFRv89YH29AaRVIEeW5T1vnGggQGHOTZYjR6ijo6MAWY2QlK23wwxfz27gim8T39wKwRsWAa5+SMPWD2jEeoac1jPkq235B2Te4dx4x2Tcp5aXqX9oyNTc2l5w8/d1Wo8o7zZ0M3w5qHAgmwKQALLQkwk7RWd9ORiYNmN03owRrxmLQbMBCWvam3cEoSEUizkW4vEnjOx6b3+hUUObwskut4TRubgBy3a61dTgzTgkptpIGPcSuscJv/kJzlm63dqzN2UsmZxlqgo1mURAUV41Mu/cXAER5YSCa6fTqSS2olpST2cz9qtSsnmIQZJVG0V+GDsUb+nr07uc17TLP/4kXu634v3rtBiVHr0VDh+a29h4dlJRDhjA7zs7C9XYprHl94JCGrYrDJ4FDZxzMIUjk07WkhLZ6k04ZyB/O4JE/yQS/vVoHHgYaU5PlZYeoMLCfavDw3tTt7e3FxhfJqPLJcEtLp5u3V52zaurwO6yrutRxuQKSgFXpSkf/ij+JHG31YkMsFn0kuXxmK53i4zFGedR387OUQP4VXPzQydOfkRPv/CWKTRWkXfRXpanzFTkvXysLO/1krK8E6VWM+lAl/zrEpZKGrjYN400smHLsTce29a0RoGx8Sjn7vlI5EVj5b2Dg/taLjbQM4fLyD9aRU2OU7TmrqLy8go6VVlBlZWVRBrXBrIARCmGdGYXu7u7TEvEH4nLMvHtbYKukz8YpOeLiqitrY0slqM0MTFObreHvrs2RkNON01OjJPH4yGXy0UkiuIriqLYo6L4sczYp4yxcrfHc/8DBw+SEAqZwblpaW2Nii0War50iWpqauj/9BfFT4OfqiC9ygAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Controller Loop&quot; title=&quot;&quot; src=&quot;/static/d560c7be466042e541f880b40979721e/1d69c/controller.png&quot; srcset=&quot;/static/d560c7be466042e541f880b40979721e/4dcb9/controller.png 188w,
/static/d560c7be466042e541f880b40979721e/5ff7e/controller.png 375w,
/static/d560c7be466042e541f880b40979721e/1d69c/controller.png 750w,
/static/d560c7be466042e541f880b40979721e/906b5/controller.png 950w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;As mentioned, the output is a gigantic config file. The controller gets notified when an ingress is created, deleted, or changed through a &lt;a href=&quot;https://pkg.go.dev/k8s.io/client-go/informers#NewFilteredSharedInformerFactory&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes informer&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;What did we learn?&lt;/h2&gt;
&lt;p&gt;The NGINX Ingress Controller is a surprisingly complicated piece of software. &lt;a href=&quot;https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-helm/#configuration&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Look&lt;/a&gt; at all the configuration parameters of the helm chart. And it’s no surprise. It’s a complex NGINX proxy, a control loop written in golang, and a connector of all these different networking pieces. I’ve used it for a while without really understanding what it does. It’s definitely worth spending some time on the details.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to Donald for the feedback.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setting up OAuth for Grafana with Auth0]]></title><description><![CDATA[Set up secure access for Grafana based on OAuth thanks to Auth0, nicely provisioned with Terraform using Infrastructure as Code]]></description><link>https://hceris.com/setting-up-oauth-for-grafana-with-auth0/</link><guid isPermaLink="false">https://hceris.com/setting-up-oauth-for-grafana-with-auth0/</guid><category><![CDATA[Auth0]]></category><category><![CDATA[OAuth]]></category><category><![CDATA[Infrastructure as Code]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[Grafana]]></category><pubDate>Sun, 17 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 633px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a9230025dba16af901f0de8912fdc6e9/bce72/dashboard.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 67.5531914893617%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLUlEQVR42iWSuXIcVRiFb3ffvlvf29P79GweS9Y2yFrKsg2SF0lGhS1LYBtIyAhw8QJAyAMQQpERAVUEJM6I8BNAFW/0wQzBqfqjU//5zhG3NjaoRy2xlVSThuMHJ8y2Zxy9d48Hjx9xenrG2fkTzi4uePLskvevrrm4/pCnL17y7OUrLl99zPNXn/DB9Ud8/sVrxO7+Pv38BvONW2wuFpSTnp29feZbW4jMIiLxv5xBlAUi94jMIbRGWIswFuEDYTYlG48QRTdkMJ7iJjeIihqZF+gsI80ypHNUXUtWlhTjnnrYMt7bo9u9jZ+vobshaVliuyGTzU3W9vcQfn0fsXmPte0tfv7lV25ubSOEQHuPzBw2z1F5IC4K1KefoScTohBIuxbVD0nbjqRuCP2I6WKBCPefEz99zfq055uvvmbJNMsHVG1LXlUr6TxfGaS//4G+vEKnMcJnJE1N0nVETUM5nTF9Z4Fwdy+pvn2zirj8TMQRidEIlSJSic7DCoGcz7Fv/mTw02/U4xEDZynqmrrvqfoR5XjM8NY6wu8+pPrhH8SX3yMPTom6GaJoiIuaOC+wRUkiE9zxQ/K3f2Pe/kX83Y/IwyPi0Zi4bjBVTVnXJNYgolCSbhwi9x6Tn1wyODyhuX2HbG0T2fbIEBBKkTQt8t1jskenFFcvyM4uyO8fk95cR5T1qsBk2XxqDNoZtIyQQiAjgUxiUpmQOUcoC5LMUgwbZCyIhCBTCd5InFPEaYIpPK4piVKFkLMFad2TGMu4mrE92iFSmsXGFuf3j6nqBldX3H3xjDDqSYPn6PyA+e6cNGSMjnZoF2uEviExy8jKopRBKYtUltTlq7F6P8CHAr/cZfC4viHNA4nPMANPvOQlU3Q5QBc5WVNgg0cIZRHWE9mA8iXCZKS+RIYKYdzKOHUOOfArnqoqkYMckSQkWUY+G5LPOhJvsHlAxCZDG4vNAkVR0w4q2qLBVw3K54S8WMU0XUE17yhmLeFGj5v22K5mMKkR2nDn3gHjpkLEicRojVaKKI6JpETIBK0VxlqUdUhnSbwj0grlLdKkREaj8uWtEHFMOWxR/zH8F70+ZoaEpkZpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Dashboard&quot; title=&quot;&quot; src=&quot;/static/a9230025dba16af901f0de8912fdc6e9/bce72/dashboard.png&quot; srcset=&quot;/static/a9230025dba16af901f0de8912fdc6e9/4dcb9/dashboard.png 188w,
/static/a9230025dba16af901f0de8912fdc6e9/5ff7e/dashboard.png 375w,
/static/a9230025dba16af901f0de8912fdc6e9/bce72/dashboard.png 633w&quot; sizes=&quot;(max-width: 633px) 100vw, 633px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If I say &lt;em&gt;monitoring&lt;/em&gt;, the first thing that comes to mind is &lt;a href=&quot;https://prometheus.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Prometheus&lt;/a&gt;. And its trusty sidekick, &lt;a href=&quot;https://grafana.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Grafana&lt;/a&gt;. Is it software engineering if you’re not continuously checking some dashboards? However, we don’t want to expose those dashboards on the public internet. That would be bad! In this post, I’m showing how to set up authentication for Grafana. I’m using &lt;a href=&quot;https://auth0.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt; as an identity provider.&lt;/p&gt;
&lt;p&gt;I wrote some time ago about &lt;a href=&quot;../setting-up-auth0-with-terraform/&quot;&gt;setting up Auth0 with Terraform&lt;/a&gt;. Auth0 is an excellent product and a convenient way to set up authentication and authorization without handling the gory details. OAuth is the last thing you want to implement yourself.&lt;/p&gt;
&lt;p&gt;I hadn’t checked my Auth0 account in a while, and honestly, I had forgotten many of the details. That’s one of the huge benefits of having the whole thing set up with &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt;. It is a lot easier to jump back, check the code, and understand what you need to add extra functionality. I don’t think the same can be said if you use the UI directly.&lt;/p&gt;
&lt;h2&gt;The flow&lt;/h2&gt;
&lt;p&gt;I’m going to configure Grafana to allow login through Auth0. I’m too lazy to handle user management, so in fact, I’m going to use Google users.&lt;/p&gt;
&lt;p&gt;My Grafana instance is available under a domain such as &lt;a href=&quot;https://grafana.mydomain.com&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://grafana.mydomain.com&lt;/a&gt;. Technically, it sits behind an nginx acting as a reverse proxy. But that’s not relevant for our purposes.&lt;/p&gt;
&lt;h2&gt;Client and connection&lt;/h2&gt;
&lt;p&gt;As mentioned, I’m leveraging Google accounts through the &lt;code class=&quot;language-text&quot;&gt;auth0_connection&lt;/code&gt; resource. Additionally, I’m defining a new client (&lt;code class=&quot;language-text&quot;&gt;auth0_client&lt;/code&gt;) pointing to Grafana. The application type I need is a &lt;a href=&quot;https://auth0.com/docs/applications&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;regular web application&lt;/a&gt;.&lt;/p&gt;
&lt;!-- auth0-client --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_client&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;grafana-frontend&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;grafana&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Grafana - Terraform generated&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;app_type&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;regular_web&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;callbacks&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;grafana_host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/login/generic_oauth&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;web_origins&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;grafana_host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_connection&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;enabled_clients&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    auth0_client.grafana-frontend.id
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;output&lt;span class=&quot;token type variable&quot;&gt; &quot;grafana-client-id&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; auth0_client.grafana-frontend.client_id
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;output&lt;span class=&quot;token type variable&quot;&gt; &quot;grafana-client-secret&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; auth0_client.grafana-frontend.client_secret
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Provisioning this client generates a &lt;code class=&quot;language-text&quot;&gt;client_id&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;client_secret&lt;/code&gt; that I’ll pass to Grafana. We don’t have a custom backend, so there is no need to set up an &lt;a href=&quot;https://auth0.com/docs/authorization/apis&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;API&lt;/a&gt; on Auth0’s side.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/49462f34d991892ca122138e45663f71/41870/client-output.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 13.829787234042554%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAk0lEQVR42jXGWQ6CMBRAUXaFtNABKH0deAUqKEogfpgQ978Ag8T7cXMSF2rf1cZXvlNgK22rtldKl8bLxohac3BCW8lYwX4VJ/ixRGl5mHPOuCyFFAelFPm/NCXZhZKMEpJTkhNC6YmMJsMdxsXGpx9mN224ffrl3a47rjveNje/fHxYF5p+MmE0GCFcAQfAK2CELxkBMbTEavs4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Client Settings&quot; title=&quot;&quot; src=&quot;/static/49462f34d991892ca122138e45663f71/1d69c/client-output.png&quot; srcset=&quot;/static/49462f34d991892ca122138e45663f71/4dcb9/client-output.png 188w,
/static/49462f34d991892ca122138e45663f71/5ff7e/client-output.png 375w,
/static/49462f34d991892ca122138e45663f71/1d69c/client-output.png 750w,
/static/49462f34d991892ca122138e45663f71/78797/client-output.png 1125w,
/static/49462f34d991892ca122138e45663f71/aa440/client-output.png 1500w,
/static/49462f34d991892ca122138e45663f71/41870/client-output.png 1788w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Let&apos;s not go through the trouble of setting up OAuth to then print the client secret
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2&gt;Configuring Grafana&lt;/h2&gt;
&lt;p&gt;We’re connecting the client with Grafana using what’s called &lt;a href=&quot;https://grafana.com/docs/grafana/latest/auth/generic-oauth/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;generic OAuth authentication&lt;/a&gt;. There are a few endpoints based on the domain, plus the &lt;code class=&quot;language-text&quot;&gt;client_id&lt;/code&gt; and the &lt;code class=&quot;language-text&quot;&gt;client_secret&lt;/code&gt; that I got before.&lt;/p&gt;
&lt;!-- grafana-config --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;toml&quot;&gt;&lt;pre class=&quot;language-toml&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;domain&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; grafana&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;HOST&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;root_url&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; https://grafana&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;HOST&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;disable_login_form&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;auth.generic_oauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;enabled&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;allow_sign_up&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;team_ids&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;allowed_organizations&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; Auth0
&lt;span class=&quot;token key property&quot;&gt;client_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; $__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;GRAFANA_CLIENT_ID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;client_secret&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; $__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;GRAFANA_CLIENT_SECRET&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key property&quot;&gt;scopes&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; openid profile email
&lt;span class=&quot;token key property&quot;&gt;auth_url&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; $__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;AUTH0_HOST&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;/authorize
&lt;span class=&quot;token key property&quot;&gt;token_url&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; $__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;AUTH0_HOST&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;/oauth/token
&lt;span class=&quot;token key property&quot;&gt;api_url&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; $__env&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;AUTH0_HOST&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;/userinfo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I &lt;strong&gt;definitely&lt;/strong&gt; don’t want to store the credentials in the code. Luckily, we can use &lt;a href=&quot;https://grafana.com/docs/grafana/latest/administration/configuration/#env-provider&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;variable expansion&lt;/a&gt; to inject those values from the outside. That spares us from templating the configuration. Nicely done, Grafana. Let’s orchestrate it with &lt;code class=&quot;language-text&quot;&gt;docker-compose&lt;/code&gt;:&lt;/p&gt;
&lt;!-- grafana-docker-compose --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;grafana&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; grafana
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; grafana/grafana

  &lt;span class=&quot;token key atrule&quot;&gt;env_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .env

  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./prometheus/grafana/dashboards:/etc/grafana/provisioning/dashboards&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./prometheus/grafana/datasources:/etc/grafana/provisioning/datasources&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./prometheus/grafana/grafana.ini:/etc/grafana/grafana.ini&quot;&lt;/span&gt;

  &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; web
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; backend&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Keep in mind that Grafana needs internet access to communicate directly with Auth0 and fetch the access token.&lt;/p&gt;
&lt;p&gt;After all this work, Grafana rewards us with a welcoming screen.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 570px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/19024db7e887aaf89d9b80e7f2c6722b/432e7/grafana-login.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACK0lEQVR42o1Ty27TQBQ1laoUO05DUZP4Fbu1kzRO4vH40TybyLQpBBZQIlCREHSBWCGWfAHiB1iy5EMPmknsNCEoLI5mru/cM+eeOxbyeoBtkLQF8jrFvhrggbKK0zU7y1aNQtRDCNsJaQZRC9B2fEyaBJJGN0j/k5AdLuiUq3rmEvy6bOH7uI2pS7haObtwByFTkO4LRgChFODHKxdfkg5mAcGnpIN9hRGu12wlTMlEllAXCvZKAWajNn5/s/Hzq423Uxd7xxR5zV+2T3crLJoxHlkximaEQzOGaMSgMcHTK4/HReuc52Vjh0KGgwqBQ6/w+t1nvJjfYTK7xfXL96DjOcLkFqPpGzyf32F28wGzm48wWmNek9/lYaEawnDHcPxLnJInsP1L2CSB1Ung0CmUxoh3IBvhyvd/eZj6uCCOUDBCXsgukZd7fkZd+njvXWaEqcGZyRsxg6yvT/fvp8bIo3WFTMWRFePY6XHI1QgHis+nLqmUq2KDKdcHKNUGUOpDPLa6KBiLTvJGDCF98aywetZFf5TAtJs4cVzUzjzE/QloNEDYvUDUG8NpeDx3WmvBrrVQspiQGEfmOYpmD4K0VPhQ9aHWu2hHE5StFpSTDjSboEkvUPMGqJMhGmQI1SaoWB2eZyhWWasht+PQ7ENg02GQDeaZj1zF4yazf5i1mit7yFVIBvZNTPOsO20xYf7Y2VBEPeJmSsZy1SOI9yBtYDO3ikOIRhd/AMDFpzSaFhWmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Grafana Login&quot; title=&quot;&quot; src=&quot;/static/19024db7e887aaf89d9b80e7f2c6722b/432e7/grafana-login.png&quot; srcset=&quot;/static/19024db7e887aaf89d9b80e7f2c6722b/4dcb9/grafana-login.png 188w,
/static/19024db7e887aaf89d9b80e7f2c6722b/5ff7e/grafana-login.png 375w,
/static/19024db7e887aaf89d9b80e7f2c6722b/432e7/grafana-login.png 570w&quot; sizes=&quot;(max-width: 570px) 100vw, 570px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Don&apos;t tell me whether I can get in the way of the data or not!
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2&gt;An unforeseen problem&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 437px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bba3524fa8aa74da236fca4e4af324ed/fca8a/koala.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 151.06382978723406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAECBAUD/8QAFwEAAwEAAAAAAAAAAAAAAAAAAQIDAP/aAAwDAQACEAMQAAABqPOtq0iIwq7GYhu4ydP/xAAcEAACAgIDAAAAAAAAAAAAAAABAgADEhMRIzH/2gAIAQEAAQUCFghAeYWCexFdKy5E5xZe6vSWLAa0fEFkE//EABgRAAIDAAAAAAAAAAAAAAAAAAABAhAR/9oACAEDAQE/AaizEf/EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8BmMrP/8QAHhAAAgIBBQEAAAAAAAAAAAAAAAERITECECJCcZH/2gAIAQEABj8C24uvShsVkomlGRuTQxp4O30//8QAGhABAQEAAwEAAAAAAAAAAAAAAREAITFRYf/aAAgBAQABPyHQ2y6xJ+MBUCvzdA/D7uWAUqYQdg3TGBXpuYy70g7nOMg1zxmCnW8Z/9oADAMBAAIAAwAAABDEwQz/xAAYEQADAQEAAAAAAAAAAAAAAAAAASERUf/aAAgBAwEBPxBPYMpDuj//xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhQf/aAAgBAgEBPxBx2EyOnY8W/8QAIBABAAMBAAEEAwAAAAAAAAAAAQARITFBUWFxgZHB8P/aAAgBAQABPxBxlJAZfgJF+bbMKhxg4C1iSKtWOg3nxDKF0HH8xoKrH3GPDGB/heTvwQW9rIYBLj0O2fuOGqa02X5+4OMXgVs//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Koala&quot; title=&quot;&quot; src=&quot;/static/bba3524fa8aa74da236fca4e4af324ed/fca8a/koala.jpg&quot; srcset=&quot;/static/bba3524fa8aa74da236fca4e4af324ed/bc01b/koala.jpg 188w,
/static/bba3524fa8aa74da236fca4e4af324ed/bf173/koala.jpg 375w,
/static/bba3524fa8aa74da236fca4e4af324ed/fca8a/koala.jpg 437w&quot; sizes=&quot;(max-width: 437px) 100vw, 437px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Did somebody say dashboards?
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Looking good! No unauthorized user will access our dashboards. Right? Well, turns out, anybody with a Google account can log in. No as secure as I had hoped.&lt;/p&gt;
&lt;p&gt;In my previous article, I added a custom &lt;a href=&quot;https://auth0.com/docs/scopes&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;scope&lt;/a&gt; to the JWT and verified it on the backend side. Grafana offers no such functionality, sadly. It’s a known issue, and it doesn’t look like it’s going to be fixed &lt;a href=&quot;https://github.com/grafana/grafana/issues/6809&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;anytime soon&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can specify an expected organization or team id, but that’s not standard OAuth. It seems like it’s a straight copy-paste based on Github’s interpretation of OAuth. The documentation for those two parameters is pretty awful, by the way. I spent a lot of time reading the source code until I understood that you need some endpoints that Auth0 doesn’t implement.&lt;/p&gt;
&lt;p&gt;Anyways, there is an alternative. Instead, we’re going to use a &lt;a href=&quot;https://auth0.com/docs/rules&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;rule&lt;/a&gt; that checks if the user has a specific role. We’ll drop the requests done by users without the role, never sending them to Grafana. Rule and role are defined like this:&lt;/p&gt;
&lt;!-- provision-rule --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_role&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;grafana-user&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Grafana - User&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_rule&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;grafana-drop-unauthorized&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;grafana-drop-unauthorized&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; templatefile(&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/drop-unauthorized-grafana.js&quot;&lt;/span&gt;, &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    application : auth0_client.grafana-frontend.name,
    role : auth0_role.grafana-user.name
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;)

  &lt;span class=&quot;token property&quot;&gt;enabled&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The rule is implemented in JavaScript. The file is templated, so the values for &lt;code class=&quot;language-text&quot;&gt;application&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;role&lt;/code&gt; are interpolated and won’t be present in the final file that is uploaded to Auth0.&lt;/p&gt;
&lt;!-- rule-definition --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dropUnauthorizedGrafana&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clientName &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;${application}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; auth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authorization &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; roles &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; auth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;roles &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;roles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${role}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Access denied&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Rules run for &lt;em&gt;every&lt;/em&gt; application, so make sure you only process the correct application.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;The temptation to do some half-assed measure to protect internal tools like Grafana is always there. Many of these tools end up behind a VPN or (God forbid) using something like Basic Auth. Thanks to providers like Auth0, the right thing is easier than ever. With infrastructure as code, you can ensure that the installation is repeatable. Moreover, you’ll be able to come back and still understand it.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 25/01/2021:&lt;/em&gt; Corrected mixed usage of API and Application for Auth0&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Prometheus up and running]]></title><description><![CDATA[Get started with Prometheus thanks to this book, which is both practical and comprehensive]]></description><link>https://hceris.com/book-review-prometheus-up-and-running/</link><guid isPermaLink="false">https://hceris.com/book-review-prometheus-up-and-running/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Monitoring]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Prometheus]]></category><pubDate>Fri, 08 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 200px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ee722eca2516bc39c2cd0f475c9fc8bc/e07e9/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 130.85106382978722%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAwQG/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQMC/9oADAMBAAIQAxAAAAFkWrUcEgoqujik8hrJ7//EABwQAAMAAgMBAAAAAAAAAAAAAAECAwASBBARE//aAAgBAQABBQK6oFnOLhVCCujCTlKAg5VW+ujZxR5LoZ//xAAYEQACAwAAAAAAAAAAAAAAAAAAARASIf/aAAgBAwEBPwHIoI//xAAYEQADAQEAAAAAAAAAAAAAAAAAAREQE//aAAgBAgEBPwGvOg3T/8QAIBAAAgICAAcAAAAAAAAAAAAAAAECESFREiAiMTKBkf/aAAgBAQAGPwK+FNsxFFRVFSkl7Fp4MEul99Hi/hnfJ//EABwQAQACAgMBAAAAAAAAAAAAAAEAESExEEFRYf/aAAgBAQABPyFleXcsKq3ZmVwDwgegNeIiqORmA2hPkcpwAkqCZbK4dTSf/9oADAMBAAIAAwAAABAIyfP/xAAYEQADAQEAAAAAAAAAAAAAAAAAARFBYf/aAAgBAwEBPxCMLg60SKH/xAAZEQADAAMAAAAAAAAAAAAAAAAAAREhMUH/2gAIAQIBAT8Qh0duRMloop//xAAeEAEBAAICAgMAAAAAAAAAAAABEQAhUWEQcTFBof/aAAgBAQABPxBjaAi15yvRoIB7M2WFezLtbVArN24kE+WP5c+stVUxDEWiUPeK8ckytS2CievG79YZrzn/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Prometheus up and running&quot; title=&quot;&quot; src=&quot;/static/ee722eca2516bc39c2cd0f475c9fc8bc/e07e9/cover.jpg&quot; srcset=&quot;/static/ee722eca2516bc39c2cd0f475c9fc8bc/bc01b/cover.jpg 188w,
/static/ee722eca2516bc39c2cd0f475c9fc8bc/e07e9/cover.jpg 200w&quot; sizes=&quot;(max-width: 200px) 100vw, 200px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;https://prometheus.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Prometheus&lt;/a&gt; is a complex beast. I’ve been using it at work for the past year, and I always felt that I could barely understand what was going on. Picking up this book is a great way to start filling those gaps. Roughly, there are the following sections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Application Monitoring&lt;/li&gt;
&lt;li&gt;Infrastructure Monitoring&lt;/li&gt;
&lt;li&gt;PromQL&lt;/li&gt;
&lt;li&gt;Alerting&lt;/li&gt;
&lt;li&gt;Deployment&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Whether you are monitoring applications or infrastructure, the core components are the same. Instrumenting the code or using exporters, and then publishing metrics that Prometheus will scrape, with a few labels to sprinkle on top.&lt;/p&gt;
&lt;p&gt;There are plenty of components that need to be deployed to have a more complete setup. The &lt;a href=&quot;https://github.com/prometheus/node_exporter&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;node-exporter&lt;/a&gt;, the &lt;a href=&quot;https://github.com/prometheus/blackbox_exporter&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;blackbox-exporter&lt;/a&gt;, and others make an appearance. This is more relevant as an operator, however.&lt;/p&gt;
&lt;p&gt;I set up a simple installation of Prometheus to try things more practically. It’s in &lt;a href=&quot;https://github.com/sirech/example-prometheus-setup&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this repository&lt;/a&gt; and can be run with Docker.&lt;/p&gt;
&lt;h2&gt;PromQL&lt;/h2&gt;
&lt;p&gt;The toughest part of the book is the comprehensive overview of &lt;em&gt;PromQL&lt;/em&gt;, Prometheus’s query language. If you want to write queries that make any sense, this section is a must-read. Otherwise, you’ll find yourself trying different combinations of &lt;code class=&quot;language-text&quot;&gt;sum&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;rate&lt;/code&gt;, and whatnot until your queries somehow work.&lt;/p&gt;
&lt;h2&gt;Alerting&lt;/h2&gt;
&lt;p&gt;Alerting is especially relevant if you handle on-call for a system. From experience, a misconfigured alerting setup can cause a lot of friction and pain, so it’s good to invest in understanding which kind of alerts you can get, and when.&lt;/p&gt;
&lt;h2&gt;Dashboarding&lt;/h2&gt;
&lt;p&gt;Visualizing your metrics is a big part of monitoring, which in this ecosystem is handled by &lt;a href=&quot;https://grafana.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;grafana&lt;/a&gt;. Grafana is another complex beast. You’ll find about twenty pages on the topic, which is not nearly enough to get a deep understanding of how to build all those fancy dashboards that you see out there. But it’s an interesting appetizer to get started.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.thoughtworks.com/de/radar/tools/prometheus&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Prometheus&lt;/a&gt; has been around for a while, all in all. It seems to be the standard monitoring collecting tool these days. Knowing about it is a good investment of your time, and I think this book strikes a reasonable balance of being practical and giving you deeper insights, thus getting ⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Provisioning an Application Load Balancer with Terraform]]></title><description><![CDATA[Learn how to provision Application Load Balancers in AWS using Terraform to ensure high availability for your applications]]></description><link>https://hceris.com/provisioning-an-application-load-balancer-with-terraform/</link><guid isPermaLink="false">https://hceris.com/provisioning-an-application-load-balancer-with-terraform/</guid><category><![CDATA[AWS]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[Load Balancing]]></category><category><![CDATA[Networking]]></category><category><![CDATA[Infrastructure as Code]]></category><pubDate>Sat, 02 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/dc8fff6512573d444b314e2727d1192c/4b190/lb.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFdKNS8nK//xAAZEAACAwEAAAAAAAAAAAAAAAABAgADEiH/2gAIAQEAAQUCqvLl7cKrkriYETi//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEhEQL/2gAIAQEABj8CzpIjNRIWmH//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhMUFRYYHR/9oACAEBAAE/IfOcENS5cvF5gKmnuGVr0I/YiqGif//aAAwDAQACAAMAAAAQXA//xAAWEQEBAQAAAAAAAAAAAAAAAAAAESH/2gAIAQMBAT8QjX//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFBUWFx/9oACAEBAAE/EHtGGFdEmMe9DAvVRlKm+Xp5MgZ5CLj9nK/qU6NAdE//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;lb&quot; title=&quot;&quot; src=&quot;/static/dc8fff6512573d444b314e2727d1192c/acb04/lb.jpg&quot; srcset=&quot;/static/dc8fff6512573d444b314e2727d1192c/bc01b/lb.jpg 188w,
/static/dc8fff6512573d444b314e2727d1192c/bf173/lb.jpg 375w,
/static/dc8fff6512573d444b314e2727d1192c/acb04/lb.jpg 750w,
/static/dc8fff6512573d444b314e2727d1192c/4b190/lb.jpg 800w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I wrote about &lt;a href=&quot;../provisioning-a-network-load-balancer-with-terraform/&quot;&gt;Network Load Balancers&lt;/a&gt; recently. You get a lot of mileage out of NLB’s, but sometimes you do need Layer 7 features.&lt;/p&gt;
&lt;p&gt;One alternative is keeping the NLB and putting a reverse proxy like &lt;a href=&quot;../setting-up-traefik/&quot;&gt;Traefik&lt;/a&gt; behind it. However, a simpler approach can be replacing both with another offering from AWS, the &lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Application Load Balancer (ALB)&lt;/a&gt;. In this post, I’ll show how to provision ALBs with help of the old trusty &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Setting up an Application Load Balancer&lt;/h2&gt;
&lt;p&gt;There are three main components to consider: The &lt;strong&gt;load balancer&lt;/strong&gt;, the &lt;strong&gt;listeners&lt;/strong&gt;, and the &lt;strong&gt;target groups&lt;/strong&gt;. I wrote in detail about this in my &lt;a href=&quot;../provisioning-a-network-load-balancer-with-terraform/&quot;&gt;previous article&lt;/a&gt;, so I won’t belabor too much. Most of the concepts are similar.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 520px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/506757965f4b4db28df9dd13a937926e/69902/diagram.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 96.80851063829786%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADyklEQVR42oWU228UVRzH+TvUJ3kwxreGEq8YfcF4SXjAdxOVlESBGAMVgWKohgQJBYQoomkarbSIQAuaErkUpI2KtNy8dNvu7uzM7Mzszv3Mpbuz8zE7LXQBL7/klzOZ8z2f+Z7fnPNbQkukaUraSLPn4h8B4ydtrpwWGIX6/HwjJU35z1hyL7CRzK84caDE7tdzHOxQGPvWz94l9TTT/C8wc7aQyQJwoGeana/dYG/HDOe+Nu8C/ls27S+574sLW/7ljMZn71+jd/sUf/3stczdzvsjve3QD2NUW2DHDayojhnWESlUwggzjvEaYIYJZtTAjOZHK0oybaaP6nhxMu+wCbSjOnm3hiwaSH5CSTTIlTVuzOaYUiQUp4riVlCcCqpbRXYqSN5cpiuJBEkk6EE923YG9GoJcthACRqU4+aYYAgd3ZHQXZlqoGD6ZUyhUfEULKGj+HGmb2qbRoywBVjWYw5synO4U+WrHVYG/WGwyP63p+ndrDJ53mbC+InVvS+yuu8F1h1/A8kLUYIUWSwAWx0W8oLOVyb4ZO0sn28oIzl1+nZP0bXqFvvXSIz225wtHWN5z2O8/OXzrDz0JLO2ixryz8CiJHjzqVE+eHWSno4ZFD/hi103WfvEOF2rfud8v8FFZZhlex7luU/beenwCvKO3wJM7gZaosbopSoXzlUZG3dQwoSJ67MM9l1iaPBXpqclSs40wzeOcvx6PxemR5CzGqZZHeWgWcNkEejGddQ4Qo0EahQguTGyW6VoFSg5JRRXR7EtLE9g+wF2ECB7EZJXy/52wZ1DF7XFY+OEIbmKzi1ZpmhbGL6BHrrIQqAGAbpw0P0KSuRTcC3KoYvuafiRQRBXCGIdK3Czcz/vUHiop7dQHVqH/eMmqm4B7eoRtKNrsL5fj5k7haH/iXbsLarD67HGdlH1FfZdvMm7J39j49AVJkr64l22bYP81keofLwM50A7VX0SefAd1G0PY/e0YY12U566iPzeg5j7nsbpXYlmzvDswcs8vvcySz88y+BEsQVYLZPreobyzhWUux6iol6heHQ70rZ2ypsfQB/Zipobp7C1HbW7DW13G7pdyIDLey6z9KNzDFxtBfouM6f2MPVNJ6UTneh2HnXyFDMDWygc2YAxNYJu5Mh/183swEa0Cz0YnsKhsZt0n7nGjpGrTMraIjCqJVi15n2MsOtghwGa55GvmEi2j+Z6qJaJ6gnyFQvFFZjCI66FxLUgy3BuLmu+i+3rnjEQAa7j4nsuQRAgfEEYBDi2jee6d7p3I73T8bIG9jcO/lTpnQeJGgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;diagram&quot; title=&quot;&quot; src=&quot;/static/506757965f4b4db28df9dd13a937926e/69902/diagram.png&quot; srcset=&quot;/static/506757965f4b4db28df9dd13a937926e/4dcb9/diagram.png 188w,
/static/506757965f4b4db28df9dd13a937926e/5ff7e/diagram.png 375w,
/static/506757965f4b4db28df9dd13a937926e/69902/diagram.png 520w&quot; sizes=&quot;(max-width: 520px) 100vw, 520px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Let’s focus on some concrete aspects. For the &lt;code class=&quot;language-text&quot;&gt;aws_lb&lt;/code&gt;, we use a different &lt;code class=&quot;language-text&quot;&gt;load_balancer_type&lt;/code&gt; (&lt;code class=&quot;language-text&quot;&gt;application&lt;/code&gt;).&lt;/p&gt;
&lt;!-- alb --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_subnet_ids&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id

  &lt;span class=&quot;token property&quot;&gt;tags&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;Tier&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Public&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;               &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;basic-load-balancer&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;load_balancer_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;application&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;subnets&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_subnet_ids.this.ids

  &lt;span class=&quot;token property&quot;&gt;enable_cross_zone_load_balancing&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Unlike NLBs, you can’t set static IPs for an ALB.&lt;/p&gt;
&lt;h3&gt;Listeners&lt;/h3&gt;
&lt;p&gt;For an ALB, our listeners have to be either &lt;code class=&quot;language-text&quot;&gt;HTTPS&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt;. We can choose to do SSL termination at this stage. Let’s see an example.&lt;/p&gt;
&lt;!-- alb-listener --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_listener&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;load_balancer_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb.this.arn

  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTPS&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;ssl_policy&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ELBSecurityPolicy-2016-08&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;certificate_arn&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_acm_certificate.this.arn

  &lt;span class=&quot;token keyword&quot;&gt;default_action&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;             &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;forward&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;target_group_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.this.arn
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_acm_certificate&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;domain&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;dns_record_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;dns_zone_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can read more about the different &lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SSL Security policies here&lt;/a&gt;. I’m referencing an existing certificate for now. We’ll see how to provision it thanks to &lt;em&gt;Route53&lt;/em&gt; later on.&lt;/p&gt;
&lt;h3&gt;Target groups&lt;/h3&gt;
&lt;p&gt;Having carried the SSL termination in the step before, our target group is going to work over &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt;.&lt;/p&gt;
&lt;!-- alb-target-group-instance --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_target_group&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTP&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id

  &lt;span class=&quot;token property&quot;&gt;load_balancing_algorithm_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;least_outstanding_requests&quot;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;stickiness&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;enabled&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lb_cookie&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;health_check&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;healthy_threshold&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;interval&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTP&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;unhealthy_threshold&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    aws_lb.this
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_autoscaling_attachment&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;target&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;autoscaling_group_name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.autoscaling_group_name
  &lt;span class=&quot;token property&quot;&gt;alb_target_group_arn&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.this.arn
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are some extra features to show:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We’re customizing the load balancing &lt;a href=&quot;https://aws.amazon.com/about-aws/whats-new/2019/11/application-load-balancer-now-supports-least-outstanding-requests-algorithm-for-load-balancing-requests/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;algorithm&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;We’re using sticky sessions through a cookie with the &lt;code class=&quot;language-text&quot;&gt;stickiness&lt;/code&gt; block.&lt;/li&gt;
&lt;li&gt;We’ve got a custom health check with the &lt;code class=&quot;language-text&quot;&gt;health_check&lt;/code&gt; block.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Security Groups&lt;/h3&gt;
&lt;p&gt;Just like network load balancers, you need to allow traffic to flow through security groups.&lt;/p&gt;
&lt;!-- security-groups --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_security_group&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow connection between ALB and target&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_security_group_rule&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ingress&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;security_group_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_security_group.this.id
  &lt;span class=&quot;token property&quot;&gt;from_port&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;to_port&lt;/span&gt;           &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ingress&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;cidr_blocks&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;0.0.0.0/0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Path-based routing&lt;/h2&gt;
&lt;p&gt;Our load balancer is aware of the path and headers that we’re requesting, and thus we can make routing decisions based on that. We use extra &lt;code class=&quot;language-text&quot;&gt;aws_lb_listener_rule&lt;/code&gt; resources to enrich the regular listener.&lt;/p&gt;
&lt;!-- listener-rule --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_listener_rule&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;redirect_based_on_path&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;listener_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_listener.this.arn

  &lt;span class=&quot;token keyword&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;             &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;forward&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;target_group_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.alternative_target.arn
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;condition&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;path_pattern&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/rest/v2/*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If the condition matches (in this case, we’re using a new version of the API in the URL), the default listener will be ignored. Instead, traffic is redirected to a different target group. Similarly, we can make other rules based on a specific header, or a hostname.&lt;/p&gt;
&lt;h2&gt;Setting up Route53&lt;/h2&gt;
&lt;p&gt;We’re surely not going to access the load balancer through an autogenerated domain, are we? We want pretty domains, using &lt;a href=&quot;https://aws.amazon.com/route53/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Route53&lt;/a&gt;. First, we set up a &lt;code class=&quot;language-text&quot;&gt;CNAME&lt;/code&gt; record.&lt;/p&gt;
&lt;!-- route53-lb --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_route53_zone&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.dns_zone_name
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_route53_record&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.dns_record_name
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CNAME&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;records&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    aws_lb.this.dns_name,
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;zone_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_route53_zone.this.zone_id
  &lt;span class=&quot;token property&quot;&gt;ttl&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;60&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re also setting up a certificate for the domain. It’s validated automatically through a DNS challenge.&lt;/p&gt;
&lt;!-- route53-cert --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_acm_certificate&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;domain_name&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;dns_record_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;dns_zone_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;validation_method&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;DNS&quot;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_acm_certificate_validation&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;certificate_arn&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_acm_certificate.this.arn
  &lt;span class=&quot;token property&quot;&gt;validation_record_fqdns&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;aws_route53_record.web_cert_validation.fqdn&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_route53_record&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;web_cert_validation&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_acm_certificate.this.domain_validation_options.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;resource_record_name
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_acm_certificate.this.domain_validation_options.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;resource_record_type

  &lt;span class=&quot;token property&quot;&gt;records&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;aws_acm_certificate.this.domain_validation_options.&lt;span class=&quot;token number&quot;&gt;0.&lt;/span&gt;resource_record_value&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;zone_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_route53_zone.zone.id
  &lt;span class=&quot;token property&quot;&gt;ttl&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;A word on pricing&lt;/h2&gt;
&lt;p&gt;As you can see on the &lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/pricing/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pricing page&lt;/a&gt;, ALBs have the same fixed costs as NLBs but are more expensive when processing traffic (LCU vs NLCU). The pricing details are a bit arcane. A good rule of thumb is to use an ALB if there is a specific feature that you want to utilize, I guess.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;A combination of &lt;a href=&quot;../provisioning-a-network-load-balancer-with-terraform/&quot;&gt;NLBs&lt;/a&gt; and ALBs will cover most if not all your load balancing needs. The sheer amount of features can be overwhelming. I’ve found it easier to start focusing on the basics and discover the vast array of possibilities one by one.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: No rules rules, Netflix and the culture of reinvention]]></title><description><![CDATA[A book about Netflix's culture is out. Talent density, candor, leading with context are some of the principles they follow]]></description><link>https://hceris.com/book-review-no-rules-rules-netflix/</link><guid isPermaLink="false">https://hceris.com/book-review-no-rules-rules-netflix/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Netflix]]></category><pubDate>Sun, 13 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 326px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b45968b3d8af71e9df9897f625d879e1/8a553/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 153.19148936170214%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAfABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/2gAMAwEAAhADEAAAAUz3WW+YotrC5TKogH//xAAcEAACAgMBAQAAAAAAAAAAAAABAgADERIhECL/2gAIAQEAAQUCCjU0qtrACK/LDnwJ8lTiZXVeoARP/8QAGREBAAIDAAAAAAAAAAAAAAAAAQACEBIh/9oACAEDAQE/AbC42Rhbk//EABYRAQEBAAAAAAAAAAAAAAAAABABEf/aAAgBAgEBPwGGH//EABwQAAIDAAMBAAAAAAAAAAAAAAERABAhEkGR4f/aAAgBAQAGPwIFx8sMwuJwd098mivkQ1V//8QAHBAAAwADAAMAAAAAAAAAAAAAAAERITFBEFFx/9oACAEBAAE/Ic6bNQ0BZ1DBcRJK6gm7bRMc4VSqlGRhfGm5ZkNd7RvlQozj0j//2gAMAwEAAgADAAAAEBASj//EABkRAQADAQEAAAAAAAAAAAAAAAEAETFhof/aAAgBAwEBPxB84wyNXtj5LgpU/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQAREP/aAAgBAgEBPxBBzCSY3//EACAQAQADAAICAgMAAAAAAAAAAAEAESExUUFxYYGRodH/2gAIAQEAAT8QVsAdc/sErcGOJv4gwQbL09QWh8DofqcwEga8V1GnKHy3BNtUHC/dwIQRW9z3zOTBVQrGu7jU2vdc31KCKLaN0T//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;No rules rules: Netflix and the culture of reinvention&quot; title=&quot;&quot; src=&quot;/static/b45968b3d8af71e9df9897f625d879e1/8a553/cover.jpg&quot; srcset=&quot;/static/b45968b3d8af71e9df9897f625d879e1/bc01b/cover.jpg 188w,
/static/b45968b3d8af71e9df9897f625d879e1/8a553/cover.jpg 326w&quot; sizes=&quot;(max-width: 326px) 100vw, 326px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Netflix is a scrappy startup doing some video stuff. Maybe you’ve heard of them. They are famous for their extensive use of &lt;a href=&quot;https://smartbear.com/blog/develop/why-you-cant-talk-about-microservices-without-ment/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;microservices&lt;/a&gt;, &lt;a href=&quot;https://github.com/Netflix/chaosmonkey&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;chaos engineering&lt;/a&gt;, and family-friendly shows like &lt;a href=&quot;https://www.netflix.com/title/80025172&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Narcos&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Anyway! There is a book out talking about their corporate culture in all of its glory. You know how many companies have tribes and squads and all those words popularized by Spotify and think they are totally agile? Then, it turns out that they’re actually not, and regardless, Spotify doesn’t even follow that model anymore. Thanks to books like this, we’ve got a whole new set of cargo culting opportunities.&lt;/p&gt;
&lt;p&gt;After reading about their ethos, I would define Netflix’s culture as &lt;em&gt;compassionate Darwinism&lt;/em&gt;. They are pretty cutthroat, expecting high performance and culling whoever falls behind. On the other hand, they foster feedback, a culture of experimentation, and empower employees to make decisions instead of waiting for orders. You can’t argue with the success, so I’m sure they must be doing something right. How much is that applicable to other situations, though?&lt;/p&gt;
&lt;h2&gt;What this book is not&lt;/h2&gt;
&lt;p&gt;If you’re picking this book up to learn how Netflix develops software, you’re going to be disappointed. There is almost nothing about how their engineering teams are organized, other than mentioning that when somebody got an offer from Google, they gave him a massive raise.&lt;/p&gt;
&lt;p&gt;At least Netflix shares many of its practices in &lt;a href=&quot;https://netflixtechblog.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;its engineering blog&lt;/a&gt;, so there are other venues to find more about what they do.&lt;/p&gt;
&lt;h2&gt;Talent density&lt;/h2&gt;
&lt;p&gt;Netflix has very high expectations for their employees. Doing your job adequately is not good enough. You have to be great at it. You get paid for it accordingly at the top of the market or are let go. It sounds scary. Still, there is a very direct link from performance to compensation. Not sure how such an environment would feel, although it has a certain appeal. Most companies are &lt;em&gt;not&lt;/em&gt; willing to pay top of the market (despite their claims), so I guess it’s a hard one to copy. There is a saying from Reid Hoffman that resonated with me:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We are a team, not family&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I couldn’t agree more. Your colleagues are not family, and that’s fine. I already have a family. Working together effectively requires mutual respect and communication. I have always found the family BS questionable.&lt;/p&gt;
&lt;h2&gt;Candor culture&lt;/h2&gt;
&lt;p&gt;Netflix is committed to exchanging feedback openly and frequently, which many other companies will claim to do even though they avoid feedback like the plague. This is understandable to some extent. Feedback is &lt;strong&gt;hard&lt;/strong&gt;. You need psychological safety to talk about vulnerability without fearing repercussions. You need to ensure that everybody has good intentions. You need to practice it often. Having a feedback board on a wall isn’t going to create this environment.&lt;/p&gt;
&lt;p&gt;I enjoyed the part of adapting to different cultures that have different customs regarding feedback. I didn’t know that the Dutch are so direct.&lt;/p&gt;
&lt;h2&gt;Empower your employees&lt;/h2&gt;
&lt;p&gt;Another very quotable belief refers to the role of managers:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Lead with context, not with control&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Give every member of your organization the context they require to take the appropriate decisions, and then let them &lt;em&gt;actually&lt;/em&gt; do it. Compared to the micromanagement level that you can observe in your day to day, that sounds refreshing.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;Every book about a company or its founder tends to be a bit of a hagiography. Nevertheless, I found this one to be pretty balanced. It paints an interesting picture about Netflix, which has a culture that’s not suited for everyone, yet has put a fair amount of thought into how they do things. You can’t say that about every organization out there.&lt;/p&gt;
&lt;p&gt;It’s a bit of a bummer that there is so little about software development, as that was the part I wanted to hear about the most. Despite that, it’s a worthy read. I gave it ⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Keeping a technical backlog]]></title><description><![CDATA[You are writing high-quality technical stories and including them in every iteration. Find a home for them in your technical backlog]]></description><link>https://hceris.com/keeping-a-technical-backlog/</link><guid isPermaLink="false">https://hceris.com/keeping-a-technical-backlog/</guid><category><![CDATA[Agile]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Leadership]]></category><pubDate>Fri, 04 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Technical Stories&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;Part 1 - Writing technical stories&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../getting-technical-stories-into-an-iteration/&quot;&gt;Part 2 - Getting technical stories into an iteration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../keeping-a-technical-backlog/&quot;&gt;&lt;strong&gt;Part 3 - Keeping a technical backlog&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;After talking about creating &lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;technical stories&lt;/a&gt; and &lt;a href=&quot;../keeping-a-technical-backlog/&quot;&gt;how to get them into an iteration&lt;/a&gt;, the technical backlog remains. We have done most of the work by now, so what’s left is essentially bookkeeping. It’s nevertheless an important topic. If you made it this far, you’re likely willing to spend a fair amount of effort handling technical stories. It’s only fair to give them a proper home.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bc157d6ca7dc35bd198a3265f724db13/eea4a/backlog.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 57.446808510638306%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAwL/2gAMAwEAAhADEAAAARPdjNHkir//xAAZEAACAwEAAAAAAAAAAAAAAAABAgADETL/2gAIAQEAAQUCtUZWBqxwCU7Wf//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/AbxL/8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEQcf/aAAgBAQAGPwKPaz//xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMVFhkf/aAAgBAQABPyGjz1qJo4AtzfOKwmVCGeoD6n//2gAMAwEAAgADAAAAELcf/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARccH/2gAIAQMBAT8QRgddgL//xAAXEQEBAQEAAAAAAAAAAAAAAAABABEh/9oACAECAQE/EDpJ2//EAB0QAQEAAgIDAQAAAAAAAAAAAAERAEEhMVFhkcH/2gAIAQEAAT8Q5HNFIK3eIjsGxJ19wPYAg5mjOcIOFfOOo397wxB3+TP/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;backlog&quot; title=&quot;&quot; src=&quot;/static/bc157d6ca7dc35bd198a3265f724db13/acb04/backlog.jpg&quot; srcset=&quot;/static/bc157d6ca7dc35bd198a3265f724db13/bc01b/backlog.jpg 188w,
/static/bc157d6ca7dc35bd198a3265f724db13/bf173/backlog.jpg 375w,
/static/bc157d6ca7dc35bd198a3265f724db13/acb04/backlog.jpg 750w,
/static/bc157d6ca7dc35bd198a3265f724db13/ec605/backlog.jpg 1125w,
/static/bc157d6ca7dc35bd198a3265f724db13/eea4a/backlog.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Backlog of fresh and relevant stories
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The technical backlog is the place to put all these stories we’ve been carefully writing and refining. We all are busy, so we want to spend the least effort possible while keeping an overview and a priority.&lt;/p&gt;
&lt;h2&gt;Why keep a technical backlog?&lt;/h2&gt;
&lt;p&gt;We aim to address two concerns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Visualization:&lt;/em&gt; How many open technical topics do we have on our plate?&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Prioritization:&lt;/em&gt; If we have the capacity available to work on technical issues, which stories should we pick?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Visualization&lt;/em&gt; is crucial to assess our current situation. For instance, we want to know the size of our backlog. Absolute numbers are often misleading. Are ten stories a lot? What about twenty? That’s why I prefer focusing on &lt;em&gt;trends&lt;/em&gt;. Is our backlog growing, and if so, how rapidly? Are we consciously accumulating tech debt? Or worse, is it happening without us realizing it?&lt;/p&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 593px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/48a8b9e8d6ef91d7f81454dee70d0ffe/0b5b1/tech-backlog-quadrants.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 81.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVR42pXUS08TURQH8P/0Ba08CoUWCpXwkA7PzvzvTAsiQRADKA1qUOMCYtzoShOJG9cmEINhgYpho/IR9AvoyrBzI4mQYFDAEDSGDQmL9poZSlLwEXqSk8nM5P5m7rnnXuBIkDxIN8lWku0kaxOJBAzDsN/lFFmglSdJmqbJQqAHHk83xsejuYFFb4ugXlWRRBK6wRIhqI2ONkNKYGUlHzs7zmMo65ncsK9K2csyJfA6gI7GeImmi35gBAsLIXcqBaTTsPFcQMAakEJUvXkqorWYg9aDrS13MJ2G28IO8p81w699xLHiyFPWlAC+IomfuKP3xEJauzFkDV5dzS/d21MC29suj3U/P1+BaNQ8WvN9sOJJheJacgE78GMTD7GJW324AdN5tvh0t5aUEt50GkEpUSgl/MACxsZUNDUZfwdpEPW36x2reKcUfsivqX5cWdAsAa1Li5DikpQoeTUXCr+YrCx/OhMOPnseDilKjyeR0Asy7VVK8gRJhwX6SdaTIq5RXNNqOob0NmOk+2zsCinGSfEoponBRiM+XG10DrQKIynIy0JQJdlCMkSyh6ROMh+GQUUIujs6ddfMdLV38ZMvtLTsrZIS4Xt36+ti7eJiV42Gjx539ItD6Vpyu4rt9ZDyj+naU1ZVEz7fGczOhpGpUamFSYng9GR1XW0scU4C7jVF6dsELnwH9LlA0F5HQUIIcRgMhToxNRVB5qNIpeDf3XUUS4nyB/frIs0xcwBvlrGqKF3rwNA60PADwGen0wYPYQeR3VtW7u0pZVLC1dZmBAxy+Lqq4r3P510HirPb9b+RDW5seJzAebS2GH4K9jeZpv3rFvQtax8gF7S3NwbT1L0kqxripr15FvPybHQjl8PBwiYm6tDQELfq4iEZyfTasY6u31ky94Ea2CbkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;tech-backlog-quadrants&quot; title=&quot;&quot; src=&quot;/static/48a8b9e8d6ef91d7f81454dee70d0ffe/0b5b1/tech-backlog-quadrants.png&quot; srcset=&quot;/static/48a8b9e8d6ef91d7f81454dee70d0ffe/4dcb9/tech-backlog-quadrants.png 188w,
/static/48a8b9e8d6ef91d7f81454dee70d0ffe/5ff7e/tech-backlog-quadrants.png 375w,
/static/48a8b9e8d6ef91d7f81454dee70d0ffe/0b5b1/tech-backlog-quadrants.png 593w&quot; sizes=&quot;(max-width: 593px) 100vw, 593px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Easy, hard, everything in between
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;We need a place that’s easily accessible, or nobody will bother looking. If you’re already using JIRA, that can be the right place. Maybe you want to use Github to keep these stories closer to the code. It doesn’t matter as long as access is guaranteed for everyone interested. Once the stories get into an iteration, &lt;strong&gt;then&lt;/strong&gt; they will have to be where your product backlog resides. Remember that we don’t want to create first and second class citizens in this process.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Prioritization&lt;/em&gt; is equally important. Let’s face it. There won’t be enough time to work on everything we’d like to. Typically, you see stories being considered based on two factors, effort and impact, which maps nicely to a bidimensional chart.&lt;/p&gt;
&lt;p&gt;Doing the low-effort, high-impact stories is a no brainer. Honestly, it’s almost hard not to do it by mistake. Discarding high-effort, low-impact stories is easy as well. You should avoid creating them in the first place. After that, it gets dicier. How much effort should we invest in ordering technical stories? You’ll be surprised to know that I have an opinion about that as well.&lt;/p&gt;
&lt;h3&gt;Leverage a relative ordering&lt;/h3&gt;
&lt;p&gt;Trying to create objective, precise metrics to rank stories is a laudable goal. If nothing else, you have my respect. Personally, I have never seen it work in practice. A relative ranking seems like a plausible alternative. Assuming we only write stories that we believe are needed and useful (Seriously, why bother if not), we have to order them in a way that makes sense. And by we, I mean the team. Not a very scientific approach, but it tends to work well enough. Some considerations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If somebody is passionate about a story, that can be a sign to put this story in front of others that don’t have as much support. That person is a great candidate to be the &lt;a href=&quot;https://www.thoughtworks.com/de/insights/blog/feature-leading-agile-team&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;feature lead&lt;/a&gt; for it.&lt;/li&gt;
&lt;li&gt;Mix it up. Presumably, different areas of your application will need some love, so it’s advisable not to overinvest in one.&lt;/li&gt;
&lt;li&gt;Whatever you do, don’t fall into the &lt;a href=&quot;https://en.wikipedia.org/wiki/Sunk_cost#Fallacy_effect&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sunk cost fallacy&lt;/a&gt;. Don’t keep investing your valuable time just because you already invested too much.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Avoid ridiculous metrics&lt;/h3&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 170px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4a904742c98115f94b95bd229117700b/651be/tulip.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 154.7058823529412%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAfABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAdeavOnTQHAObxpWKD//xAAdEAACAgIDAQAAAAAAAAAAAAABAgADERIQEyFD/9oACAEBAAEFAmYLHu1sHoddl6WN0ziE8/af/8QAFhEAAwAAAAAAAAAAAAAAAAAAAREg/9oACAEDAQE/AQo//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgEEAwAAAAAAAAAAAAAAABEBEBIgQSExYf/aAAgBAQAGPwKHstRzCEeZLXdP/8QAHBAAAwACAwEAAAAAAAAAAAAAAAERITFBUYGR/9oACAEBAAE/IW6PKiE7CbLpd0Jc3j6HpFgq3wMcK9EXVmxL6PZTxFs//9oADAMBAAIAAwAAABCEJbz/xAAWEQEBAQAAAAAAAAAAAAAAAAAQAVH/2gAIAQMBAT8Q2Kf/xAAXEQEBAQEAAAAAAAAAAAAAAAABABAR/9oACAECAQE/EEzst//EAB4QAAICAgIDAAAAAAAAAAAAAAERACExUUFhwdHh/9oACAEBAAE/EMmpCp96i2AEw35iIQ+zUozd8hbhcS0JI0wRy69zKCYJkSeIB4CrLBZQ9pYQsCNhAAdfYRz/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;tulip&quot; title=&quot;&quot; src=&quot;/static/4a904742c98115f94b95bd229117700b/651be/tulip.jpg&quot; srcset=&quot;/static/4a904742c98115f94b95bd229117700b/651be/tulip.jpg 170w&quot; sizes=&quot;(max-width: 170px) 100vw, 170px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  By comparison, buying tulips seems like a better deal
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;As I mentioned in my first article, we should quantify the value that any technical story provides. Unless your organization is very data-driven, you might not be in the position to provide accurate numbers, and that’s ok. Making up shit isn’t going to help anybody.&lt;/p&gt;
&lt;p&gt;In a previous job, we had to assign a monetary value to every story shown in the sprint review. A developer would come and claim that &lt;em&gt;feature X&lt;/em&gt; was worth 30k EUR. Based on what? On nothing, really. Those numbers were pulled straight out of somebody’s ass. Nobody believed for a second that any of these numbers were remotely true. Nonetheless, management wanted it, so we kept doing it. This was &lt;em&gt;absurd&lt;/em&gt;. If you don’t have precise numbers, use the best approximation that you can get.&lt;/p&gt;
&lt;h2&gt;The size of a technical backlog&lt;/h2&gt;
&lt;p&gt;Is there an expected size of such a backlog? Not if you ask me! It feels that it should be noticeably smaller than the regular backlog. Say, 10% or so. If your technical backlog is as big as the product backlog, you’re not really working on a product, are you?&lt;/p&gt;
&lt;p&gt;Anyways, I already said that keeping an endless amount of stories doesn’t bring anything unless you measure progress by the number of stories created. That might be a sign that you should spend less time on stories and more time polishing your resume.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I’ve written around 3k words in total, just about technical stories. Did we get anywhere? I think so! Technical stories are not the solution to every problem in agile. They require dedication and are only worth it if you actually follow through and implement them. Once you get there, they help to have better and more transparent conversations. More facts and fewer opinions.&lt;/p&gt;
&lt;p&gt;The difference in effort between having crappy technical stories and good ones is not very high. If you’re going to do it, you might as well get some value out of it.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Provisioning a Network Load Balancer with Terraform]]></title><description><![CDATA[Learn how to provision Network Load Balancers in AWS using Terraform to ensure high availability for your applications]]></description><link>https://hceris.com/provisioning-a-network-load-balancer-with-terraform/</link><guid isPermaLink="false">https://hceris.com/provisioning-a-network-load-balancer-with-terraform/</guid><category><![CDATA[AWS]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[Load Balancing]]></category><category><![CDATA[Networking]]></category><category><![CDATA[Infrastructure as Code]]></category><pubDate>Tue, 17 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e9e42d18a599da2296397c7c01a01c39/0f98f/lb.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdAuKHZqv//EABwQAAIBBQEAAAAAAAAAAAAAAAECAwQREhMhMf/aAAgBAQABBQIHm1SxxuPOIZ6l1k//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAdEAACAgEFAAAAAAAAAAAAAAAAAQIRAxASMTKB/9oACAEBAAY/AuhtcX4zjJoqRUT/xAAbEAADAAIDAAAAAAAAAAAAAAAAAREhUWGxwf/aAAgBAQABPyGOVPhT0i0t0hLoJDiodwzuSSP/2gAMAwEAAgADAAAAEHcP/8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQMBAT8QV//EABcRAQADAAAAAAAAAAAAAAAAAAABITH/2gAIAQIBAT8QjVP/xAAaEAEBAQEBAQEAAAAAAAAAAAABEQAhMbFx/9oACAEBAAE/EEvA/ZiwdXj+WMhBKWn3L67kMAgK9O3DI89LWXf/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;lb&quot; title=&quot;&quot; src=&quot;/static/e9e42d18a599da2296397c7c01a01c39/acb04/lb.jpg&quot; srcset=&quot;/static/e9e42d18a599da2296397c7c01a01c39/bc01b/lb.jpg 188w,
/static/e9e42d18a599da2296397c7c01a01c39/bf173/lb.jpg 375w,
/static/e9e42d18a599da2296397c7c01a01c39/acb04/lb.jpg 750w,
/static/e9e42d18a599da2296397c7c01a01c39/ec605/lb.jpg 1125w,
/static/e9e42d18a599da2296397c7c01a01c39/c58a3/lb.jpg 1500w,
/static/e9e42d18a599da2296397c7c01a01c39/0f98f/lb.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Are you using some form of load balancing in your application? Don’t answer. It’s a rhetorical question. &lt;em&gt;You bet I am&lt;/em&gt;, you scream defiantly. How else am I going to ensure that traffic is evenly distributed?&lt;/p&gt;
&lt;p&gt;Load Balancers come in all shapes and sizes. In the past, it used to be a concern for the operations folks. As an application developer, you could spend years without having to think about them. That’s not always the case in the cloud. Luckily, AWS makes it &lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;easy&lt;/a&gt; for us to create such resources. More so if you use &lt;a href=&quot;https://www.hashicorp.com/resources/what-is-infrastructure-as-code&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Infrastructure as Code&lt;/a&gt; (which I’m sure you are). I’m going to use &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; in this article to provision &lt;em&gt;Network Load Balancer&lt;/em&gt; instances.&lt;/p&gt;
&lt;h2&gt;It’s AWS. Of course, there are multiple competing options&lt;/h2&gt;
&lt;p&gt;There are three different types of load balancers in AWS.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Classic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Network Load Balancer (NLB)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Application Load Balancer (ALB)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Classic load balancers are becoming a relic of the past. Usually, your choice is between an &lt;em&gt;NLB&lt;/em&gt; (Layer 4) and an &lt;em&gt;ALB&lt;/em&gt; (Layer 7). If you are worried about &lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/features/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the number of features&lt;/a&gt;, they got you covered. All three are managed infrastructure. AWS handles the availability and scaling transparently for you.&lt;/p&gt;
&lt;p&gt;Let’s talk about NLBs. Being a Layer 4 means that you don’t know about the application protocol used. Even so, most of your load balancing needs in life can be covered with an NLB. Unless you want routing based on an HTTP path, for instance. In that case, you need an ALB, which I’ll cover in a future post.&lt;/p&gt;
&lt;h2&gt;Setting up a basic load balancer&lt;/h2&gt;
&lt;p&gt;Setting up a load balancer requires provisioning three types of resources.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;strong&gt;load balancer&lt;/strong&gt; itself&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;listeners&lt;/strong&gt; that will forward the traffic&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;target groups&lt;/strong&gt; that ensure that the traffic reaches its destination&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The most typical setup is a Virtual Private Cloud (VPC) with a public and a private subnet. The load balancer goes in the public subnet. The instances live in the private subnet. To protect ourselves against outages, we deploy everything to multiple Availability Zones (AZ).&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 658px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/2bf09a3aa6fb0b71a30d1092cc4cfc04/889a4/diagram.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 98.93617021276596%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlklEQVR42o2U32scVRTH80eI4KtYBSmU4s83QXzLg+JDH1rqj6AFpQpKxYrVEm3FUjUpbR40poVKq02hgWpQjDFpUmvSpJvGbNJkN5k0uzM7uzOT2fmxM5uZnZmP7OwvlE3phS/3zJ1zP9xzzz2ngzYjiqL7Wms3Orbb6FgBKzdLrM6UKeaD+4Z2NJyqc1VhUPteuF7kq9dT9L+XY+KiHa+FYdT0a6fmCVuLNIGzowpH9yQ4c3CN3wbUFrDq304N4H/DiIjCMLZyQolzx5L88MUySzes2t+wvj1qozq0CcwXbfKWh+YGqE6Foh+ibW2huC5GEKI6PorjxaraWjmIfRuzH4StkKuhyG4FyQvJ+SGiG3FX11mR0qwW1pFtBdlU2XRMdMekYJtk7ArZUhgrUwoo+0EdGMWBktV8lta2WF7zyBgRoq6TTmVIr4jIikze2mBevEki+xdpJUXOCZGcIJZYBVbqwEYSfj6f4/M9KXr2S9ya8pieLnCkc5HeLpEbgzbjG8M80fMoT57awcGhA1gVyNh+C+j/D/hTn8BHnQlOHxCYnnS4NiZx6IVZvu5aY2RA53dhiGdO7eT5b5/izcuv3QMY1oC/DmX57I05+j5IMzfvkpiX+WTfBCffusXfwzKJ/CT7L77M3gudfHPtBLq3DbCWlBDVC5G96iV7ZEsBWaPISiZJUlhAKorkDQXFUFFNBdU26smIyNhhrOYdximJQDQsklKBO7KKXLLJWQZZ2yVrO0i2iWRuIjoud00LqVR9YjrmloHtGWiOgetXGlmOqL4gRV5GTlxAWRhEK9xG1VLkEz+iLlxmU55F1QUK84MU/hlEF6+TNWR+WVhmMHGHyVUBv9IAhkEMzI32kfv4IYyex9FnzpCbu4J0+AGM3l0Ux48iL40gHn4QvXc35eEuxjIqO47/wcPHx3jp7BRhGMQlGAOrhjjST7b7WQrdj6COf4l0e5iNI7vJdz+GMnwIKTnCxqdPIx/bhXVpL6MZjZ0n/uS5vilePDtFEDRDDuMTSskJUgNvs9a/j/ziVfIbCYRz77A+8ArK/CUKuUWE8+8jfP8qm9PfsagpfHh1hnevzHJ6YpFKE1gvasuvoJS3UMoVDM9HsUzWNR1BK5IzTKRNjWzRRFB1JMPCdCw838HzS7ie06rlZrdpdp3a7HsetmnilGzKrovruLilErZl4jpOrZ1FNbUQUevZtGuW9xrbNdh/AUBQt4qUAQbWAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;diagram&quot; title=&quot;&quot; src=&quot;/static/2bf09a3aa6fb0b71a30d1092cc4cfc04/889a4/diagram.png&quot; srcset=&quot;/static/2bf09a3aa6fb0b71a30d1092cc4cfc04/4dcb9/diagram.png 188w,
/static/2bf09a3aa6fb0b71a30d1092cc4cfc04/5ff7e/diagram.png 375w,
/static/2bf09a3aa6fb0b71a30d1092cc4cfc04/889a4/diagram.png 658w&quot; sizes=&quot;(max-width: 658px) 100vw, 658px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Assuming that we have an existing VPC (identified by &lt;code class=&quot;language-text&quot;&gt;vpc_id&lt;/code&gt;), this snippet creates the load balancer.&lt;/p&gt;
&lt;!-- lb --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_subnet_ids&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id

  &lt;span class=&quot;token property&quot;&gt;tags&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;Tier&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Public&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;               &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;basic-load-balancer&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;load_balancer_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;network&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;subnets&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_subnet_ids.this.ids

  &lt;span class=&quot;token property&quot;&gt;enable_cross_zone_load_balancing&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;aws_lb&lt;/code&gt; resource is confusing because it represents both NLBs and ALBs, depending on the &lt;code class=&quot;language-text&quot;&gt;load_balancer_type&lt;/code&gt; argument. Some arguments only apply to one type, so you’ve got to read the documentation carefully.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;enable_cross_zone_load_balancing&lt;/code&gt; is an &lt;a href=&quot;https://aws.amazon.com/about-aws/whats-new/2018/02/network-load-balancer-now-supports-cross-zone-load-balancing/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;interesting parameter&lt;/a&gt;. It’ll help prevent downtimes by sending traffic to other AZs in case of problems. Cross-AZ traffic ain’t free, so make that an exception!&lt;/p&gt;
&lt;h3&gt;Listeners&lt;/h3&gt;
&lt;p&gt;Our load balancer is not being a &lt;em&gt;good listener&lt;/em&gt; right now. We’ve got to fix that. Through the &lt;code class=&quot;language-text&quot;&gt;aws_lb_listener&lt;/code&gt; resource, we specify the ports we want to handle and what to do with them. We want to listen to both port 80 and 443, so we’ll set up two different resources using &lt;code class=&quot;language-text&quot;&gt;for_each&lt;/code&gt;. Let’s have a look at the code.&lt;/p&gt;
&lt;!-- listener --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;variable&lt;span class=&quot;token type variable&quot;&gt; &quot;ports&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; map(number)
  &lt;span class=&quot;token property&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;http&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;https&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_listener&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;load_balancer_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb.this.arn

  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value

  &lt;span class=&quot;token keyword&quot;&gt;default_action&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;             &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;forward&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;target_group_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.this&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;each.key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.arn
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see the ports defined in the &lt;code class=&quot;language-text&quot;&gt;ports&lt;/code&gt; variable. Next is the &lt;code class=&quot;language-text&quot;&gt;protocol&lt;/code&gt;. If we only want to forward the request, we use TCP or UDP. We can also choose to &lt;a href=&quot;https://aws.amazon.com/about-aws/whats-new/2019/01/network-load-balancer-now-supports-tls-termination/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;terminate the TLS connection&lt;/a&gt; by using TLS as a protocol. For that, we’d need to set up a certificate, though.&lt;/p&gt;
&lt;p&gt;After port and protocol are there, we need the action to perform. The most common action is to forward it to our receiver target group. Additionally, we can do redirects, fixed results, or even authentication. By the way, I showed how to do authentication in &lt;a href=&quot;../concourse-fly-behind-alb-oidc/&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Target Groups&lt;/h3&gt;
&lt;p&gt;The last step is defining the target group(s) so that the load balancer knows who will receive the requests. We do that with the &lt;code class=&quot;language-text&quot;&gt;aws_lb_target_group&lt;/code&gt; resource. Here we branch again, as there are different possibilities.&lt;/p&gt;
&lt;h4&gt;Instance-based&lt;/h4&gt;
&lt;p&gt;The target group can point to specific instances. That’s the default &lt;code class=&quot;language-text&quot;&gt;target_type&lt;/code&gt;. You don’t want to explicitly specify instances (What if they go down?), but rather create an &lt;a href=&quot;https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroup.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Autoscaling Group (ASG)&lt;/a&gt;. We assume an existing ASG in the code.&lt;/p&gt;
&lt;!-- target-group-instance --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_target_group&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id

  &lt;span class=&quot;token property&quot;&gt;stickiness&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    aws_lb.this
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_autoscaling_attachment&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;target&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;autoscaling_group_name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.autoscaling_group_name
  &lt;span class=&quot;token property&quot;&gt;alb_target_group_arn&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.this&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;each.value&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.arn
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We add a &lt;code class=&quot;language-text&quot;&gt;depends_on&lt;/code&gt; block containing the lb resource so that the dependencies are properly modeled. Otherwise, destroying the resource might not work correctly.&lt;/p&gt;
&lt;h4&gt;IP-based&lt;/h4&gt;
&lt;p&gt;We use the &lt;code class=&quot;language-text&quot;&gt;target_type&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;ip&lt;/code&gt; when using IPs instead of instance ids. We assume that these IPs are available and readable through a &lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt; resource. They are connected to the target group through a &lt;code class=&quot;language-text&quot;&gt;aws_lb_target_group_attachment&lt;/code&gt;.&lt;/p&gt;
&lt;!-- target-group-ip --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_target_group&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token property&quot;&gt;target_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ip&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;depends_on&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    aws_lb.this
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;lifecycle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;create_before_destroy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_target_group_attachment&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.ports_ips_product

  &lt;span class=&quot;token property&quot;&gt;target_group_arn&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_lb_target_group.this&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;each.value.port&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.arn
  &lt;span class=&quot;token property&quot;&gt;target_id&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value.ip
  &lt;span class=&quot;token property&quot;&gt;availability_zone&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;all&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;locals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;ports_ips_product&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; flatten(
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      for port in values(var.ports): &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        for eni in keys(data.aws_network_interface.this): &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; port
          &lt;span class=&quot;token property&quot;&gt;ip&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_network_interface.this&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;eni&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.private_ip
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  )
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_network_interfaces&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;description&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ENI for target&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_network_interface&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; toset(data.aws_network_interfaces.this.ids)
  &lt;span class=&quot;token property&quot;&gt;id&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.key
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The connections to the &lt;a href=&quot;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ENIs&lt;/a&gt; are expressed as a list of [port, ip] pairs. That requires some ungainly terraform loops to define everything properly.&lt;/p&gt;
&lt;p&gt;These are two typical examples, but it’s not the only way of doing it. &lt;a href=&quot;https://aws.amazon.com/ecs/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ECS&lt;/a&gt; supports adding target groups to reach services directly. If you are working with &lt;a href=&quot;https://aws.amazon.com/lambda/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Lambda&lt;/a&gt;, that needs an ALB.&lt;/p&gt;
&lt;p&gt;I’ve left a bunch of details out to avoid writing a 10k words article. You can customize the health check (&lt;code class=&quot;language-text&quot;&gt;health_check&lt;/code&gt;) associated with each target group, the algorithm used (&lt;code class=&quot;language-text&quot;&gt;load_balancing_algorithm_type&lt;/code&gt;), and a host of other things. The flexibility can be overwhelming. I recommend starting small.&lt;/p&gt;
&lt;h3&gt;Security Groups&lt;/h3&gt;
&lt;p&gt;Oh yes, security groups. Every so often, running &lt;code class=&quot;language-text&quot;&gt;curl&lt;/code&gt; against your shiny, new infrastructure results in timeouts. Inevitably, you forgot the &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;security groups&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Network load balancers don’t have associated security groups per se. For both instance and IP based target groups, you add a rule that allows traffic from the load balancer to the target IP.&lt;/p&gt;
&lt;!-- security-groups --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_security_group&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow connection between NLB and target&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_security_group_rule&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ingress&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;for_each&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.ports

  &lt;span class=&quot;token property&quot;&gt;security_group_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_security_group.this.id
  &lt;span class=&quot;token property&quot;&gt;from_port&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value
  &lt;span class=&quot;token property&quot;&gt;to_port&lt;/span&gt;           &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; each.value
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ingress&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;cidr_blocks&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;0.0.0.0/0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Getting to our load balancer&lt;/h2&gt;
&lt;p&gt;That’s about it. With all these resources, we’ve got ourselves a working load balancer!&lt;/p&gt;
&lt;p&gt;All load balancers are reachable through their automatically assigned DNS entry. We can programmatically find it thanks to the &lt;a href=&quot;https://aws.amazon.com/cli/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS CLI&lt;/a&gt;.&lt;/p&gt;
&lt;!-- curl --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;LB_NAME&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;basic-load-balancer&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;dns&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;aws elb describe-load-balancers --load-balancer-name $LB_NAME &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq &lt;span class=&quot;token parameter variable&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.LoadBalancerDescriptions[0].DNSName&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;nslookup&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$dns&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Provided there is a registered target, we can query it using the content of &lt;code class=&quot;language-text&quot;&gt;dns&lt;/code&gt; and see that our setup, in fact, works.&lt;/p&gt;
&lt;h3&gt;Internal Load Balancers&lt;/h3&gt;
&lt;p&gt;A load balancer doesn’t always have to be publicly available. Let’s say you use &lt;a href=&quot;../understanding-vpc-endpoints/&quot;&gt;VPC endpoints&lt;/a&gt; to keep your traffic inside AWS’s network. We don’t want to expose our load balancer to the public if it’s going to sit behind a VPC endpoint service. Instead, you set the &lt;code class=&quot;language-text&quot;&gt;internal&lt;/code&gt; parameter to &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;. The LB can live in a private subnet.&lt;/p&gt;
&lt;h2&gt;Operations&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Operations&lt;/strong&gt; is a bit of a strong word. There is not &lt;em&gt;a lot&lt;/em&gt; to operate here. Not for us, at least. Still, let’s finish with some thoughts about that.&lt;/p&gt;
&lt;p&gt;Out of the box, a lot of &lt;a href=&quot;https://aws.amazon.com/cloudwatch/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CloudWatch&lt;/a&gt; metrics are exported for your convenience. The AWS Console has some nice charts to look at. You could use another monitoring tool if you wish.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 675px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7396067b737b68e4721294892ceb034e/23296/monitoring.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 28.723404255319153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7ElEQVR42oWPQUoEMRBF+/4ncukF3LhxJS5EHGV6pns6qUqlKnnSYUBFxQ8fEkhe1ZvmZWNNhWiQRXifF9akiAWqhWVdWdYLWgz3IKWEiFBrpbWGSMatAJ090+3DkZv7A3dPZ4oZHoFHGzUzshqpOKlUqjvuTuudiDaASzaeZ+HxbeOUjGnfohTDrhPNCl4rEUHvfZzdK+E+7qKFlJUkSrQ2bI5L5rhmpDhTUaGFj3VVdSjuetH6AHwr/2d6OWVez8JxK6gI65ZJWslah9rXfML5Oeza6XDaeDsn5ovsr6hm1GpDs1+Bf33+DfgBi8TVey7QltwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;monitoring&quot; title=&quot;&quot; src=&quot;/static/7396067b737b68e4721294892ceb034e/23296/monitoring.png&quot; srcset=&quot;/static/7396067b737b68e4721294892ceb034e/4dcb9/monitoring.png 188w,
/static/7396067b737b68e4721294892ceb034e/5ff7e/monitoring.png 375w,
/static/7396067b737b68e4721294892ceb034e/23296/monitoring.png 675w&quot; sizes=&quot;(max-width: 675px) 100vw, 675px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Pretty lines make everything better
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;What about costs? As you can see on the &lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/pricing/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pricing page&lt;/a&gt;, an NLB has a fixed price, plus a fairly arcane operating cost based on &lt;em&gt;Load Balancer Capacity Units (LCU)&lt;/em&gt;. Honestly, the easiest way to monitor expenditures is by looking at previous months in the Cost Explorer.&lt;/p&gt;
&lt;p&gt;Lastly, performance. An NLB &lt;em&gt;scales&lt;/em&gt; like there is no tomorrow. Each unique target IP can support 55000 simultaneous connections, and the whole thing should be merrily passing along requests long after your applications have collapsed into a smoking pile of ashes. The word &lt;em&gt;managed&lt;/em&gt; is genuinely appropriate because you’ll rarely have to do anything past the provisioning.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Load balancers are an integral part of every cloud setup. It’s a vast topic as well, and thus I could only scratch the surface. However, this is enough to get started with a rock-solid foundation.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Working effectively with legacy code]]></title><description><![CDATA[Working effectively with legacy code is an excellent resource when dealing with hairy, messy pieces of legacy code that nobody wants to touch]]></description><link>https://hceris.com/book-review-working-effectively-with-legacy-code/</link><guid isPermaLink="false">https://hceris.com/book-review-working-effectively-with-legacy-code/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[Practices]]></category><pubDate>Thu, 12 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 182px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ff13a32e4413493f43271e7391550c56/5fc5d/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.86813186813185%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgMABP/EABcBAQEBAQAAAAAAAAAAAAAAAAIDAAH/2gAMAwEAAhADEAAAAZqClWehkRbkSAw3d//EAB0QAAICAQUAAAAAAAAAAAAAAAECAAMSEBETITL/2gAIAQEAAQUC4gIKxGrG4uLzJobu0JxLR/S6/wD/xAAYEQACAwAAAAAAAAAAAAAAAAAAAQIQIv/aAAgBAwEBPwFuJm//xAAYEQACAwAAAAAAAAAAAAAAAAAAAhARIv/aAAgBAgEBPwGmNT//xAAcEAACAgIDAAAAAAAAAAAAAAAAEQEhEDIgMZH/2gAIAQEABj8CSgaRuVBrjuCp94//xAAdEAADAAICAwAAAAAAAAAAAAAAASERQTFxUWGB/9oACAEBAAE/IWhRTQPCnKVuZNqYOsU9iKYSvZTCk/oz5NOaHjE3aPln/9oADAMBAAIAAwAAABAH4Yz/xAAXEQADAQAAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EGDK/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAEREEH/2gAIAQIBAT8QXQojz//EAB8QAQADAQACAgMAAAAAAAAAAAEAESExQVFhgXGx4f/aAAgBAQABPxBbdALvv1AoGgUEO+b+peqq2io+ruNPbFMM/cDaDxdI3CVTVdIfFVw633YCRBu1Tr8X/GaL+m88iFCmk8w77m/zT//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Working effectively with legacy code&quot; title=&quot;&quot; src=&quot;/static/ff13a32e4413493f43271e7391550c56/5fc5d/cover.jpg&quot; srcset=&quot;/static/ff13a32e4413493f43271e7391550c56/5fc5d/cover.jpg 182w&quot; sizes=&quot;(max-width: 182px) 100vw, 182px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Do you wake up in the morning and tell yourself, “man, I would love to work on some legacy code today”? I guess you don’t. We need to talk if you do.&lt;/p&gt;
&lt;p&gt;But anyway, whether you like it or not, you probably &lt;strong&gt;will&lt;/strong&gt; work on legacy code more often than you’d like to. That’s where this book comes in. If you have read &lt;a href=&quot;https://martinfowler.com/books/refactoring.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Refactoring&lt;/a&gt;, the structure will ring familiar. A collection of patterns to handle different aspects of working in a legacy system. I read it in one go, but it’s probably a book that works best as a reference that you revisit whenever you’re facing a concrete issue.&lt;/p&gt;
&lt;h2&gt;A collection of patterns&lt;/h2&gt;
&lt;p&gt;There are plenty of patterns to choose from. Some examples include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Interception Points&lt;/li&gt;
&lt;li&gt;Delete Unused Code&lt;/li&gt;
&lt;li&gt;Adding New Behavior&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each pattern describes a problem, proposes a way of handling it, and has sample code to visualize it better. That part is crucial. Actionable advice based on real-life experience with examples make the scenarios a lot easier to digest.&lt;/p&gt;
&lt;p&gt;An interesting point is that some language features that we normally appreciate can hinder when dealing with legacy code. If a class is entirely untestable, overriding some parts through subclassing might enable you to write some tests. But if the constructor is private, then you are out of luck.&lt;/p&gt;
&lt;h2&gt;A shared vocabulary&lt;/h2&gt;
&lt;p&gt;I’m a big believer in having a shared vocabulary inside a team. If we use different words whenever we talk about the same thing, a lot of effort is spent understanding each other. Referring back to the way concepts are named in the book is something I’d like to try at some point to see if it helps or not.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;Having a strategy in place to handle code that is, to put it nicely, &lt;em&gt;problematic&lt;/em&gt; will be crucial at some point in your career. How do you start testing a monstrosity with dozens of methods and dependencies that you inherited? TDD won’t help here.&lt;/p&gt;
&lt;p&gt;That’s why I liked this book, as it covers an area of development that isn’t sexy. You can almost feel the pain that led to some of the techniques to add test harnesses or bring structure in a code grown without a plan. It gets ⭐⭐⭐⭐ stars from me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Getting technical stories into an iteration]]></title><description><![CDATA[Writing technical stories is only the first step. Integrating them in an iteration is where progress happens. Don't avoid this discussion]]></description><link>https://hceris.com/getting-technical-stories-into-an-iteration/</link><guid isPermaLink="false">https://hceris.com/getting-technical-stories-into-an-iteration/</guid><category><![CDATA[Agile]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Leadership]]></category><pubDate>Thu, 05 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Technical Stories&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;Part 1 - Writing technical stories&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../getting-technical-stories-into-an-iteration/&quot;&gt;&lt;strong&gt;Part 2 - Getting technical stories into an iteration&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../keeping-a-technical-backlog/&quot;&gt;Part 3 - Keeping a technical backlog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f5817265350682aaa60742596c7e4f92/0f98f/iteration.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 76.06382978723406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHhQsZg/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQERIh/9oACAEBAAEFAqRyE6NuP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAACAx/9oACAEBAAY/Aqv/xAAcEAADAAEFAAAAAAAAAAAAAAAAARFREDFBYZH/2gAIAQEAAT8hUVeBMmPobgJG080//9oADAMBAAIAAwAAABCDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAgMBAAAAAAAAAAAAAAERADEhYYFR/9oACAEBAAE/ELhy0ga51jVBfMi7TvAIHouNrt6YtV+5/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Iteration&quot; title=&quot;&quot; src=&quot;/static/f5817265350682aaa60742596c7e4f92/acb04/iteration.jpg&quot; srcset=&quot;/static/f5817265350682aaa60742596c7e4f92/bc01b/iteration.jpg 188w,
/static/f5817265350682aaa60742596c7e4f92/bf173/iteration.jpg 375w,
/static/f5817265350682aaa60742596c7e4f92/acb04/iteration.jpg 750w,
/static/f5817265350682aaa60742596c7e4f92/ec605/iteration.jpg 1125w,
/static/f5817265350682aaa60742596c7e4f92/c58a3/iteration.jpg 1500w,
/static/f5817265350682aaa60742596c7e4f92/0f98f/iteration.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;As I recently wrote, I believe &lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;technical stories&lt;/a&gt; &lt;strong&gt;have&lt;/strong&gt; a place in a healthy agile workflow, as long as we use them judiciously.&lt;/p&gt;
&lt;p&gt;I left a question in that article unanswered: How do you get such stories into an iteration? An iteration can be fixed, like a two-week sprint or something more free-flowing like Kanban. In any case, the &lt;em&gt;Product Owner&lt;/em&gt; is typically the backlog’s gatekeeper, which naturally leads to user stories having priority over technical ones. We have to live with that.&lt;/p&gt;
&lt;p&gt;Trying to get important stories in play to see them deprioritized is very demotivating. Even more so if that happens again and again. The sarcasm level might increase. &lt;a href=&quot;https://dilbert.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Dilbert&lt;/a&gt; comics might appear on the walls. Let’s see what we can do about it.&lt;/p&gt;
&lt;h2&gt;The bottomless pit of despair&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3773739e04c8fee5da4fa051d529f80e/c08c5/bottom.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAwT/2gAMAwEAAhADEAAAAVN5O3x0kgV//8QAGRAAAwEBAQAAAAAAAAAAAAAAAAECEhET/9oACAEBAAEFAoldqUODbPRmmf/EABcRAAMBAAAAAAAAAAAAAAAAAAACEhP/2gAIAQMBAT8BzYhj/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREv/aAAgBAgEBPwHSKj//xAAYEAACAwAAAAAAAAAAAAAAAAAAASAhMv/aAAgBAQAGPwK2aj//xAAbEAEBAAIDAQAAAAAAAAAAAAABABFhITFBcf/aAAgBAQABPyHBMLPX2DPCQR3bLdf/2gAMAwEAAgADAAAAEI//AP/EABcRAQEBAQAAAAAAAAAAAAAAAAEAMVH/2gAIAQMBAT8Qcxjpf//EABYRAQEBAAAAAAAAAAAAAAAAAAABYf/aAAgBAgEBPxCnJ//EABsQAQACAgMAAAAAAAAAAAAAAAEAETFBUWFx/9oACAEBAAE/ENQHCyziVYEM6Z6zME7ZFm4//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Bottom&quot; title=&quot;&quot; src=&quot;/static/3773739e04c8fee5da4fa051d529f80e/c08c5/bottom.jpg&quot; srcset=&quot;/static/3773739e04c8fee5da4fa051d529f80e/bc01b/bottom.jpg 188w,
/static/3773739e04c8fee5da4fa051d529f80e/bf173/bottom.jpg 375w,
/static/3773739e04c8fee5da4fa051d529f80e/c08c5/bottom.jpg 640w&quot; sizes=&quot;(max-width: 640px) 100vw, 640px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  I&apos;m sure the ticket to fix that old bug is somewhere here
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Much like rocks, technical stories are dense and tend to sink to the bottom of the backlog. They will remain there, forever, unless you fish them up like a treasure hunter. Many backlogs are living museums of ideas that are long obsolete.&lt;/p&gt;
&lt;p&gt;Writing a story is the beginning of the journey. Don’t think your work is done after this! Until implemented, it’s just the illusion of progress. Our goal is to make sure that we regularly pick some of these stories alongside user stories and work on both. If that’s not happening, adding more stuff to the pile won’t help anybody.&lt;/p&gt;
&lt;h2&gt;No process will survive the lack of trust&lt;/h2&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/09254baac75690b88ba64938586a6ded/c08c5/trust.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAP/2gAMAwEAAhADEAAAAepwzk2EF//EABkQAAIDAQAAAAAAAAAAAAAAAAABAhASEf/aAAgBAQABBQLZoc30df/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAEEAwAAAAAAAAAAAAAAAAABAhAxITKx/9oACAEBAAY/AtUKaY4XP//EABsQAQEBAAIDAAAAAAAAAAAAAAERABAxUXGh/9oACAEBAAE/IYF+3C6hDI+WNgKetd//2gAMAwEAAgADAAAAEJc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qqv/EABsQAQEAAgMBAAAAAAAAAAAAAAERACExYdGR/9oACAEBAAE/EEEiJyrvvBGwGmyuvcenoKcG5f55kEBbVMHDP//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;trust&quot; title=&quot;&quot; src=&quot;/static/09254baac75690b88ba64938586a6ded/c08c5/trust.jpg&quot; srcset=&quot;/static/09254baac75690b88ba64938586a6ded/bc01b/trust.jpg 188w,
/static/09254baac75690b88ba64938586a6ded/bf173/trust.jpg 375w,
/static/09254baac75690b88ba64938586a6ded/c08c5/trust.jpg 640w&quot; sizes=&quot;(max-width: 640px) 100vw, 640px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Emerging trust-based relationship
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve been in many teams and worked with many different Product Owners. For some reason, negotiating the amount of bandwidth for technical work (or &lt;a href=&quot;https://martinfowler.com/bliki/TechnicalDebt.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;technical debt&lt;/a&gt;) is a classical friction source. There is something about wanting to upgrade to &lt;a href=&quot;https://rubyonrails.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Rails’s&lt;/a&gt; latest version that brings out the darkest resentments of an otherwise functional team.&lt;/p&gt;
&lt;p&gt;All those fruitless confrontations throughout the years have taught me that &lt;em&gt;trust&lt;/em&gt; is an indispensable ingredient in this negotiation. I mean, trust is crucial in general. But in this case, you have some deeply technical topics that need to be merged into a very business-y roadmap (the backlog). If both sides mistrust each other, it’s bound to go poorly. No process will survive this.&lt;/p&gt;
&lt;p&gt;As a Tech Lead, I often engage in these discussions. I have to admit that I’ve failed to build this bridge more than once. In one team I was part of, the Product Owner didn’t believe in technical work, to begin with, but the lack of trust between him and me made it worse. It created a very adversarial relationship. I learned that focusing on &lt;em&gt;winning&lt;/em&gt; a discussion can be damaging.&lt;/p&gt;
&lt;p&gt;What to do, then? Hard to say! I could recommend something standard, like having &lt;em&gt;empathy&lt;/em&gt; or being &lt;em&gt;transparent&lt;/em&gt;. But you know that already.&lt;/p&gt;
&lt;h3&gt;A conversation starter&lt;/h3&gt;
&lt;p&gt;Finally, having invested all that time in creating &lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;sound stories&lt;/a&gt; starts to pay off. A story that provides clear context, has tangible value, and is clear about scope is &lt;strong&gt;much&lt;/strong&gt; easier to sell than a poorly written one-liner. If your organization doesn’t value this type of work at all, this conversation might not get started at all. I’d recommend spending extra time surfacing the value that a particular story creates, seeking to collect clear data where possible.&lt;/p&gt;
&lt;h3&gt;Negotiate in good faith&lt;/h3&gt;
&lt;p&gt;The capacity of a team is a precious resource. It’s tempting to exaggerate the severity of a problem so that we get a bit more time to work on it. Hiding behind impenetrable tech jargon to prevent questions that we don’t have answers for might work once, but it’s not a long term strategy. We want to present stories that are clear on its purpose and give a picture of the value that we want to achieve. We want to have an honest conversation. That includes skipping work that we believe is important if there is no space for it at this moment. Only then we’ll gain the credibility to do so repeatedly over time.&lt;/p&gt;
&lt;h3&gt;Don’t be a pushover&lt;/h3&gt;
&lt;p&gt;Conversely, negotiation doesn’t mean capitulation. Some teams opt to avoid the confrontation, not pushing for any technical story unless the Product Owner brings it up herself. That will produce bitterness among the developers, who’ll think that they are not being heard. However, to be heard, you need to use your voice in the first place.&lt;/p&gt;
&lt;h2&gt;A healthy dose of continuous progress&lt;/h2&gt;
&lt;p&gt;Trust issues, conflicting priorities. It looks like an uphill battle! How do we know that we’re going in the right direction?&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 675px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/10378411419e567a08a904697096b3e7/23296/balance.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 26.063829787234045%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVR42i2Pz0uTcQCHn3ffd1/e911z6sGk4Yb9QIgdnFgo+oLDi0GHRtgOW5aVOCyKCElCE29BIiOZXu3UKWJkCKKToPW+m2i15mF28SB4DgIPIl9Z7PMHPJ/noQz8AhRQ0NAcEOWg1F5VUuLtQUq8Lib0haMRcW/5ptfujIZvRCLnFWjrui4c8OwBP4Bd6qsB81JqxzWgB4rAl/YAH9QkoDdBcys0tgK+oG3bxOPhj6bJDuAATzo6eBYKsWoYrAQC/+3MCthVsL55uO7CbL7N1/1OTSSXjh9MLZ8+epH9NzqXUenRnFfezgsx58JzF6a/w8ge9FYh/Aeo1gx/gtyU8tq2EEZB46oLdzcuNVzJqsdDb/aTT2eKiZeLf+8/zKqJwV2IlmDYgVsO3HHBXjOMrs+mGfrk85GzLDgEzIEBi0yGLd2DC3y9eI75kzGU2q99et+rcTIqzW9gu55aAlalxB+L+Vv6+63LPT1c6OvjDL4Oa7uUMzmdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;balance&quot; title=&quot;&quot; src=&quot;/static/10378411419e567a08a904697096b3e7/23296/balance.png&quot; srcset=&quot;/static/10378411419e567a08a904697096b3e7/4dcb9/balance.png 188w,
/static/10378411419e567a08a904697096b3e7/5ff7e/balance.png 375w,
/static/10378411419e567a08a904697096b3e7/23296/balance.png 675w&quot; sizes=&quot;(max-width: 675px) 100vw, 675px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;The most sustainable process is to invest a regular amount of work into technical concerns, every sprint. As my totally non-scientific chart shows, it should be a meaningful amount but not become the dominant theme. From experience, 10% to 25% is a reasonable number, although that changes depending on the context.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Why?&lt;/em&gt; Because small &lt;a href=&quot;https://www.leanproduction.com/kaizen.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;continuous improvements&lt;/a&gt; &lt;strong&gt;compound&lt;/strong&gt; over time. It might not look like much, but it &lt;strong&gt;will&lt;/strong&gt; make an impact. It doesn’t require extraordinary efforts. Keep the stories small. If you can prove that you can deliver small increments, it will create a positive cycle.&lt;/p&gt;
&lt;p&gt;Also, be &lt;strong&gt;persistent&lt;/strong&gt;. If there is one message to take from this post, it’s don’t give up. Every team I’ve ever been part of has had this discussion at some point. Without patience and perseverance, it always ends up in frustration. Angry people won’t do great work. Eventually, tech stagnation leads to user stories not being delivered, either.&lt;/p&gt;
&lt;h3&gt;Don’t bet on miracles&lt;/h3&gt;
&lt;p&gt;An anti-pattern that I’ve observed is to bet everything on one magical measure. One example is dedicating one full sprint to bug-fixing. Or hoping that using a new tool/framework while continuing the same process will fix every shortcoming. Not to mention the nuclear button: Let’s rewrite things from &lt;em&gt;scratch&lt;/em&gt;!&lt;/p&gt;
&lt;p&gt;It could work, I guess. But it doesn’t sound likely. And, more importantly, it isn’t sustainable. Are you going to do that next time as well? And the one after? Isn’t it just easier to make small improvements as mentioned above?&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In summary, once you have your lovingly crafted tickets, you want to, you know, implement them. That is an essential and ongoing discussion with your Product Owner that has to be based on trust, transparency, and flexible negotiation. Your best bet is to create a continuous stream of technical work that gradually improves things.&lt;/p&gt;
&lt;h2&gt;Next Step: A technical backlog&lt;/h2&gt;
&lt;p&gt;After talking about writing technical stories, it’s the turn of getting them into an iteration. One thing remains: Which stories to pick? In other words, how do we maintain a technical backlog? That’ll be its own post.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 08/11/2020:&lt;/em&gt; Added more context.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to Anna and David for the feedback.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Never split the difference]]></title><description><![CDATA[Being properly prepared for a negotiation is a skill that is useful in many situations. Software development is about humans, after all]]></description><link>https://hceris.com/book-review-never-split-the-difference/</link><guid isPermaLink="false">https://hceris.com/book-review-never-split-the-difference/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Negotiation]]></category><pubDate>Sun, 25 Oct 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 220px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4a8ac24f3f38c8b132d5f7508747b69e/27dc7/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 153.19148936170214%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAfABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgH/xAAXAQEBAQEAAAAAAAAAAAAAAAADAgAF/9oADAMBAAIQAxAAAAG+V2OU1RoDLW9LU44DP//EABsQAQEBAAMBAQAAAAAAAAAAAAECEQADEiIx/9oACAEBAAEFAnsx7W65G+EfeU8nUTX8qUZ+uMOwZP8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/ARxgz//EABwRAAEEAwEAAAAAAAAAAAAAAAABAhExAxIhIv/aAAgBAgEBPwFkJ0WzHrPodZ//xAAfEAACAQQCAwAAAAAAAAAAAAAAARECEiExECKRoeH/2gAIAQEABj8CatYnTMCu2PAuvsyfCFTcStcSmvBCP//EAB4QAQADAAICAwAAAAAAAAAAAAEAESExcUFRYaGx/9oACAEBAAE/IdEK+5SAfD3OldjmB3ceIZCsCmWv6wtmBzVFQlyo6xK6jGdot208kLwBP//aAAwDAQACAAMAAAAQ3zgP/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAERIVH/2gAIAQMBAT8QfaDd06DauH//xAAaEQEAAgMBAAAAAAAAAAAAAAABABEhMWHw/9oACAECAQE/ELYKv3ZuiWXHJQYT/8QAIBABAQACAQMFAAAAAAAAAAAAAREAITFBUWGBkaGx8P/aAAgBAQABPxCQd1Ppk2bSJu3LOnbCKeD15zxEJ+Olwit0CA17+XJlUdH5xVAHgJm+2DUKeAvKzgw5ZsCSd8KcnTaxdZAmOLZpwres27V2vzn/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Never split the difference&quot; title=&quot;&quot; src=&quot;/static/4a8ac24f3f38c8b132d5f7508747b69e/27dc7/cover.jpg&quot; srcset=&quot;/static/4a8ac24f3f38c8b132d5f7508747b69e/bc01b/cover.jpg 188w,
/static/4a8ac24f3f38c8b132d5f7508747b69e/27dc7/cover.jpg 220w&quot; sizes=&quot;(max-width: 220px) 100vw, 220px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Essentially, this is a book about negotiating written by a former hostage negotiator. How is this relevant for software development, you might ask? Well, it &lt;strong&gt;is&lt;/strong&gt; relevant. How many meetings do you attend per week? Probably a lot. You always want to get &lt;strong&gt;something&lt;/strong&gt; out of every meeting (I’m fond of saying that a meeting without a goal is a social gathering). In many cases, what you want might not be what others want to give you. Thus, negotiation ensues.&lt;/p&gt;
&lt;p&gt;If you’re &lt;em&gt;constantly&lt;/em&gt; negotiating, so you might as well pretend to know what you’re doing, right? &lt;a href=&quot;https://www.amazon.com/Getting-Yes-Negotiating-Agreement-Without/dp/0143118757&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Getting to yes&lt;/a&gt; was the canonical book about the topic. The big difference is that this one is very explicit about the fact that people don’t usually behave rationally, which rings very accurate.&lt;/p&gt;
&lt;h2&gt;The magic recipe&lt;/h2&gt;
&lt;p&gt;There is no magic recipe that will instantly transform every situation, as you might expect. There are, however, things that you need to do in every negotiation to tilt the odds in your favor.&lt;/p&gt;
&lt;p&gt;It starts with &lt;em&gt;listening&lt;/em&gt;. Who knew? But really, listening is vital. Not just paying attention to the words coming out of your counterparty. Being empathetic towards them. Empathy is &lt;strong&gt;hard&lt;/strong&gt;. Understanding their concerns. It sounds so easy, yet you often feel that people don’t truly listen in meetings or listen having already decided what they’re going to hear in advance.&lt;/p&gt;
&lt;p&gt;Your tone and posture impact how you’re perceived. Chris Voss recommends using a downward inflection when talking. This one is particularly difficult for non-native speakers. Mirroring is another tool to create rapport. I’ve always heard that consultants are most effective when they plant ideas so that your clients believe they thought of it. That’s another one that’s difficult in practice.&lt;/p&gt;
&lt;h3&gt;The folly of &lt;em&gt;yes&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;The book touches on a topic that is very dear to me: The dangers of abusing &lt;em&gt;yes&lt;/em&gt;. I’ve seen countless times that people will agree to everything to avoid being perceived as &lt;em&gt;negative&lt;/em&gt; or &lt;em&gt;unconstructive&lt;/em&gt;. Not only can it be an empty agreement, but it can hide real issues in the name of fake consensus.&lt;/p&gt;
&lt;h3&gt;Getting to a price&lt;/h3&gt;
&lt;p&gt;The last part is about getting numbers, be it while buying a car or getting a raise. I’m not sure if this is more culture-specific than other parts. For instance, in Germany, I’ve seen that mentioning extreme ranges tend to kill the whole conversation instead of working as an anchor.&lt;/p&gt;
&lt;h2&gt;Negotiation in a remote world&lt;/h2&gt;
&lt;p&gt;What if you are not face to face anymore? I’m sure there’re many adjustments to make to account for that. Sadly this book was written before the lockdown times, so it assumes physical presence. There is a book waiting to be written for remote setups, I’m sure.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;I liked the book quite a lot. I want to try some of the things mentioned here in my &lt;em&gt;crucial conversations&lt;/em&gt;. Sometimes it kind of sounds a bit too self-convinced for my taste, but I think it’s worth a read. I’m giving it ⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Either Types for Rust]]></title><description><![CDATA[Either types are great for error handling. Rust has the Result type. It's tightly integrated into the language, and simplifies robust code]]></description><link>https://hceris.com/either-types-for-rust/</link><guid isPermaLink="false">https://hceris.com/either-types-for-rust/</guid><category><![CDATA[Rust]]></category><category><![CDATA[Functional Programming]]></category><category><![CDATA[Exceptions]]></category><category><![CDATA[Either]]></category><pubDate>Mon, 19 Oct 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3a002e4d50503f331792135c43c92fe5/eea4a/rust.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB5dJsupm//8QAFxABAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAQABBQKNai8//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAQEAAwAAAAAAAAAAAAAAAQARIUGB/9oACAEBAAE/IXjsiQ9xFxhz62F//9oADAMBAAIAAwAAABAsD//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EFf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEUH/2gAIAQIBAT8Q1H//xAAcEAEBAQABBQAAAAAAAAAAAAABEQAhMUFRgZH/2gAIAQEAAT8QOgvvTBIPa1yN4zjnQZShiGHg+anU3//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Rust&quot; title=&quot;&quot; src=&quot;/static/3a002e4d50503f331792135c43c92fe5/acb04/rust.jpg&quot; srcset=&quot;/static/3a002e4d50503f331792135c43c92fe5/bc01b/rust.jpg 188w,
/static/3a002e4d50503f331792135c43c92fe5/bf173/rust.jpg 375w,
/static/3a002e4d50503f331792135c43c92fe5/acb04/rust.jpg 750w,
/static/3a002e4d50503f331792135c43c92fe5/ec605/rust.jpg 1125w,
/static/3a002e4d50503f331792135c43c92fe5/eea4a/rust.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve written extensively about the &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/either-data-type-alternative-throwing-exceptions&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Either datatype&lt;/a&gt; this year. It’s an excellent way to model errors without resorting to exceptions.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Kotlin&lt;/em&gt; has been thus far my go-to language to show this concept. However, I’ve been playing a lot with &lt;em&gt;Rust&lt;/em&gt; lately. My first instinct was to explore its functional programming capabilities. Rust really delivers there.&lt;/p&gt;
&lt;p&gt;There are plenty of exciting ideas in Rust. The borrow checker, lifecycles, and plenty of others. I’m going to focus on &lt;em&gt;Either&lt;/em&gt; in this post, although you might be more familiar with its actual name in the language, &lt;em&gt;Result&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;A reason to use Rust&lt;/h2&gt;
&lt;p&gt;Rust is an increasingly &lt;a href=&quot;https://stackoverflow.blog/2020/01/20/what-is-rust-and-why-is-it-so-popular/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;popular language&lt;/a&gt;. It’s &lt;a href=&quot;https://www.rust-lang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;defined as:&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A language empowering everyone to build reliable and efficient software.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0ca3061342e6987672c10c47dfc5ee58/0f98f/tool.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAD/9oADAMBAAIQAxAAAAHFUFc6vFh//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECEBESIf/aAAgBAQABBQLsRKoN6owf/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/AWf/xAAZEAACAwEAAAAAAAAAAAAAAAAQEQAhMTL/2gAIAQEABj8C5ot6Nn//xAAcEAADAAEFAAAAAAAAAAAAAAAAARExIUFhcZH/2gAIAQEAAT8h1FGYlsTkgUoxy/TsP//aAAwDAQACAAMAAAAQIN//xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQMBAT8Q1Vf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAIAQIBAT8QxEf/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMUFRgWH/2gAIAQEAAT8QNwXKN151FNgv4wSZrDpdbc6OiK+a87SzofZ//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Tool&quot; title=&quot;&quot; src=&quot;/static/0ca3061342e6987672c10c47dfc5ee58/acb04/tool.jpg&quot; srcset=&quot;/static/0ca3061342e6987672c10c47dfc5ee58/bc01b/tool.jpg 188w,
/static/0ca3061342e6987672c10c47dfc5ee58/bf173/tool.jpg 375w,
/static/0ca3061342e6987672c10c47dfc5ee58/acb04/tool.jpg 750w,
/static/0ca3061342e6987672c10c47dfc5ee58/ec605/tool.jpg 1125w,
/static/0ca3061342e6987672c10c47dfc5ee58/c58a3/tool.jpg 1500w,
/static/0ca3061342e6987672c10c47dfc5ee58/0f98f/tool.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  A tool with a simple interface
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Is Rust a replacement for, say, &lt;em&gt;Kotlin&lt;/em&gt; or &lt;em&gt;Ruby&lt;/em&gt;? I don’t think so! A systems programming language like Rust might not be the tool you want to use to write applications, especially if there is no need to have tight memory management.&lt;/p&gt;
&lt;p&gt;However, I’ve found a use case where Rust fits very well: CLI Tools. By that, I mean tools like &lt;code class=&quot;language-text&quot;&gt;cat&lt;/code&gt; that are used from the command line. Typically, they start as shell scripts that inevitably get too hard to read and maintain. With Rust, you can use a pretty high-level language, and package it as a binary that’s extremely easy to distribute, be it in a Docker container or anywhere else.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Go&lt;/em&gt; has seen success in this space (&lt;a href=&quot;https://github.com/hashicorp/envconsul&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;envconsul&lt;/a&gt; comes to mind). After having been involved with both, I find Rust much more pleasant to use.&lt;/p&gt;
&lt;h2&gt;Either is actually called Result in Rust&lt;/h2&gt;
&lt;p&gt;Just in case you missed previous posts, let’s quickly present Either. Either is an entity whose value can be of two different types, called left and right. It represents a computation that can fail. So the &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; side is the result in case of success, and the &lt;code class=&quot;language-text&quot;&gt;Left&lt;/code&gt; one is the error if something goes wrong.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0a4b044b34c467c78b0ab4de51ad5d81/29007/either.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 58.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACNklEQVR42o2Sy2sTURTGx7Wo3bVKQBC0guLC+upGYlMfBbELsWhXdaGuikuLOyN001X9B+q/UFpNkzTP5tUYJ8kknRkkqaRgTU0mc+/cJNhU+WTuJCWRVlx8HM653/ndw7lXoJTiINUIhfZDQ7VQglbc4qpVNF4/rMcwDAjdBUIofjYYsps7cMwnMOJcxdjT97gztYC7Uwuwv/Fi9F0C6WKZ+wg5BEjaMm/fbTKElW0Iz5ZwZHoFNmcEJ14HcXQmAOHFBwjPlxGUv6HVZKgRst/bA2wYBpqGwWOrwbD1XcPcRxWzSzLeLua5nIt5zC7LmHOpKG1r3Nfd1wMsaTqK1Ro22yrVdFTrFLRpALsNoGWJNgxU6pSfm76vHb+m8yk5sEII7sdlXApkcSOcw+WghKGghPO+DCYSCqo64buq6AQT6you+LO4FsrhSkjiuhjI4kFcwY5OUO8Ah8M52GMy7FEZNq+IM6tp9Ls/Yywm872aRo1Qno/EFDz69AXn/Bmc9qYx4BZxcy2PcjfwViSP4bU87sUV3I7JGArlYPOIGE8oHMgMg8fxuIJBf5ZPedaXwaDPgjqiG73AqyEJfSspnPKIGPCIOOkRcdyVgiOy0TPhaHQDx1wpPlW/2/L1uVK4HsqhrOsWUCME05kCHq4reJJU8TipYjKp8vyVVIROrQnNOCMVeX3yL9/LTIHvmHVeea/O8LvO8KtLZt5i1neg7W9h5gf59hjb9wnmU5N/yDxnjOF/fX8A4JQyMaHMbrAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Either&quot; title=&quot;&quot; src=&quot;/static/0a4b044b34c467c78b0ab4de51ad5d81/1d69c/either.png&quot; srcset=&quot;/static/0a4b044b34c467c78b0ab4de51ad5d81/4dcb9/either.png 188w,
/static/0a4b044b34c467c78b0ab4de51ad5d81/5ff7e/either.png 375w,
/static/0a4b044b34c467c78b0ab4de51ad5d81/1d69c/either.png 750w,
/static/0a4b044b34c467c78b0ab4de51ad5d81/78797/either.png 1125w,
/static/0a4b044b34c467c78b0ab4de51ad5d81/aa440/either.png 1500w,
/static/0a4b044b34c467c78b0ab4de51ad5d81/29007/either.png 1600w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;It turns out that Rust has a built-in Either datatype, called &lt;a href=&quot;https://doc.rust-lang.org/std/result/enum.Result.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Result&lt;/a&gt;. It has two possible values, &lt;code class=&quot;language-text&quot;&gt;Ok&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Err&lt;/code&gt;. Rust doesn’t have &lt;a href=&quot;https://doc.rust-lang.org/book/ch09-00-error-handling.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;exceptions&lt;/a&gt;, which means that handling error conditions is predominantly done using Result. Great news!&lt;/p&gt;
&lt;h2&gt;Using Result&lt;/h2&gt;
&lt;p&gt;Result integrates well into the language. It’s implemented as an enumeration with two possible types.&lt;/p&gt;
&lt;!-- result-base --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token class-name&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Being an enumeration comes in handy when we try to unwrap the value, as we’ll see in a second.&lt;/p&gt;
&lt;h3&gt;Returning a Result&lt;/h3&gt;
&lt;p&gt;Any value can be wrapped using &lt;code class=&quot;language-text&quot;&gt;Ok&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Err&lt;/code&gt; as constructors.&lt;/p&gt;
&lt;!-- result-create --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; success&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; failure&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;failed :(&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Unwrapping a value&lt;/h3&gt;
&lt;p&gt;Many operations in Rust return a Result. How do you get the value inside? How do you decide what to do based on the outcome of the operation? The answer to both questions lies in pattern matching.&lt;/p&gt;
&lt;!-- result-unwrap --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;read_state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; file &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;answer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token macro property&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Extracted from file {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; answer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token macro property&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Bitter disappointment&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note how we can decide what to do based on the Result type and extract our data in one operation. That’s convenient. Moreover, pattern matching is exhaustive, so we’re sure we’ve handled every possibility. I love pattern matching.&lt;/p&gt;
&lt;h3&gt;Chaining&lt;/h3&gt;
&lt;p&gt;You rarely do just one computation. So, are you expected to unwrap the value, transform it, and rewrap it every time? That’d be very annoying. Instead, let’s use &lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;flatMap&lt;/code&gt; (called &lt;code class=&quot;language-text&quot;&gt;and_then&lt;/code&gt; in Rust) to apply a function and get a new Result. If you remember, these methods are biased, so they’ll never be applied to an error case.&lt;/p&gt;
&lt;!-- result-chaining --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;from_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file_name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;anyhow&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token namespace&quot;&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read_to_string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;content&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;serde_json&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Flat syntax&lt;/h3&gt;
&lt;p&gt;One disadvantage of modeling errors with Result/Either is that your code can become quite nested as you operate on the data contained within it. The &lt;a href=&quot;https://en.wikibooks.org/wiki/Haskell/do_notation&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;do notation&lt;/a&gt;, coming from Haskell, attempts to address this, though it’s not without &lt;a href=&quot;https://wiki.haskell.org/Do_notation_considered_harmful&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;detractors&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Luckily, Rust has a solution for that as well! The &lt;a href=&quot;https://doc.rust-lang.org/edition-guide/rust-2018/error-handling-and-panics/the-question-mark-operator-for-easier-error-handling.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;question mark operator&lt;/a&gt;. Using it, you can extract the data from an Ok result or return directly the Err if it didn’t work. It looks like this:&lt;/p&gt;
&lt;!-- result-flat-syntax --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;from_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file_name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;anyhow&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read_to_string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;serde_json&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Both &lt;code class=&quot;language-text&quot;&gt;read_to_string&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;from_str&lt;/code&gt; can fail, thus returning a &lt;code class=&quot;language-text&quot;&gt;Result&lt;/code&gt;. If that happens, computations stop, and the method will return an error. The code remains readable without compromising its security.&lt;/p&gt;
&lt;p&gt;It combines well with the &lt;a href=&quot;https://docs.rs/anyhow/1.0.33/anyhow/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;anyhow&lt;/a&gt; crate. If you have multiple kinds of errors in your method, &lt;em&gt;anyhow&lt;/em&gt; helps with the propagation. If they implement &lt;code class=&quot;language-text&quot;&gt;std::error::Error&lt;/code&gt;, that is.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Who said you couldn’t use functional programming concepts in a systems programming language like Rust? I’ve been reading a lot of Go code lately, and this code feels so much more readable than the endless list of &lt;code class=&quot;language-text&quot;&gt;if err != nil&lt;/code&gt; spread through it. If only &lt;em&gt;Kubernetes&lt;/em&gt; stuff would be written in Rust!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Technical stories, a miscast artifact of agile development]]></title><description><![CDATA[Technical stories are misused. If used correctly, they help shape the technical vision. If not, they just enable skipping essential work]]></description><link>https://hceris.com/technical-stories-a-miscast-artifact-of-agile-development/</link><guid isPermaLink="false">https://hceris.com/technical-stories-a-miscast-artifact-of-agile-development/</guid><category><![CDATA[Agile]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Leadership]]></category><pubDate>Thu, 24 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Technical Stories&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../technical-stories-a-miscast-artifact-of-agile-development/&quot;&gt;&lt;strong&gt;Part 1 - Writing technical stories&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../getting-technical-stories-into-an-iteration/&quot;&gt;Part 2 - Getting technical stories into an iteration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../keeping-a-technical-backlog/&quot;&gt;Part 3 - Keeping a technical backlog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8852d4b9a80db6a08d28d4216b54eed0/eea4a/tech-story.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFZ3VJGwX//xAAYEAEBAQEBAAAAAAAAAAAAAAABAgARA//aAAgBAQABBQKkdTzHl0ozAUDJ/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AWqQ/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AU4U/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERQQISMVHh/9oACAEBAAY/AufCEyWxNWa92Qsmf//EABsQAAMAAwEBAAAAAAAAAAAAAAABESExQVFh/9oACAEBAAE/IYL5zE6HbpPhJib+m3RJlNUwHWtomHXh/9oADAMBAAIAAwAAABCMD//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEVH/2gAIAQMBAT8Q6oAYX//EABcRAQEBAQAAAAAAAAAAAAAAAAEAMVH/2gAIAQIBAT8Q4pTt/8QAHRABAQACAgMBAAAAAAAAAAAAAREAITFhQVFxgf/aAAgBAQABPxDRUu5nZfa/uM0guwJ45x42bAJOtOaRAUQP3I4E1Rm+JeOsMxMQIhQdU4z/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Technical Story&quot; title=&quot;&quot; src=&quot;/static/8852d4b9a80db6a08d28d4216b54eed0/acb04/tech-story.jpg&quot; srcset=&quot;/static/8852d4b9a80db6a08d28d4216b54eed0/bc01b/tech-story.jpg 188w,
/static/8852d4b9a80db6a08d28d4216b54eed0/bf173/tech-story.jpg 375w,
/static/8852d4b9a80db6a08d28d4216b54eed0/acb04/tech-story.jpg 750w,
/static/8852d4b9a80db6a08d28d4216b54eed0/ec605/tech-story.jpg 1125w,
/static/8852d4b9a80db6a08d28d4216b54eed0/eea4a/tech-story.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;Technical stories&lt;/em&gt; are a controversial topic in the agile world. If you google &lt;a href=&quot;https://www.google.com/search?q=technical+stories+antipattern&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;technical stories antipattern&lt;/a&gt;, you’ll get plenty of people advocating never to do them. On the other hand, some teams religiously outsource any refactoring onto technical stories.&lt;/p&gt;
&lt;p&gt;Should we eschew technical stories altogether? Or should we embrace them and put all of our (technological) dreams and hopes into them?&lt;/p&gt;
&lt;p&gt;I believe this kind of story belongs in a healthy backlog, as long as we don’t use it to hide our corpses under the rug.&lt;/p&gt;
&lt;h3&gt;What is a technical story, anyways?&lt;/h3&gt;
&lt;p&gt;I’ll quote myself for this since there isn’t a universal definition.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A technical story is one where the main stakeholders are the developers in the team.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The end-user benefits only indirectly from such a story. As our system becomes better, the theory goes, we’ll have an easier time delivering actual user stories.&lt;/p&gt;
&lt;h2&gt;Are technical stories an antipattern?&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b735c858bcf225af5ad3a67ccf619e18/c08c5/iceberg.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGbsZzSGxEH/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBERIDE//aAAgBAQABBQKIMSVR6ML0fLM1/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGq/8QAGBAAAgMAAAAAAAAAAAAAAAAAADEQERL/2gAIAQEABj8Cll6Gf//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExUZH/2gAIAQEAAT8hyw4xuR2Qv29jMyIstuf/2gAMAwEAAgADAAAAEN8v/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EAbG/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAgEBPxBLyxf/xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAxIf/aAAgBAQABPxAQRV5AzqePYq5haJHCAd8HRl5dReF7v//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Iceberg&quot; title=&quot;&quot; src=&quot;/static/b735c858bcf225af5ad3a67ccf619e18/c08c5/iceberg.jpg&quot; srcset=&quot;/static/b735c858bcf225af5ad3a67ccf619e18/bc01b/iceberg.jpg 188w,
/static/b735c858bcf225af5ad3a67ccf619e18/bf173/iceberg.jpg 375w,
/static/b735c858bcf225af5ad3a67ccf619e18/c08c5/iceberg.jpg 640w&quot; sizes=&quot;(max-width: 640px) 100vw, 640px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  How hard could it be?
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Back to the original question. To answer it, let’s picture a user story as an iceberg.&lt;/p&gt;
&lt;p&gt;The visible part is above water. Your stakeholders probably won’t care much about what happens underwater. Yet, the complexity hides below. Most of the effort will be spent there.&lt;/p&gt;
&lt;p&gt;The problem with technical stories comes when they are used to draw an artificial line. We do the visible part, then extract the rest into a technical story. What an improvement in our velocity!&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 689px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fddd782480bad80df13c31041f99445c/0f79a/iceberg-reality.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 105.31914893617021%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVR42qWUW0/CQBCFKVCKXIoV5KpgYuIDDwS+5YEfZowkJhp/uRlz1qylBcEmk+5ud8+eM3OmlcoZD/ArNpuNvevhWuVCwCowAh6BGXAP3JwFmGOXAv3dbufnNQH/TVpBjMVoLKYWi0sAY6ABXAM955xn1wSmltNTYHawrXELmJhUyXsABsAd8GQXFDL0YLp97nMjeR2BZgLu69Kq9h9ll0lKV0ADgU0EnhalpYxZJCmxQI1lInsMBRgXggVAkYXmPR00gKnYdfStuVwuK6VmDplZrFYrny9f1ViVnIulZ109BmiS9sAr8Al8AC+a7zV+1/oz8AasdTYqArQq2a1XskPinGs452rOOevV2MZKQaL1qld1ALher8OW6ga+m+Wq2fI9G6apLIeRLBEFAGbquv4qYdvVS/8uwcaed3sOIK/C0nJ7qsrf7OTBtqr5c2C73fr1THtG6ulSwDQAWkhWrcDsdY0T+fSQpW5fqNVSGdgiMem+RwvSMFSRCluuHVQ4VWRBm41yMZDRR6U9/N/wzxdmstF9rer8FQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The reality of the iceberg&quot; title=&quot;&quot; src=&quot;/static/fddd782480bad80df13c31041f99445c/0f79a/iceberg-reality.png&quot; srcset=&quot;/static/fddd782480bad80df13c31041f99445c/4dcb9/iceberg-reality.png 188w,
/static/fddd782480bad80df13c31041f99445c/5ff7e/iceberg-reality.png 375w,
/static/fddd782480bad80df13c31041f99445c/0f79a/iceberg-reality.png 689w&quot; sizes=&quot;(max-width: 689px) 100vw, 689px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Except, this is a &lt;strong&gt;crucial mistake&lt;/strong&gt;. We’re avoiding essential technical work in a misguided effort to move faster. Striping a &lt;em&gt;user story&lt;/em&gt; of this bottom part &lt;strong&gt;is&lt;/strong&gt; the antipattern. It leads to an endless list of tickets in the backlog that will never happen. It encourages cutting corners and short-term thinking.&lt;/p&gt;
&lt;p&gt;If the story is too big, let’s agree on a smaller scope that still delivers meaningful value.&lt;/p&gt;
&lt;h3&gt;Why do we extract this work when we know it’s so important?&lt;/h3&gt;
&lt;p&gt;Does this happen in your team? You’re not alone. Many teams struggle with this. There are many reasons, among them:&lt;/p&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/0f98f/conflict.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDAf/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAGhPSnGKT//xAAZEAACAwEAAAAAAAAAAAAAAAAAEQEhQSL/2gAIAQEAAQUC1qLH1p//xAAXEQEAAwAAAAAAAAAAAAAAAAABAhAR/9oACAEDAQE/AYuNf//EABYRAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAgEBPwF0n//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQEAAwEAAAAAAAAAAAAAAAEAESFRMf/aAAgBAQABPyE5znG4Sa3JVCTkeZv/2gAMAwEAAgADAAAAEGjf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EA2Sb//EABcRAAMBAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QDCr/xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMVFB4f/aAAgBAQABPxBaOfR5+QgLX89iG+RnqQG+S6o1u537Fs//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Conflict&quot; title=&quot;&quot; src=&quot;/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/acb04/conflict.jpg&quot; srcset=&quot;/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/bc01b/conflict.jpg 188w,
/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/bf173/conflict.jpg 375w,
/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/acb04/conflict.jpg 750w,
/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/ec605/conflict.jpg 1125w,
/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/c58a3/conflict.jpg 1500w,
/static/fdc4e92a49f2f1ed9cc25eb5837d1ff8/0f98f/conflict.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  PO and Dev align expectations
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;Avoidance of conflict&lt;/em&gt;. If the product owner and the developers push in opposite directions, there’s tension that needs to be solved. Avoiding the conflict solves nothing, but it’s the path of least resistance.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Delivery pressure&lt;/em&gt;. Yes, features almost always take priority. Technical work is a catalyst for features. There might be real urgency, in which case it’s worth talking about managing the created &lt;a href=&quot;https://martinfowler.com/bliki/TechnicalDebt.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tech debt&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Lack of empowerment&lt;/em&gt;. Developers sometimes feel that they can’t stand for what they believe is necessary, or that their voice won’t be heard. Maybe they’re genuinely not being listened to, or perhaps their voice is too quiet.&lt;/p&gt;
&lt;p&gt;Let’s be honest; these are symptoms of deeper problems than writing some stories (or not). However, keeping the platform healthy is in everyone’s best interest.&lt;/p&gt;
&lt;h2&gt;Then when &lt;strong&gt;do you&lt;/strong&gt; create technical stories?&lt;/h2&gt;
&lt;p&gt;I thought you’d never ask. The most natural place to create technical stories is the &lt;a href=&quot;../dev-huddle-as-a-tool-to-achieve-alignment-among-developers/&quot;&gt;dev huddle&lt;/a&gt;. As a result of a successful dev huddle, the development team will agree on certain experiments, refactorings, or changes to be made. Any action big enough is a prime candidate for a technical story. To name some examples:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Refactor the layout of our product cards to use &lt;a href=&quot;https://css-tricks.com/snippets/css/a-guide-to-flexbox/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;flexboxes&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Let’s try out &lt;a href=&quot;https://strikt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;strikt&lt;/a&gt;, a new assertions library.&lt;/li&gt;
&lt;li&gt;Refactor our API calls to use &lt;a href=&quot;https://reactjs.org/docs/hooks-intro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React hooks&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once there is an agreement in the team, reflecting these points in stories helps build the team’s technical vision. These stories will (hopefully) happen soon, and increase the quality of the system. That, in turn, means that the iceberg’s visible part will have an easier time floating, which will lead to more fancy features for our happy stakeholders.&lt;/p&gt;
&lt;h3&gt;Monitor the amount of technical stories in your backlog!&lt;/h3&gt;
&lt;p&gt;The number of technical stories is a useful &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/architectural-fitness-function&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;fitness function&lt;/a&gt;. If that number only grows and grows, this whole process is not working very well. If anything, it can even discourage further attempts to improve the situation.&lt;/p&gt;
&lt;h2&gt;The tenets of a good technical story&lt;/h2&gt;
&lt;p&gt;Let’s say you grudgingly agree to start writing technical stories. How do you do it? This is the kind of story that will likely be written by a developer. And, to be fair, many lack the experience.&lt;/p&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9f2b70b3630236d6c2e62b9878ad4e5b/0f98f/story.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABgZNuVgsNP//EABcQAAMBAAAAAAAAAAAAAAAAAAECAxD/2gAIAQEAAQUCShQmrPoz/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQMBAT8Bp//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAZEAACAwEAAAAAAAAAAAAAAAABEQACICL/2gAIAQEABj8CdTOi8//EABoQAAIDAQEAAAAAAAAAAAAAAAERACExEGH/2gAIAQEAAT8ho4pZCYanihNx8nZ//9oADAMBAAIAAwAAABCM3//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxALhf/EABYRAQEBAAAAAAAAAAAAAAAAAAARIf/aAAgBAgEBPxC4p//EABwQAQACAgMBAAAAAAAAAAAAAAEAESExQXGRsf/aAAgBAQABPxDJ13UfsvhChjt1OcvsEGGK7uGP/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Story writing&quot; title=&quot;&quot; src=&quot;/static/9f2b70b3630236d6c2e62b9878ad4e5b/acb04/story.jpg&quot; srcset=&quot;/static/9f2b70b3630236d6c2e62b9878ad4e5b/bc01b/story.jpg 188w,
/static/9f2b70b3630236d6c2e62b9878ad4e5b/bf173/story.jpg 375w,
/static/9f2b70b3630236d6c2e62b9878ad4e5b/acb04/story.jpg 750w,
/static/9f2b70b3630236d6c2e62b9878ad4e5b/ec605/story.jpg 1125w,
/static/9f2b70b3630236d6c2e62b9878ad4e5b/c58a3/story.jpg 1500w,
/static/9f2b70b3630236d6c2e62b9878ad4e5b/0f98f/story.jpg 1920w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Like everything else, good writing takes practice
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Poorly written technical stories are sadly all-too-common. They are dense. They don’t get to the point. They are vague on the provided value. Because of this, they languish in the backlog. That leads to important topics not being addressed. This cycle is hard to escape from.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;A technical story has to be held to the same standards as a user story&lt;/strong&gt;. A story with a one-line description like &lt;em&gt;Upgrade Rails to a new version&lt;/em&gt; doesn’t cut it. It’s unfair to demand that user stories are descriptive, complete, and clear if that won’t apply to the technical ones.&lt;/p&gt;
&lt;p&gt;There are many resources on &lt;a href=&quot;https://www.mountaingoatsoftware.com/books/user-stories-applied&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;how to write user stories in general&lt;/a&gt;. There is even an acronym, &lt;a href=&quot;https://www.agilealliance.org/glossary/invest&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;INVEST&lt;/a&gt;. Follow these practices while using your best judgment. Here are five suggested sections based on my last five years of story poetry.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Context
- What&apos;s the value
- What to do (Acceptance Criteria)
- Out of scope
- Tech hint&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’ll explain what I think should be part of each, plus some bad and good examples.&lt;/p&gt;
&lt;h3&gt;Context&lt;/h3&gt;
&lt;p&gt;Where does this story come from? Understanding the background prevents misunderstandings. It allows us to understand if some parts are more critical than others.&lt;/p&gt;
&lt;p&gt;❌ &lt;em&gt;We want to use &lt;code class=&quot;language-text&quot;&gt;flexbox&lt;/code&gt; now.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;✅ &lt;em&gt;When we started this application, we had to support older versions of Internet Explorer. Support for &lt;code class=&quot;language-text&quot;&gt;flexbox&lt;/code&gt; is limited for them, so we decided to build our product cards using a more traditional inline-block layout to avoid incompatibilities. This requirement has been dropped, so we’re free to switch to a more modern technique.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;What’s the value&lt;/h3&gt;
&lt;p&gt;Technical stories are in a perpetual fight for survival. At the end of the day, it’s the product owner who controls the backlog. Stories without clear value get ignored in favor of user stories that bring a tangible benefit. Getting hard numbers is ideal, although not always possible. A qualitative judgment of what we want to improve can be helpful enough.&lt;/p&gt;
&lt;p&gt;❌ &lt;em&gt;I like &lt;code class=&quot;language-text&quot;&gt;flexbox&lt;/code&gt; a lot.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;✅ &lt;em&gt;Using &lt;code class=&quot;language-text&quot;&gt;flexbox&lt;/code&gt; will lead to a simpler CSS structure, resulting in less maintenance effort. We expect less visual bugs and less difficulty with typical tasks like centering elements.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;What to do (Acceptance Criteria)&lt;/h3&gt;
&lt;p&gt;Yes, this seems pretty self-evident. Still, you’ll find stories that are neither actionable nor verifiable. Is it clear what we want to do? How will we know when we’re finished? Can somebody in the team that didn’t write the story pick it up?&lt;/p&gt;
&lt;p&gt;❌ &lt;em&gt;Fix the product cards.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;✅ &lt;em&gt;Replace layout based on inline display with flexbox for product cards.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Out of scope&lt;/h3&gt;
&lt;p&gt;Technical stories can be very broad. It’s useful to be explicit if we won’t touch some parts that folks would expect to be part of this story. In the end, you want small, incremental improvements. Not a complete rewrite.&lt;/p&gt;
&lt;p&gt;✅ &lt;em&gt;The customer preview uses a similar layout, but we won’t touch that one until we’ve finished changing the product cards.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Tech hint&lt;/h3&gt;
&lt;p&gt;Help your teammates by giving them some guidance. If it’s about upgrading &lt;em&gt;React&lt;/em&gt;, what did we check already? Are there some pitfalls to take into account? Usually, there was a prior investigation, which is invaluable information that we don’t want to rediscover.&lt;/p&gt;
&lt;p&gt;Be mindful, however, of not writing an instruction list. Nobody wants to be ordered around. Moreover, writing down a very detailed list of steps can be as much effort as doing the story in the first place.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/56f4ff32f09beccc87d0c3d07d4975eb/eea4a/blueprint.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgAEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB6RI1NMI//8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQERL/2gAIAQEAAQUCUJ1tYbX/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAAhACD/2gAIAQEABj8CYz//xAAbEAEAAgIDAAAAAAAAAAAAAAABACERMUFhgf/aAAgBAQABPyHasEOJ6wTFsbjb3Ftg1P/aAAwDAQACAAMAAAAQkA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAFn//EABsQAQEBAAMBAQAAAAAAAAAAAAERAEFRcSEx/9oACAEBAAE/ECKIcvOs+kfwJcAFHuaoUvU8yM6Q7zZ//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Blueprint&quot; title=&quot;&quot; src=&quot;/static/56f4ff32f09beccc87d0c3d07d4975eb/acb04/blueprint.jpg&quot; srcset=&quot;/static/56f4ff32f09beccc87d0c3d07d4975eb/bc01b/blueprint.jpg 188w,
/static/56f4ff32f09beccc87d0c3d07d4975eb/bf173/blueprint.jpg 375w,
/static/56f4ff32f09beccc87d0c3d07d4975eb/acb04/blueprint.jpg 750w,
/static/56f4ff32f09beccc87d0c3d07d4975eb/ec605/blueprint.jpg 1125w,
/static/56f4ff32f09beccc87d0c3d07d4975eb/eea4a/blueprint.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  An exact blueprint will prevent so many needless discussions
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2&gt;Technical stories are another tool in the belt&lt;/h2&gt;
&lt;p&gt;Technical stories have helped the teams I’ve been on managing evolution and improving. The two fundamental points that I want to highlight again are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Don’t&lt;/em&gt; strip the underlying complexity of a story and put it in technical stories that you “will just do later.”&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Do&lt;/em&gt; yourself a favor and treat technical stories with the same respect and care as you do for user stories.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Notice that I haven’t talked about the tension between including user stories and technical stories in an iteration. That relates to building a technical backlog and assessing the health of a system. I plan to dig into that on its own post.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to Anna, Rachael and Felix for the feedback.&lt;/em&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: The Rust programming language]]></title><description><![CDATA[Rust is a trendy pick for a programming language these days. There is no better book to get started than this one]]></description><link>https://hceris.com/book-review-the-rust-programming-language/</link><guid isPermaLink="false">https://hceris.com/book-review-the-rust-programming-language/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Rust]]></category><category><![CDATA[Systems Programming]]></category><pubDate>Sun, 20 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 378px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7f931d84318ba16de8617590fbf563e5/a5608/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 131.91489361702128%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFwEBAQEBAAAAAAAAAAAAAAAAAgEAA//aAAwDAQACEAMQAAAB6CmzyTjOGxerUamcm//EAB4QAAICAgIDAAAAAAAAAAAAAAABAgMRExIUISIx/9oACAEBAAEFApxMCriaakaajr1ns3xFPJX9kS8P/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAEREBL/2gAIAQMBAT8B6ZXlP//EABcRAQEBAQAAAAAAAAAAAAAAAAABERL/2gAIAQIBAT8BbG1w/8QAHRAAAQQDAQEAAAAAAAAAAAAAAAERITICMaEQgf/aAAgBAQAGPwKiFeE4IhrpVU+lejpkzagfL1SIP//EACEQAAICAQMFAQAAAAAAAAAAAAEhABExQVFhcZGhwdHx/9oACAEBAAE/IRjAhuH6md9n4hgfcOVw75OUXesyfmXuwvS/2bMDNKXkooQwoA0lM3WKaTCVxP/aAAwDAQACAAMAAAAQ/Ax//8QAGBEAAgMAAAAAAAAAAAAAAAAAAGEBEBH/2gAIAQMBAT8QaNMin//EABcRAQEBAQAAAAAAAAAAAAAAAAERADH/2gAIAQIBAT8QAlmRZM8jNtu//8QAHxABAQACAQUBAQAAAAAAAAAAAREAIUExUWFxoYGR/9oACAEBAAE/EFZbaOk8leMBCKUvo2ZpaToI/sw2LdALrsbzrUbh+zCITheHiboQgDeTtPuKNl8lG975XWLJbq7E4xsaw6P1ztT16wcwVTUtd5//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The Rust programming language&quot; title=&quot;&quot; src=&quot;/static/7f931d84318ba16de8617590fbf563e5/a5608/cover.jpg&quot; srcset=&quot;/static/7f931d84318ba16de8617590fbf563e5/bc01b/cover.jpg 188w,
/static/7f931d84318ba16de8617590fbf563e5/bf173/cover.jpg 375w,
/static/7f931d84318ba16de8617590fbf563e5/a5608/cover.jpg 378w&quot; sizes=&quot;(max-width: 378px) 100vw, 378px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;Rust&lt;/em&gt; is not a new language by any means, but it’s getting plenty of &lt;a href=&quot;https://www.thoughtworks.com/de/radar/languages-and-frameworks/rust&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;attention&lt;/a&gt; &lt;a href=&quot;https://thenewstack.io/microsoft-rust-is-the-industrys-best-chance-at-safe-systems-programming/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;lately&lt;/a&gt;. As you might’ve heard, it’s a relatively low-level systems programming language. Similar to &lt;a href=&quot;https://golang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;golang&lt;/a&gt; in a sense, with a completely different approach to memory management.&lt;/p&gt;
&lt;p&gt;Apart from the classical use cases, I really like using &lt;em&gt;Rust&lt;/em&gt; to make fast, super-portable CLI tools that are easy to package in a container. A compiled binary is a lot easier to handle than something like a &lt;em&gt;Python&lt;/em&gt;-based tool with a ton of dependencies.&lt;/p&gt;
&lt;p&gt;For a systems programming language, &lt;em&gt;Rust&lt;/em&gt; is surprisingly rich in features. Pattern matching, &lt;code class=&quot;language-text&quot;&gt;Option&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;Result&lt;/code&gt; types, who knew? This power comes at the cost of complexity. &lt;em&gt;Rust&lt;/em&gt; is definitely &lt;strong&gt;not&lt;/strong&gt; a simple language, which is why this book clocks at 500 pages. The borrow checker is very different from anything you’ve seen before, and you’ll have to re-read that chapter over and over until you start making sense of the concept. Lifetimes are pretty tricky as well. By the time things like multi-threading came around, I was pretty overwhelmed.&lt;/p&gt;
&lt;p&gt;Luckily, this book is an excellent reference to navigate all these ideas. And it covers the ecosystem as well, which is a nice plus. You’ll learn about &lt;a href=&quot;https://crates.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cargo&lt;/a&gt;, its build system, and package manager. Testing makes an appearance, which is great news for all the TDD lovers.&lt;/p&gt;
&lt;p&gt;All in all, if you want to get started understanding &lt;em&gt;Rust&lt;/em&gt;, this book is an excellent starting point. It won’t be the last one you read if you’re going to get a deeper understanding of the whole thing.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;This is a comprehensive book, not only introducing the language but the ecosystem as well. The only thing I missed was going a bit more into the community’s best practices and established conventions. Although to be fair, it’s already a pretty long book as it’s. It gets ⭐⭐⭐⭐ stars from me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Diagrams as code for infrastructure as code]]></title><description><![CDATA[Diagrams is a neat tool to visualize your infrastructure using code. Using code allows easy modification and is version control friendly]]></description><link>https://hceris.com/diagrams-as-code-for-infrastructure-as-code/</link><guid isPermaLink="false">https://hceris.com/diagrams-as-code-for-infrastructure-as-code/</guid><category><![CDATA[Infrastructure as Code]]></category><category><![CDATA[Diagrams as Code]]></category><category><![CDATA[Documentation]]></category><pubDate>Wed, 09 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a03e30c0b62e78382df53fc28e41a4b9/eea4a/blueprint.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB00R6JikS/wD/xAAaEAADAAMBAAAAAAAAAAAAAAAAARECAzEy/9oACAEBAAEFAm4rCmzvoWTR/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAECAQE/AVP/xAAYEAACAwAAAAAAAAAAAAAAAAAAEAECEf/aAAgBAQAGPwJ1hYf/xAAaEAADAQADAAAAAAAAAAAAAAAAAREhMXGR/9oACAEBAAE/Ie4PNiRorZlIqpQR8OH/2gAMAwEAAgADAAAAEKAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFhEAAwAAAAAAAAAAAAAAAAAAABFB/9oACAECAQE/EFRKf//EABoQAAIDAQEAAAAAAAAAAAAAAAERACExQVH/2gAIAQEAAT8Qel+BL8Wb4YIF0chEMlpC1BxRdJJx3N7ers//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Blueprint&quot; title=&quot;&quot; src=&quot;/static/a03e30c0b62e78382df53fc28e41a4b9/acb04/blueprint.jpg&quot; srcset=&quot;/static/a03e30c0b62e78382df53fc28e41a4b9/bc01b/blueprint.jpg 188w,
/static/a03e30c0b62e78382df53fc28e41a4b9/bf173/blueprint.jpg 375w,
/static/a03e30c0b62e78382df53fc28e41a4b9/acb04/blueprint.jpg 750w,
/static/a03e30c0b62e78382df53fc28e41a4b9/ec605/blueprint.jpg 1125w,
/static/a03e30c0b62e78382df53fc28e41a4b9/eea4a/blueprint.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  a diagram is worth a thousand lines of poorly documented code
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;If you’re working with infrastructure, you’re undoubtedly leveraging &lt;a href=&quot;https://searchitoperations.techtarget.com/definition/Infrastructure-as-Code-IAC&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;infrastructure as code&lt;/a&gt;, right? I sure hope so. Otherwise, start now. I’ll be waiting.&lt;/p&gt;
&lt;p&gt;A natural evolution might be creating a graphical representation of your infrastructure. Diagrams as code if you will. It is not a new idea. This technique appeared in the &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/generated-infrastructure-diagrams&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tech radar&lt;/a&gt; back in 2015. You can hark back to that period where people thought that generating code &lt;a href=&quot;https://softwareengineering.stackexchange.com/questions/124996/is-code-commonly-generated-from-uml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;from UML diagrams&lt;/a&gt; was a sensible idea.&lt;/p&gt;
&lt;p&gt;Let’s forget that ever happened! Instead, let’s think about using visualization to understand complex architectures. And maintaining those artifacts up to date while we’re at it. I’m going to talk about a tool that builds on top of &lt;a href=&quot;https://www.graphviz.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Graphviz&lt;/a&gt; called &lt;a href=&quot;https://diagrams.mingrammer.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Diagrams&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;What is diagrams?&lt;/h2&gt;
&lt;p&gt;A tool with a very generic name, that’s for sure. If you check its website, it’s described as:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Diagrams lets you draw the cloud system architecture in Python code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pretty straight-forward. Installing it is a one-liner.&lt;/p&gt;
&lt;!-- installation --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;pip3 &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; diagrams&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re going to create infrastructure diagrams with Python. We’ll commit both the image and the code used to generate them so that everybody in the team can make changes. Let’s get coding, err drawing. I have two examples for you.&lt;/p&gt;
&lt;h2&gt;Alerting workflow&lt;/h2&gt;
&lt;p&gt;Let’s say you have a workflow where you publish alarms to an &lt;a href=&quot;https://aws.amazon.com/sns/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SNS Topic&lt;/a&gt;. That topic is processed by a &lt;em&gt;lambda function&lt;/em&gt;, which transforms the data and writes it back to &lt;em&gt;Cloudwatch&lt;/em&gt;. Through an event rule, the right alerts reach our event bus.&lt;/p&gt;
&lt;p&gt;So much text for such a little thing. I’m surprised you’re still paying attention. Let me hit you with a fancy diagram.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/01ccc/alerting_workflow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIElEQVR42pWT22oTURSG8wz6Dj6Cdz6Ct76Bii8gXtkqigiiIIjgAS8k6o1gEUSrWFJjDwjVgm2atsaaOTSTNpmYZDKTffpkDmmSoTcuWPx7zez9r3+vtXbBGENsMf6PH50hXaaAVxj9GJvJ+fGWS2Cyb15hRDaUknAokNqgtEFKhdIapTRSyAQTFyrBjHWUdMQ5JrQPfdxWl8NggBsM2BfgBBJ3CPuAK8GNwAYONAwiQTM0BJq8wjTb8u4XHpdu8s1eor3zmebcJZq1D/z+0aBy7SW10hbWVoP6/Xe0y9u0jWBjYR7PPog1xvdOCZVWCeGD+TucvnqCZ2tPaL2/h32+gLc4y+ajMt9PnqN6d47qqzLVUxfxb7+h6h/y8MIM7qabitMZoc4UliqL3Ho7w9e9ZbztFSrFKzi/lqitu6xdL1Jb3aVWcVmZfY69+JO/Ej4tWFhe/6iGCSFZ61sdQcse4HUETgT1CKwAnLiWZBhBbWhoiPEEaPI1zDpWL5aon73B/utVLANWO8TpS5yewu4K7J7E6askbgYybbI2Wacnu5wR7jz9yPqZy+y9KFM3UO8MsfoKOzA4A5NgHP/pKRojwqMhT/mm5tBv9bA29mj7AR1h8CNFJ9J43QFOq5tgHPuhojdUOcLpl2IyvRM+jqUUJgpDo6SY2jN5xmSzN6UwyaZ1lnUq+7HPLfeWR3YQKwzzboxJfHKdj/P7gbiw1j/VJCgl+IGhewAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;alerting workflow&quot; title=&quot;&quot; src=&quot;/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/1d69c/alerting_workflow.png&quot; srcset=&quot;/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/4dcb9/alerting_workflow.png 188w,
/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/5ff7e/alerting_workflow.png 375w,
/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/1d69c/alerting_workflow.png 750w,
/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/78797/alerting_workflow.png 1125w,
/static/4d5de6e54d2e76cb9c5cbcd545fa5c6e/01ccc/alerting_workflow.png 1399w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you check the code, you’ll notice how simple it is. There are three elements.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;strong&gt;nodes&lt;/strong&gt;, which are single components. It has a recognizable icon and a name.&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;edges&lt;/strong&gt;, which are the connections between components. They can be directed or undirected.&lt;/li&gt;
&lt;li&gt;The &lt;strong&gt;clusters&lt;/strong&gt;, which group nodes logically.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And there is not much else. The diagram is built with this snippet.&lt;/p&gt;
&lt;!-- alerting-workflow --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Diagram&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Cluster

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;storage &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; S3
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compute &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Lambda
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;integration &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; SNS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Eventbridge
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;management &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Cloudwatch
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onprem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;queue &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ActiveMQ

&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Diagram&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Alerting Workflow&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; show&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;main account&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        topic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SNS&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;SNS Topic&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Lambda&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            l &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Lambda&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;processor&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            topic &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; l
            S3&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;lambda source&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; l

        cl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Cloudwatch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Cloudwatch&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        l &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; cl

        event &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Eventbridge&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Cloudwatch\nevent rule&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        cl &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; event

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Event Bus&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        event_bus &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ActiveMQ&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bus&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        event &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; event_bus&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice how quickly you can get a decent overview of your system with a just bit of Python.&lt;/p&gt;
&lt;h2&gt;Network diagrams&lt;/h2&gt;
&lt;p&gt;Networking seems to be uniquely suited for this approach. While researching &lt;a href=&quot;../understanding-vpc-endpoints/&quot;&gt;VPC endpoints&lt;/a&gt;, I realized that a clear drawing aids understanding significantly.&lt;/p&gt;
&lt;p&gt;Let’s say we are connecting to a &lt;a href=&quot;https://kubernetes.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kubernetes&lt;/a&gt; cluster because that’s what we all do these days. We’re routing a bunch of different domains to a VPC endpoint. The cluster resides in a different account, so we use an endpoint service to make it available. Add a few more routes, and the whole thing becomes a tangled mess, much like the pile of cables behind your desk. That is until you see this diagram.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3f7f57c9d4c83e5f6f872e57d72cfa58/061c7/connecting_two_accounts.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 103.72340425531914%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAACnklEQVR42qWUS08TURTH+Sau/AAmJu6Ie000MepGFybEmPgFlF3jA1QwBqMsDIsmJIARmypBYAE0KgTaSoW+qNN2Zjqv+5yZO8PMtHRuTYuoNASinJzFPbn55X/+93F6WieInqO3eSf/FebHgQdhaLkKYdRv0iCkAcc+N4MQmAy7AauHdr1pBw0raLiNZhfcVlCpUZCzwAOS5comMXaYYjsi1IGLgENUSjXHV5gPmHsA5p3ushsoPiolYlhjrFYh0jYBJhWK5voM3U66RLNQcpasTWNDbu0zbTgM26u5Sfnh9eLYPV1E1uqcsTilKwZ990aIXCq+HbT1fEEb7rVencVbHztwc1+5A6fXlNHIejwqKCZLJYxEXNWR+WFc6L+cnHiqQ0EUBi7Whs7D/HIHDv8cGOctVjfNRs3cNWRsAYmAKobEkmWcS9fEEqbQr+TKpY0CJqzLc1t5Kw1jr6XEe1RGNJ5UJ1eUvIwBZFWZKYqDDQ/DOgYNRN3fV/i3Z+nBtUK038goqPfl11OPFqe/idHVypnhz7cnvlvQR4aHdA9R56DyL8/qaCQ1O17N6fTqWOrc85X5rPJiqXR6cPnKWMoEATZ8pPvdynsFdLGAsrgBaqatECgTBCySKoPoSmVhUyXQQcCBBkPmYZ4rVfhlvpLbQDI1M2tyOqGKKqYOtggwbYiYjpgObQ079JC2l+LqyJ3q1AAuivhZX374prKZJMufpKFb5diIQTwdOTpkGnYPgxdnqpEb69HHFUGnT+4mn/XlslswFt2+fyEzMSghdx/uUt4LbLNCSZQ1hD1fg1hWIXZZrqAuxH5kkgpyAGQA2AZxrGO+JG+1djzPshnbcby6yznfbYZ72Qz58cOAcx62g7dfAf+vSXKiMXQ0/BNVSIZc7OKH9AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;connecting accounts&quot; title=&quot;&quot; src=&quot;/static/3f7f57c9d4c83e5f6f872e57d72cfa58/1d69c/connecting_two_accounts.png&quot; srcset=&quot;/static/3f7f57c9d4c83e5f6f872e57d72cfa58/4dcb9/connecting_two_accounts.png 188w,
/static/3f7f57c9d4c83e5f6f872e57d72cfa58/5ff7e/connecting_two_accounts.png 375w,
/static/3f7f57c9d4c83e5f6f872e57d72cfa58/1d69c/connecting_two_accounts.png 750w,
/static/3f7f57c9d4c83e5f6f872e57d72cfa58/78797/connecting_two_accounts.png 1125w,
/static/3f7f57c9d4c83e5f6f872e57d72cfa58/061c7/connecting_two_accounts.png 1216w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Better, isn’t it? What about the code used to generate it?&lt;/p&gt;
&lt;!-- connecting-accounts --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Diagram
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;network &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; VPC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; PublicSubnet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; PrivateSubnet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Endpoint&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ELB&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Route53
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; diagrams&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compute &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; EKS

&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Diagram&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Connecting two accounts&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; show&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Account 1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hosted Zone\nmain.io&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            star &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Route53&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;*.test.main.io&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            subdomain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Route53&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test.main.io&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hosted Zone\nalt.dev&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            alt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Route53&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;other.alt.dev&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;VPC&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            VPC&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                PrivateSubnet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

                endpoint &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Endpoint&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;VPC Endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;star&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subdomain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; alt&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; endpoint

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Account 2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;VPC&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            VPC&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Cluster&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                PrivateSubnet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

                service &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ELB&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;VPC\nEndpoint Service&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                cluster &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; EKS&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Kubernetes\nCluster&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

                endpoint &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; service &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; cluster&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The amount of code used to represent it has grown compared to the previous example. Luckily, using &lt;em&gt;Python&lt;/em&gt; gives us access to functions, comprehensions, and other tools to manage this complexity.&lt;/p&gt;
&lt;h2&gt;The curious case of the diagram that could not be updated&lt;/h2&gt;
&lt;p&gt;That’s how you use &lt;em&gt;Diagrams&lt;/em&gt;. Is it really valuable? I certainly like the pretty icons. Apart from that, it shines in enabling visual documentation to evolve.&lt;/p&gt;
&lt;p&gt;I’ve tried to digitalize technical diagrams before. I really tried. &lt;a href=&quot;https://www.sketch.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Sketch&lt;/a&gt;, &lt;a href=&quot;https://sketchboard.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sketchboard&lt;/a&gt;, or even just taking a picture of a hand-drawn diagram. It works until you need to update it, and you don’t have the source. Perhaps it was done by somebody else, who preferred a completely different tool. I’ve often seen a project’s documentation get more and more out of date because nobody can update the damn diagrams. If it’s just source code, your chances get a lot better.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Diagrams&lt;/em&gt; is a neat, albeit limited tool. You can’t add much more than what I’ve shown. While that is constraining, it can protect you from yourself. Overly complicated diagrams do more harm than good. If you are representing the system in its entirety, why not check the code directly? The point of abstraction is to make it simpler to understand by omitting some of the details.&lt;/p&gt;
&lt;p&gt;In summary, it’s a convenient way to bring clarity into your impenetrable READMEs, and you’ll be able to update the images as your code evolves.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Dev huddle as a tool to achieve alignment among developers]]></title><description><![CDATA[A well-run dev huddle increases the alignment among the developers of a team. I'm going to share my experience preparing for and running it]]></description><link>https://hceris.com/dev-huddle-as-a-tool-to-achieve-alignment-among-developers/</link><guid isPermaLink="false">https://hceris.com/dev-huddle-as-a-tool-to-achieve-alignment-among-developers/</guid><category><![CDATA[Agile]]></category><category><![CDATA[Practices]]></category><category><![CDATA[Leadership]]></category><pubDate>Sun, 30 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/949aa08c7be6c3d0c8090dd1607d8078/eea4a/huddle.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUBA//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAXOdpaTB/8QAHBAAAQQDAQAAAAAAAAAAAAAAAQIEESEAAxIi/9oACAEBAAEFAlPz2H681vfNTFpBj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAIBBQAAAAAAAAAAAAAAAAAxARARISJB/9oACAEBAAY/AsRFjhuxUZ//xAAbEAADAAIDAAAAAAAAAAAAAAAAARExgSFBcf/aAAgBAQABPyFNr8Ucup9C6yrpDTMoIXgxEaP/2gAMAwEAAgADAAAAEPDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRABAAICAgMAAAAAAAAAAAAAAREhADFBUWFx8P/aAAgBAQABPxAfltiunb7wOzNCqt6fozsGw1RwYzDLSDV4twFIK85awlmOGf/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Huddle&quot; title=&quot;&quot; src=&quot;/static/949aa08c7be6c3d0c8090dd1607d8078/acb04/huddle.jpg&quot; srcset=&quot;/static/949aa08c7be6c3d0c8090dd1607d8078/bc01b/huddle.jpg 188w,
/static/949aa08c7be6c3d0c8090dd1607d8078/bf173/huddle.jpg 375w,
/static/949aa08c7be6c3d0c8090dd1607d8078/acb04/huddle.jpg 750w,
/static/949aa08c7be6c3d0c8090dd1607d8078/ec605/huddle.jpg 1125w,
/static/949aa08c7be6c3d0c8090dd1607d8078/eea4a/huddle.jpg 1280w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;How do you ensure that the developers in a team are aligned on the technical direction? That’s a difficult question! Every team has its own idiosyncrasies. As a &lt;a href=&quot;https://www.patkua.com/blog/the-definition-of-a-tech-lead/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tech lead&lt;/a&gt;, I’ve thought a lot about it and ended up with vague ideas like &lt;em&gt;empowerment&lt;/em&gt; or &lt;em&gt;shared goals&lt;/em&gt;. Not very actionable!&lt;/p&gt;
&lt;p&gt;However, one ritual has worked really well in the teams I’ve been part of. I want to talk about the &lt;em&gt;dev huddle&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;Dev huddle?&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e64530d65f0a986f884afa2bcde4a050/36dd4/developers-aligning.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIGBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAU1pdBthBP/EABoQAQACAwEAAAAAAAAAAAAAAAIDBAABECH/2gAIAQEAAQUCjtSKQWDvhaCWHwf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAEAAQQDAAAAAAAAAAAAAAABAAIQEXESITH/2gAIAQEABj8C2+R5IYsNLidQ1P/EABoQAQEAAwEBAAAAAAAAAAAAAAERACFREDH/2gAIAQEAAT8hOivCaMllF9unyqZJmgIlww8Gf//aAAwDAQACAAMAAAAQPy//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QJ//EAB0QAAMBAAEFAAAAAAAAAAAAAAERIQBBUWFxkaH/2gAIAQEAAT8QuITZDx384EokflHAghijLIN05z7xB2IN1jaD6wb/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Alignment&quot; title=&quot;&quot; src=&quot;/static/e64530d65f0a986f884afa2bcde4a050/36dd4/developers-aligning.jpg&quot; srcset=&quot;/static/e64530d65f0a986f884afa2bcde4a050/bc01b/developers-aligning.jpg 188w,
/static/e64530d65f0a986f884afa2bcde4a050/bf173/developers-aligning.jpg 375w,
/static/e64530d65f0a986f884afa2bcde4a050/36dd4/developers-aligning.jpg 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Developers aligning expectations
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;There are many names: Dev Huddle, Tech Huddle, Dev Meeting. Whatever the name, it’s a recurring meeting intended for the developers in a team. It’s a forum to discuss technical topics and make decisions regarding architecture, conventions, or any other technology stack aspect.&lt;/p&gt;
&lt;p&gt;Wow, that’s &lt;em&gt;so&lt;/em&gt; innovative! You might sneer. Yes, it’s nothing groundbreaking. The devil is in the details, though. Running one effectively is tricky. Nothing will frustrate a group of developers more than having yet another useless meeting. If you’re taking their time, you better make it count.&lt;/p&gt;
&lt;h2&gt;Why should I do it?&lt;/h2&gt;
&lt;p&gt;Before focusing on the &lt;em&gt;How&lt;/em&gt;, let’s stop at the &lt;em&gt;Why&lt;/em&gt; first. What do we expect to accomplish?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Create Alignment&lt;/strong&gt;: Developers might work closely together (sometimes &lt;em&gt;too&lt;/em&gt; literally), yet build software as if they never met before. Do they agree on the coding conventions? What’s the preferred library to parse &lt;em&gt;JSON&lt;/em&gt;? There are tons of small decisions to make. Over time those form a cohesive understanding of building software that is crucial for any high-performing team.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Foster Innovation&lt;/strong&gt;: You won’t rewrite your application every six months with the trendiest technology, but you want to encourage experiments. &lt;a href=&quot;https://www.creativesafetysupply.com/articles/continuous-improvement/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Continuous improvements&lt;/a&gt; compound over time. I’ve been part of teams that looked hopeless in the beginning. After a year of many small improvements, we’re doing &lt;a href=&quot;https://www.atlassian.com/continuous-delivery/continuous-deployment#:~:text=Continuous%20Deployment%20(CD)%20is%20a,cycle%20has%20evolved%20over%20time&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;continuous deployment&lt;/a&gt;. That will rarely happen in one big push, though.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Encourage Debate&lt;/strong&gt;: Some teams practice what I call &lt;em&gt;discussion by tenure&lt;/em&gt;, where the most senior people in the team make the technology decisions, and the rest, well, follow them. If they are lucky to find out about those decisions. Your senior folks have the experience and the instincts, but everybody else can contribute as well.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Preparation&lt;/h2&gt;
&lt;p&gt;I like to structure huddles around a backlog of ideas. Something as simple as a piece of paper on the wall and stickies. Or a list of issues in Github. Each one can be just a simple headline. They are there to start a conversation. Some examples:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Let’s try out &lt;a href=&quot;https://strikt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;strikt&lt;/a&gt;, a new assertions library&lt;/li&gt;
&lt;li&gt;Refactor our API calls to use &lt;a href=&quot;https://reactjs.org/docs/hooks-intro.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React hooks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Missing documentation for our newest microservice&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;figure figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3c0b31103f446471eedd65b84e5a284a/8c76f/huddle-board.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 122.87234042553192%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEC0lEQVR42pVV22scVRz+Zmc3e89mt7ltdrq5bC6zuezufGe2a2w2xgTTeAmxyaSxrQ8WLXh5iSLUKF0qKQUj+CYW/wAf/AN8KPjggwgqCoqID1IfBH0Qi/ig9GXlt5wp06UWHfiYM3PO+c73ux6QhFIKJE2SEZLRLvSQTJPM3GMuiIjwCJmQFEgOB6FcJ69cZ0QpHiO5S/I02RnnA+vyAczUajVAnz4o7IoulOugUl7EQ1ujWN0toNGcw5mr6PwXa+4DOcCUQYpkTn461TpWtovG8x8C2wdmcuf1UObxF9Pm9oGJJ1+N+hsN/Q6RnCQ5r00W9RGZSMqHKNy9Apw5BLzLyHgtrHstnPdaWNg7BE6emjLoqKCiUZJNkjWST4vJcpivMNMhdZ312fHlkb2rsLwWlrwWmt5lNIA26KgFkmskV0jaAXWy9xmSD7iu2/FhgmS/bHJUM53CW+bWpVzSaxkrXgtPeC1Mnb4UFl9K8MLa1JjOiBdIvqkJSzIvhHFS9Y+MvIvjx48wmHsfJfUOPvgLxvYb0fjeNQOLq7YERdJqWpuY8E1XSoW1DwfkIDjOibjrzorCvlTqi2Im83ExGv3ZAto91VOvoNrY8X3XT/JZki2S49pkccOYJpf5OOr16djCwiNDQHsin39vbnz8tUoy+ZUNtHPihuLYNUOpzgZRsEVyX/vwQW1qM0CYQK3WjDUaxWNAOwS0Y0A7DrQzlnWESOQX2PZ5P6qSr4skL+gIV0l6JB/T85I2KSwvmz0zMxcKhvH3UDb7kZXN3rBSqS/FZDkEpnkLZMMvT4loQqKpVVJH2idM4+JFmJZ1NBUO/zZp22dP2va51YmJlwtAezSd/szY2JDy7GzI6fIThSMks9p/YU0o371YXg5FyuWzlvZZXzR6c0DGhnE7ZRi3MT39nEF21A2RXCW5o2v3YZLnSKoAYQauOx9xnEUJSgpoZzXE3Gw4/LuxuSkKq9Ak89pv4zooQljXhH0CXL8Ow7Lenk4mv66WSvvlYvFwtlTan08mvylJcMSPgkqlAm3ijCZokNyTCgkQZrG2BrNcfsoyzT/yicS3hXj8h0I8/r1lmrcGgbZxcAC47pwfkDLJinQnncz5QLPIdAhrtaWw684OJhLfIZP5BOn05+jt/RSRyK9a2TpI11ewSfKK7p+zumrm7iJUqmaS7rBsjkZ/QjR6E7HYj0Yo9GeHUKmKn4cD2m/SWVySJ0i+RHLpLkLd+odt2+7kWvcTaFcp3QBEmaVJN0g+2k0o3WNYklUn7B04juMnNAJ3j/+e1ORj/0ooCxuNBvxxENr5hl5v3OMKuEMokwWllFGv1yHoJguqvA+k1nP+4kLXbTb0PzGoORLoupd9hAOI/Af0+DX9D8qPbFfyGfhJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Huddle board&quot; title=&quot;&quot; src=&quot;/static/3c0b31103f446471eedd65b84e5a284a/8c76f/huddle-board.png&quot; srcset=&quot;/static/3c0b31103f446471eedd65b84e5a284a/4dcb9/huddle-board.png 188w,
/static/3c0b31103f446471eedd65b84e5a284a/5ff7e/huddle-board.png 375w,
/static/3c0b31103f446471eedd65b84e5a284a/8c76f/huddle-board.png 612w&quot; sizes=&quot;(max-width: 612px) 100vw, 612px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Who adds new topics? Everybody! You found a candidate for refactoring while pairing. You read that &lt;a href=&quot;https://dev.to/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;dev.to&lt;/a&gt; article about that new library. Just add it to the wall.&lt;/p&gt;
&lt;p&gt;In the beginning, you’ll be the only one posting ideas. Over time, the rest of the team will feel more comfortable and chip in. We’ll see how to choose what to talk about in a minute.&lt;/p&gt;
&lt;h3&gt;Finding a time&lt;/h3&gt;
&lt;p&gt;Some might say: &lt;em&gt;Let’s just get together whenever needed. We are agile!&lt;/em&gt;. That doesn’t work in practice, in my experience. There is always something urgent. Somebody doesn’t have time right now.&lt;/p&gt;
&lt;p&gt;My advice? Pick a fixed slot: same day and hour, every week. Ideally, whenever you interrupt the least. After the daily, just after lunch. Doesn’t really matter. People will get used to it and take it into account in their schedule.&lt;/p&gt;
&lt;p&gt;Half an hour should be enough to have meaningful conversations. The flow of the board is a good indicator. If you’re collecting more and more topics that you’ll never talk about, maybe it’s time to stay a bit longer. If you’re running out of stuff, perhaps you can finish early, or even switch to bi-weekly?&lt;/p&gt;
&lt;h2&gt;How to run a dev huddle&lt;/h2&gt;
&lt;p&gt;Running a dev huddle consists of going through the list of topics, discussing them, reaching a conclusion, and documenting it. Sounds easy, right?&lt;/p&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9adc80a58eff2b709e275a2e0b27303e/c08c5/moderator.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAZzE5nO9xQH/AP/EABkQAAIDAQAAAAAAAAAAAAAAAAECABESIv/aAAgBAQABBQIGoW5NmBzN6VmN/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8Bla//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARL/2gAIAQIBAT8BsZf/xAAaEAACAgMAAAAAAAAAAAAAAAAAMQEQIVFh/9oACAEBAAY/Ao0YfbUDP//EABsQAAIDAQEBAAAAAAAAAAAAAAERACExQVFx/9oACAEBAAE/IQmAv0nAFtMEAZpQEUV8j3MHYzHFZP/aAAwDAQACAAMAAAAQHy//xAAVEQEBAAAAAAAAAAAAAAAAAAAAAf/aAAgBAwEBPxAV/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEx/9oACAECAQE/EM6h/8QAHBABAAIDAAMAAAAAAAAAAAAAAQARITFRYXGR/9oACAEBAAE/EC9TdOGoAbBYN+Km2JCywlAI8FS1qJgGTte5gwfRif/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Moderator&quot; title=&quot;&quot; src=&quot;/static/9adc80a58eff2b709e275a2e0b27303e/c08c5/moderator.jpg&quot; srcset=&quot;/static/9adc80a58eff2b709e275a2e0b27303e/bc01b/moderator.jpg 188w,
/static/9adc80a58eff2b709e275a2e0b27303e/bf173/moderator.jpg 375w,
/static/9adc80a58eff2b709e275a2e0b27303e/c08c5/moderator.jpg 640w&quot; sizes=&quot;(max-width: 640px) 100vw, 640px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Moderation happening
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Not so fast. First of all, there &lt;strong&gt;has&lt;/strong&gt; to be a facilitator. Keeping the total time, making sure that no single topic consumes the whole timeslot. Giving everybody a chance to speak. Without this role, you might end up having a pub discussion, without the beer.&lt;/p&gt;
&lt;p&gt;I used to run all the huddles in a previous team. I only realized much later what a mistake it was. The meeting ends up becoming yours when it should belong to the whole team. Besides, it’s tough to facilitate and be an active participant at the same time. Rotate the facilitation instead. Everybody gets practice moderating, and you get to have some of the fun as well!&lt;/p&gt;
&lt;p&gt;If you have too many topics, you have to pick which ones to tackle. You can take them in order of creation, or &lt;a href=&quot;https://en.wikipedia.org/wiki/Dot-voting&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;dot vote&lt;/a&gt; just before starting. Some people will bring more points than others. Try to keep it balanced. A big architectural change requires more than a few minutes, so maybe a follow-up meeting is in order.&lt;/p&gt;
&lt;p&gt;And then … &lt;em&gt;discussion ensues&lt;/em&gt;. A huddle won’t fix a broken culture, but it’s a good litmus test. Are you stating opinions or facts? Are you fighting to get a word in? If so, a huddle is the least of your problems. Here is a sample checklist to help less experienced moderators:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Are there open points from last time?
- Choose the topics for today
* For every topic
    
    The owner presents the issue so that everybody is on the same page
    Talk about it (Keep a timebox!)
    Resolution
        What did we decide?
        Assign an owner to take care of the follow-up
  
- Have we made decisions that need to be reflected in ADRs?
- Finish on time, unless there is something that absolutely can&apos;t wait&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;The outcome&lt;/h2&gt;
&lt;p&gt;Getting the team to talk to each other is already &lt;em&gt;something&lt;/em&gt;. If there is no outcome, though, it’s not really a meeting but a social gathering. So let’s write down our findings. Typically, it’ll be about things you want to do or things you’ll do from now.&lt;/p&gt;
&lt;h3&gt;Technical Stories / Slack items&lt;/h3&gt;
&lt;p&gt;Don’t listen to the &lt;a href=&quot;https://en.wikipedia.org/wiki/Pointy-haired_Boss&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pointy-haired micromanagers&lt;/a&gt; who want to record every action ever taken, no matter how inconsequential. For small stuff, keep the accounting to a minimum and rely on &lt;a href=&quot;https://www.solutionsiq.com/resource/blog-post/the-importance-of-slack-in-achieving-speed-and-quality/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;slack time&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For bigger things, write technical stories and make sure to integrate them into your regular backlog. There is a lot that can be said &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/treat-devops-stories-user-stories&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;about this&lt;/a&gt;. TLDR: Hold a technical story to the same standards as user stories.&lt;/p&gt;
&lt;h3&gt;Keeping track of decisions&lt;/h3&gt;
&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/df2e49a34070e97aad0230482f42a479/36dd4/decision-records.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 62.76595744680851%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQBA//EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABs3lTomEf/8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQETH/2gAIAQEAAQUC7SkGZX//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAQMFAQAAAAAAAAAAAAAAAAERMQIQIYGx0f/aAAgBAQAGPwLD8PFJqTQ83//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESGRMUFRYXH/2gAIAQEAAT8hPEzSAJy7JYz6kUFls9sQ4a+kVVzuf//aAAwDAQACAAMAAAAQoO//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBD/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EGV//8QAHBABAQEAAgMBAAAAAAAAAAAAAREAMZEhUeHw/9oACAEBAAE/ECwjDlTs5cyRw/emL5h7FyFAREh8wsalAiadODDk97//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Decision records&quot; title=&quot;&quot; src=&quot;/static/df2e49a34070e97aad0230482f42a479/36dd4/decision-records.jpg&quot; srcset=&quot;/static/df2e49a34070e97aad0230482f42a479/bc01b/decision-records.jpg 188w,
/static/df2e49a34070e97aad0230482f42a479/bf173/decision-records.jpg 375w,
/static/df2e49a34070e97aad0230482f42a479/36dd4/decision-records.jpg 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Archiving decisions
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Everybody was fired up for the huddle. It got intense, but you’ve reached an agreement on whether to use semicolons or not. &lt;em&gt;Shit is getting done&lt;/em&gt;. Until nobody wrote it down, and you had to start from scratch next week. Infuriating.&lt;/p&gt;
&lt;p&gt;Can I interest you in some &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/lightweight-architecture-decision-records&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;lightweight Architecture Decision Records&lt;/a&gt;? It may sound formal and un-agile, but it’s really not. You just have a place where you keep track of the decisions you made. A Markdown file with a title, what you decided, and an explanation of the context. I’ve seen people write novels to wax poetic about Kafka’s virtues when something simple will work just as well.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Title: Use Kotlin instead of Java for new services

Date: 2018/10

Decision: We&apos;ll be using Kotlin whenever we start a new service but leave the existing ones

Context: We think Kotlin will help us create more lightweight services while improving quality thanks to null safety&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are &lt;a href=&quot;https://github.com/joelparkerhenderson/architecture_decision_record#adr-example-templates&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;many templates&lt;/a&gt; that you can use. The important part is to be disciplined and reflect what you agree upon.&lt;/p&gt;
&lt;h2&gt;Get huddling!&lt;/h2&gt;
&lt;p&gt;Looking back, all the teams I’ve been on have significantly benefited from having a place for developers to align. It’s a small investment of effort and time. Go ahead and give it a try and find the setup that works best for you.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: The art of leadership]]></title><description><![CDATA[In his newest book, Rands talks about leadership using his experience in different management roles in Silicon Valley companies]]></description><link>https://hceris.com/book-review-the-art-of-leadership/</link><guid isPermaLink="false">https://hceris.com/book-review-the-art-of-leadership/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Leadership]]></category><category><![CDATA[Rands]]></category><pubDate>Fri, 28 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 333px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a3e10039bab95a4eac1ab3f94a9bff09/77c11/cover.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7VLGNxFKbQxh/8QAGRABAAIDAAAAAAAAAAAAAAAAAQIgABEh/9oACAEBAAEFAqR0OPQjX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABgQAAIDAAAAAAAAAAAAAAAAAAEgEDFh/9oACAEBAAY/AkOza//EABsQAQACAwEBAAAAAAAAAAAAAAEQEQAhMXGR/9oACAEBAAE/Ia3dv2VDudr1e4GjBG7Psix//9oADAMBAAIAAwAAABCcz3D/xAAWEQEBAQAAAAAAAAAAAAAAAAABESD/2gAIAQMBAT8Qi4//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAdEAEAAgICAwAAAAAAAAAAAAABEDEAESFBUYGh/9oACAEBAAE/ENfg0kDaDAwPyldQKPYJZeA0sNcoaxDyB7j/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The Art of Leadership&quot; title=&quot;&quot; src=&quot;/static/a3e10039bab95a4eac1ab3f94a9bff09/77c11/cover.jpg&quot; srcset=&quot;/static/a3e10039bab95a4eac1ab3f94a9bff09/bc01b/cover.jpg 188w,
/static/a3e10039bab95a4eac1ab3f94a9bff09/77c11/cover.jpg 333w&quot; sizes=&quot;(max-width: 333px) 100vw, 333px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you have read &lt;a href=&quot;https://randsinrepose.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Rands in Repose&lt;/a&gt; long enough, this book will ring familiar. &lt;em&gt;Rands&lt;/em&gt; has a very particular way of writing about managing humans, as he likes to say. I find it kind of soothing. It’s his third book after &lt;a href=&quot;https://www.amazon.com/Managing-Humans-Humorous-Software-Engineering/dp/1430243147&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Managing humans&lt;/a&gt; and &lt;a href=&quot;https://www.amazon.com/Being-Geek-Software-Developers-Handbook/dp/0596155409&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Being Geek&lt;/a&gt;. Thematically it is much closer to the first one.&lt;/p&gt;
&lt;p&gt;This time around, he’s focused on giving actionable advice, with plenty of items about how to improve communication, run 1on1’s, or make meetings more effective. I’d say that’s the most valuable part of this book. Picking one or two things, and applying them in your regular day-to-day. You don’t need to be a manager for that, just like you don’t need to be a &lt;em&gt;Lead&lt;/em&gt; to practice leadership.&lt;/p&gt;
&lt;p&gt;How do you actually run a 1on1? Like, in practice. There are plenty of useless generalities out there, such as “you just have to listen”. But what do you do, how do you prepare? I remember when I first started doing regular 1on1s with everybody in my team. I didn’t really know how I was supposed to guide the conversations and, you know, &lt;em&gt;manage things&lt;/em&gt;. There is a lot of good advice to follow here.&lt;/p&gt;
&lt;p&gt;The problem with books that touch on managing or guiding people is that most situations require a lot of context to say something that truly applies to them. &lt;em&gt;Rands&lt;/em&gt; has written so much about these topics through the last twenty years that you see the patterns emerging, making it easier to digest.&lt;/p&gt;
&lt;p&gt;Which brings me to what I liked the least. &lt;em&gt;Rands&lt;/em&gt; has been on many of the most relevant SV companies. In this book, Netscape, Apple, and Slack are specifically mentioned. I bet there are plenty of interesting stories to share, situations that can make all this advice a lot more relatable. But he, as a matter of policy, never speaks about concrete people. So that’s out of the question. It’s understandable but a pity nonetheless. I think the book would benefit a lot from that.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;If you have been reading &lt;em&gt;Rands&lt;/em&gt; through the years, this book probably won’t tell you anything terribly new. I liked the &lt;em&gt;How to rands&lt;/em&gt; section a lot, that’s something that I want to copy.&lt;/p&gt;
&lt;p&gt;I only give it ⭐⭐⭐ stars because I feel like I’ve read most of it before. For new readers, I imagine it’ll be a lot more useful.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Understanding VPC endpoints]]></title><description><![CDATA[Using VPC endpoints helps keeping your network traffic away from prying eyes. I'm showing you how to provision them using Terraform]]></description><link>https://hceris.com/understanding-vpc-endpoints/</link><guid isPermaLink="false">https://hceris.com/understanding-vpc-endpoints/</guid><category><![CDATA[AWS]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[VPC]]></category><category><![CDATA[Networking]]></category><pubDate>Thu, 20 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 485px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ef6a957565cfc675c990047011368726/44c61/private_communication.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.68085106382979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYklEQVR42o2Uz0sUYRjHvQT9FUGnDkZRRIfo0F4kC+oUUh2KoMJDtw4dii4eCrSioiwhSAlCMk0rFFvLH5jK9gvTimRNXWd2dmbd3zs7887MJ+Z1d11zhR74wjPvPO/n/c48z0wNgOd5VIbnunKtpGo1m0VNqdASDt/DS8wpBrGcIJq10aQsbOGUoa7nblDloWVgpmDzW88ynzBRCh7Lpksk57KYFmQtUdywubMSpwzMFgSK6aEWPMK6RVi3UX1oVpArAz1iaZXIyjzLiT8oyQX0jCJdbnDou1hICiamkrwPGnwYMpgKpVhI2WQtS9b8VKY53LKThtYDXGiv59zTACfadvNpcVjed1ynCPQg7zh8nk4THNB5263S26nI/MtMmry76nAqPMKx2/u52nWRxo7jXOs5T8PjfQR/vCwCxXqHHycTDPRpvH6h0v0sQuhrmtC3JLF4Rh7aH3pD3c1dnHwQ4FRrgOs9jZx9EmBwtusfoO9QCCZCSfmofZ2K1Ph4QgLTZkFuGJ0d4lBTLacf1nGwaTuXn5/h6J1a3s32bHToA39FTEZHV+jvjUqnI8NxuZYXtqyZnBtj26WtElrfvJcjLXvYcWULgzNVgBnTlqPid9d/l778PJJ3yJirTUnmErQF73Kv/wa3XjXxKNhM+9h9tJRS7LK7BjRtwVLaQskJYraH4YBWADXrIKrMn8i7m89hcc5xHAfH9UgkUiwrKpquE9MNdMMgHo9jxOMoqoKma3JEfAlHrP9SSkmliVw+j6KqUj4sGtVQo1F5vRSJoKpRhFgb9krVVNIrfwb/E9Vq/wL+xgMv3RqpNwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Private communication&quot; title=&quot;&quot; src=&quot;/static/ef6a957565cfc675c990047011368726/44c61/private_communication.png&quot; srcset=&quot;/static/ef6a957565cfc675c990047011368726/4dcb9/private_communication.png 188w,
/static/ef6a957565cfc675c990047011368726/5ff7e/private_communication.png 375w,
/static/ef6a957565cfc675c990047011368726/44c61/private_communication.png 485w&quot; sizes=&quot;(max-width: 485px) 100vw, 485px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you are going to do one thing with your network traffic, it should be using https. But you already do that, don’t you? Once you have that in place, why not use &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;VPC endpoints&lt;/a&gt; to make your data flow through private channels?&lt;/p&gt;
&lt;p&gt;With VPC endpoints, you can connect to most AWS services without ever leaving Amazon’s network. Not only that, but you can connect two of your services in different VPCs, even across accounts. It doesn’t replace the need for &lt;a href=&quot;https://searchsecurity.techtarget.com/definition/end-to-end-encryption-E2EE&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;End-to-End Encryption&lt;/a&gt;, but it adds an extra layer of security. Maybe keeping the traffic private can help convince some cloud skeptics along the way.&lt;/p&gt;
&lt;p&gt;You’ll find many guides using the &lt;em&gt;AWS Management Console&lt;/em&gt;. Don’t do that. Let’s use &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; to provision them instead. Code is easier to follow than screenshots.&lt;/p&gt;
&lt;h2&gt;Accessing AWS services&lt;/h2&gt;
&lt;p&gt;A typical setup is having instances in a private subnet and go through a &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;NAT gateway&lt;/a&gt; to reach AWS services (i.e., S3).&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/00ef2251e1bc52ac06a58c67e05e0666/ae21e/connecting_to_s3_over_the_internet.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 78.19148936170212%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACjklEQVR42n2UzWsTYRDGe/R/8B8Qb54EDx4UwYMXL17EgxQvehM8eFTRKgWR0oNaP1Hbix5EURBBRK3RRrFpo9Jq0s3uu9ltNsl+Zz/zk2yTJo1tBx5m35nnfd7ZYZgRtrB2u73uq6aM0ix1Thtym9lIjzCMtHspiALOPDzGqYeHCeOArfg9jGz9Wq+alDvvJph8c3k9tp1lFbbiFCdMcaMUZxBhihenhElKEMV4YYAb+LhB+D8vStcq7AjW/ISKkyC7w0hR3IiFRYlCocyqo6JbAtWqZ7lBrnDjrE2ZoNHqBr20j+5ZcSLyX0t8+/oH3VbRbRnVNrq8LsdLqXrJgKC/ieA6Iio1iRXtLw1vFT+0qXvOAD9BcbcRVNxkCCGKrlNrGPzWF7j3ZZKP5Rx6C2Q33lyw18PeL1asENmJkO0QyWxR/L6KUgx4Nv+EnZd2cPHtBawYKnaQPdopRt3QwyBBBCnCT5F9kD0QPlQ8sgvFJYmlv4JFbZ6buUnel3JoARlXeO2sWt1P+4KaFbOsxihWjFiVUA0F1awjqn+oWnXKyk/KcgGtqWPVJAzLQK4JVL2MsC0WtAalht0fm9ePBeMnFX7MKtSmDtJ4egJ19j7G+C6M/BTa41HMR0dQ8zNo13ZjzF5HPD2Ld2svnxc/s+fGJ86/LPQH+9VMhfHTyxTmBMrd46jTo4j8M6SxfehzD5CmzyGmjlKdf8HK1f3oHyaQnl9BnzhA/tcch27nGHtb7AsarQiltTYiy5rKSqOG5prIZgPNtRB2E8VurseqjpnFZKuJ7jSpe3UM1+z3MAhjWlFKEHfQ3oC65VK3HBq2i2E6+GFCkKzlwq5vdbjJtsuhPeDbnQ3R/x7ODS2Hf/g8q+t10ZKsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Network setup&quot; title=&quot;&quot; src=&quot;/static/00ef2251e1bc52ac06a58c67e05e0666/1d69c/connecting_to_s3_over_the_internet.png&quot; srcset=&quot;/static/00ef2251e1bc52ac06a58c67e05e0666/4dcb9/connecting_to_s3_over_the_internet.png 188w,
/static/00ef2251e1bc52ac06a58c67e05e0666/5ff7e/connecting_to_s3_over_the_internet.png 375w,
/static/00ef2251e1bc52ac06a58c67e05e0666/1d69c/connecting_to_s3_over_the_internet.png 750w,
/static/00ef2251e1bc52ac06a58c67e05e0666/78797/connecting_to_s3_over_the_internet.png 1125w,
/static/00ef2251e1bc52ac06a58c67e05e0666/aa440/connecting_to_s3_over_the_internet.png 1500w,
/static/00ef2251e1bc52ac06a58c67e05e0666/ae21e/connecting_to_s3_over_the_internet.png 1537w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;We’ll replace the NAT gateway with a VPC endpoint so that we can reach S3 (or any other AWS service) without connectivity to the outside. There are two types of endpoints, &lt;code class=&quot;language-text&quot;&gt;Gateway&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Interface&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpce-gateway.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Gateway endpoint&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This type can be used for S3 and DynamoDB (don’t ask me why). I’m assuming that there is an existing VPC.&lt;/p&gt;
&lt;!-- vpc-endpoint-gateway --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_route_table&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_vpc_endpoint&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;s3&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token property&quot;&gt;vpc_endpoint_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Gateway&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;service_name&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;com.amazonaws.&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;.s3&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;route_table_ids&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;data.aws_route_table.this.id&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are a bunch of arguments that we can pass. Let’s have a look at the ones that are relevant for us:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;vpc_id&lt;/code&gt;: We always associate an endpoint with a &lt;a href=&quot;https://aws.amazon.om/vpc/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;VPC&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt;: In this case, &lt;code class=&quot;language-text&quot;&gt;Gateway&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;service_name&lt;/code&gt;: The URL associated with the service. I found &lt;a href=&quot;https://docs.aws.amazon.com/general/latest/gr/aws-general.pdf#aws-service-information&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this list&lt;/a&gt; as a reference.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;route_table_ids&lt;/code&gt;: For this type of endpoint, you have to specify a routing table, which will get an entry to route to the service. In our case, the routing table of the VPC.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And that’s it. S3 is now accessible from our private subnet without needing a NAT gateway. This kind of endpoint is free, by the way. Useful if you need to pull Docker images, for instance.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/vpce-interface.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Interface endpoint&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;For other AWS services, we use the &lt;code class=&quot;language-text&quot;&gt;Interface&lt;/code&gt; type. Let’s take accessing CloudWatch as an example. We define our endpoint like this:&lt;/p&gt;
&lt;!-- vpc-endpoint-interface --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_subnet_ids&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token keyword&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tag:Name&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.subnet_names
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_vpc_endpoint&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;log&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token property&quot;&gt;vpc_endpoint_type&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Interface&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;service_name&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;com.amazonaws.&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;.logs&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;subnet_ids&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_subnet_ids.this.ids
  &lt;span class=&quot;token property&quot;&gt;security_group_ids&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    aws_security_group.this.id,
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Both &lt;code class=&quot;language-text&quot;&gt;vpc_id&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;service_name&lt;/code&gt; work as before. &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt; is &lt;code class=&quot;language-text&quot;&gt;Interface&lt;/code&gt; this time. Some new arguments are coming  to the party:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;subnet_ids&lt;/code&gt;: Instead of a route table, we need the subnets accessing the endpoint. These are the private subnets where we put our instances.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;security_group_ids&lt;/code&gt;: We need an existing security group as well. This security group must allow inbound traffic on port 443, as well as outbound traffic (in case you want to touch the defaults).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;By default, we can reach the AWS service that we’re connecting through its DNS hostname. It can be disabled with &lt;code class=&quot;language-text&quot;&gt;private_dns_enabled&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Using policies to limit permissions&lt;/h3&gt;
&lt;p&gt;There is an extra argument, &lt;code class=&quot;language-text&quot;&gt;policy&lt;/code&gt;, where you can pass an IAM policy to restrict the permissions allowed by the endpoint. If you need a refresher on IAM, check &lt;a href=&quot;../aws-iam-an-overview/&quot;&gt;this article I wrote&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Accessing our own services&lt;/h2&gt;
&lt;p&gt;We have covered one aspect of endpoints, accessing AWS itself. But we can use it for our infrastructure as well. Consider this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c1edef36d56ecf2452f8a9c3627a6221/7fee5/connecting_two_services.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 121.27659574468086%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAECElEQVR42qWV228UVRzH+UNEXnghPEjig6KRGJEHxAQTNUqC0WA0YARLYjBEIdAmxBKuhaaNWKwGSGhRqCIK1Jh4SaFcTADXtrvsdS47s/fOzO7MzpzzMTvbrtsCgcSTfHPOnPzOZ36XM79ZACClvEc01BpyRvOf/9uTM/YL5JyDtIwa20bJouB4WD6UXUHFDUJN1wlV8SS2F7Re3mAtmF3ohQp5u0a5ccD18YUkklH5O51mUtNJFYtkbJ9kyWFCVZlQNWKmiW45CNn0tgUMhCRRdkhN+yiOIOsGVL0Ao2yi5OIks1EKloZquWiVCqoZJaHHyBYTFOwigaANKMMlpw4r9G5N099h8NPX5TCEwfHjvDTwLG+efJn1p14hVS4yliqysv931n41zore3xidVEJbIds89IWg5+MJdr8aoW9zhqF9ZmjUeXEHTx5azOvfrOapniXEiio/TuRZ1HWJtcevs7BrlJPXE8xG2QIKJF3v3WDryqsc3RzlxOeZJvDSTp44sIhVXyxn+ZGlRAsK5//J83jXZZ7rHeOxzlFO3AOUzboODcY5vD3CwJ44l0eaHv5w53s6zr3LtvMfsvviNtKVMjfVEpu/G+ejszfZODzOlaRG+9VrhhwIcoGgBOSBghA4bp2SXcH1bGoNudMo0zWy1jT1uobrGXh1neI9RZlxN+3QlAValbDKpm2Qr2UwHQXTSaNYVRTLJlstoFsmmmViWBWEnFNlSQBkLnSTPbGewshG8lf68IGxXzMMfBbldLfKzwM6yVKAqk6iD75G/uz7lM69RS55haaDoi1kCcnDa8juWkTx0FKKZ96hDgz3T7HtxVsc3ZTh2JYMkzqkbo2S2b4Qc98ySgcXk7/97QwwmJvDeN8G1N3LMPYsITv4Bh5w8uhttjx/lUObYhzZFCWiBtz9a5TkrqfR9z6D0bkQ48bpJlC0gM2Qp4a6mexZz9T+1SgXukOjX85P0bnhT/ZvucGpvRMkij5KMkKsZx2x3nUkD67AiP4xP2QZJjVXFcT1PHGjTKkObj0ga1VI53WmlBT6dAHFclFtj1ReJ5KIEc8ZGE4VIdqag5xtLfPaUyMNWVc0rxFgSInqCBQ7QHUkeg0UR5K1/VbralVZzuuJzT3JtWsVhvsMRo4VuXTaJlNpwIIQqth+OGed+cD7NdiZEM58qfDJqtsceDtJ3wcGMdVHc2e9bEDF/YFz2msbcHggSccLVxncmWBwh8pk2kP3/gdwZChNx5ox9m6M0P9pkrumj1oTZGwRwhqzbj8CcPZzNB0fpeSRyrmo5TpGrZGzpoyZuVB9RKDjOGi6jqZrmDkDM2eiaRp1zwuLJoRACjEHFv6kHgRsFqh95oHj4TmcA3242vvhv/b42HJ3A1RdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Connecting two services&quot; title=&quot;&quot; src=&quot;/static/c1edef36d56ecf2452f8a9c3627a6221/1d69c/connecting_two_services.png&quot; srcset=&quot;/static/c1edef36d56ecf2452f8a9c3627a6221/4dcb9/connecting_two_services.png 188w,
/static/c1edef36d56ecf2452f8a9c3627a6221/5ff7e/connecting_two_services.png 375w,
/static/c1edef36d56ecf2452f8a9c3627a6221/1d69c/connecting_two_services.png 750w,
/static/c1edef36d56ecf2452f8a9c3627a6221/7fee5/connecting_two_services.png 781w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;We have two services. Service A wants to reach Service B, which is exposed through an &lt;a href=&quot;https://aws.amazon.com/elasticloadbalancing/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ELB&lt;/a&gt;. Both services reside in different networks and might even be in different accounts.&lt;/p&gt;
&lt;p&gt;One solution is to make the load balancer publicly reachable. Then, our Service A can use a NAT gateway, as I described before.&lt;/p&gt;
&lt;p&gt;Or we can use endpoints again. To do so, we need a new toy, a &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/endpoint-service.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;VPC endpoint service&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Endpoint service&lt;/h3&gt;
&lt;p&gt;An endpoint service allows us to expose Service B. Once created, it gets assigned a &lt;code class=&quot;language-text&quot;&gt;service_name&lt;/code&gt;, that we can reference as an attribute.&lt;/p&gt;
&lt;!-- vpc-endpoint-service --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_subnet_ids&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token keyword&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tag:Name&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.subnet_names
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;               &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;internal-lb&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;load_balancer_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;network&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;subnets&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; data.aws_subnet_ids.this.ids
  &lt;span class=&quot;token property&quot;&gt;internal&lt;/span&gt;           &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_vpc_endpoint_service&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;network_load_balancer_arns&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;aws_lb.this.arn&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;allowed_principals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpce_allowed_principals
  &lt;span class=&quot;token property&quot;&gt;acceptance_required&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We configure it as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;network_load_balancer_arn&lt;/code&gt;: The service has to be attached to an existing (internal) network load balancer. That load balancer determines the VPC and subnets.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;allowed_principals&lt;/code&gt;: The list of actors that can connect to the service, like a list of AWS Accounts.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;acceptance_required&lt;/code&gt;: You can force the connections to be manually accepted. For automation reasons, it’s preferable to use &lt;code class=&quot;language-text&quot;&gt;allowed_principals&lt;/code&gt; to restrict access instead.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Connecting to the endpoint Service&lt;/h3&gt;
&lt;p&gt;We use an &lt;em&gt;Interface endpoint&lt;/em&gt; to connect to the service that we just created:&lt;/p&gt;
&lt;!-- vpc-endpoint-interface-own-service --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_vpc_endpoint&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;vpc_id&lt;/span&gt;            &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.vpc_id
  &lt;span class=&quot;token property&quot;&gt;vpc_endpoint_type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Interface&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;service_name&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_vpc_endpoint_service.this.service_name

  &lt;span class=&quot;token property&quot;&gt;subnet_ids&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.subnet_ids
  &lt;span class=&quot;token property&quot;&gt;security_group_ids&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;aws_security_group.this.id&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;output&lt;span class=&quot;token type variable&quot;&gt; &quot;dns_entry&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; aws_vpc_endpoint.this.dns_entry&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.dns_name
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The configuration is similar to what we did before. We get the &lt;code class=&quot;language-text&quot;&gt;service_name&lt;/code&gt; from the endpoint service directly.&lt;/p&gt;
&lt;p&gt;And now, the connection between the two is complete. Our Service A can reach Service B through the endpoint. That endpoint exports a &lt;code class=&quot;language-text&quot;&gt;dns_entry&lt;/code&gt; attribute so that we know what to use as a URL.&lt;/p&gt;
&lt;h3&gt;A note about availability zones&lt;/h3&gt;
&lt;p&gt;You need to remember one thing. A VPC endpoint can only connect to a VPC endpoint service in the same &lt;a href=&quot;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-availability-zones&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Availability Zone&lt;/a&gt;. That’s more relevant for a zone like &lt;code class=&quot;language-text&quot;&gt;us-east-1&lt;/code&gt;, which has six AZs.&lt;/p&gt;
&lt;p&gt;For the names to be consistent across accounts, you need to identify them with &lt;a href=&quot;https://docs.aws.amazon.com/ram/latest/userguide/working-with-az-ids.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Availability Zone IDs&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The end(point) justifies the means&lt;/h2&gt;
&lt;p&gt;I wasn’t a massive fan of endpoints when I started using them in my project, to be honest. But they have grown on me over time.&lt;/p&gt;
&lt;p&gt;Don’t use them to recreate an old-school on-premise setup. This idea of a huge private network where all the connections flow unimpeded doesn’t need to be recreated in the cloud.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: The software architect elevator]]></title><description><![CDATA[This book is an excellent source to be an effective architect bringing enterprises closer to be digitally native]]></description><link>https://hceris.com/book-review-software-architect-elevator/</link><guid isPermaLink="false">https://hceris.com/book-review-software-architect-elevator/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Architecture]]></category><category><![CDATA[DevOps]]></category><pubDate>Sun, 26 Jul 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 233px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bff61e37531de6f4cc5fc8e4540dc41b/397a5/elevator.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwH/xAAXAQADAQAAAAAAAAAAAAAAAAABAgME/9oADAMBAAIQAxAAAAGzNHbKo4ZwVZuHDo8//8QAGRABAQEBAQEAAAAAAAAAAAAAAQAREAID/9oACAEBAAEFAmd4PMIvGPD5kAWX/8QAGxEAAgEFAAAAAAAAAAAAAAAAAAISAQMRIjH/2gAIAQMBAT8BZSBbjPYbtcH/xAAcEQACAQUBAAAAAAAAAAAAAAAAAQIDERITISL/2gAIAQIBAT8BzRtRVu4eSL50/8QAFxABAQEBAAAAAAAAAAAAAAAAEDEgIf/aAAgBAQAGPwJpTuf/xAAeEAEAAgEEAwAAAAAAAAAAAAABABExECFhoVGRsf/aAAgBAQABPyFLj7Bk4lzheyFeTqW57EUN2/imbChiMLt0ivM//9oADAMBAAIAAwAAABB7yf7/xAAaEQEAAwADAAAAAAAAAAAAAAABABExIVHh/9oACAEDAQE/EEdZfuMBHHkNti5//8QAGxEBAAICAwAAAAAAAAAAAAAAAQARITFBYbH/2gAIAQIBAT8QC4nQwsFTj2UE2qf/xAAeEAEAAgICAwEAAAAAAAAAAAABABEhMcHRQVFhcf/aAAgBAQABPxBW2twERw82Qk6AxavoiXE9Js5Py4meWt4BoRUhQoWwBSv5LTC37ZnURbe5/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The Software Architect Elevator&quot; title=&quot;&quot; src=&quot;/static/bff61e37531de6f4cc5fc8e4540dc41b/397a5/elevator.jpg&quot; srcset=&quot;/static/bff61e37531de6f4cc5fc8e4540dc41b/bc01b/elevator.jpg 188w,
/static/bff61e37531de6f4cc5fc8e4540dc41b/397a5/elevator.jpg 233w&quot; sizes=&quot;(max-width: 233px) 100vw, 233px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you follow &lt;a href=&quot;https://www.enterpriseintegrationpatterns.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Gregor Hohpe’s&lt;/a&gt; blog, you will know his views on software architecture and its role in the enterprise. What I like is that he combines technical topics and how they apply to the business side, which is an extremely important conversation that we sometimes forget as technologists.&lt;/p&gt;
&lt;p&gt;So now he has another book about architecture out. What should a software architect do? How to be effective at communicating with different sorts of people? How do you get closer to what he calls a digital company? All those questions are answered with a lot of actionable advice and some dry humor.&lt;/p&gt;
&lt;p&gt;Moving fast and quality are not mutually exclusive. Properly defined boundaries help teams. Communicating effectively is extremely important. That’s pretty generic, though. What kind of documentation should an architect produce? How to make a more effective presentation? And how to use diagrams to convey your message better? That is actually something that you can apply right now.&lt;/p&gt;
&lt;h2&gt;Bad Agile&lt;/h2&gt;
&lt;p&gt;One pet peeve of mine is &lt;em&gt;claiming to do agile while doing the opposite&lt;/em&gt;. You know, saying that you do agile just because you do a standup where nothing useful is said. Or writing stories that have no provable value to the business. There are many examples.&lt;/p&gt;
&lt;p&gt;Another one is claiming that if you do agile, you don’t need any documentation. Instead, you better explain the same thing over and over, until eternity. That is nonsense, and we get here a few ideas on how to write documentation that will actually be &lt;em&gt;read&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;The power of automation&lt;/h2&gt;
&lt;p&gt;One prominent theme in the book is that the only way to truly achieve speed and minimize errors is to automate manual tasks. An automated task is going to be faster, less error-prone, repeatable, and trackable. Yet you often hear folks trying to skimp on automation to save a little bit of time. Seriously, don’t do that.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;You might think that if you are a developer, you don’t need to care about architecture in your organization, but that’s just not true. Everybody can influence the shape of the systems that they work with. Moreover, communicating effectively about it is of paramount importance to have any impact. That’s why this book is very useful and is worthy of ⭐⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A directory structure for React projects]]></title><description><![CDATA[How do you structure your components in a React application? I like to group mine around features close to the domain enforced by convention]]></description><link>https://hceris.com/a-directory-structure-for-react-projects/</link><guid isPermaLink="false">https://hceris.com/a-directory-structure-for-react-projects/</guid><category><![CDATA[React]]></category><category><![CDATA[TypeScript]]></category><category><![CDATA[Code Organization]]></category><pubDate>Sun, 19 Jul 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/19597ce04f3b3a49f5f8812a8ff44799/c3fd4/react-folders.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVR42mWST0hUURjF7zMIqWbRH11Vhlag/Z3zcsxFUBaJUhIhJanNGUGhiahV0UoiahNRq1zVLiIXtWjdul3QRuI8giBo46KVhN9XTNz542hz4ePet/m9851zQqgfygNlcRLKJygvU7aD8gJl9/j199HLbz6Gwplz2wGcBTAEYAuA0JgNh5knzDzePZRfo6ydsreUz1K+k1otXnr1IQyOjOWA/HEgPQBgcwswKitlFphZwnjLU8rvUz5N+WvKn9cU293pz8vhZqUShueftiGf7wDQBSDXAlyDZXaS8rl1oCuUk7J3zPwRZVPFpZVdI49fhLRQOAxgCsCx/4DWmE2UPShlVS9vUHaVsp+UP6R8nvJOZj5KrY5PfvoRBobO7wbQA2Bbq8JaEPF9hLJbNe9sgbJxyuYoe0/5M2Y+UVxayY0tLIa0MBCBgwD21oHJGrRUVehttfW9j7I7lF+gfJGyJ8xsmLLbcZPyn0roCiEC+gBcBLCvJZgqsJlyN+VFyjsof1lPuZuymfjD619+JbPLlZD2F6KiGEz0shPAnmhBszayEP2rezhaC8PbKe+lrEz5/mojvv1N0vREQ9FWAKcA9APoBXB6A7DuY/OdrfvOavWa+V4J61aMxY59PAggenroH7yWT2+WI+85AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;React folders&quot; title=&quot;&quot; src=&quot;/static/19597ce04f3b3a49f5f8812a8ff44799/1d69c/react-folders.png&quot; srcset=&quot;/static/19597ce04f3b3a49f5f8812a8ff44799/4dcb9/react-folders.png 188w,
/static/19597ce04f3b3a49f5f8812a8ff44799/5ff7e/react-folders.png 375w,
/static/19597ce04f3b3a49f5f8812a8ff44799/1d69c/react-folders.png 750w,
/static/19597ce04f3b3a49f5f8812a8ff44799/c3fd4/react-folders.png 854w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I’ve answered a variation of the question “How do you organize your components in a &lt;em&gt;React&lt;/em&gt; project?” a few times in our internal mailing lists over the last months. I wanted to share the structure that I have been using in my last projects.&lt;/p&gt;
&lt;p&gt;I have a &lt;a href=&quot;https://github.com/sirech/cookery2-frontend&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;small project&lt;/a&gt; that serves as an example. It is based around two simple concepts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Folders are Features&lt;/li&gt;
&lt;li&gt;Using &lt;code class=&quot;language-text&quot;&gt;index.ts&lt;/code&gt; to differentiate between public and private components.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Folders are features&lt;/h2&gt;
&lt;p&gt;I used to call this &lt;em&gt;structuring components vertically&lt;/em&gt;, but this name is more catchy! The idea is to move away from a functional structure, where you have things like &lt;code class=&quot;language-text&quot;&gt;controllers&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;models&lt;/code&gt;, or &lt;code class=&quot;language-text&quot;&gt;services&lt;/code&gt;. Instead, you group your code around features. A folder contains all that is needed to understand a particular feature in your app. The code maps the domain more closely. If you like &lt;a href=&quot;https://en.wikipedia.org/wiki/Domain-driven_design&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;domain-driven design&lt;/a&gt;, that should be music to your ears.&lt;/p&gt;
&lt;p&gt;Let’s have a look at one example. I have a view to show the details of a recipe, including the ingredients, and a list of steps. The data is fetched from the backend through a service. The page roughly looks like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f2a2c6b98e22658f6e1dccad2d766381/dd45a/recipe-details.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 93.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVR42oVU224TUQzctLln0zRJSS9AuSZCQmmynvEJleChFRLwyhPP8As88SP8LprIp9omkVjJWukc22c8HruYz+cFgILkQXP37X22+nlVVQ13b5HskDzWebFYLOTYBtAjeUJyHDYh+UQG4BWAlwBmcTYNm4TvKYBzM2vqpTbJK5IlgA4AvdQk2SB5RvIFgG8APpN8DmBkZkLZdPdGSimjHpHsFimlnruX9dLkFOVdkPxA8hPJjyQ9zlpFUWzLVtJIeKrSFTgAMNzlCIAcJre3t0J9amZn7j5090HcDcOvEbEqu6MXBhmhrNYQcTQ2MyUUb+/M7ER8kxwEt/WYRwjLHYQKuCQ5J/mG5PVms+kCWAB4K15Jnqt8odpLaGZlEC0r5QzgWmZmfREuiegfjasEIh4uM0WPSq41Qi+1Qx6Si+iQNJopJZWs7weALwC6kfhwU+Klk6DgJ4A/ANThHoCWJBMJf0lGKaWOwDxKmGFn2Ujc8chvAH+FZLPZiKeWmY2i3PcAvpPs55L3Ega6InjqBeozAH0zU7eP4+4ZgK8AUkzYMBKOtwnNTE0ZVlWVhT0KadS7PtW9u09jUgSg6+6zmOVMVSd3dduUm5sbBWmmn4ZsruKvwOOMKFBp7vvxeDN0O9CYtSNgDGASXGiGZ7EMcvKLEPgofEaxFPIymbp7M8/tUUpJVtzd3T1MS2hzFmMmRJcqvb7edlfaw75TMtn9/b0uG+FYRidzUD/PcGyjvV26/XL27CBkgSSvtTIQiorXq9WqWK/XW9//fnJSwHK5fECkhFpzZiYtHuW5P/T9A8CX8MFRcQu3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Recipe details&quot; title=&quot;&quot; src=&quot;/static/f2a2c6b98e22658f6e1dccad2d766381/dd45a/recipe-details.png&quot; srcset=&quot;/static/f2a2c6b98e22658f6e1dccad2d766381/4dcb9/recipe-details.png 188w,
/static/f2a2c6b98e22658f6e1dccad2d766381/5ff7e/recipe-details.png 375w,
/static/f2a2c6b98e22658f6e1dccad2d766381/dd45a/recipe-details.png 550w&quot; sizes=&quot;(max-width: 550px) 100vw, 550px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;In my code, I will group the whole feature in one folder, this way:&lt;/p&gt;
&lt;!-- recipe-details --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;recipe-details
├── Ingredients.tsx
├── RecipeDetails.test.tsx
├── RecipeDetails.tsx
├── Steps.tsx
├── __mocks__
│   └── recipeDetails.service.ts
├── index.ts
└── recipeDetails.service.ts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The main component is &lt;code class=&quot;language-text&quot;&gt;RecipeDetails&lt;/code&gt;. There are other smaller components, &lt;code class=&quot;language-text&quot;&gt;Ingredients&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Steps&lt;/code&gt;. There is a service that talks to an API, some tests, and mocks. By looking at this folder, I’m able to understand this feature without having to comb through multiple parts of my application.&lt;/p&gt;
&lt;h3&gt;Scaling it up&lt;/h3&gt;
&lt;p&gt;As your application gets more complex, these folders might grow to a point where there are too many files in one folder. Extracting components helps to keep them small.&lt;/p&gt;
&lt;p&gt;Another optimization we did in one project was to introduce the concept of &lt;code class=&quot;language-text&quot;&gt;pages&lt;/code&gt;. A page is just like a feature but is associated with a URL. Having your code broken down in pages aligns well with how users see your app, and it lends itself to code splitting down the line.&lt;/p&gt;
&lt;h2&gt;Use index.ts to differentiate between public and private components&lt;/h2&gt;
&lt;p&gt;With &lt;em&gt;TypeScript&lt;/em&gt;, you don’t have a way to group code in packages like you could do in something like &lt;em&gt;Kotlin&lt;/em&gt;. You can simulate it with folders, though. I like to use the &lt;code class=&quot;language-text&quot;&gt;index.ts&lt;/code&gt; for a folder as an entry point. You can only import components from the outside &lt;strong&gt;if&lt;/strong&gt; they are exported there. Coming back to our &lt;code class=&quot;language-text&quot;&gt;recipe-details&lt;/code&gt;, the only component I want to export is &lt;code class=&quot;language-text&quot;&gt;RecipeDetails&lt;/code&gt;, so my &lt;code class=&quot;language-text&quot;&gt;index.ts&lt;/code&gt; looks like this:&lt;/p&gt;
&lt;!-- index.ts --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./RecipeDetails&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which I import from the main &lt;code class=&quot;language-text&quot;&gt;App.tsx&lt;/code&gt; like this:&lt;/p&gt;
&lt;!-- import --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; RecipeDetails &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;recipe-details&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This convention is enforced with &lt;a href=&quot;https://eslint.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;eslint&lt;/a&gt;, with the help of the &lt;a href=&quot;https://github.com/benmosher/eslint-plugin-import/blob/master/docs/rules/no-internal-modules.md&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;eslint-plugin-import&lt;/a&gt; plugin. It is not a proper package system, but it works pretty well in practice.&lt;/p&gt;
&lt;p&gt;Both &lt;code class=&quot;language-text&quot;&gt;Ingredients&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Steps&lt;/code&gt; are private components. They are intended to be used only in the context of this folder to make sure that all the components remain small. They don’t have dedicated tests but are rather tested as part of the whole feature following the principles of &lt;a href=&quot;https://github.com/testing-library/react-testing-library&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React Testing Library&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Use absolute imports for public components&lt;/h3&gt;
&lt;p&gt;It just makes refactorings a lot easier.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Navigation &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;navigation&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is done with a small adjustment in the &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;include&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;src&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Generic components under &lt;code class=&quot;language-text&quot;&gt;components&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Beware of over-abstraction! Don’t try to create components that are too generic. It will end up bringing more complexity. If you do in fact have some components that can be reused, I like to put them in a &lt;code class=&quot;language-text&quot;&gt;components&lt;/code&gt; folder:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;components
├── adapter-link
│   ├── AdapterLink.tsx
│   └── index.ts
└── recipe
    ├── Recipe.test.tsx
    ├── Recipe.tsx
    ├── index.ts
    └── types.ts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Don’t be afraid to tinker&lt;/h2&gt;
&lt;p&gt;Nothing is set in stone. Keep the components small. Don’t let folders get too big. Group them when it makes sense. And give &lt;a href=&quot;../book-review-effective-typescript/&quot;&gt;Effective TypeScript&lt;/a&gt; a read, it’s a really good book.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Kotlin in Action]]></title><description><![CDATA[Kotlin in Action is an excellent resource to get started with Kotlin, a language that is quickly becoming an alternative to Java]]></description><link>https://hceris.com/book-review-kotlin-in-action/</link><guid isPermaLink="false">https://hceris.com/book-review-kotlin-in-action/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[Kotlin]]></category><pubDate>Sun, 28 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 350px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/eb69c5e5c82ef4645b26036684966186/70ebb/kotlin-in-action.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 125.53191489361701%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFBv/EABYBAQEBAAAAAAAAAAAAAAAAAAECAP/aAAwDAQACEAMQAAABV0GfqTVMWGc9ZjazKw0J/8QAHBAAAgMAAwEAAAAAAAAAAAAAAQIDBBIQETMy/9oACAEBAAEFAokO5nKop0sTHVrvVbyj9LQOq4zDH98f/8QAFhEBAQEAAAAAAAAAAAAAAAAAEAEC/9oACAEDAQE/AaaP/8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQIBAT8BIf/EAB0QAAIBBAMAAAAAAAAAAAAAAAACEQExYXEQIYH/2gAIAQEABj8CSuSVuSLTJTR6Jsnuws3E3z//xAAeEAEAAgEEAwAAAAAAAAAAAAABABEhEFFhsTFBof/aAAgBAQABPyFYyxHcw1y8QQCN7TAWKZvmUkNnpHd91L8Ve5SEV0xHEMi2fN71/9oADAMBAAIAAwAAABC39/D/xAAYEQEAAwEAAAAAAAAAAAAAAAABABAhEf/aAAgBAwEBPxDTHGHtf//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBEx/9oACAECAQE/EDSHI8r/xAAdEAEBAAICAwEAAAAAAAAAAAABEQAhMUEgccHw/9oACAEBAAE/EDiLtdBtcstAVG03hDgWqlwA0RQux1myYTtOWOS/0M+ZLkr08MIb+FdIr1i2iDSIrfvhl//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Kotlin in Action&quot; title=&quot;&quot; src=&quot;/static/eb69c5e5c82ef4645b26036684966186/70ebb/kotlin-in-action.jpg&quot; srcset=&quot;/static/eb69c5e5c82ef4645b26036684966186/bc01b/kotlin-in-action.jpg 188w,
/static/eb69c5e5c82ef4645b26036684966186/70ebb/kotlin-in-action.jpg 350w&quot; sizes=&quot;(max-width: 350px) 100vw, 350px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;&lt;em&gt;Kotlin&lt;/em&gt; has been an obsession of mine for the last two years. I remember advocating for immutable data and using streams in a project I was on, where we were stuck with &lt;em&gt;Java&lt;/em&gt;. Switching to &lt;em&gt;Kotlin&lt;/em&gt; was such a breath of fresh air. This is the book that helped me during that period.&lt;/p&gt;
&lt;p&gt;I would say the ideal target audience is folks who are already familiar with &lt;em&gt;Java&lt;/em&gt; and want to learn &lt;em&gt;Kotlin&lt;/em&gt;. You’ll get started faster, and you’ll be able to appreciate how much more concise and usable &lt;em&gt;Kotlin&lt;/em&gt; is. That seems to be a common origin for most people learning &lt;em&gt;Kotlin&lt;/em&gt;, but in any case, you should be able to pick it up regardless of your background, as long as you do have some experience programming.&lt;/p&gt;
&lt;h2&gt;Learning Kotlin&lt;/h2&gt;
&lt;p&gt;This book focuses on introducing you to &lt;em&gt;Kotlin&lt;/em&gt;, from its syntax to features like nullable types, collections, or operators. The later chapters are dedicated to some more advanced concepts, like reflection or building DSLs. Interestingly, &lt;a href=&quot;https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;coroutines&lt;/a&gt; don’t make an appearance.&lt;/p&gt;
&lt;p&gt;As usual with learning a new programming language, a healthy combination of reading and practicing is advisable. Given that there are no exercises to practice in the book, I recommend &lt;a href=&quot;https://exercism.io/tracks/kotlin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;exercism&lt;/a&gt; to get started and the &lt;a href=&quot;https://github.com/sirech/kotlintapas&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlin Tapas&lt;/a&gt; I shared some time ago.&lt;/p&gt;
&lt;p&gt;The book doesn’t make assumptions about your target environment. Whether you want to do backend development or mobile, it is the right place to get acquainted with the basic constructs of the language. It is written by two members of the core development team of &lt;em&gt;Kotlin&lt;/em&gt;, who are knowledgeable about the language and present it in a clear and approachable way.&lt;/p&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;As I mentioned, this book functions as an introduction to the language. If you want to explore it further, I liked &lt;a href=&quot;https://www.manning.com/books/the-joy-of-kotlin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;The joy of Kotlin&lt;/a&gt;, which is definitely not an introduction book. I’ve heard good things about &lt;a href=&quot;https://leanpub.com/effectivekotlin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Effective Kotlin&lt;/a&gt;, although I haven’t read that one myself.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;An excellent way of getting started with &lt;em&gt;Kotlin&lt;/em&gt;. It doesn’t go too much into idiomatic &lt;em&gt;Kotlin&lt;/em&gt;, however. Nevertheless, it’s worth ⭐⭐⭐⭐ stars for me.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Templating Concourse pipelines with Jsonnet: Follow-up]]></title><description><![CDATA[After building a bunch of big infrastructure pipelines for Concourse with jsonnet, I've some patterns to share to handle all that complexity]]></description><link>https://hceris.com/templating-concourse-pipelines-with-jsonnet-follow-up/</link><guid isPermaLink="false">https://hceris.com/templating-concourse-pipelines-with-jsonnet-follow-up/</guid><category><![CDATA[Concourse CI]]></category><category><![CDATA[Jsonnet]]></category><category><![CDATA[Templating]]></category><pubDate>Fri, 12 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Generating pipelines for Concourse using jsonnet&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../templating-concourse-pipelines-with-jsonnet/&quot;&gt;Part 1 - Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../templating-concourse-pipelines-with-jsonnet-follow-up/&quot;&gt;&lt;strong&gt;Part 2 - Follow-up&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/00538e4fa827f56bccc7081853cadddb/55811/logo.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACC0lEQVR42m2Sz0sUYRyH59gPiK5dSgxKxGrdnd2deX/Pzuy6O2tpqVGH1LRDkESZ2I9bJHZJBC3q0CU6lPQnVIeoQxSFQffoL3lqphw9eHh4X/jyPvD5vh9PKYXSO1C7IGWOVqrAKEVJKi4ayZtE5PO6lHg6ENhKiPUzBDqUaCG3TyHzx0brQpwRCsmMlawnmlctzXKsOWcUXjAWMzCfcuJGysm5DmHHImONSEyBX6vil8tYrXHWoo2l6yzrQxGPYsGTqM5aLFlNNN7A3dPs3Zxm/5cpDn64hH8hziWZOGxbgiHDqXKJgf5+Gs7RbbcxzjEeR9xvRbwd1nDe8rIlWG4ovNLiGY5+n+PY52v0vrtCkFpMTRSxTRb9f0wpJZG12ChiWIYsNRQfxxKYSdnoKB5kwsrtUQY3F6h+XaDv/dVtoVRIIQpEGObIMMQ6x0QzYbkT88LU+KHLPDUBq5HC67uTsufnZfZ9m+LAp8k8skwMQdsgjSpEzjmMMQT1er7Hbtphpdmgc6/LocejzF5vczO1eIMzLY48n6Dn2Ti9a2PURyJkbAibmkAE1HyfWrX6L7IQ+JUKzhiSZkIUSAZfT9P3a5Hy0mg+90wgceUQm1EJ0cF2XZQQRU22om/do8jRVI5jG5P0/J7n+MOzSKvw8uKaHewotN6FrYJnH+Skpv9WyuGVEUqzLdRf4R+fkm63ZWq0XwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;YAML and Concourse and Jsonnet&quot; title=&quot;&quot; src=&quot;/static/00538e4fa827f56bccc7081853cadddb/55811/logo.png&quot; srcset=&quot;/static/00538e4fa827f56bccc7081853cadddb/4dcb9/logo.png 188w,
/static/00538e4fa827f56bccc7081853cadddb/5ff7e/logo.png 375w,
/static/00538e4fa827f56bccc7081853cadddb/55811/logo.png 501w&quot; sizes=&quot;(max-width: 501px) 100vw, 501px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Around a month ago, I began experimenting with &lt;a href=&quot;https://jsonnet.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jsonnet&lt;/a&gt; to generate pipelines for &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Concourse&lt;/a&gt; programmatically. Since then, I’ve used it to build &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/pipelines-for-infrastructure-as-code&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;infrastructure pipelines&lt;/a&gt;. We provision infrastructure in AWS using &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt;. Before, the process was mostly manual. As we added more and more teams to our platform, that approach was becoming untenable. I want to expand on that first article and talk about what I’ve learned in the process.&lt;/p&gt;
&lt;h2&gt;Project-specific resources&lt;/h2&gt;
&lt;p&gt;I wrote a small &lt;a href=&quot;https://github.com/sirech/concourse-jsonnet-utils&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;library of generic helper functions&lt;/a&gt; while developing our pipelines. We have built custom resources on top of them that are specific to our use case. Thanks to the &lt;code class=&quot;language-text&quot;&gt;+:&lt;/code&gt; operator, we can override what we need while benefitting from sane defaults.&lt;/p&gt;
&lt;p&gt;We have &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt; resources adapted to include credentials:&lt;/p&gt;
&lt;!-- basic-resources-extended --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;GitResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; paths&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GitResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;%s/%s.git&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;git&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    source&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;prune&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;private_key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;((%s-deploy-key-%s))&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;product&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; paths&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;DockerResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;DockerResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tag&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    source&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;aws_access_key_id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;((aws-access-key-id))&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;aws_secret_access_key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;((aws-secret-access-key))&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We realized that all of our jobs were declaring the same inputs, so we built a resource for that as well.&lt;/p&gt;
&lt;!-- basic-resources-extended-inputs --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;Inputs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dependencies&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; trigger&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;source-code&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dependencies&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dependencies&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; trigger&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;trigger&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; trigger&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; source &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dev-tools&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;terraform-tools&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;container&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Helper functions&lt;/h2&gt;
&lt;p&gt;Whenever you try to reuse code with plain YAML, you end up hitting a wall. Even if you use &lt;a href=&quot;https://confluence.atlassian.com/bitbucket/yaml-anchors-960154027.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;anchors&lt;/a&gt;, they cannot be parameterized easily.&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;jsonnet&lt;/code&gt;, we can address that limitation by building simple functions to check conditions based on the environment.&lt;/p&gt;
&lt;!-- helper-functions --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;local config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extVar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;CONFIG&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;environments&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; env &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;objectFields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clusters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;isProdEnvironment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;accounts&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;product-prod&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;isNonProdEnvironment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isProdEnvironment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token literal-property property&quot;&gt;nonProdEnvironments&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isNonProdEnvironment&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;prodEnvironments&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isProdEnvironment&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environments&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see that there is a &lt;code class=&quot;language-text&quot;&gt;config&lt;/code&gt; object that we receive from the outside, which brings me to my next point, configuring different pipelines that share the same structure.&lt;/p&gt;
&lt;h2&gt;Configuring the pipelines&lt;/h2&gt;
&lt;p&gt;Our pipelines are deploying the same infrastructure for different teams. There are some differences like the product name, the number of environments to deploy, the regions, and things like that.&lt;/p&gt;
&lt;p&gt;We have found out that this configuration is easier to keep in a separate &lt;code class=&quot;language-text&quot;&gt;product.yaml&lt;/code&gt; file. That way, changes in the domain are seen more clearly, and new products are quick to spin up. It looks like this:&lt;/p&gt;
&lt;!-- product-yaml --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;product_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; new&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;product
&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; master

&lt;span class=&quot;token key atrule&quot;&gt;clusters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;eu-west-1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;prod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;eu-west-1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;us-east-1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;accounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;product&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;prod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;product-prod&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;jsonnet&lt;/code&gt; can receive external configuration (&lt;code class=&quot;language-text&quot;&gt;local config = std.extVar(&apos;CONFIG&apos;)&lt;/code&gt;), although you have to convert this file to &lt;code class=&quot;language-text&quot;&gt;json&lt;/code&gt; first.&lt;/p&gt;
&lt;h2&gt;Combining everything&lt;/h2&gt;
&lt;p&gt;By using all these helpers and abstractions, our actual pipeline definition is about 80 lines long. Here is a simplified version of the function that provisions a complete environment:&lt;/p&gt;
&lt;!-- pipeline-definition --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;local EnvironmentJobs&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  local regions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;objectFields&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clusters&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  local params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ENV&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; env &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  local modules &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    Job&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;cluster-services-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cluster-global-dns&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tasks&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;TaskPerRegion&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;module&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; regions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; module &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;system-services&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;monitoring&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;logging&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Job&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ingress-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cluster-services-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tasks&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;TaskPerRegion&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;module&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; regions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; module &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;private-ingress-app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;private-ingress-dispatcher&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Job&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;egress-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;cluster-services-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tasks&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TaskPerRegion&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;private-egress&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; regions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  modules &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    Job&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;smoketest-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;module&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; module &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; job &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; modules&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tasks&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      TaskPerRegion&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;smoketest&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; regions&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is no denying that this code gets pretty complex! That is hard to avoid, as the dependencies between different jobs are complex themselves. Trying to represent all these dependencies in YAML would be orders of magnitude more verbose.&lt;/p&gt;
&lt;h2&gt;The end result&lt;/h2&gt;
&lt;p&gt;Just to give you an idea, here is the graphical representation of the full pipeline for one of the products that we provision:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c16b81ec5b95af1847803c44bd7c9c48/1d69c/big-pipeline.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 21.27659574468085%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAp0lEQVR42lWQXQ6CQAyE907CwtJ2f0gMRkWMPnj/kwy2C0QfmnRmp+nXdUIEZoYMBBa2iqF62qsfe4LmJNRSrW+UuM6GbZYZTkWYIk6fEd2c0V0TmleBf2b4e4afs+n+ktAu2TJ+qbn2kdHdEpp3sZwudTshJ4YoETH6KWIYxXqlaOcEjpU4nMW0kovS8ZYvYp4zZKKjeD9t2Hr6OZno+IK/uT3/PXkFlT6JHIyev+cAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Huge infrastructure pipeline&quot; title=&quot;&quot; src=&quot;/static/c16b81ec5b95af1847803c44bd7c9c48/1d69c/big-pipeline.png&quot; srcset=&quot;/static/c16b81ec5b95af1847803c44bd7c9c48/4dcb9/big-pipeline.png 188w,
/static/c16b81ec5b95af1847803c44bd7c9c48/5ff7e/big-pipeline.png 375w,
/static/c16b81ec5b95af1847803c44bd7c9c48/1d69c/big-pipeline.png 750w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Yeah, you probably can’t even read the names of the jobs. That thing is huge! The actual YAML file has 2781 linesn if you are wondering. Why is it so large, you might ask. It is provisioning four different environments across different regions, for starters. We have tried to divide the infrastructure in smaller modules so that they are simpler to manage.&lt;/p&gt;
&lt;p&gt;The result is a lot easier to visualize that one big job. Smaller modules are a lot easier to apply and maintain, as well. Thanks to &lt;code class=&quot;language-text&quot;&gt;jsonnet&lt;/code&gt;, the complexity of managing the pipeline is greatly reduced. We tried for a bit to create this by hand, and it didn’t work at all.&lt;/p&gt;
&lt;h2&gt;Is it worth it?&lt;/h2&gt;
&lt;p&gt;If your pipelines share a similar structure and only some parameters differ, it is a clear yes. You are going to have a much easier time doing this.&lt;/p&gt;
&lt;p&gt;Even if there is no common structure to abstract, you can spare yourself a massive amount of YAML duplication, and reduce the accidental complexity. I would recommend exploring this option, although one has to be careful not to build something that becomes unmaintainable.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Securing DevOps]]></title><description><![CDATA[Securing DevOps offers plenty of actionable advice to make your setup, from CI to production, more secure]]></description><link>https://hceris.com/book-review-securing-devops/</link><guid isPermaLink="false">https://hceris.com/book-review-securing-devops/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Security]]></category><pubDate>Tue, 26 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 412px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8a1db19ef0e5502bf765b55f12d90ba6/9e32a/securing-devops.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXUlEQVR42o2Vi09TdxTH+RuWmT2chgLikg2TbRKhIM7HNre5scXHhs5HMsKQZAijvIRWypvysGBpb29hiIOB4yEKC9M5nYQxDaKwmZDNZVvUycQXj1LsAz5LLy1QrM5f8ss9N+n95HtOz/ccH2OYP+4rOJ9yP8TVgZSvWMSfXadxnimHg+npaZ7k+HjAwvwQnMCIQCpfforr3WdcQDtPenw8FMpdcXgAqpX+nO/smAFOzSmc//Smek6h3E9SWRXqS+66V/kkNZ29+YX8cfOWCzo1C3HfqQXvs0Bh3hXlMjRrVyCo1YhqNTeuXZd+6HA4/jddJ3QuZUlhANUhSylZtZyv0/ZzQqXiu46TdF68Mgu1TD6Q4pExMwNX/2Z6akpSb7XZ5il0pWsK9aXgjdfYFRdPXa0RQ2kx+sY2yo//QNbhVnRtpzF++yOahnYyq5soOHKMFGMjGVXf0HT2vGfKYpgfulA/ovYmUaDTcEQVx8Hkz6jUZlFmqieuSEBbcxSDWI26wojpVA9i+1mKGztQGOrRNnV6Ak1yGaVhy8lPUCAoMxAKFDTr0zGlfEqRIoc8RREVWflcHbgkfXj95y5+62yT4uHRCQavDc0Ana0iuOqol8v44oONREclUqjMplnIoKFczYm6JlqzlbQrk+gVy+mvq+K8TsMFfQk/afPoq9Zxb/DXh4FCqAz15mAy42JJjlFTnJLGld4uJsdGuSgU02eqYPBEkwS80lxHr1HLGbWCgYYafj/ZvgAYKkO/5kWM8e9Sl78bvSaXPEUqx8VK+nu6sYyOSB/YJiel9nDYbIzfGmLolz7sNhtWy8RcDQ1hAdSELCHl/fUU5yfQrIlFkaUiVZnMhXPf8++NG7g98cBqY2RklHGzGbNlkokHVsbGzZgnLM5OnFEohvujC15KRuRGDmuSKclXoF79PLWfv8e57nMzTevFKZI73PZzO0VqmVAZZeuD2L9rBwl7ovkoeg+VG56hWhVDY1MDo/fvefjXbTNnQ9vtDux2uxTPpBzuj7DKF922EE4d3E1OSSbbdu+kJXIxVWVKDtfXcvf2La9As9nMnTt3GR6+zcSEq4ZimD+HQvyI/3gdYu4eNh/IJnrndvLWLkGvzeFYcy12q/WhCeNt0khedqarXfMSO6Lj2BCTyKZ9WSi3RlL6+mLqDx2g86gBm8un3mALx5iPKWQpuRvDSYtNIC8hkYKkdDTRW2jZEkirNpOWxi9x2O1eU572Nr5EJ/DtCJJi9qFO3Y8mK4eyA0kIe9/hq5x9tHS0O6v/yDS9DliDXMbBdSvQfLiBtK1voYp6E82mYCoTt3NpoP+x6hbGPs7RZZRaxxdx1RK0wS9QErGMwpXPYUrZic3u8Fq3hTX0nNhy98QOQAwPoCp8GdpXnuW0ochrU884xsr4+PjD/7LgBrqUurdeRdDTXOvp8th684H/3Bzi8uUBRsfGuH9/BIvFsnBJzS0r516uCFrEX4/Yy49L+T/bqhExzEj+MAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Securing DevOps&quot; title=&quot;&quot; src=&quot;/static/8a1db19ef0e5502bf765b55f12d90ba6/9e32a/securing-devops.png&quot; srcset=&quot;/static/8a1db19ef0e5502bf765b55f12d90ba6/4dcb9/securing-devops.png 188w,
/static/8a1db19ef0e5502bf765b55f12d90ba6/5ff7e/securing-devops.png 375w,
/static/8a1db19ef0e5502bf765b55f12d90ba6/9e32a/securing-devops.png 412w&quot; sizes=&quot;(max-width: 412px) 100vw, 412px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Security is becoming more and more of a priority for every organization that develops software. Some seek to implement security through heavy process and control, filling out extensive checklists that get forgotten the second after they are completed. Others try to incorporate security in their daily life, leveraging automation, and aiming to implement &lt;a href=&quot;https://www.oreilly.com/library/view/devopssec/9781491971413/ch04.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Security as Code&lt;/a&gt;. This book is for the latter group.&lt;/p&gt;
&lt;p&gt;This book is structured like a tutorial, starting slow and easy and gradually increasing difficulty as you progress. It has some theory, but it is fairly light. There are high-level explanations for things like &lt;a href=&quot;https://en.wikipedia.org/wiki/Transport_Layer_Security&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TLS&lt;/a&gt;, &lt;a href=&quot;https://openid.net/connect/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OpenID Connect&lt;/a&gt;, or the &lt;a href=&quot;https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ACME&lt;/a&gt; protocol. Nothing too overwhelming, though. It is more about practices, tools, and checks to take a typical setup on the cloud and make it more resilient against bad actors. Which, for many, is a big step forward.&lt;/p&gt;
&lt;h2&gt;Practical advice&lt;/h2&gt;
&lt;p&gt;Throughout the book, you can find many actionable suggestions to bring improvements, one little step at a time. The focus is on cloud infrastructure, concretely on AWS. Unlike other resources I’ve seen, whenever the author is talking about hardening systems, he uses the CLI to set up things, and not the UI. That’s a very welcome change. If you want to create a reproducible setup, you need to use code to provision it. I would have liked it even more if it were using &lt;em&gt;Terraform&lt;/em&gt;, but the CLI is a good compromise to make it more accessible.&lt;/p&gt;
&lt;p&gt;While reading it, you keep finding nice little tools that you can add to your delivery pipeline, like &lt;a href=&quot;https://www.zaproxy.org/docs/docker/about/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ZAP&lt;/a&gt;. I adapted my ssh client configuration based on its &lt;a href=&quot;https://github.com/sirech/shell/blob/master/ssh/config#L1-L9&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;guidelines&lt;/a&gt;. In general, the book is full of &lt;em&gt;security nuggets&lt;/em&gt; worth checking. Maybe you already know all of them! Then it will be mostly a reminder not to forget them.&lt;/p&gt;
&lt;h2&gt;Food for thought&lt;/h2&gt;
&lt;p&gt;The last part is a bit less concrete. It talks about setting up logging and intrusion detection, among other things. It is harder to show specific examples, so you can take it more as an appetizer, and seek additional sources if you want more depth. I guess those parts might be less likely to be relevant for non-security specialists, but it’s good to know about them. Threat modeling makes an appearance, although I think the way to learn about that is with &lt;a href=&quot;https://martinfowler.com/articles/agile-threat-modelling.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;practical exercises&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;If you are looking for a deep treaty in algorithms, this is the wrong book. It is more of a handbook of useful recipes that can help you get started in some areas and refresh what you are already doing in others. It’s not too long, and pretty easy to digest. Let’s give it ⭐⭐⭐⭐ stars.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Templating Concourse pipelines with Jsonnet: An Introduction]]></title><description><![CDATA[Templating YAML pipelines using a tool like Jsonnet is a way of managing the complexity of pipelines that increase in size and complexity]]></description><link>https://hceris.com/templating-concourse-pipelines-with-jsonnet/</link><guid isPermaLink="false">https://hceris.com/templating-concourse-pipelines-with-jsonnet/</guid><category><![CDATA[Concourse CI]]></category><category><![CDATA[Jsonnet]]></category><category><![CDATA[Templating]]></category><pubDate>Tue, 19 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide clearfix&quot;&gt;
&lt;h3&gt;Generating pipelines for Concourse using jsonnet&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../templating-concourse-pipelines-with-jsonnet/&quot;&gt;&lt;strong&gt;Part 1 - Introduction&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../templating-concourse-pipelines-with-jsonnet-follow-up/&quot;&gt;Part 2 - Follow-up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/813f454ce9cf9cf63b201506e1ab38ba/17474/logo.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.61702127659575%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADPklEQVR42o1UXWgUVxT+5q7RIj6UlrQQfdA36UP7VFtEoSD0od3YKBEfjBt3Z6bZoBisEBOjYjWEkgcJooIJAZXGdLNdaMymy2bu7FaiTd3Y+ltt0uqWEOpWJbKb3WyyM3uPzGSyrm9+cBjm3HO+e88957uAzFEyhTP4yv59jq88pgxFIUBE+DdtYCpjON7FQAneUtI6yPwryNzNFF5l+ZgnWiLsvjpdIiyYguUKRdfgRMY1OpVlQJ9D6NWAnSPMpfJTTNXzksLJpeoEmacha61MiQK7EnasdSIL1nfJgg/S0JOzAL4DoOgSFHv38/DqBJ9GKxuvmvBxs6IhTlBiBFk7Blmzy8/OG/iiP7lEJhNR++hUrv1WKr8bCMK+J6bwDZA5rW+OFc8Ojhc7eodExw83qCcQMav2hgm+WO6tr6NrUc9Re+42Wyr54fP5O5MzCzQ4kaHhf2av48gfAOqiwJ6Rb1Y1xulJ6lmBaJ56e86L/6eTovvSgHhf/dGAGqcKVauB/z4+aji3vO7tDYzoCQs+TN+4Mpmh8f/mKJU1tcXr2GOXckiSOe37fqKwYAjKZNIicPmSOHG2X6xu0gzIOsGjba3adhKffSDht7p65C9eAIliMFsoZnrvvJjTk9kQlg8sNoWp+udWyUzWjdi9lOCjCdEb0kV3d09xbWOQoP46u8nXfrDzxLHwt11d4f7qmvDc0HCYiG4+nZnd0vn7i3d/TuYqcXQS2DX0F1bsi0NSuMZUnd5r+qXwjn/YqDxw3VhzIGZA0Qnbw6eJaPfB5mZq8NRT0qvS4+ZWsmEaH0/PFYHOv4Ham1icQWuAvbxSUnjMOqmkxq3OEnycKhpiIaejddq1azTQ2jZPP10xpk91GflHjy3KT631mbzpwuEHpcG2FbLxzDiYoldLCj8ChR92qXwL0ISUsAl9oVCIOo4fX7jQf9ncu3+/eSuRsAg/cTZ0uq/wV2rZGcFrMpM5Esn0MidB7evro02bN1O1203uL90UHRmxCDda66ZpsleifJ3EBYUvs03mbDKVczmENYFA4FEkErk9NjZ21+Px3N1RW/tnS0vLh21tbfD7/QxvAuE8AJZZieUol9+SJF8CC7okp8nweh4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;YAML and Concourse and Jsonnet&quot; title=&quot;&quot; src=&quot;/static/813f454ce9cf9cf63b201506e1ab38ba/17474/logo.png&quot; srcset=&quot;/static/813f454ce9cf9cf63b201506e1ab38ba/4dcb9/logo.png 188w,
/static/813f454ce9cf9cf63b201506e1ab38ba/17474/logo.png 312w&quot; sizes=&quot;(max-width: 312px) 100vw, 312px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If you talk about &lt;a href=&quot;https://www.thoughtworks.com/radar/techniques/templating-in-yaml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;templating in YAML&lt;/a&gt;, it’s bound to raise some eyebrows. It’s the perfect storm. A whitespace-aware templating language combined with some shitty annotations means you’re in for a world of pain. I recently tried to abuse &lt;a href=&quot;https://docs.gomplate.ca/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;gomplate&lt;/a&gt; to generate some &lt;em&gt;YAML&lt;/em&gt; files, and it was just gross.&lt;/p&gt;
&lt;p&gt;Let’s agree not to do it. It’s just not built for that. Nevertheless, at some point, &lt;em&gt;YAML&lt;/em&gt; documents get really difficult to handle. Like when you are defining pipelines in &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Concourse&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That’s why I want to talk about &lt;em&gt;templating that generates YAML&lt;/em&gt; instead. I’ve been using &lt;a href=&quot;https://jsonnet.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jsonnet&lt;/a&gt; for that, and I’m quite happy with the results thus far. The code is &lt;a href=&quot;https://github.com/sirech/example-concourse-pipeline&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt; if you want to jump straight to it.&lt;/p&gt;
&lt;h2&gt;What’s the point of templating, anyways?&lt;/h2&gt;
&lt;p&gt;In a nutshell, &lt;em&gt;YAML&lt;/em&gt; is &lt;strong&gt;very&lt;/strong&gt; verbose. It also happens to be the format of choice for most CI/CD tools. That means it’s pretty likely that you’ll be defining delivery pipelines using &lt;em&gt;YAML&lt;/em&gt; sooner or later. I’ve written in &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/modernizing-your-build-pipelines&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;depth&lt;/a&gt; about high-quality pipelines. I’m all about pipelines that tell me exactly what’s wrong, without having to examine tons of log output. Let’s say a job in my pipeline failed:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9e9c088749b3bd4672e54a436c7b0974/7d62e/failed-concourse-job.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 23.936170212765955%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVR42k2RvU7DQBCE/RrUUFFAYsf23e79xIagkCiAhBR+GiQ6BHTpqUlHBS0FbwBPw8N8kc8iohhpNasZzc5m3jmcag+nhFqIhcWL4rVDvxdV7qNyFRSjjk73pxVrqcoyzZk1JhExBhrjGDxM2X29QI4D2niqusQ7z3Qc+Z46PifKUWdWVZi6TqZniwWr1YpxjGSdWYIT2qFl/+OWnd9n7CTgfZ8ihMC8bflZRL5mgVaFohhS5DlqLdfLJev1mrZpyLbRvSOWwuHTKXtvl8gkYMUixlCrZV567PsN/uWcsRWGdsQoz4khJHSh0snb/lKHDm+EUEnq0ImiIqj23MHjjMHdCVJbRkWREnZG//+wAWcWsF+JFQJkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Failed Job&quot; title=&quot;&quot; src=&quot;/static/9e9c088749b3bd4672e54a436c7b0974/1d69c/failed-concourse-job.png&quot; srcset=&quot;/static/9e9c088749b3bd4672e54a436c7b0974/4dcb9/failed-concourse-job.png 188w,
/static/9e9c088749b3bd4672e54a436c7b0974/5ff7e/failed-concourse-job.png 375w,
/static/9e9c088749b3bd4672e54a436c7b0974/1d69c/failed-concourse-job.png 750w,
/static/9e9c088749b3bd4672e54a436c7b0974/78797/failed-concourse-job.png 1125w,
/static/9e9c088749b3bd4672e54a436c7b0974/aa440/failed-concourse-job.png 1500w,
/static/9e9c088749b3bd4672e54a436c7b0974/7d62e/failed-concourse-job.png 2368w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I know the linting failed. Which part exactly? If the job is nicely split into tasks, I can spot the problem at a glance:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/daf10ba4b9c0f005784e466b7e18fa61/799f3/failed-concourse-task.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 41.48936170212767%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABU0lEQVR42p3Py27UMBTG8TwEl0UXbXOxU8d2YidO5sIgQCxmoKpaIVatVFGpiynseYa+XdUFa1bdVek8wR8SUKlgRRc/fdY5Rz529P3oFTcfl9wczLk9XnJ3vKQ/WdHvd/TvAv37X+5G7T/6VcPmdJ/NyYrNpwOib2dzrr52XH+Yc7kInDeGL3XB5yp/YG/Mi1Kytn8TrN0ea6+4aAzR4WvL2zcFCy2J45gn27s829nl6QND7Xmcsq0KpK8RziNcTV4HpG/IKkesLVtCEtmyQuWa0nmMUjijCc4xbRpa75iFwDQEZm1gMZmMXnQdL2dT5l07WkwnY1pTEM28oykNbVWihUBLgZESm0tMPmT+25/a0L/P+7NgMlw4vMYZQ2U0eZo+mkwSSl0QOecwWmONIU0SsjR9lCRJUIUiqr2ntJY2BAqlEMO2LEP8h2E+y1L0zy//ANfACbg6qkURAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Failed Task&quot; title=&quot;&quot; src=&quot;/static/daf10ba4b9c0f005784e466b7e18fa61/1d69c/failed-concourse-task.png&quot; srcset=&quot;/static/daf10ba4b9c0f005784e466b7e18fa61/4dcb9/failed-concourse-task.png 188w,
/static/daf10ba4b9c0f005784e466b7e18fa61/5ff7e/failed-concourse-task.png 375w,
/static/daf10ba4b9c0f005784e466b7e18fa61/1d69c/failed-concourse-task.png 750w,
/static/daf10ba4b9c0f005784e466b7e18fa61/78797/failed-concourse-task.png 1125w,
/static/daf10ba4b9c0f005784e466b7e18fa61/aa440/failed-concourse-task.png 1500w,
/static/daf10ba4b9c0f005784e466b7e18fa61/799f3/failed-concourse-task.png 1642w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I have a granular breakdown, including every task, and I can directly go to the error without an archeological investigation. The downside, though? A lot of markup. Like really, a lot. This is how this innocent linter task looks like:&lt;/p&gt;
&lt;!-- linter-task --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lint
  &lt;span class=&quot;token key atrule&quot;&gt;serial&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;plan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;in_parallel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
      &lt;span class=&quot;token key atrule&quot;&gt;passed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;prepare&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;passed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;prepare&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;in_parallel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;sh
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token important&quot;&gt;*common-params&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sh
      &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git/pipeline/tasks/linter/task.yml
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;js
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token important&quot;&gt;*common-params&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; js
      &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git/pipeline/tasks/linter/task.yml
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;css
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token important&quot;&gt;*common-params&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; css
      &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git/pipeline/tasks/linter/task.yml
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lint&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;docker
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token important&quot;&gt;*common-params&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker
      &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git/pipeline/tasks/linter/task.yml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This task definition is using anchors and a parametrized task to reduce duplication, which is about the most you can do in &lt;em&gt;Concourse&lt;/em&gt;. Still, this is way too much code. And it just gets bigger and bigger as the pipeline grows in functionality. &lt;em&gt;YAML&lt;/em&gt; doesn’t really give us a way to fight duplication.&lt;/p&gt;
&lt;h2&gt;Jsonnet to the rescue&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Jsonnet&lt;/em&gt; is a data templating language. You define your data, and it creates one or more &lt;em&gt;JSON&lt;/em&gt; documents for you. The crucial part is that it gives you functions, conditionals, variables, and other tools to build more powerful abstractions. Just what I need! After a quick &lt;code class=&quot;language-text&quot;&gt;brew install jsonnet&lt;/code&gt;, we can get going.&lt;/p&gt;
&lt;p&gt;As you surely know, &lt;em&gt;YAML&lt;/em&gt; is a superset of &lt;em&gt;JSON&lt;/em&gt;. If this tool is outputting &lt;em&gt;JSON&lt;/em&gt;, we can convert it to &lt;em&gt;YAML&lt;/em&gt; without loss. We are going to build a pipeline that will be lean and maintainable without any ugly hacks.&lt;/p&gt;
&lt;h3&gt;A small library of utility functions&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Concourse&lt;/em&gt; has a bunch of basic abstractions. You have &lt;a href=&quot;https://concourse-ci.org/resources.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;resources&lt;/a&gt;, &lt;a href=&quot;https://concourse-ci.org/jobs.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jobs&lt;/a&gt;, and &lt;a href=&quot;https://concourse-ci.org/tasks.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tasks&lt;/a&gt;, among others. Each of those is represented by an object with some attributes. We can instantiate one by using functions that receive a configuration and emit a valid object. Here are some examples:&lt;/p&gt;
&lt;!-- basic-resources --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;DockerResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;latest&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; allow_insecure &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;docker-image&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;repository&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; tag
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; allow_insecure then &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;insecure_registries&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;repository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;


  &lt;span class=&quot;token function&quot;&gt;Parallel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tasks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;in_parallel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; tasks
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;Job&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; serial &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; plan &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;prune&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;serial&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; serial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;plan&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; plan
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can use them as regular functions inside a &lt;code class=&quot;language-text&quot;&gt;.jsonnet&lt;/code&gt; file after importing the library.&lt;/p&gt;
&lt;!-- git-resource --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;local concourse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;concourse.libsonnet&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GitResource&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;https://github.com/sirech/example-concourse-pipeline.git&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The syntax somehow resembles both &lt;em&gt;JavaScript&lt;/em&gt; and &lt;em&gt;Python&lt;/em&gt;. It’s not quite a programming language, but you have some more toys to play with. Additionally, there is a big &lt;a href=&quot;https://jsonnet.org/ref/stdlib.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;standard library&lt;/a&gt; to use. I’ve packaged these building blocks as a &lt;a href=&quot;https://github.com/sirech/concourse-jsonnet-utils&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;small library&lt;/a&gt; that can be reused by just pulling the code.&lt;/p&gt;
&lt;h3&gt;Less YAML, more Jsonnet&lt;/h3&gt;
&lt;p&gt;Let’s say we are defining our &lt;code class=&quot;language-text&quot;&gt;resources&lt;/code&gt;. I have a sample project where it looks like this:&lt;/p&gt;
&lt;!-- resources --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
  &lt;span class=&quot;token key atrule&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/sirech/example&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;concourse&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pipeline.git
    &lt;span class=&quot;token key atrule&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; master

&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;image
  &lt;span class=&quot;token key atrule&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;repository&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; registry&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;5000/dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;insecure_registries&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; registry&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; serverspec&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;image
  &lt;span class=&quot;token key atrule&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;repository&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sirech/dind&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ruby
    &lt;span class=&quot;token key atrule&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 2.6.3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s not a lot of code, but you can feel that the structure is pretty repetitive. With the help of our previously defined helpers, we can do better.&lt;/p&gt;
&lt;!-- jsonnet-resources --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;local source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;git&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
local container &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;dev-container&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

local resources &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GitResource&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;https://github.com/sirech/example-concourse-pipeline.git&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DockerResource&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;container&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;registry:5000/dev-container&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; allow_insecure &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DockerResource&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;serverspec-container&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sirech/dind-ruby&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;2.6.3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using the &lt;code class=&quot;language-text&quot;&gt;GitResource&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;DockerResource&lt;/code&gt;, we got something much more compact without losing readability.&lt;/p&gt;
&lt;h3&gt;Building your own DSL&lt;/h3&gt;
&lt;p&gt;Every pipeline is different, which means a generic abstraction is hard to find. But within a pipeline, you tend to see certain patterns emerging. We create them to make the &lt;em&gt;YAML&lt;/em&gt; overdose easier to swallow, even if we are still relying on copy-paste.&lt;/p&gt;
&lt;p&gt;What if you build a small DSL to express these patterns? I mostly pass the same inputs to every job, so I have a function to fetch them in parallel:&lt;/p&gt;
&lt;!-- get-resource --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;local Inputs&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dependencies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Parallel&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dependencies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; dependencies&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; s &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; container&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see that through variables, I keep this in sync with the resources I defined above. You can use &lt;a href=&quot;https://www.pythonforbeginners.com/basics/list-comprehensions-in-python&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;list comprehensions&lt;/a&gt; to make the code more expressive.&lt;/p&gt;
&lt;p&gt;My &lt;a href=&quot;https://concourse-ci.org/tasks.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tasks definitions&lt;/a&gt; follow a defined structure, as well. They are stored in the &lt;code class=&quot;language-text&quot;&gt;source&lt;/code&gt;, in a defined folder. We set some baseline parameters. All that context goes into a pipeline specific way of creating tasks.&lt;/p&gt;
&lt;!-- task --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;local Task&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; container&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  task&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  image&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; image&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  params&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; CI&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; true &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;%s/pipeline/tasks/%s/task.yml&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Step by step, we have a tailor-made set of functions that produce a smaller pipeline. It is more consistent and easier to change.&lt;/p&gt;
&lt;h3&gt;Back to the huge linter job that we started with&lt;/h3&gt;
&lt;p&gt;That &lt;em&gt;linter&lt;/em&gt; job has a ton of repetition. It’s time to compose all these smaller blocks into one job definition. The structure looks like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bf3ff57a63b332639ce8af182039b061/01e7c/jsonnet-job.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.8936170212766%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42oVTbW/aYAx8QsugLwxCWlbWbV23VmiICuE7O/wD/v8/mi5yUNRV2oeT87ydzz6nkCyHw6GQ/ERyAmCimBi7+9jMxoO9D+Hu4igFQEVyCWBBcp6xxyrxMNh7j7neZyxinZKstRAAlFStRL8AbEiupbS/M7w3wF1H6O6S+1mS3b06Ho/FzHRhRHKWmRcRcZFtuQHwDOBKpHlXaDpCM5uY2VwH2+22tG07BvDdzNZ6oETqcdu2+r7Pah5J/pAqAF8jojoTZlO7+kUKYAVgTfKnopnNtC/iiFCPrwH8znZU7r509xGA5T+EiS9J9pJNrzebjRJdmlnj7rckX3tCADWAURrTuaxRUea+rAcpUynKmiqvREbym7tPk/A5BXQKc1LOpsxV0m63U4JHlWRmrwDu3V0mdP1190WuX2RM27b/V2hm6mETEXVErKQoIqSkMjMZMgPwBuBPViSFF1lNRzjNLOf5UsaIECo9Op1O/dmdu6vHTyQ1CbWZqQqdNX3J/Z/SpPUd0rVlH9MgzaVMkdPXg/VsODbloz9gGPf7vVqhwZ4m0c073KYx5S9sM6kaA4b1pwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Diagram of a job&quot; title=&quot;&quot; src=&quot;/static/bf3ff57a63b332639ce8af182039b061/01e7c/jsonnet-job.png&quot; srcset=&quot;/static/bf3ff57a63b332639ce8af182039b061/4dcb9/jsonnet-job.png 188w,
/static/bf3ff57a63b332639ce8af182039b061/5ff7e/jsonnet-job.png 375w,
/static/bf3ff57a63b332639ce8af182039b061/01e7c/jsonnet-job.png 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;We have a &lt;code class=&quot;language-text&quot;&gt;Job&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Inputs&lt;/code&gt;, and some &lt;code class=&quot;language-text&quot;&gt;Tasks&lt;/code&gt;. Let’s use all the functions that we defined:&lt;/p&gt;
&lt;!-- full-job --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Job&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;lint&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; plan &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  Inputs&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;prepare&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  concourse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Parallel&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Task&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;lint-%s&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; lang&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;linter&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; TARGET&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; lang &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; lang &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sh&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;css&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;docker&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I really like this one! Is it too smart for its own good? I think not! You see a clear structure. If you need to change or add something, you do it once, not multiple times. We have gone from around 30 lines of pure repetition to a tight block that still communicates clearly what it does.&lt;/p&gt;
&lt;h2&gt;How to generate a pipeline from this&lt;/h2&gt;
&lt;p&gt;I like to convert the &lt;code class=&quot;language-text&quot;&gt;json&lt;/code&gt; output to &lt;em&gt;YAML&lt;/em&gt;, and use &lt;code class=&quot;language-text&quot;&gt;fly set-pipeline&lt;/code&gt; with the generated file. This is the script:&lt;/p&gt;
&lt;!-- generating-pipeline --&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;json2yaml&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  python3 &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;import sys, yaml, json; print(yaml.dump(json.loads(sys.stdin.read())))&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function-name function&quot;&gt;goal_generate-pipeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;FILES&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;jsonnet pipeline.jsonnet &lt;span class=&quot;token parameter variable&quot;&gt;-J&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;/concourse-jsonnet-utils &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token for-or-select variable&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$FILES&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    json2yaml &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$file&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${file&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;.json}&lt;/span&gt;.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$file&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I had some reservations when I started with &lt;em&gt;Jsonnet&lt;/em&gt;, but I’m really impressed. You can truly reduce the amount of duplication. Check &lt;a href=&quot;https://github.com/sirech/example-concourse-pipeline/blob/master/pipeline.jsonnet&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this pipeline&lt;/a&gt; to get a first taste. I’ll try to get a bigger example for a future post, where we were dealing with a huge 500+ line infrastructure pipeline that we beat into shape.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Book Review: Effective TypeScript]]></title><description><![CDATA[If there is one book to read about TypeScript, it's got to be Effective TypeScript]]></description><link>https://hceris.com/book-review-effective-typescript/</link><guid isPermaLink="false">https://hceris.com/book-review-effective-typescript/</guid><category><![CDATA[Book Review]]></category><category><![CDATA[TypeScript]]></category><pubDate>Sat, 25 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 267px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9e73dc3fcfae93495a277cda2fcc2f11/05876/effective-ts.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 130.85106382978722%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgUD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdS1lofArLe7rQyQV//EAB0QAAICAQUAAAAAAAAAAAAAAAECAAMSEBETITP/2gAIAQEAAQUCzOXJOjHVIrLYQNpfWbrqQor0HqJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHxAAAAUEAwAAAAAAAAAAAAAAAAECEBESITGhQlGB/9oACAEBAAY/AjtsY2LCpYhCJLtqeKcgqSh1+N//xAAcEAEBAQEAAgMAAAAAAAAAAAABEQAxIUEQUWH/2gAIAQEAAT8hRlYM9cO8yyzh6BwBkB7d5a/w8hiMNDFToGecKfoPp+A3PnO//9oADAMBAAIAAwAAABDvBPD/xAAVEQEBAAAAAAAAAAAAAAAAAAAgMf/aAAgBAwEBPxCj/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQIBAT8QSP/EAB0QAQEAAgMAAwAAAAAAAAAAAAERACExQWEQUXH/2gAIAQEAAT8QLgvCV1NPm8XtrloB24ZQLKNxgCNiQMCmqUEB+e5G4FsCZLjPJDgOl731kkw0hHsE+78AVALthy4DUJFPZzgCQDef/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Effective TypeScript&quot; title=&quot;&quot; src=&quot;/static/9e73dc3fcfae93495a277cda2fcc2f11/05876/effective-ts.jpg&quot; srcset=&quot;/static/9e73dc3fcfae93495a277cda2fcc2f11/bc01b/effective-ts.jpg 188w,
/static/9e73dc3fcfae93495a277cda2fcc2f11/05876/effective-ts.jpg 267w&quot; sizes=&quot;(max-width: 267px) 100vw, 267px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Maybe it’s just my experience, but I used to think of &lt;a href=&quot;https://www.typescriptlang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TypeScript&lt;/a&gt; as the programming language without a fanbase. Too formal for the &lt;em&gt;JavaScript&lt;/em&gt; crowd, with all those types getting in the way. Yet too lax for the &lt;em&gt;Java&lt;/em&gt; folks, used to structure and order.&lt;/p&gt;
&lt;p&gt;I didn’t spend much time learning the language when I started using it. I remember my confusion when I discovered that due to structural typing, you can assign the same object to two classes with the same shape. What the hell is that?&lt;/p&gt;
&lt;p&gt;Then at some point, I read &lt;a href=&quot;https://www.oreilly.com/library/view/effective-typescript/9781492053736/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Effective TypeScript&lt;/a&gt;. After that, I felt like when I discovered as a kid that scissors are way easier to use with your right hand (I’m left-handed). I wasn’t stupid after all. I was just misusing the tool!&lt;/p&gt;
&lt;h2&gt;Should &lt;strong&gt;you&lt;/strong&gt; read it?&lt;/h2&gt;
&lt;p&gt;Yes! Fittingly, it follows a similar structure to &lt;a href=&quot;https://www.oreilly.com/library/view/effective-java-3rd/9780134686097/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Effective Java&lt;/a&gt; (the best book about a programming language, IMO). It’s not a book to learn &lt;em&gt;TypeScript&lt;/em&gt;. It is a book about learning how to use &lt;em&gt;TypeScript&lt;/em&gt; &lt;strong&gt;effectively&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;There are 62 items across its roughly 240 pages. Each item offers actionable advice on how to write better &lt;em&gt;TypeScript&lt;/em&gt; code, providing examples and explaining some of the misunderstood or little known features that &lt;em&gt;TypeScript&lt;/em&gt; throws at you.&lt;/p&gt;
&lt;p&gt;Given that &lt;em&gt;TypeScript&lt;/em&gt; is mostly about enhancing &lt;em&gt;JavaScript&lt;/em&gt; with types, this book is mostly about using types to make your code more self-descriptive and catch errors. If you have come in contact with one of these awful codebases where people gave up in the middle and littered the code with &lt;code class=&quot;language-text&quot;&gt;any&lt;/code&gt; annotations, you’ll understand exactly what I mean.&lt;/p&gt;
&lt;p&gt;Just as an appetizer, let’s have a look at some actual items.&lt;/p&gt;
&lt;h2&gt;Item 37: Consider brands for nominal typing&lt;/h2&gt;
&lt;p&gt;Structural typing can lead to unexpected results. This object:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;can be assigned to this two classes.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserId&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VehicleId&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;While technically correct, you probably didn’t mean this! In a project, we had a production bug because of this. So what do you do? Well, you brand your classes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserId&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  _brand&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;user-id&apos;&lt;/span&gt;
  id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Item 28: Prefer types that always represent valid states&lt;/h2&gt;
&lt;p&gt;Union types are a way of dealing with objects being possibly in different states. Let’s say you are loading a user, and you have to wait for it to load before accessing any property. You can use a ton of optional fields, or you can use a tagged union:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoadingUser&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;loading&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoadedUser&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  firstName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; LoadingUser &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; LoadedUser&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thanks to type narrowing (&lt;em&gt;Item 22&lt;/em&gt;), your code will be a lot tighter and typesafe this way. Once you get used to this style, you’ll notice that many libraries don’t follow this pattern, making things a lot more brittle than they should be.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;Compact, informative, even eye-opening. &lt;em&gt;Effective TypeScript&lt;/em&gt; is a clear ⭐⭐⭐⭐⭐. Now that both &lt;em&gt;Angular&lt;/em&gt; and &lt;em&gt;React&lt;/em&gt; seem to use &lt;em&gt;TypeScript&lt;/em&gt; as their default, you can’t afford to miss this one.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Either Types extended version]]></title><description><![CDATA[The extended version of my article about Either types just got published in our corporate blog]]></description><link>https://hceris.com/either-types-longer-form/</link><guid isPermaLink="false">https://hceris.com/either-types-longer-form/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[Functional Programming]]></category><category><![CDATA[Arrow]]></category><category><![CDATA[Exceptions]]></category><category><![CDATA[Either]]></category><pubDate>Thu, 23 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/either-data-type-alternative-throwing-exceptions&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;a lot to say about Either types using Kotlin&lt;/a&gt;. It just got published in our company blog. I had written about this &lt;a href=&quot;../kotlin-either-types-instead-of-exceptions/&quot;&gt;here&lt;/a&gt; before. This is a slightly longer version with nicer graphics. Check it out if you hadn’t before!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Useful commands to work with certificates]]></title><description><![CDATA[A collection of commands to work with certificates for common operations]]></description><link>https://hceris.com/useful-commands-to-work-with-certificates/</link><guid isPermaLink="false">https://hceris.com/useful-commands-to-work-with-certificates/</guid><category><![CDATA[Certificates]]></category><category><![CDATA[SSL]]></category><category><![CDATA[openssl]]></category><pubDate>Wed, 08 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 336px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c301cb5811ee88e6b667bf76fe9d8412/d99f2/https.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.680851063829785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVR42pWQzWrCQBSF8zY+ja/iPrTgStBFEaRdumq7dtNiK6WtJY0gNZMZZzKJf5CKCflxkSZq0tFMMZHsSum3ONxz4cA9VzgcDuH/iaIoTVNhOp3KsqxCFagAADACIwCAAhQFKEefLYEK1IzMAISQJEmmaQoQwvV6zTmPWcz/Is3gnFuWRSkV0Bhtgo30KTXfm2zPXhevTuhQlxKH+JEfxuHme7NNtoyx2Wy2XC4ty8rDhmEIEMEkTCp3ldJFiTq09dYSH8Wzh/PGS6MpNatP1Xq/Ls/llbkiGoEQBkHAObdt+xSOw/hyeFW+Lttfdn/R75DOLbjpGl3xXqw919of7Z7WwwBPphOEUH7/KYwQyjvnZU7d+HF2Iqd4xG63S5IkjuMirOu6QCkdDoca1cZ4TAjBGsYE5zrRJ5qmYYIJIbqu0wxCiGEYg8FgPp8LjDHvF1zXdT23mAv1PM/3/f1+/wNEzNc843TeKgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;https&quot; title=&quot;&quot; src=&quot;/static/c301cb5811ee88e6b667bf76fe9d8412/d99f2/https.png&quot; srcset=&quot;/static/c301cb5811ee88e6b667bf76fe9d8412/4dcb9/https.png 188w,
/static/c301cb5811ee88e6b667bf76fe9d8412/d99f2/https.png 336w&quot; sizes=&quot;(max-width: 336px) 100vw, 336px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;We seem to have switched to &lt;em&gt;https&lt;/em&gt; finally. That means we use certificates all the time, often without paying them much attention. How do you &lt;em&gt;see&lt;/em&gt; the content of a certificate? Convert it to a different format? There are a bunch of useful commands that are hard to remember unless you use them frequently (or, conveniently, find a post about the topic). I want to share some of them, focusing on doing things from the command line. Maybe you have seen &lt;a href=&quot;https://www.sslshopper.com/article-most-common-openssl-commands.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this wonderful article about OpenSSL commands already&lt;/a&gt;. I hope I can provide a bit more context.&lt;/p&gt;
&lt;p&gt;As a refresher, we mostly use certificates to verify the identity of a server when using &lt;em&gt;https&lt;/em&gt;. However, if you are using mTLS, the client needs to present a certificate as well. The &lt;a href=&quot;https://en.wikipedia.org/wiki/X.509&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;X.509&lt;/a&gt; format is how we commonly see them in the wild.&lt;/p&gt;
&lt;p&gt;We are going to use some handy tools for this job, which can be installed with &lt;a href=&quot;https://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;brew&lt;/a&gt;, for example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/FiloSottile/mkcert&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;mkcert&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.openssl.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;openssl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;base64&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2&gt;Creating a test certificate&lt;/h2&gt;
&lt;p&gt;To get started, we need a certificate. If you own a domain, you’ll want to use &lt;a href=&quot;https://letsencrypt.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LetsEncrypt&lt;/a&gt; to generate one programmatically. For demonstration purposes, I’ll use &lt;code class=&quot;language-text&quot;&gt;mkcert&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;mkcert -install
mkcert example.com app1.example.com app2.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The result is stored under &lt;code class=&quot;language-text&quot;&gt;example.com+2-key.pem&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;example.com+2.pem&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This certificate is issued for three domains, using what’s called a &lt;a href=&quot;https://en.wikipedia.org/wiki/Subject_Alternative_Name&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SAN&lt;/a&gt;, which extends the &lt;a href=&quot;https://support.dnsimple.com/articles/what-is-common-name/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Common Name&lt;/a&gt; so that you can specify multiple domains. The CN is limited to 64 characters, which can be a problem for internal certificates with a lot of subdomains (don’t ask how I learned this!).&lt;/p&gt;
&lt;p&gt;Even though it is self-signed, we can still verify it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;openssl verify -CAfile ~/Library/Application\ Support/mkcert/rootCA.pem example.com+2.pem&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;h2&gt;Reading a certificate&lt;/h2&gt;
&lt;p&gt;You can read the certificate by using:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;openssl x509 -in example.com+2.pem -text -noout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which displays something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            d7:98:98:19:27:dd:52:d0:1f:1f:07:b5:ea:85:54:eb
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: O=mkcert development CA, OU=me@my-computer (My Name), CN=mkcert me@my-computer (My Name)
        Validity
            Not Before: Jun  1 00:00:00 2019 GMT
            Not After : Apr  6 20:21:32 2030 GMT
        Subject: O=mkcert development certificate, OU=me@my-computer (My Name)
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b1:b7:1b:14:f9:61:79:90:be:21:bc:91:12:78: (...)
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Authority Key Identifier: 
                keyid:34:0F:21:0C:F8:7D:D5:DF:E4:15:B6:15:B9:94:C9:2B:F3:E0:24:AD

            X509v3 Subject Alternative Name: 
                DNS:example.com, DNS:app1.example.com, DNS:app2.example.com
    Signature Algorithm: sha256WithRSAEncryption
         a8:52:3b:19:dc:74:4f:e3:6b:9c:cd:0c:59:c3:fe:e8:0b:2d: (...)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can see there all the relevant information. The &lt;em&gt;X509v3 Subject Alternative Name&lt;/em&gt; tends to be the most interesting part because you can see the domains that the certificate covers.&lt;/p&gt;
&lt;h3&gt;Encoded certificates&lt;/h3&gt;
&lt;p&gt;Usually, certificates are stored in PEM format in Base64 ASCII. You recognize them by the &lt;code class=&quot;language-text&quot;&gt;---- BEGIN CERTIFICATE----&lt;/code&gt; line in the beginning. That is what &lt;code class=&quot;language-text&quot;&gt;mkcert&lt;/code&gt; gives us, for instance.&lt;/p&gt;
&lt;p&gt;Sometimes a PEM certificate is transmitted encoded in Base64 itself. Let’s say we receive our certificate over the wire. We store it under &lt;code class=&quot;language-text&quot;&gt;/tmp/b64-cert&lt;/code&gt;, and it looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVlakNDQXVLZ0F3SUJBZ0lSQU5lWW1Ca24zVkxRSHg4SHRlcUZWT3N3RFFZSktvWklodmNOQVFFTEJRQXcKZ1lNeEhqQWNCZ05WQkFvVEZXMXJZMlZ5ZENCa1pYWmxiRzl3YldWdWRDQkRRVEVzTUNvR0ExVUVDd3dqYldabApjbTVoYm1SbGVrQm9hWE52YTJFZ0tFMWhjbWx2SUVabGNtNWhibVJsZWlreE16QXhCZ05WQkFNTUttMXJZMlZ5CmRDQnRabVZ5Ym1GdVpHVjZRR2hwYzI5cllTQW9UV0Z5YVc4Z1JtVnlibUZ1WkdWNktUQWVGdzB4T1RBMk1ERXcKTURBd01EQmFGdzB6TURBME1EWXlNREl4TXpKYU1GY3hKekFsQmdOVkJBb1RIbTFyWTJWeWRDQmtaWFpsYkc5dwpiV1Z1ZENCalpYSjBhV1pwWTJGMFpURXNNQ29HQTFVRUN3d2piV1psY201aGJtUmxla0JvYVhOdmEyRWdLRTFoCmNtbHZJRVpsY201aGJtUmxlaWt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQ3gKdHhzVStXRjVrTDRodkpFU2VMNENTL3JET3RxbGZGN0syN1g3NERuQ0ExeHpDMlkwTkJxa1hPVWFka2VRZ1MrSgo4NVFZQlYrcWFFRGhZNVNMZm1MTGxkMmFWQnIvSG9MYVFuRDc4VXJuVHNHM1JJb2dEYlI0R25CQnJUc0ltQWk3CnRNeU1kVVZSc21EM1RYcmUxdFM4dmowL3RQNzE1UEQvRTd1Tk94M2VyYjUrQmtFY0JodElnbVU4ZUVybnpLMnEKNkV0N0tsUERwQm5mL2pySEM0ZU1URFBiRDhqeGZBRmhvZ2R0YUgrTGRxeDZ6Uk5mN2pTZXNXMTJNMW5JenpsTwpLa0IxaHBhOEZqc3Y3Ry9ONytFeHFzQzMrQjdaZHB5UWl5Zm8ydU1KL1lJQWJMN29sbnV5THF5UkZPNWNaNnp3Cjg5MG5lV1gweE5hWmE5bWo3RmNwQWdNQkFBR2pnWk13Z1pBd0RnWURWUjBQQVFIL0JBUURBZ1dnTUJNR0ExVWQKSlFRTU1Bb0dDQ3NHQVFVRkJ3TUJNQXdHQTFVZEV3RUIvd1FDTUFBd0h3WURWUjBqQkJnd0ZvQVVOQThoRFBoOQoxZC9rRmJZVnVaVEpLL1BnSkswd09nWURWUjBSQkRNd01ZSUxaWGhoYlhCc1pTNWpiMjJDRUdGd2NERXVaWGhoCmJYQnNaUzVqYjIyQ0VHRndjREl1WlhoaGJYQnNaUzVqYjIwd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLaFMKT3huY2RFL2phNXpOREZuRC91Z0xMYlNlV0NsVjFMSnFNU3NLbE16VXZ4aVlmKzdzeDZRUmxZcGtYeWpndVFUNwppRWZMWUhQZG8zeTJMNmFIaW9tbU1FUjNmWjAyMjJWUWJhV2hjUkJmUDgzdFhnQmdqN0pUZjArUUxjVERXZG9YCnd2KzZQNHNuNmVqV2xWc3drZTBQcjhLMm9DM1NyazVibjJFVVpQSU1oQnNMZFdmczBZbkZhRTFCY2ZlWGNVV0QKU3QzckRZcjFlSW1mQ1FTQ1BkU0ZwTU5HWS81dkdtWm5lVTNxbXlhS2hLNWZRREhkWVpQYlQ5NFE4ZDBVVXRaMgpEeWdxQmFmTG5oMWxmVHRRNi9NUjdIQlNWZCtWajcwRnFCajJlaEJlTXZhUDUrQlRCTEFCbWdoK0VMVHp6VTRUCmdHMHZuSzF2OUhvd1FDaVdadDkxZDRtdFRHbldJQVVHWGpKcDBjMmVHbU5NOUN4eVM0QTJNRXRJcngwZy9ESWQKNU9rMXZodnVJOTV4cWVOZ1E4UDBrOEF0VWlYdVp4Uk53M1FubHdLRzloMDhmVGJRc04rZEh1T2lhRWNPcWY4WgoxcStxakxQMlVsbmZYaGwyN25aUVgwZ3F5ZnROUldRV3pvc0V6cGh0RVpwdGJrVzZPUExhby9DNHhVRU5lQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Yes, that’s a very long line. &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt; can’t read that out of the box, so we’ve got to decode it first. Moreover, it can be that, once decoded the lines are too long, which confuses &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt;. We’ll decode and fold that string so that we can read the certificate again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;base64 -d /tmp/b64-cert | fold -64 | openssl x509 -text -noout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Binary certificates&lt;/h3&gt;
&lt;p&gt;Sometimes your certificate is encoded in &lt;a href=&quot;https://wiki.openssl.org/index.php/DER&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;DER&lt;/a&gt;, a binary format. The &lt;code class=&quot;language-text&quot;&gt;JVM&lt;/code&gt; world really likes to transport certificates in this way. You’ll notice that if you inspect such a certificate, it will be mostly a bunch of special characters and gibberish. Luckily, &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt; can convert from DER to PEM, in both directions.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;openssl x509 -in example.com+2.pem -outform DER -out example.com+2.der
openssl x509 -inform DER -in example.com+2.der -text -noout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Binary certificates encoded in base64url&lt;/h3&gt;
&lt;p&gt;What if you have a certificate in DER format, that has been encoded in &lt;a href=&quot;https://base64.guru/standards/base64url&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;base64url&lt;/a&gt;? Your first thought might be, “That’s an oddly specific combination”. But it can actually happen. If you are implementing your own ACME server, it is part of the &lt;a href=&quot;https://tools.ietf.org/html/rfc8555#section-7.1.5&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;protocol to request a certificate&lt;/a&gt;. I recently spent quite a bit of time trying to make sense of that.&lt;/p&gt;
&lt;p&gt;There is no out-of-the-box tool to decode Base64 URL, but you can use a script like &lt;a href=&quot;https://raw.githubusercontent.com/Moodstocks/moodstocks-api-clients/master/bash/base64url.sh&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this one&lt;/a&gt;. You can read this mysterious certificate by combining the script with the previous calls:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;./base64url.sh decode `cat /tmp/b64url-cert | tr -d &amp;#39;\n&amp;#39;` | openssl x509 -inform DER -text -noout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You will probably never run into this, but if you do, this will save you a ton of time.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Checking a certificate on a remote server&lt;/h2&gt;
&lt;p&gt;What if you don’t have the certificate, but want to get it from a remote server? &lt;em&gt;openssl&lt;/em&gt; is up to the task.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;console&quot;&gt;&lt;pre class=&quot;language-console&quot;&gt;&lt;code class=&quot;language-console&quot;&gt;echo -n | openssl s_client -connect google.com:443 -servername google.com | openssl x509 -text -noout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With the &lt;code class=&quot;language-text&quot;&gt;s_client&lt;/code&gt; command, we are requesting the certificate presented by a host on a specific port (usually 443). In this case, we are checking the certificate from &lt;em&gt;google.com&lt;/em&gt;. We can pipe the output into the standard command for reading a certificate. We pipe the &lt;code class=&quot;language-text&quot;&gt;echo -n&lt;/code&gt; first so that it doesn’t hang.&lt;/p&gt;
&lt;p&gt;You might be wondering about the &lt;code class=&quot;language-text&quot;&gt;-servername&lt;/code&gt; option. That is related to &lt;a href=&quot;https://en.wikipedia.org/wiki/Server_Name_Indication&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SNI&lt;/a&gt;. If the target is serving multiple domains under the same IP address, you might want to select the one associated with a domain. I recently needed the option when testing a Kubernetes &lt;a href=&quot;https://github.com/kubernetes/ingress-nginx&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;nginx ingress&lt;/a&gt; that was serving a self-signed certificate unless I specified that option.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;We are only scratching the surface&lt;/h2&gt;
&lt;p&gt;This post was focused on reading existing certificates, but there are a ton more things that you can do with &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt;, including writing them, extracting keys and whatnot. Not to mention &lt;a href=&quot;https://en.wikipedia.org/wiki/Certificate_signing_request&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Certificate signing requests&lt;/a&gt;. Reading is a good place to familiarize yourself with certificates, however.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 19/06/2020:&lt;/em&gt; Fix &lt;code class=&quot;language-text&quot;&gt;openssl s_client&lt;/code&gt; command&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Authorization for a Kotlin Spring backend, using JSON Web Tokens]]></title><description><![CDATA[Build authorization into your Kotlin backend by combining Auth0, JWTs and Spring Security to ensure only the right parties can execute operations]]></description><link>https://hceris.com/authorize-spring-backend-with-jwt-in-kotlin/</link><guid isPermaLink="false">https://hceris.com/authorize-spring-backend-with-jwt-in-kotlin/</guid><category><![CDATA[Auth0]]></category><category><![CDATA[OAuth]]></category><category><![CDATA[Kotlin]]></category><category><![CDATA[SpringBoot]]></category><category><![CDATA[Security]]></category><pubDate>Thu, 19 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In my previous article, I wrote about &lt;a href=&quot;../setting-up-auth0-with-terraform/&quot;&gt;setting up Auth0 using Terraform&lt;/a&gt;. In this article, I want to put that setup to work to authorize requests to a backend API written in &lt;em&gt;Kotlin&lt;/em&gt;, using &lt;a href=&quot;https://spring.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This API is used  to upload recipes. It is consumed through a frontend application. Login is optional for viewing them. I want to authorize requests to create new ones, however. That’s what we’ll be doing now, thanks to &lt;a href=&quot;https://en.wikipedia.org/wiki/JSON_Web_Token&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JSON Web Tokens&lt;/a&gt;.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a2bd97f48810308dce1184cdd574b395/d7abb/jwt-concept.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 39.361702127659576%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbklEQVR42l2R30oCQRTGP3VdU3N1138UREWQIbXtfLOrRIUVXXnfRVBeRS8QPYBd9Ax2202v0CP0AtJLdCVUUNDU6KxoA4dzduecH9/5BiRhIkGyQDJNSQwwABTm4xNwnh2IlohnbN0vpYy/gRlg2TS4lLRmQE0onEPhDD9IYQSItiiSdEgujvvJJSNmDuiYKEZbERQUrFEChZe8yL1mrnLDzLU9tFPHOEky4jLJygxU52oM1KpKGmRU6uxxJ7TXcYNNXObreMjVcFsY4BHBwa5FITWgpmeDIIgFFWNgaewbaZkLXWdaFM7TRhGqhKyqoqIclP2VQwghbTlRVTC+w3jo6hyv6sUekMxJ0jv1fe/NsvAOdL6A+w/gTgFp9HqJPSFcozBLcsH4OPUwNV1z8rOua0Gmm1GEtXbbFeT2RaOxqt8I3a6eSRqgnsvPbDf3KOMIw3Ba7wcBjnw/2YgiG/1+4huA3elA/puZwv7OLzYActe6ZXs7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;authorizing backend requests&quot; title=&quot;&quot; src=&quot;/static/a2bd97f48810308dce1184cdd574b395/1d69c/jwt-concept.png&quot; srcset=&quot;/static/a2bd97f48810308dce1184cdd574b395/4dcb9/jwt-concept.png 188w,
/static/a2bd97f48810308dce1184cdd574b395/5ff7e/jwt-concept.png 375w,
/static/a2bd97f48810308dce1184cdd574b395/1d69c/jwt-concept.png 750w,
/static/a2bd97f48810308dce1184cdd574b395/d7abb/jwt-concept.png 959w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;JSON Web Tokens&lt;/h2&gt;
&lt;p&gt;I’m delegating the user management to &lt;em&gt;Auth0&lt;/em&gt;. Our frontend communicates with it using &lt;a href=&quot;https://auth0.com/docs/api-auth/which-oauth-flow-to-use&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth&lt;/a&gt; to obtain a &lt;a href=&quot;https://tools.ietf.org/html/rfc6750&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;bearer token&lt;/a&gt;, but that is outside the purpose of this article. We’ll assume that this step happened already and that the requests to our backend come with an &lt;em&gt;Authorization&lt;/em&gt; header.&lt;/p&gt;
&lt;p&gt;The token is encoded in base64, which can be conveniently decoded using &lt;a href=&quot;https://jwt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jwt.io&lt;/a&gt;. Once decoded, we can have a look at the payload, which is just a JSON object:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;iss&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://{{auth0_tenant}}.eu.auth0.com/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;sub&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2|{{user_id}}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;aud&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;{{our_domain}}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;https://{{auth0_tenant}}.eu.auth0.com/userinfo&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;iat&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1584296421&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;exp&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1584303621&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scope&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;openid profile create:recipes&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we have an Issuer (&lt;code class=&quot;language-text&quot;&gt;iss&lt;/code&gt;), an Audience (&lt;code class=&quot;language-text&quot;&gt;aud&lt;/code&gt;), an Expiration Time (&lt;code class=&quot;language-text&quot;&gt;exp&lt;/code&gt;), and the scopes granted (&lt;code class=&quot;language-text&quot;&gt;scope&lt;/code&gt;). All those are fields that we can verify. How will that work? Here’s a diagram:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b7ed50bf14720008280a3c00b3ddd8bf/33e10/jwt-overview.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 80.31914893617021%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVR42p2T3U4TQRTHzy5q+RYCLYkEDHaB2AK785vdbUmhgRZpb0SNJRFN1KSJiYlc6UN4a+IzeMWTeO+VeK1gYqIPYM2ss6Q0oOgk/8yZzZnfno85orUWI6AfGAaGrAYvKON7JeUYkNEd4CGwClSBDaAGbAJ1a/eqbrUGtIF1w0qBr4AAGAcWgXm7Xy15JfErvuibWhRKlFLG37FZpXsTeNINfAGsAHOABnwjv+qPlfIlyb3Nifa1qEhJVI3SOw5w2dom0r1u4D6/V+KgSkr8qj98IAfu8q1lke+SwNAIceKfA6aAWVvHui3ZKaCyjZkMKkG2MlHJZt5nZuWLVN1P7o314fUJVVLTaEaABWDGNmQAaJwVoQFmTP2C1WBxo28j5350i/JZbruHLuXr5UUVqQjNpI1w0N7tPw9I13MZIyRXk1qf/JAx99B1pCNS2Ck4QRykKZvGZeM4Nuets1L2bfjGedqkHq6ElwxoW7adwr2CEy1FDjpphtgGTll7uzfCl7YuyeNsP2on37XSEnuxhH6YNESjU/9emff6uBt4X8NT0JuRZifW7Nq/Nv6iph2C5xYqko6Mjx6qRozIfHlU8uXxAD0UakYh6eqfZHwGTkbPrMS4tibvmgXp7OXnfj7Iq3qspBYpKapz0zyl3lmWD3cX3G+7nhy1vMZRy9t/XVuSzrMZebNVvBAw1ck6bnmp3OOWl0nP/72+trwTdcH/GfQLB9fcZaIrjGsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;the general overview of our backend&quot; title=&quot;&quot; src=&quot;/static/b7ed50bf14720008280a3c00b3ddd8bf/1d69c/jwt-overview.png&quot; srcset=&quot;/static/b7ed50bf14720008280a3c00b3ddd8bf/4dcb9/jwt-overview.png 188w,
/static/b7ed50bf14720008280a3c00b3ddd8bf/5ff7e/jwt-overview.png 375w,
/static/b7ed50bf14720008280a3c00b3ddd8bf/1d69c/jwt-overview.png 750w,
/static/b7ed50bf14720008280a3c00b3ddd8bf/33e10/jwt-overview.png 844w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;In order to authorize requests, we need three components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;em&gt;Verifier&lt;/em&gt; that checks if the token is valid, and extract information from it if so&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;JwtAuthorizationFilter&lt;/em&gt; that runs before every request to the backend, and run the &lt;em&gt;Verifier&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;A connection to &lt;em&gt;Spring Security&lt;/em&gt;, which rejects the request if it is invalid&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s have a look at each separately.&lt;/p&gt;
&lt;h2&gt;Verifying the token&lt;/h2&gt;
&lt;p&gt;So, our backend has received a request that includes a &lt;em&gt;JWT&lt;/em&gt;, what do we do now? We can picture it as two distinct steps. Checking the signature and verifying the token itself. We combine both steps into an interface (&lt;code class=&quot;language-text&quot;&gt;Verifier&lt;/code&gt;), which defines one method:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; Verifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * @param jwt a jwt token
     * @return whether the token is valid or not
     */&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;JWTVerificationException&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TokenAuthentication&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’m using an &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; type for the return type. I wrote &lt;a href=&quot;../kotlin-either-types-instead-of-exceptions/&quot;&gt;about them&lt;/a&gt; recently. Essentially, we’ll get a &lt;code class=&quot;language-text&quot;&gt;TokenAuthentication&lt;/code&gt; if &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt; succeeds and an instance of &lt;code class=&quot;language-text&quot;&gt;JWTVerificationException&lt;/code&gt; if not.&lt;/p&gt;
&lt;h3&gt;The signature&lt;/h3&gt;
&lt;p&gt;The token is signed by the issuer (in our case &lt;em&gt;Auth0&lt;/em&gt;). The signature ensures that the token comes from the issuer, and that hasn’t been tampered with.&lt;/p&gt;
&lt;p&gt;To avoid having to share a secret key, we prefer to use a public/private key combination. That’s where &lt;code class=&quot;language-text&quot;&gt;JWKS&lt;/code&gt; comes in. &lt;em&gt;Auth0&lt;/em&gt; publishes the key for your tenant under https://{{auth0_tenant}}.eu.auth0.com/.well-known/jwks.json. I am injecting that key into our &lt;code class=&quot;language-text&quot;&gt;RemoteVerifier&lt;/code&gt;, which implements the interface I defined above. We provide it as a &lt;code class=&quot;language-text&quot;&gt;Bean&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; JWTConfiguration &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\${auth.jwks}&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; jwks&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String

    &lt;span class=&quot;token annotation builtin&quot;&gt;@ConditionalOnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;auth.enabled&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; havingValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Verifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; keySet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; JWKSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RemoteVerifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keySet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;Bean&lt;/code&gt; is conditional so that we can provide an alternate implementation for our tests, thus avoiding network requests.&lt;/p&gt;
&lt;h3&gt;Setting up the verifier&lt;/h3&gt;
&lt;p&gt;For the verification itself, we are going to use &lt;a href=&quot;https://github.com/auth0/java-jwt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;auth0’s own library&lt;/a&gt;. First, we initialize a &lt;code class=&quot;language-text&quot;&gt;JWTVerifier&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RemoteVerifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; keySet&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JWKSet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; leeway&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Verifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;companion&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keySet&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JWKSet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; keySet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; RSAKey
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;algorithm&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RSAKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Algorithm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RSA256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toRSAPublicKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;algorithm&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Algorithm&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; leeway&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; JWT
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;algorithm&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;acceptExpiresAt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;leeway&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JWTVerifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keySet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; algorithm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;algorithm&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;algorithm&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; leeway&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see we include the key we got before, plus a leeway limit for the expiration time of the token. If you want to test for the issuer and the audience explicitly, you can use the &lt;code class=&quot;language-text&quot;&gt;withIssuer&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;withAudience&lt;/code&gt; methods, before calling &lt;code class=&quot;language-text&quot;&gt;build()&lt;/code&gt;. In my case,  checking that my tenant signs the token feels safe enough.&lt;/p&gt;
&lt;p&gt;We trigger the actual verification by calling the &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt; method of the &lt;code class=&quot;language-text&quot;&gt;JWTVerifier&lt;/code&gt; we just created, wrapping it so that it does not throw exceptions into the wild.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;JWTVerificationException&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TokenAuthentication&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsafeVerify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Wait, what is that &lt;code class=&quot;language-text&quot;&gt;asToken&lt;/code&gt; method doing there? As I mentioned, we want to extract information from the token. We need the list of scopes in the token for later, which we fetch and include in our &lt;code class=&quot;language-text&quot;&gt;TokenAuthentication&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; DecodedJWT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;TokenAuthentication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subject&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scopes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; DecodedJWT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;scopes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getClaim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;scope&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;The authorization filter&lt;/h2&gt;
&lt;p&gt;The verifier runs inside a filter, which inherits from &lt;code class=&quot;language-text&quot;&gt;OncePerRequestFilter&lt;/code&gt;. As you probably guessed, it runs before every request, but only once. Let’s call it &lt;code class=&quot;language-text&quot;&gt;JwtAuthorizationFilter&lt;/code&gt;. It does the following steps:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 659px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/006cb062ab62134b34584bec769116fa/6db71/jwt-flow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 98.40425531914893%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8UlEQVR42p2U/W7aQBDEbSANgiRgCoSE4kDappVoBN7fQT+ktkn7EFXV93+PaNE4OozJH7W0urO9Hu/OzF6yWq0S4CBCCMlyuUyKokjNrGFmLeAVcFrN3bv8Q2AAXAMjxRB4rRjofmBmmd57brMWEOgCY+AN8B34ATwCn4EH4CfwSfeP0Q8vjgGmApwCt8Bb4J3Wj9ovtH4A5sDlSxUmm83G15aSPBri6y9wY2Y9oGNmbeDEzI5zWApQJ4y3aWZdM/Of9IFztXpuZumLoAoXYQZcaT+XAJnEuVQnbfHY0nc7cK+8CjgNIWSRGAZsgN/AmUB6Uf5VbKM6wJHEySXEIhLLKx+Lv6GqvdO7iX/rWuwuT/IQl85XGkLw9Y+Z5bJWZmZ9qX0rLoO7wY2vH3SqFe5iu906eEOtO5cdB5AQbQF6u19lrbKzRhWwp3ZziTFXO5mAJ+KquV6vfRxzMxsVRXGiKg84zH12gTXwS0b+BnzRLE9L8iP7PFNWB9iV0l7dLISwUKUzjeZYOUOtSQy4U7nulCnlB/5JhJ54utDEJAdWqTH1XlJRFIkOhE5s3qjlQ7DIMqkIv9Y6kQ1uon353IU63eOspsK+Rmum42ur8ArvtX+QSIN4Wo4BNuWreXR03SnK4+y9/DeNZvgo4H9H9XoCux3n6GHAftIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;the flow that I use to authorize requests&quot; title=&quot;&quot; src=&quot;/static/006cb062ab62134b34584bec769116fa/6db71/jwt-flow.png&quot; srcset=&quot;/static/006cb062ab62134b34584bec769116fa/4dcb9/jwt-flow.png 188w,
/static/006cb062ab62134b34584bec769116fa/5ff7e/jwt-flow.png 375w,
/static/006cb062ab62134b34584bec769116fa/6db71/jwt-flow.png 659w&quot; sizes=&quot;(max-width: 659px) 100vw, 659px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;We covered the &lt;em&gt;Verify Token&lt;/em&gt; step in the previous section. Before that, we have to extract the token from the header. If the verification succeeds, we set the &lt;code class=&quot;language-text&quot;&gt;SecurityContext&lt;/code&gt;, which is relevant for &lt;em&gt;Spring Security&lt;/em&gt;. The code looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;JwtAuthorizationFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; verifier&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Verifier&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;OncePerRequestFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;companion&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Bearer &quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;maybe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doFilterInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpServletRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpServletResponse&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            filterChain&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FilterChain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Option&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fx&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Headers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AUTHORIZATION&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toOption&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; header&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toOption&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            SecurityContextHolder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authentication &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; token
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        filterChain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is fairly straightforward … wait, what is that &lt;code class=&quot;language-text&quot;&gt;Option.fx&lt;/code&gt; thing? And the parentheses? Also, according to the diagram, ever step could have an empty answer, where are we handling that?&lt;/p&gt;
&lt;p&gt;The long explanation is an article on its own. The short version is that thanks to &lt;em&gt;Arrow&lt;/em&gt;, we can use &lt;a href=&quot;https://arrow-kt.io/docs/patterns/monad_comprehensions/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;monad comprehensions&lt;/a&gt; to flatten our code and make a collection of operations on an &lt;code class=&quot;language-text&quot;&gt;Option&lt;/code&gt; look like a regular block of code.&lt;/p&gt;
&lt;h2&gt;Binding Spring Security&lt;/h2&gt;
&lt;p&gt;I am using &lt;a href=&quot;https://spring.io/projects/spring-security&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spring Security&lt;/a&gt; to integrate my filter into my application. The easiest way to get started is to use this dependency:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;implementation &lt;span class=&quot;token string&quot;&gt;&apos;org.springframework.boot:spring-boot-starter-security&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the configuration, I’m specifying the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;My &lt;code class=&quot;language-text&quot;&gt;JwtAuthorizationFilter&lt;/code&gt; will run before every request&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GET&lt;/code&gt; requests don’t need authorization&lt;/li&gt;
&lt;li&gt;For mutating requests (such as a &lt;code class=&quot;language-text&quot;&gt;POST&lt;/code&gt;), we expect the &lt;code class=&quot;language-text&quot;&gt;create:recipes&lt;/code&gt; scope there. Remember that we mapped that into our &lt;code class=&quot;language-text&quot;&gt;TokenAuthentication&lt;/code&gt; as part of the verification.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There is a fluent interface to configure this in code, which looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@EnableWebSecurity&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@EnableGlobalMethodSecurity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;securedEnabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; SecurityConfiguration &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;WebSecurityConfigurerAdapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; filter&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JwtAuthorizationFilter

    &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;http&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpSecurity&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        http&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;csrf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;disable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;authorizeRequests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;antMatchers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HttpMethod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GET&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;permitAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;anyRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasAuthority&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;create:recipes&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addFilterBefore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BasicAuthenticationFilter&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sessionManagement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sessionCreationPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SessionCreationPolicy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;STATELESS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So now all three parts are finally connected. We defined which requests we want to authorize. The filter parses and verifies the token. If that token fulfills all our requirements, the request goes through. Otherwise, it fails with an unauthorized response. If you want deeper into &lt;em&gt;Spring Security&lt;/em&gt;, you can check &lt;a href=&quot;https://www.toptal.com/spring/spring-security-tutorial&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this tutorial&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;Building authorization into your API is something you &lt;strong&gt;need&lt;/strong&gt; to do if you want to make sure that your backend is properly ensuring only the right parties are allowed to do certain things. I rolled a custom solution for a project that I worked on, but if you use standard tools and libraries, it is a lot more convenient and a lot easier for other people to understand.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setting up Auth0 with Terraform]]></title><description><![CDATA[Setting up Auth0 with Terraform ensures that your setup is repeatable, and that you can authorize your apps easily and conveniently]]></description><link>https://hceris.com/setting-up-auth0-with-terraform/</link><guid isPermaLink="false">https://hceris.com/setting-up-auth0-with-terraform/</guid><category><![CDATA[Auth0]]></category><category><![CDATA[OAuth]]></category><category><![CDATA[Infrastructure as Code]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[Security]]></category><pubDate>Sat, 22 Feb 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Let’s imagine you have an application divided into two components, a frontend, and a backend. The frontend is a Single Page Application written in &lt;em&gt;React&lt;/em&gt;, and the backend is a REST API written in, say, &lt;em&gt;Kotlin&lt;/em&gt;. You want to implement some functionality that requires authorization. You naturally gravitate toward &lt;a href=&quot;https://oauth.net/2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth&lt;/a&gt;. But then you realize that implementing it by yourself implies much effort. And you still need to manage users. Maybe use an &lt;a href=&quot;https://en.wikipedia.org/wiki/List_of_OAuth_providers&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth provider&lt;/a&gt;? It all seems kind of overkill for protecting your homemade recipes manager.&lt;/p&gt;
&lt;p&gt;That’s where an &lt;em&gt;Identity Platform&lt;/em&gt; like &lt;a href=&quot;https://auth0.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Auth0&lt;/a&gt; comes in. Why reinvent the wheel when you can use an existing solution?&lt;/p&gt;
&lt;h2&gt;The authorization flow&lt;/h2&gt;
&lt;p&gt;There is so much material about &lt;a href=&quot;https://auth0.com/docs/flows&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;authorization/authentication&lt;/a&gt; already out there, what else can be said at this point? Maybe we can have a look at a simple diagram that shows the position of &lt;em&gt;Auth0&lt;/em&gt; between my frontend and backend:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 633px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9ba2c30ca85c9e15451abd04b934756a/bce72/flow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 72.87234042553192%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrUlEQVR42o2U30obQRSHT6JJ1ESrojFgkbZZiUY27nyzmrT+hZZSKoVaXK8EL8T7UsitvoGXvoIv4uNEX0GZeGKX7K46cJjZmTnfOb85MyuiDXi2/Q0j3zaMPFzOyV3k5XqRlxc57a9193x5tcVhznxjZTs0InIt95HnoFJft9IyyEpgE/tfAuaBQstY+b5pKg/dBelF3pde5O2LdN16eTkFmIDGFuaAjoXqVmiWRG5chod3kXcmtZ0RYCm0TGvgUe1fBI4BDdc3jZV/u770jur521+N0s2PVan5oZgnyCLwGZhJAIdSnwJKbtwyNr8bmkLVD4vF5mZJvI40ApsbClx8DViOjatAM7RUf7aDkT+dQNq2P59L2fsfGsuspTLWdM5FX0lzjAV8nwX8CPwFDoET/V7QIpVUorNx7VeBHacA+kVKAOeBC+BKoS7yO3Wu8NQ+KXwCWAbamuVUGnBMpW6p47C8D/GKxpKYzJI8rzJr6lzXezYMHhRkUs/bywI6wDnwGzgAjt2LySjGAPwVCLKuTUELUNEzKVtrZWAZj2A2cX5pP4aBvQGY+pYfAU6IrwA9gEcgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;the flow to authorize the frontend to access the backend&quot; title=&quot;&quot; src=&quot;/static/9ba2c30ca85c9e15451abd04b934756a/bce72/flow.png&quot; srcset=&quot;/static/9ba2c30ca85c9e15451abd04b934756a/4dcb9/flow.png 188w,
/static/9ba2c30ca85c9e15451abd04b934756a/5ff7e/flow.png 375w,
/static/9ba2c30ca85c9e15451abd04b934756a/bce72/flow.png 633w&quot; sizes=&quot;(max-width: 633px) 100vw, 633px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Until now, everything might sound familiar. Fetch a token in the frontend using a flow, include it in the request to the API with a header. Then verify the token in the backend to ensure its validity. Got it.&lt;/p&gt;
&lt;h2&gt;Setting up Auth0&lt;/h2&gt;
&lt;p&gt;You still need to set up the whole thing in &lt;em&gt;Auth0&lt;/em&gt; itself, however. Most guides you’ll find on the internet show you how to do that by clicking through the UI. Which works, more or less. But what about the second time you want to do it? You’ll start from scratch, assuming you still remember how to do it, of course.&lt;/p&gt;
&lt;p&gt;The whole point of this article is that you are much better off using &lt;a href=&quot;https://www.thoughtworks.com/de/insights/blog/infrastructure-code-reason-smile&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Infrastructure as Code&lt;/a&gt; instead. I am going to show you how to deal with the previously mentioned setup by using &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt;, a tool to provision infrastructure declaratively. It is definitely worth &lt;a href=&quot;https://www.terraform.io/intro/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;learning&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Auth0 + Terraform&lt;/h3&gt;
&lt;p&gt;There is an excellent &lt;a href=&quot;https://www.terraform.io/docs/providers/auth0/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;terraform provider&lt;/a&gt; for &lt;em&gt;Auth0&lt;/em&gt;, which will make our life massively easier. We’ll declare our stuff, provision it, and store the code in &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt;. That way, you can quickly check what you did, and adapt it for further applications without much effort. Or even write a blog post about it.&lt;/p&gt;
&lt;p&gt;Let’s assume we already have an account served under a domain (&lt;code class=&quot;language-text&quot;&gt;auth0_domain&lt;/code&gt;). If we want to work with &lt;em&gt;Auth0&lt;/em&gt; programmatically, we need to create an application with access to the &lt;em&gt;Auth0 Management API&lt;/em&gt;. We have to do this step manually, &lt;a href=&quot;https://auth0.com/docs/api/management/v2/create-m2m-app&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;following these steps&lt;/a&gt;. After this, we’ll have a &lt;code class=&quot;language-text&quot;&gt;client_id&lt;/code&gt; and a &lt;code class=&quot;language-text&quot;&gt;client_secret&lt;/code&gt; that we can use throughout the rest of the process. On to the code.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4816781576f3c83e2935ccd97e42c18a/e7aec/management-api.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 60.1063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSklEQVR42o2SX2vbMBTF/f0/zthD2dPYXgqlFDLYRmkDSVp5juPOvpIs6f4tlhnLGA39vemKc484Rw2M07PrvPeHStu2Xddtt1sAMDNVtbdphsPu53YfU2rb1jnX9/3pdHLOjdME4Oc5XRKbaTVQqyZaMTMRISIRuSSOhSBjYfGFcy6IaO+mQeaMWBBTwZQXELGUZctlVLUZhuF4PMbKPM8hBO89APgzQggAsF6tAICINESUcyYiZiaiy/Ges4hVRapukdYVUgfnrBP5g6quxyYz/8441sxY+C3fxYJI6utySms1TX6BsXuBfpx+DXGcVrH+BzGnkjMWQo4xSR024fOm/Xh9vLoZP93y84lMCfGfetcU9r08OjsMw+7B3W/sadClqpzjOEXwEXyIcwgxhFBK+WvKsnyju8d0/Z03ux93X26/frBvezZ7BYpAuWWfgdMWAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;you need a test app with the management API active&quot; title=&quot;&quot; src=&quot;/static/4816781576f3c83e2935ccd97e42c18a/1d69c/management-api.png&quot; srcset=&quot;/static/4816781576f3c83e2935ccd97e42c18a/4dcb9/management-api.png 188w,
/static/4816781576f3c83e2935ccd97e42c18a/5ff7e/management-api.png 375w,
/static/4816781576f3c83e2935ccd97e42c18a/1d69c/management-api.png 750w,
/static/4816781576f3c83e2935ccd97e42c18a/78797/management-api.png 1125w,
/static/4816781576f3c83e2935ccd97e42c18a/aa440/management-api.png 1500w,
/static/4816781576f3c83e2935ccd97e42c18a/e7aec/management-api.png 1726w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;The provider&lt;/h3&gt;
&lt;p&gt;The first thing we need to do is set up the provider.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;provider&lt;span class=&quot;token type variable&quot;&gt; &quot;auth0&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;domain&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.auth0_domain
  &lt;span class=&quot;token property&quot;&gt;client_id&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.auth0_client_id
  &lt;span class=&quot;token property&quot;&gt;client_secret&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; var.auth0_client_secret
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This provider requires the credentials we manually obtained in the step before. Store them securely in something like &lt;a href=&quot;../storing-passwords-with-gopass/&quot;&gt;gopass&lt;/a&gt;. You can export these credentials as environment variables, and they will be picked up by &lt;code class=&quot;language-text&quot;&gt;terraform&lt;/code&gt; automatically. You only need to follow this specific syntax:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TF_VAR_auth0_domain&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;gopass auth0/domain&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TF_VAR_auth0_client_id&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;gopass auth0/client_id&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TF_VAR_auth0_client_secret&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;gopass auth0/client_secret&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;TF_VAR_auth0_my_host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;gopass auth0/my_host&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Let’s set up our application&lt;/h2&gt;
&lt;h3&gt;The identity provider&lt;/h3&gt;
&lt;p&gt;We can provision our users, but what about using an existing solution like Google? Then we don’t need to do any account management. For that, we need to define a connection.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_connection&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;strategy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;enabled_clients&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    auth0_client.cookery2-frontend.id,
    auth0_client.shelf2-frontend.id
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This connection means that anybody with a Google account can log in. We’ll get to defining permissions in a bit.&lt;/p&gt;
&lt;h3&gt;The application&lt;/h3&gt;
&lt;p&gt;For our frontend, we need to define an &lt;a href=&quot;https://auth0.com/docs/dashboard/reference/settings-application&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;application&lt;/a&gt;. We’ll use this application to get an access token to connect to our API.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_client&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-frontend&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-frontend&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookery2 Application - Terraform generated&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;app_type&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;spa&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;callbacks&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:3003/callback&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;https://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;cookery2_host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/callback&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;oidc_conformant&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;jwt_configuration&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;alg&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;RS256&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I am using the &lt;a href=&quot;https://oauth.net/2/grant-types/implicit/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;implicit flow&lt;/a&gt;, which is not recommended anymore from a security standpoint. That is a topic for a future article. My list of recipes doesn’t have strong security requirements, so I can live with it!&lt;/p&gt;
&lt;p&gt;I’m enabling two callbacks, the actual domain, and localhost so that we can test things locally as well.&lt;/p&gt;
&lt;h3&gt;The API&lt;/h3&gt;
&lt;p&gt;Our application is now able to fetch a token. But it still needs to access something. That something is the API, which is conveniently called an &lt;a href=&quot;https://auth0.com/docs/dashboard/reference/settings-api&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;API&lt;/a&gt; in &lt;em&gt;Auth0&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_resource_server&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-backend&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;             &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-backend&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;identifier&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; local.cookery2_host
  &lt;span class=&quot;token property&quot;&gt;signing_alg&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;RS256&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;enforce_policies&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;token_lifetime&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;86400&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;token_lifetime_for_web&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7200&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;skip_consent_for_verifiable_first_party_clients&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;scopes&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;value&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;create:recipes&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Can create a recipe&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;enforce_policies&lt;/code&gt; flag activates the &lt;a href=&quot;https://auth0.com/docs/authorization/concepts/rbac&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Role-Based Access Control&lt;/a&gt; that is required to enforce anything. We are defining a scope (&lt;code class=&quot;language-text&quot;&gt;create:recipes&lt;/code&gt;), which is the only operation that we want to restrict.&lt;/p&gt;
&lt;h2&gt;RBAC&lt;/h2&gt;
&lt;p&gt;There are two ways of implementing &lt;em&gt;RBAC&lt;/em&gt; in &lt;em&gt;Auth0&lt;/em&gt;, &lt;a href=&quot;https://auth0.com/docs/authorization/guides/how-to&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Authorization Core&lt;/a&gt;, and &lt;a href=&quot;https://auth0.com/docs/extensions/authorization-extension&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Authorization Extension&lt;/a&gt;. We are going to use the Core one, which is a bit newer and more integrated into &lt;em&gt;Auth0&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;The idea is to create a role with a permission associated with it for a concrete API. In our case, the &lt;code class=&quot;language-text&quot;&gt;create:recipes&lt;/code&gt; scope we provisioned before.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_role&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-editor&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookery2 - Editor&quot;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;permissions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;                       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;create:recipes&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;resource_server_identifier&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; auth0_resource_server.cookery2-backend.identifier
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When we authenticate with our client, we include a list of requested scopes, let’s say &lt;code class=&quot;language-text&quot;&gt;profile create:recipes&lt;/code&gt;. &lt;em&gt;Auth0&lt;/em&gt; checks our user, and if that user is assigned the &lt;code class=&quot;language-text&quot;&gt;cookery2-editor&lt;/code&gt; role, then the scope is included in the &lt;code class=&quot;language-text&quot;&gt;access_token&lt;/code&gt; that gets returned. The API then knows that the user is allowed to create recipes.&lt;/p&gt;
&lt;h3&gt;Assigning the role to a user&lt;/h3&gt;
&lt;p&gt;The way to assign roles to users at scale is by associating &lt;a href=&quot;https://auth0.com/docs/users/concepts/overview-user-metadata&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;metadata&lt;/a&gt; to them with a &lt;a href=&quot;https://auth0.com/docs/rules&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;rule&lt;/a&gt;. A rule is a &lt;em&gt;JavaScript&lt;/em&gt; snippet where you can apply your business logic. This is an example taken directly from the official documentation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// update the app_metadata that will be part of the response&lt;/span&gt;
  user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;roles &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;roles &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;roles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;administrator&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// persist the app_metadata update&lt;/span&gt;
  auth0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;users&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateAppMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_metadata&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For my tiny little app, I’m assigning the role to my user manually, in the UI.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/596f761649471620a7203e636aa0dbe0/b4904/user-role.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.74468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVR42oWRvU7DMBDH/aqsDCw8AiNvgVhYmUBiY+gAAxIgSiU6VE5pA2qc2MnZ9+FDSaqqEir8dMP57P/5PkwIYbFYWGubplHVnLMeIouq4uypPj92Z0fx/tq0bbtar4tiWZZf3ofGeyI+IO7zSlnA3VV3c0nzF7MNZ9nx1+eq+3cmEnfIHXFk6YgTiwNMJD6RA6wgJZaQyCMDQIxxUPFg2RAxQITYW0ooYw05Ewux8OCz9A71Z/4I/FjRQ0VLEIOIfaNN470HgH8LvrB0+hpPnuG2JINEkNLeULY45+q6znuoKgC4zYYQtz3Tuw2Tt3Yyxfln7tch41Ma+C0ObauqoYOY0Ij9hlkRp1ZW1W4fhxgzqmpCIuIfMmoJGPhIDMIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;the user with the correct role assigned&quot; title=&quot;&quot; src=&quot;/static/596f761649471620a7203e636aa0dbe0/1d69c/user-role.png&quot; srcset=&quot;/static/596f761649471620a7203e636aa0dbe0/4dcb9/user-role.png 188w,
/static/596f761649471620a7203e636aa0dbe0/5ff7e/user-role.png 375w,
/static/596f761649471620a7203e636aa0dbe0/1d69c/user-role.png 750w,
/static/596f761649471620a7203e636aa0dbe0/78797/user-role.png 1125w,
/static/596f761649471620a7203e636aa0dbe0/aa440/user-role.png 1500w,
/static/596f761649471620a7203e636aa0dbe0/b4904/user-role.png 1768w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;A test application&lt;/h2&gt;
&lt;p&gt;Lastly, we want an extra application for testing purposes. If we want to test that the connection to the API works, we can create one that uses machine-to-machine authentication, which makes obtaining a token easier.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_client&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-frontend-test&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-frontend-test&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookery2 Application (Test) - Terraform generated&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;app_type&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;non_interactive&quot;&lt;/span&gt;

  &lt;span class=&quot;token property&quot;&gt;token_endpoint_auth_method&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;client_secret_post&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;auth0_client_grant&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cookery2-frontend-test&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;client_id&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; auth0_client.cookery2-frontend-test.id
  &lt;span class=&quot;token property&quot;&gt;audience&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; auth0_resource_server.cookery2-backend.identifier
  &lt;span class=&quot;token property&quot;&gt;scope&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is a tab on the API page that has the code to generate a token for it using the test app we just created.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/53cb58422f2a28eb7726b59d1c1dfc5d/f69df/testing-api.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 53.191489361702125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVR42nWRXWvTUBiA80u8FRp02hZNo+kH3ea6boo3gksLXgzZ0qT65wRxeCvMC73SVfuZpE1J03VdmpyT8xlJ4oUUfM4D54XzfhzOETYRxpSFiCBKQ0QgJojQAJHECG8ow4s1/vKDm4s4jmPO438QIsoY55hywhIx45TxiDLMOKIMxjFZ3kZfe8z2eBzzJPcvSbFpThzHsW17nuE4rut6nmdZlm1b8/mcUhb/BwFCiBACAPi+DyEEAIQpQRBEKYwxzjijlLHtLkK2IYTW6zVOASlRFGVH2SUJIZTS7eJsTpKdzIdhMhxugjBZAPhBsAlDfxMAAAgh28VXvV9D0xpMzN+jSX9sXY0mg4n5czjuj82BafVG5nBi9cemPZ3Z09l05mRa0ykAQNiRyrXG83rjRXX/SCrvlip7UnlXru5Llb3i01rik8SCXM2nFuRqUanf3Xn08eKzkCvK9aOX+WeHheZx/uDwYfP4QaNZOGgWa3uipOQkJSdXREkRS2XxsSKWFFFS7svVO/fyHz5dCK/fnJ7q7080Q+0Yqmac6F21002Cc72lGS3NUI13rXNd1Q31rNPWu23NaGvGq7dnl9++C67rLpfezfXq5nq1Wi491/Pchb++RTBCUWoaROk3YoQwQjAEBCeP9weuTwLpurj6bQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Testing the API page&quot; title=&quot;&quot; src=&quot;/static/53cb58422f2a28eb7726b59d1c1dfc5d/1d69c/testing-api.png&quot; srcset=&quot;/static/53cb58422f2a28eb7726b59d1c1dfc5d/4dcb9/testing-api.png 188w,
/static/53cb58422f2a28eb7726b59d1c1dfc5d/5ff7e/testing-api.png 375w,
/static/53cb58422f2a28eb7726b59d1c1dfc5d/1d69c/testing-api.png 750w,
/static/53cb58422f2a28eb7726b59d1c1dfc5d/78797/testing-api.png 1125w,
/static/53cb58422f2a28eb7726b59d1c1dfc5d/aa440/testing-api.png 1500w,
/static/53cb58422f2a28eb7726b59d1c1dfc5d/f69df/testing-api.png 1762w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Storing the state&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Terraform&lt;/em&gt; creates a &lt;a href=&quot;https://www.terraform.io/docs/state/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;state&lt;/a&gt; when run to know what things are there and in which state. Storing it in your laptop is risky, as it could get lost or even leaked. In our case, the most convenient option is to store it directly in &lt;a href=&quot;https://app.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;HashiCorp’s own service&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;terraform&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;backend&lt;span class=&quot;token type variable&quot;&gt; &quot;remote&quot; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;organization&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;our-organization&quot;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;workspaces&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;our-workspace&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are multiple &lt;a href=&quot;https://www.terraform.io/docs/state/remote.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;alternatives&lt;/a&gt; to store the state remotely.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;That’s all you need to do. Thanks to &lt;code class=&quot;language-text&quot;&gt;Terraform&lt;/code&gt;, we can provision applications and APIs using code that we can execute repeatedly. We know exactly what we have configured. We can add new use cases with little effort. You won’t need to reverse engineer what you did six months ago or write a note not to forget setting a parameter correctly. It is truly a new world.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Either Types as an alternative to throwing exceptions in Kotlin]]></title><description><![CDATA[Using Either is an alternative to exceptions to make your code more explicit about errors. Easy and convenient with Kotlin and Arrow]]></description><link>https://hceris.com/kotlin-either-types-instead-of-exceptions/</link><guid isPermaLink="false">https://hceris.com/kotlin-either-types-instead-of-exceptions/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[Functional Programming]]></category><category><![CDATA[Arrow]]></category><category><![CDATA[Exceptions]]></category><category><![CDATA[Either]]></category><pubDate>Thu, 09 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Many of the REST APIs I’ve built lately follow the same pattern. A dumb controller calls a service, which in turn calls a 3rd party API. Simple, well tested, and tidy. Everybody is happy. And then, you start dealing with error conditions.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 375px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/43ec9400dd086acca8bce4feb88eb274/5ff7e/exception.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 105.85106382978724%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVR42p2U2y8DQRTGty5tw1KXBlFRqV5c2tX9bdHQiCII4sWbB09eJP7/Zzl8y2S7lU0nOdmZOTPfnu+c74wXhqFnFkWR1+12c2EYfhuQsz3XMg07CJgdAh2gCbSAXSACyvJnA9ThPLAHrABd4ESA28BmEjBeGwvZ757raAMHQKDI9oE+UPoHcMTSNueAJZv3er00vxvRGrATRVFhBNDJ5QKwaoVK0knYBfAGvANPwGIMGF+qi66NU1Hu6QfmX7YfAaHsWin6sCiB+yRgR/nqKIdWoJpADGxd4GUVLVDBPlXUx2QOtySdfX2bmheBSoLuFPAq2i+iHIwrygww76ynHenkBGZzHxgAl6L8J37ncl6Xq7INFaeSUmWT1I0K0499LpgvUdcl6jVRz48BtIKcA1fqrJ8InYMt53BMeV3gpRRAG2fAMXAn6gUXcFcRhpLLrSIMxuhxVk1QUgDFX8oStUlkCDyLblPrVkqHZGq9BnCkCD3pcBB3wCS93JCoH6TJI9H1J3m+PIk4J6Ch9qppr01WwJrzKPgSeFvCngiwIICm6B+Kujcp4P/Jzji+ADgK5iGT/63dAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;When you think everything is flowing nicely...&quot; title=&quot;&quot; src=&quot;/static/43ec9400dd086acca8bce4feb88eb274/5ff7e/exception.png&quot; srcset=&quot;/static/43ec9400dd086acca8bce4feb88eb274/4dcb9/exception.png 188w,
/static/43ec9400dd086acca8bce4feb88eb274/5ff7e/exception.png 375w&quot; sizes=&quot;(max-width: 375px) 100vw, 375px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;If we don’t handle the exception, it will bubble up until our API returns a 500 to the caller. As a state-of-the-art backend, we can’t afford this. We have to &lt;em&gt;do&lt;/em&gt; something.&lt;/p&gt;
&lt;h2&gt;Handling failure&lt;/h2&gt;
&lt;p&gt;A typical pattern in the &lt;a href=&quot;https://spring.io/projects/spring-boot&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot&lt;/a&gt; ecosystem is using an exception handler. You put this method in the controller, and it catches automagically exceptions that happen in the chain. Our caller then gets the error formatted the way we want.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@ExceptionHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JWTVerificationException&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exception&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JWTVerificationException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ResponseEntity&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ErrorMessage&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ResponseEntity
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HttpStatus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;BAD_GATEWAY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ErrorMessage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Do not want&lt;/h3&gt;
&lt;p&gt;I don’t like this way of dealing with error conditions. Error conditions are not something to hide. They happen all the time. They are part of the code. This exception business makes the code difficult to understand. Half of the flow is happening in a way that is partially hidden and easy to miss. It makes the code harder to read.&lt;/p&gt;
&lt;p&gt;Instead, I want to show how to make errors explicit by using &lt;em&gt;Either Types&lt;/em&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;An example based on JWT&lt;/h2&gt;
&lt;p&gt;Let’s say that our &lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt; from the diagram above is going to verify &lt;a href=&quot;https://jwt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JSON Web Tokens&lt;/a&gt;. The idea is simple. We are getting a &lt;em&gt;JWT&lt;/em&gt; as a string, and we want to know if it is a valid token. If so, we want to get certain properties that we will wrap in a &lt;code class=&quot;language-text&quot;&gt;TokenAuthentication&lt;/code&gt;. This interface defines it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; Verifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * @param jwt a jwt token
     * @return authentication credentials
     */&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TokenAuthentication
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Forged signatures&lt;/h3&gt;
&lt;p&gt;I am using &lt;a href=&quot;https://github.com/auth0/java-jwt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;auth0’s library to verify tokens&lt;/a&gt;. It has a &lt;code class=&quot;language-text&quot;&gt;JWTVerifier&lt;/code&gt; class, which receives the encoded token and returns a &lt;code class=&quot;language-text&quot;&gt;DecodedJWT&lt;/code&gt;. If something goes wrong, it throws a &lt;code class=&quot;language-text&quot;&gt;JWTVerificationException&lt;/code&gt;. There are different reasons for that, such as an expired token, or an invalid signature.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Kotlin&lt;/em&gt; does not have &lt;a href=&quot;https://kotlinlang.org/docs/reference/exceptions.html#checked-exceptions&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;checked exceptions&lt;/a&gt; for a good reason. As a consequence, however, the signature is lying to us! This method might throw an exception. Only looking at the implementation will reveal the treachery. As I mentioned, the code becomes harder to read. More context is needed to understand how the app behaves.&lt;/p&gt;
&lt;h3&gt;The explicit approach&lt;/h3&gt;
&lt;p&gt;There are two things I want to change in the &lt;code class=&quot;language-text&quot;&gt;Verifier&lt;/code&gt; implementation.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt; method should not throw an exception.&lt;/li&gt;
&lt;li&gt;The signature of the method should reflect that an error might happen.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A naive approach would be to use a &lt;a href=&quot;https://kotlinlang.org/docs/reference/null-safety.html#nullable-types-and-non-null-types&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;nullable type&lt;/a&gt;. &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt; would return &lt;code class=&quot;language-text&quot;&gt;TokenAuthentication?&lt;/code&gt;. But it has a fatal flaw: We are losing all the context about what actually went wrong. If there are different causes for the error, we want to keep that information.
Enter &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; (dum dum dum…).&lt;/p&gt;
&lt;h2&gt;The Either datatype&lt;/h2&gt;
&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/01a93f228e105034b17a364c39951f42/5a46d/either.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 64.36170212765958%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVR42l1TXVPCQAw8CghIVUAo+D0+OA4+YLPbPijjX/D//xxn6552eMjkekn3NpskAUgAzgDMAExPbKLYfr9PETF03sR+RLJomibJSHa+OwB4BLAGcC0juQIg2wHYkHwn+QrgTt+OrR2Tr5ybBDY2kM75gWwPJGuS3yQ/ACxt6Xg8irVyBmLqxzpAlbbKQG3bCnSQmZP8IvkG4IXkzsy68k5IVPI6zAEsnDQAUERE4Zf1LSaqYmwmOd7lOE842wxYCvBwOOj8bD0kwda6PETERE0heeO7pXMql1pa2z/AS2u5Mouyp2MVETOxJFm1bVsYdO74PDdJFfUBpz4/AfhUgnUS4LTXvEvH71QiyZJkZvzLkOSFwcqmaUYWfu0ubgQYEboXw/4U5KbuSC7+NCSZS74l2c2hvXS8sYaj3lyqAQLJ87cx8/+m+LWBuze0V0dTXddDdzadTEDh/84zRvLK3fc6l7ckD/EyIrYRUfXvbAKRXLcArjrAuq6TGY1t2tMzkjLtrcqd9PZ7dmLn9t3M/gAh4qUkFc95rwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Either way&quot; title=&quot;&quot; src=&quot;/static/01a93f228e105034b17a364c39951f42/5a46d/either.png&quot; srcset=&quot;/static/01a93f228e105034b17a364c39951f42/4dcb9/either.png 188w,
/static/01a93f228e105034b17a364c39951f42/5a46d/either.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Originating from the &lt;a href=&quot;http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Either.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;functional community&lt;/a&gt;, &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; is a class whose value can be of two different types, called left and right. By convention, &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; is for the success case and &lt;code class=&quot;language-text&quot;&gt;Left&lt;/code&gt; for the error one.&lt;/p&gt;
&lt;p&gt;It is essentially an option type that keeps the information about the error in it. Just what we need! You can implement it yourself, but I’m going to use the excellent &lt;a href=&quot;https://arrow-kt.io/docs/apidocs/arrow-core-data/arrow.core/-either/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;arrow library&lt;/a&gt;, which includes an &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; type, among many other functional goodies.&lt;/p&gt;
&lt;p&gt;With that being said, let’s rewrite our code to make use of &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Adapting the interface&lt;/h3&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;Verifier&lt;/code&gt; class returns an &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; type to indicate that the computation might fail.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; Verifier &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;/**
     * @param jwt a jwt token
     * @return authentication credentials, or an error if the validation fails
     */&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;JWTVerificationException&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TokenAuthentication&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that we are still using the exception to signal an error, but we are not &lt;em&gt;throwing&lt;/em&gt; it anymore.&lt;/p&gt;
&lt;h3&gt;Wrapping the code that throws&lt;/h3&gt;
&lt;p&gt;Inside our implementation of &lt;code class=&quot;language-text&quot;&gt;Verifier&lt;/code&gt;, we are wrapping the problematic code from the library that we use with an extension method called &lt;code class=&quot;language-text&quot;&gt;unsafeVerify&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; JWTVerifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsafeVerify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; JWTVerificationException&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Arrow&lt;/em&gt; provides a ton of convenience methods to make it simpler to use. Thanks to the &lt;code class=&quot;language-text&quot;&gt;left&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;right&lt;/code&gt; extension methods, this code is quite tight.&lt;/p&gt;
&lt;h3&gt;Using it as a client&lt;/h3&gt;
&lt;p&gt;Implementation is done. How do we use this in our code? Whenever you want to operate on the underlying type, ignoring the error case, you can use &lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;. That allows you to chain calls without having to check whether the value is valid or not. There is an equivalent &lt;code class=&quot;language-text&quot;&gt;mapLeft&lt;/code&gt; for the error side.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;verifier
 .unsafeVerify(jwt)
 .map { it.asToken() }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ultimately, you want to convert the &lt;code class=&quot;language-text&quot;&gt;Left&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; branches into one value. One option is to use the functional &lt;a href=&quot;https://wiki.haskell.org/Fold&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;fold&lt;/a&gt; method.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    ifLeft &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ResponseEntity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;badRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    ifRight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ResponseEntity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Worked!&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or we can use a &lt;code class=&quot;language-text&quot;&gt;when&lt;/code&gt; expression because &lt;code class=&quot;language-text&quot;&gt;Left&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; happen to be &lt;a href=&quot;https://kotlinlang.org/docs/reference/sealed-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sealed classes&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Left &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; ResponseEntity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;badRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Right &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; ResponseEntity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Worked!&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So that’s pretty much it. The &lt;code class=&quot;language-text&quot;&gt;Verifier&lt;/code&gt; doesn’t throw exceptions anymore. Instead, an &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; wrapping the token is returned, with additional information about the error in case something goes wrong. We can manipulate the result throughout our application. When we are ready to unwrap the value, we use one of the two methods above to convert it to one value. In our case, the success case returns a 200, and the error a 502. To see the full implementation, check &lt;a href=&quot;https://github.com/sirech/cookery2-backend/blob/master/src/main/kotlin/com/hceris/cookery2/auth/RemoteVerifier.kt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Appendix: A built-in solution&lt;/h2&gt;
&lt;p&gt;Since &lt;em&gt;Kotlin&lt;/em&gt; 1.3, there is a built-in way of dealing with computations that can fail. It is the &lt;code class=&quot;language-text&quot;&gt;Result&lt;/code&gt; class, which is typically used in a &lt;code class=&quot;language-text&quot;&gt;runCatching&lt;/code&gt; block:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;runCatching &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;methodThatMightThrow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOrElse&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ex &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;dealWithTheException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This class can’t be used as a return type yet, so we can’t use it for our interface. Moreover, &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; integrates with all the other &lt;em&gt;arrow&lt;/em&gt; library. I plan to write in more detail about other things that you can do with it, such as converting it to an &lt;code class=&quot;language-text&quot;&gt;Option&lt;/code&gt; or chaining multiple calls in more complex examples.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; is a great way to make the error handling in your code more explicit. I’ve been trying to make all my services return it if there are failure conditions. The &lt;a href=&quot;https://github.com/sirech/cookery2-backend/blob/master/src/main/kotlin/com/hceris/cookery2/recipes/RecipesController.kt#L65-L67&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;controller&lt;/a&gt; is then responsible for branching based on success/error and deciding what to do.&lt;/p&gt;
&lt;p&gt;I think that the code is a lot clearer this way, and worth trying. It’s one step towards more functional code. I’ll follow up with others, including other parts of &lt;em&gt;arrow&lt;/em&gt;, which I like quite a bit.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Comparing Traefik2 with Traefik]]></title><description><![CDATA[Traefik2 is a significant change from Traefik. How do the both compare? I have ported an old setup to the new format]]></description><link>https://hceris.com/comparing-traefik2-with-traefik/</link><guid isPermaLink="false">https://hceris.com/comparing-traefik2-with-traefik/</guid><category><![CDATA[Traefik]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Load Balancing]]></category><category><![CDATA[SSL Termination]]></category><category><![CDATA[mTLS]]></category><category><![CDATA[Smart Routing]]></category><pubDate>Sun, 15 Dec 2019 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/403a439d1e6839e167e9e5a3f54044d0/0a47e/traefik2.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAD/UlEQVR42o2Ua1CUVRjH/7vgDSgmHcFAGNAwcWFZ3nfffVkusa5JiHITiItcFsgaJIYamO5FOgyCIggFFrfYgCVZCKVgAQ1nDGg3WnAJk8y8oBJDGB8cPywte5rdhvoQu/mfeWbOOfN/fuec55lzACtiGOY/IRQKzfHYkkqlCJZIzGHv5QXKywOmdMYW8PPeAThtQUBwCMSBgZBIJNZhx52dkenhgWQeD4iJxd6wcNuMuGiHBDfHda/zXNYfit7/BPPsLhtERELk6wu/rVutA0udnJC0fTtSdu4E9kWs4/vx+QBcXUPDvTm0hAf7p3YwgWI+ARDs4gKRuztOOjpaBhYCWH9rjAOVBklhYRW5kZHTFRe1Z6MGp6bztTM/NbR296SHvfBrulSaLTqYhhcPJ3M3WoJNzmSirOgg52RpNADCSduz+/ZXp8qJSeOzf5Cf780R8ucSOf1SNkl6XtqVKgsBEIW2pnhz7qrAX+Zl6BvJsSMkeUNIxMu5758fJWOPiP781x3LAwPdBtWi0XCktnPZxyNUSEipff9Ilt2PMzLoVgfKMHFThv4fcp68/zBl35nuDzOy2j8n/q1DhqLhK8b3vtUZmZZB8soXn+nHLmT5XpuXxV2+krVh4pYMk3csnFAznc5VLL6NngeFghuNVMvDqm3kdo1w+eOmQmNDY57xbo2APKry0OtagsvP3cn1OXszF6NX07i6GdnqdQzy8VsZ2pQURPUs1PCIvmKT8Xq1wDhT5W3UV25e/q16FzmWf6CekE9AiAqAm+Uu68d7oRv41FY30IipwaZjdy/Xkd+Hypa0A5XGqYFy4/zQiSXT2vSllje/667FyJfVtoQQy8D7NzSYUzfbzKrlmNUqix9omolhQrHUO6wyfjPaZzRMKPQLGjmZ0yo/WNAqsDiusJlQ91sGJoa4Q9beyo1rVyKhWU692lq3dFxRSWKUg4Y4pcpQ3FZJXmupvVdWk7fpnYajONpYxLH6UhghBdlHDeg6nmeeZ6uGtT7KcUJ1qImg43tCnZs0FFxSn0mrr0N0Uxv3lLXrmkTTNIA15qacKDjkRq7Xhx9o72PEXZpUkfxCcsyRnHhNXX5CZmqsQ0l+Et46HGv95zEBGaEQIkb4NF9ApQN2Poz8Ip/tvRoheqPkOT9P9xRnT+/9FEVlsIzQVsyKQFGUdaDJ4C9i7WiBIDFob9hutncqke3UvMtUKgJonncQKw6Ip2k6i6IoB5P371tZkMlgNoVKTca19DOeHLZHt4bt1KxlCos51JaNHKd/N+au+B9L5iS+L1jVNbBKNUSn20G5bgYtDsLKyVbif0E0Kwbl7w86KARs7xTYTg2Ycjkor22gGdE/pVkN9hcvEa2WDvPlDgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Directing traefik&quot; title=&quot;&quot; src=&quot;/static/403a439d1e6839e167e9e5a3f54044d0/0a47e/traefik2.png&quot; srcset=&quot;/static/403a439d1e6839e167e9e5a3f54044d0/4dcb9/traefik2.png 188w,
/static/403a439d1e6839e167e9e5a3f54044d0/5ff7e/traefik2.png 375w,
/static/403a439d1e6839e167e9e5a3f54044d0/0a47e/traefik2.png 600w&quot; sizes=&quot;(max-width: 600px) 100vw, 600px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;One year ago I experimented with &lt;a href=&quot;https://traefik.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Traefik&lt;/a&gt; and wrote &lt;a href=&quot;../setting-up-traefik/&quot;&gt;about the experience&lt;/a&gt;. We ended up using it as a reverse proxy in my project at the time. It was remarkably unremarkable, in that it didn’t give us much trouble. That is a good thing! I kind of forgot about it, other than the occasional update.&lt;/p&gt;
&lt;p&gt;Anyways, in my current project, we need a reverse proxy with automatic discovery again. Thus, &lt;em&gt;Traefik&lt;/em&gt; is back on the menu. Version 2 has been released since I last touched it. It brings quite a few changes. I decided to adapt my sample setup and compare both.&lt;/p&gt;
&lt;p&gt;I took the old repository and made a &lt;a href=&quot;https://github.com/sirech/traefik2-test&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;new one using version 2&lt;/a&gt;. Let’s see how things have changed.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Plumbing&lt;/h2&gt;
&lt;h3&gt;TOML vs YAML&lt;/h3&gt;
&lt;p&gt;Right of the bat, &lt;a href=&quot;https://github.com/toml-lang/toml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TOML&lt;/a&gt; is no longer the only supported configuration mechanism. &lt;a href=&quot;https://yaml.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;YAML&lt;/a&gt; support has been added. I don’t have a strong opinion on the matter, though &lt;em&gt;YAML&lt;/em&gt; seems to be more of a standard these days.&lt;/p&gt;
&lt;h3&gt;New concepts&lt;/h3&gt;
&lt;p&gt;Core notions have &lt;a href=&quot;https://docs.traefik.io/migration/v1-to-v2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;changed significantly&lt;/a&gt;. Before, we had &lt;em&gt;entrypoint&lt;/em&gt;, &lt;em&gt;frontend&lt;/em&gt; and &lt;em&gt;backend&lt;/em&gt;. Now we’ve got &lt;em&gt;entrypoint&lt;/em&gt;, &lt;em&gt;router&lt;/em&gt;, and &lt;em&gt;service&lt;/em&gt;. Modifications of the request happen through &lt;em&gt;middleware&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In terms of functionality, not a lot has changed. The format is not compatible, so you’ll have to migrate quite a few things.&lt;/p&gt;
&lt;p&gt;The configuration for entrypoints and providers goes in a static configuration file. The rest is dynamic, which can be extra YAML/TOML files, or directly as labels for the containers.&lt;/p&gt;
&lt;h2&gt;Service Discovery and Load Balancing&lt;/h2&gt;
&lt;p&gt;Mostly works the same. Support for ECS is gone, &lt;a href=&quot;https://github.com/containous/traefik/issues/4674&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pending to be re-added&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;As for load balancing, I had an example with two separate services in &lt;em&gt;docker-compose&lt;/em&gt; &lt;a href=&quot;https://github.com/sirech/traefik-test/blob/master/docker-compose.app1.yml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;running the same container in version 1&lt;/a&gt;. It was solved by using the same backend. Now you’ll want to define the same service for both, which couldn’t be done directly, as far as I could tell. I went around this by defining a healthcheck:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.services.web.loadBalancer.healthCheck.path=/&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/sirech/traefik2-test/blob/master/docker-compose.app1.yml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Feels a bit hacky&lt;/a&gt;, but production services will have a healthcheck anyways, so it’s not too bad.&lt;/p&gt;
&lt;h2&gt;Routing&lt;/h2&gt;
&lt;p&gt;Routing goes from &lt;em&gt;frontend&lt;/em&gt; to &lt;em&gt;routers&lt;/em&gt;. The syntax is slightly different. Other than that it remains unchanged.&lt;/p&gt;
&lt;h2&gt;TLS&lt;/h2&gt;
&lt;p&gt;Setting TLS was a lot harder than expected. In the past, you would &lt;a href=&quot;https://github.com/sirech/traefik-test/blob/master/traefik/traefik.toml#L17-L22&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;associate your certificates with the entrypoint&lt;/a&gt;. That would work automatically for a frontend using the entrypoint.&lt;/p&gt;
&lt;p&gt;Now the certificates are defined as part of a store, which can look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;stores&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;defaultCertificate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;certFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /certs/cert.crt
        &lt;span class=&quot;token key atrule&quot;&gt;keyFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /certs/cert.key&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, we activate &lt;code class=&quot;language-text&quot;&gt;tls&lt;/code&gt; for a route with labels (full compose file &lt;a href=&quot;https://github.com/sirech/traefik2-test/blob/master/docker-compose.app2.yml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.routers.web-secure.entrypoints=https&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.routers.web-secure.tls=true&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.routers.web-secure.rule=Host(`echo.testing.com`) &amp;amp;&amp;amp; Path(`/standard`)&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In theory, you can use multiple stores, but I only managed to get my certificate delivered by making it the default one.&lt;/p&gt;
&lt;p&gt;I found the whole thing quite confusing. I was getting errors about self-signed certificates in the logs all the time. I was thinking that self-signed certificates were not supported. But then they did. Confusing logs have been a theme during this whole ordeal.&lt;/p&gt;
&lt;h2&gt;Mutual TLS&lt;/h2&gt;
&lt;p&gt;This was a hard requirement I had when I first tried &lt;em&gt;Traefik&lt;/em&gt;. To get &lt;em&gt;mTLS&lt;/em&gt;, you have to add a configuration block that is applied to the &lt;em&gt;TLS&lt;/em&gt; connection:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;enforceClientCert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;clientAuth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;caFiles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; /certs/client.crt
        &lt;span class=&quot;token key atrule&quot;&gt;clientAuthType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; RequireAndVerifyClientCert&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I think this has to be a dynamic configuration, although I’m not sure. Then it’s a matter of activating that configuration for your router (full compose file &lt;a href=&quot;https://github.com/sirech/traefik2-test/blob/master/docker-compose.app3.yml#L4-L12&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.routers.web-secure-mtls.entrypoints=mTLS&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;traefik.http.routers.web-secure-mtls.tls.options=enforceClientCert@file&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Somehow my https router from the previous example stopped working without client certificates. I only managed to separate them by using two entrypoints running two different ports, much like in old &lt;em&gt;Traefik&lt;/em&gt;. My understanding from the documentation is that this shouldn’t be the case, but I couldn’t make it work otherwise.&lt;/p&gt;
&lt;h2&gt;Middleware&lt;/h2&gt;
&lt;p&gt;The biggest change I’ve seen so far is that &lt;em&gt;Traefik&lt;/em&gt; supports manipulating requests before sending them to a service and before returning them to the caller. It is called &lt;a href=&quot;https://docs.traefik.io/middlewares/overview/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;middleware&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Operations on the path of the request, like stripping parts or adding a prefix, are now expressed as middleware. Authentication has become middleware as well. I thought for a second this was new functionality. It turns out you could do most of it before, although it is a lot more consistent and organized now.&lt;/p&gt;
&lt;p&gt;I like the idea. It is potentially pretty powerful, especially if custom middleware becomes a thing.&lt;/p&gt;
&lt;h2&gt;The dashboard&lt;/h2&gt;
&lt;p&gt;The dashboard has gotten quite a facelift. This is how it looks like now:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/def444d13de58dcb32d0cd4fff68d0b5/74d4a/dashboard.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.85106382978723%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACP0lEQVR42nWRO08UURiG5694wUQFjSGx0EqRxlgZf4GX0oSGwoRYSam1hYW/wBBqgoVxdwmXZWGEBbJhFxeWxZ1hZufMucztMXOwwNtJ3pzv/r3nPc6tO08Yv/uYm7cfMTr+kCs3JhkZe2Bx8dp9Lly991+U+bL+8ugEI2OTXLo+gdM56LLfPqB3fIJ3GjLwAgvPDxn45R3YuHfO9s/hT985DUKGkSCOJUoZsiynKEBKTZYXpGmGVBqTpOQFKG0QsSQS/4ajtcZ1N/F9nzwv6HTauK5rB3U6HbrdLuXp9/vU19Yo60WsCEJBOPwbjpSSWq1mG5IkZWNjg5WVVYxJrN1s7ljW7c6BrYuEsAzL5vJlwyj+DU6p31DIX1sjtElJ0sw2mCRDmsTGY6lJ0pxIxGfDhCSMzuzgPMPDox4qGJKZBKU0UioioaweQRCSxwqtDVpphFCIWFsmUTAksUQkptRVaptzQt9nftulG0dWK2FSYpWRmoTvxz0+NV1MnpMUEKuUWGdkSlPdaTL3rUGWpKi8QKoMpVOcj3tbTNUrTK1W+Nxt0jpqo+XZ1teby0yv15hpLNHo7dI7OaYwCftBwMu1r0yvL/F+r8H24S5hENgPc2ZWK7zbqvOiXqVRXUS1dhHaEEaCp9VFPrS2eV5ZQC1/wR8MKLRhpd/jWXWRt7sus5UFqC/hC4GMYxxPCN40lpk/bEM/RHkhOkvJdcKm94NXa1W2vQF0PauxMobcpMx1Wsy6q0RhRNodYLLM5n8C/ZkIjVyZZxEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Traefik&apos;s Dashboard Revisited&quot; title=&quot;&quot; src=&quot;/static/def444d13de58dcb32d0cd4fff68d0b5/1d69c/dashboard.png&quot; srcset=&quot;/static/def444d13de58dcb32d0cd4fff68d0b5/4dcb9/dashboard.png 188w,
/static/def444d13de58dcb32d0cd4fff68d0b5/5ff7e/dashboard.png 375w,
/static/def444d13de58dcb32d0cd4fff68d0b5/1d69c/dashboard.png 750w,
/static/def444d13de58dcb32d0cd4fff68d0b5/78797/dashboard.png 1125w,
/static/def444d13de58dcb32d0cd4fff68d0b5/aa440/dashboard.png 1500w,
/static/def444d13de58dcb32d0cd4fff68d0b5/74d4a/dashboard.png 2422w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Fancy! I found the dashboard really useful in the beginning, although I didn’t check it as much once &lt;em&gt;Traefik&lt;/em&gt; was up and running. Setting basic auth for it &lt;a href=&quot;https://github.com/sirech/traefik2-test/blob/master/docker-compose.base.yml#L18-L22&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;was surprisingly tricky&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;It is a mixed bag for me, to be honest. I’m not sure if I just got used to the old stuff, but I’ve struggled to wrap my head around how things work now. Where does the config go? In a dynamic file? In labels? Who knows. The debug output could be a lot more helpful with that.&lt;/p&gt;
&lt;p&gt;Maybe doing a direct translation of an existing setup is not the way to go? From my short experience, you have to dig deep into the documentation and assume that what you knew before no longer applies.&lt;/p&gt;
&lt;p&gt;My favorite new part is middleware. For the rest, it feels a bit of a lateral move.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fail a test in Jest if an unexpected network request happens]]></title><description><![CDATA[Automatically failing unit tests with Jest in React when network requests are made will make your tests more reliable and easier to maintain]]></description><link>https://hceris.com/jest-fail-test-if-unexpected-network-request-happens/</link><guid isPermaLink="false">https://hceris.com/jest-fail-test-if-unexpected-network-request-happens/</guid><category><![CDATA[React]]></category><category><![CDATA[Jest]]></category><category><![CDATA[Testing]]></category><category><![CDATA[react-testing-library]]></category><category><![CDATA[create-react-app]]></category><category><![CDATA[axios]]></category><pubDate>Sun, 08 Dec 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A &lt;a href=&quot;https://martinfowler.com/bliki/UnitTest.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;unit test&lt;/a&gt; should not trigger network requests, such as calls to a REST API. It breaks the isolation and will make the tests flaky and unreliable.&lt;/p&gt;
&lt;p&gt;Instead, we should be mocking these requests. &lt;a href=&quot;https://reactjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React&lt;/a&gt; and &lt;a href=&quot;https://jestjs.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jest&lt;/a&gt; provide a convenient way of doing so. What if you forget to mock some requests, though? We are going to set up &lt;em&gt;Jest&lt;/em&gt; in such a way that tests fail automatically if a network request was attempted.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c27d1d36445964592105f2fa4eb92bfa/01e7c/jest.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 49.46808510638298%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42nWSvWtTYRTGT2ybj6a3iSY2MYlKq61K89H3PM/7ookYumZ16+rUzcm/QNB/QHApuLjUQYdClQpWcJKCHSqCiy4uTsVK0Sly9N4QKL5weC/3cn/neZ5zxHsvJAWAhBBEVdMkp8YqRXICwBSAybF3f/87cQyYQJ1zdl8EUFfVGgCrLoArABokz5OcB5AxAf8DWrec9z7y3pu6BoBl/DsaA8+ZclXNAVggmUkUJuCRYgDT3vsLq/1+kWRVVUskz5Ksk6zYM4CCqmadc2a7TDKbwE4A791ZFwZfyean6wvLVyeDDyXvfSGEUCBZCyHkQwhFALOqanfZsjSQRRQDozhbkQ/PX8m33b3awbOXO5+3dpdEZKZ3o7vonKuo6pyqGuASgCVVtSyvAVixXJvN5imSiyQvm6PBYCAyHA6zX97t3T94sTP8tP32uohkVm/1DTCvqvXYYkNVp5xzpmwWQBXAmVarlbJmNiiSFllKfv88jt5vbG6/efB44+v+x7KIRDe7vWrc2SZqdkrtdjuxlzd7ieXYdjleKZH9zS05PjxKP7m9bmql1+3OdVY6uTgvyy0fTzftvTeFpwHYd9vZ0WBGa/T64SP5dXgkT9fuTgy//5BOp2OASFVn4jKoTbkY24rGF3scaPUHJLOiaQ1zpugAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Test it like you mean it&quot; title=&quot;&quot; src=&quot;/static/c27d1d36445964592105f2fa4eb92bfa/01e7c/jest.png&quot; srcset=&quot;/static/c27d1d36445964592105f2fa4eb92bfa/4dcb9/jest.png 188w,
/static/c27d1d36445964592105f2fa4eb92bfa/5ff7e/jest.png 375w,
/static/c27d1d36445964592105f2fa4eb92bfa/01e7c/jest.png 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;!--more--&gt;
&lt;p&gt;I have been using &lt;a href=&quot;https://testing-library.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;react-testing-library&lt;/a&gt; a lot lately to test &lt;em&gt;React&lt;/em&gt; applications. Its core design principle is described like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The more your tests resemble the way your software is used,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;the more confidence they can give you.&lt;/p&gt;
&lt;p&gt;This is a good thing! In my experience, you write stronger tests once you get used to it. However, if you use this library you probably have seen this error message multiple times:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;: &quot;Warning: An update to %s inside a &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; was not wrapped &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; act&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.·
When testing, code that causes React state updates should be wrapped into act&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;:·
act&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  /* fire events that update state */
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It usually means that there were pending asynchronous requests when the test finished.&lt;/p&gt;
&lt;h2&gt;Our first attempt at catching errors&lt;/h2&gt;
&lt;p&gt;We have this starting configuration in the &lt;code class=&quot;language-text&quot;&gt;setupTests.js&lt;/code&gt; that is loaded automatically if you are using &lt;a href=&quot;https://create-react-app.dev/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Create React App&lt;/a&gt;. It is pretty standard.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@testing-library/jest-dom/extend-expect&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cleanup &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@testing-library/react&apos;&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;afterEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;afterEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cleanup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is very useful to fail on &lt;code class=&quot;language-text&quot;&gt;console.error&lt;/code&gt;, because that will show that there were pending requests. However, that output can be fairly confusing. We had a test in my project that was failing because we added a new section to a component. It wasn’t obvious that the new section was fetching data from an endpoint. We ended up “fixing” it by adding &lt;code class=&quot;language-text&quot;&gt;await wait()&lt;/code&gt; statements all over the place.&lt;/p&gt;
&lt;p&gt;That didn’t address the underlying issue, though. I had to spend quite a bit of time digging into it before I figured out what was going on. We want clearer feedback.&lt;/p&gt;
&lt;h2&gt;A more targeted approach&lt;/h2&gt;
&lt;p&gt;We use &lt;a href=&quot;https://github.com/axios/axios&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;axios&lt;/a&gt; to build our API requests. &lt;em&gt;Any&lt;/em&gt; test that does a request that is not mocked should fail. It still should be possible to add explicit mocks for things like service tests as well. We also use &lt;a href=&quot;https://pact.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pact&lt;/a&gt; for &lt;em&gt;Contract Testing&lt;/em&gt;. These tests go against a local server, no mock should be active when they run. I extended the &lt;code class=&quot;language-text&quot;&gt;setupTests.js&lt;/code&gt; file to mock &lt;code class=&quot;language-text&quot;&gt;axios&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; spies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;spyOn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;get&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;patch&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;spyOn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;patch&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;spyOn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;post&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resetAllMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;afterEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;spies&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;spies&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;patch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;spies&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;post&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s it. With this, any attempt at doing an unexpected request will trigger a nice and explicit failed assertion. We still need to deal with &lt;em&gt;expected&lt;/em&gt; requests.&lt;/p&gt;
&lt;h3&gt;Mocking services&lt;/h3&gt;
&lt;p&gt;This setup does not define any return for the requests. You need to take care of that if you are building integrated tests for your components.&lt;/p&gt;
&lt;p&gt;I tend to deal with that at the service level. My requests are usually encapsulated in a file that gets imported by the components that need them. I use Jest’s &lt;a href=&quot;https://jestjs.io/docs/en/manual-mocks&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;manual mocks&lt;/a&gt; for that, which sit one level higher than &lt;code class=&quot;language-text&quot;&gt;axios&lt;/code&gt;. A service could be as simple as this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// src/recipe-list/recipeList.service.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AxiosResponse &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Recipe &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;components/recipe/types&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; recipeList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Recipe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;axios&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/rest/recipes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which can be replaced with a manual mock like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// src/recipe-list/__mocks__/recipeList.service.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AxiosResponse &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; recipes &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@testing/__fixtures__&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Recipe &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;components/recipe/types&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; recipeList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Recipe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    status&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    statusText&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;OK&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recipes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    config&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Mocking axios directly&lt;/h3&gt;
&lt;p&gt;Another alternative is to mock &lt;em&gt;axios&lt;/em&gt; directly and add your behavior, which will replace the mock that we defined initially.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;service&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockResolvedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Resetting the mocks&lt;/h3&gt;
&lt;p&gt;If you need &lt;code class=&quot;language-text&quot;&gt;axios&lt;/code&gt; to work normally, like in the case of Contract Tests, you can restore the original behavior.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;beforeAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;restoreAllMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Summary: Make your errors explicit&lt;/h2&gt;
&lt;p&gt;That all there is to it. A simple solution, if a bit hacky, to make sure that errors surface as quickly as possible and don’t get hidden.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 25/12/2019:&lt;/em&gt; Grammar review
&lt;em&gt;EDIT 15/04/2020:&lt;/em&gt; Fix broken code snippet&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How to split the deployment of your front end and back end with the help of Consumer Driven Contract Testing]]></title><description><![CDATA[By using contract tests, you can build more independent frontend and backends that can be deployed separately. That way, you can get faster feedback]]></description><link>https://hceris.com/split-frontend-backend-deployment-with-cdcs/</link><guid isPermaLink="false">https://hceris.com/split-frontend-backend-deployment-with-cdcs/</guid><category><![CDATA[Testing]]></category><category><![CDATA[Contract Testing]]></category><category><![CDATA[Pact]]></category><category><![CDATA[Continuous Delivery]]></category><category><![CDATA[Jest]]></category><category><![CDATA[CircleCI]]></category><pubDate>Tue, 12 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://www.thoughtworks.com/de/radar/techniques/consumer-driven-contract-testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Consumer driven contract testing&lt;/a&gt; is a great way to improve the reliability of interconnected systems. Integration testing becomes way easier and more self contained. It opens the door for independent deployments. It leads to faster iterations and more granular feedback. Unlike your insurance, they don’t have any fine print. This article is about setting them up in a delivery pipeline, in the context of doing &lt;a href=&quot;https://continuousdelivery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;continuous delivery&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I want to show how &lt;em&gt;Contract Tests&lt;/em&gt; help splitting the deployment of the front end and the back end of a small application. I have a React client and a Spring Boot backend written in Kotlin.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;What is a Contract Test?&lt;/h2&gt;
&lt;p&gt;I am not talking about &lt;a href=&quot;https://en.wikipedia.org/wiki/Smart_contract&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;smart contracts&lt;/a&gt;. There is no blockchain whatsoever in this article. Sorry for that (Contract Tests for Smart Contracts sounds like a conference talk that the world badly needs, though!).&lt;/p&gt;
&lt;p&gt;In a nutshell, a Contract Test is a specification of the interactions between a consumer and a provider. In our case, the communication happens using REST. The consumer defines the actions sent to the provider and the responses that will be returned. In our case, the frontend is the consumer and the backend is the provider. A &lt;em&gt;contract&lt;/em&gt; is generated. Both sides test against this contract.&lt;/p&gt;
&lt;p&gt;It is not really about any particular technology. There are a bunch of different frameworks, but some simple scripts could do the trick.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 450px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c8503db2bd616288d804d97c55d725ca/fc2a6/simple-cdc.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.17021276595745%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVR42mVQy04CQRCcwd0EWSDgG4N4EIkXl+2qWhIuegFvRj/JTzeNvQnqoTKZnq7HVNpsNglAH8DwCCdm5vNE8h/+zv3ukJR8UAC4A3AJ4ALAAsAkloogLUm+kHwIgeJI8AzATcdJTdP4QgPgGcAyzrmZjcNgRPKd5BfJTwCnAK7MrHJzko8AqghUJjPLIeTJzgFcA7glOQ3nIcmG5AfJt0g3i0QzknMAAw9gZsUhPoBxXdd5vV73IkEVHebdbuffWpF89TRt2+a6rn2WoxYX8/3SOYciSS4kkaRFmrIrXlImOZI0kTSV1AuOoy9pKelJ0v1+v/8RlFS2beuksSTvw6vo3jrhX/dAljQIs2q73aZv37Bb///QjKgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Basic contract test&quot; title=&quot;&quot; src=&quot;/static/c8503db2bd616288d804d97c55d725ca/fc2a6/simple-cdc.png&quot; srcset=&quot;/static/c8503db2bd616288d804d97c55d725ca/4dcb9/simple-cdc.png 188w,
/static/c8503db2bd616288d804d97c55d725ca/5ff7e/simple-cdc.png 375w,
/static/c8503db2bd616288d804d97c55d725ca/fc2a6/simple-cdc.png 450w&quot; sizes=&quot;(max-width: 450px) 100vw, 450px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;Why have it as part of the delivery pipeline?&lt;/h3&gt;
&lt;p&gt;First of all, running these tests continuously ensures that they keep working at all times. The big benefit, however, is that we can separate the deployment of frontend and backend. If both sides are fulfilling the contract, it is likely that they work together correctly. Thus, we can consider avoiding expensive integrated tests. They tend to work pretty badly anyways.&lt;/p&gt;
&lt;h2&gt;Setting up some contracts&lt;/h2&gt;
&lt;p&gt;There are two sides to set up, consumer and provider. The tests will run in the pipelines that build the frontend and the backend, respectively. We are going to use the &lt;a href=&quot;https://docs.pact.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Pact framework&lt;/a&gt; for our examples, which is the tool that I am most familiar with. Because of that, I tend to use pact and contract interchangeably. Our pipelines are written for &lt;a href=&quot;https://circleci.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CircleCI&lt;/a&gt;, but they should be fairly easy to port to other CI Tools.&lt;/p&gt;
&lt;h3&gt;The consumer side&lt;/h3&gt;
&lt;p&gt;As mentioned, the consumer leads the creation of the contract. Having the client driving this might sound counterintuitive. Often, APIs are created before the clients that will use them. Flipping it around is a nice habit to get into. It forces you to really think in terms of what the client will actually do, instead of bikeshedding a super generic API that will never need most of its features. You should give it a try!&lt;/p&gt;
&lt;p&gt;The pact is defined through interactions specified in unit tests. We specify what we expect to be sent to the backend, and then use the client code to trigger requests. Why? We can compare expectations against actual requests, and fail the tests if they don’t match. Let’s have a look at an example. We are using &lt;a href=&quot;https://jestjs.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jest&lt;/a&gt; to run the tests. We’ll start with some initialization code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; path &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;path&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Pact &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pact&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;Pact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    port&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8990&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    log&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;logs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pact.log&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    dir&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pacts&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    spec&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    consumer&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;frontend&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    provider&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;backend&apos;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; provider&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we have the code for an actual test. The test consists of two parts. First we define the expected interaction. This is not very different from mocking an http library, with something like &lt;a href=&quot;https://github.com/ctimmerm/axios-mock-adapter&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;axios&lt;/a&gt;. It specifies the request that we will send (URL, headers, body and so forth), and the response that we will get.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; interaction&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; InteractionObject &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i have a list of recipes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  uponReceiving&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a request to get recipes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  withRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    path&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/rest/recipes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      Accept&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&apos;X-Requested-With&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;XMLHttpRequest&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  willRespondWith&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    status&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string-property property&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json; charset=utf-8&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    body&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pasta carbonara&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        servings&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        duration&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;35&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we have the test itself, where we call the actual client code that will trigger the request. I like to encapsulate these requests in services that convert the raw response into the domain model that will be used by the rest of the app. Through some assertions, we make sure that the data that we are delivering from the service is exactly what we expect.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;works&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recipeList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBeGreaterThan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pasta carbonara&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    servings&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    duration&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;35&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that even if &lt;code class=&quot;language-text&quot;&gt;recipeList&lt;/code&gt; is properly typed with &lt;code class=&quot;language-text&quot;&gt;TypeScript&lt;/code&gt;, that won’t help us here. Types disappear at runtime, so if the method is returning an invalid &lt;code class=&quot;language-text&quot;&gt;Recipe&lt;/code&gt; we won’t realize it, unless we explicitly test for it.&lt;/p&gt;
&lt;p&gt;Finally we need to define some extra methods that will ensure that the interactions are verified. If there are interactions missing, or they don’t look like they should, the test will fail here. After that, all that remains is writing the pact to disk.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;beforeAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; provider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;afterEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; provider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;afterAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; provider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;finalize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the end, the pact gets generated as a JSON file, reflecting all the interactions that we have defined throughout all our tests.&lt;/p&gt;
&lt;h4&gt;Flexible matching&lt;/h4&gt;
&lt;p&gt;Our pact thus far is specifying the exact values that it will get from the backend. That won’t be maintainable in the long run. Certain things are inherently harder to pin down to exact values (for example, dates). A pact that breaks constantly will lead to frustration. We are going through this whole process to make our life easier, not harder. We’ll avoid that by using &lt;a href=&quot;https://docs.pact.io/getting_started/matching&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;matchers&lt;/a&gt;. We can be more flexible and define how things will look like, without having to provide exact values. Let’s rewrite our previous body:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;willRespondWith&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  status&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string-property property&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json; charset=utf-8&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  body&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Matchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eachLike&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Matchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;somethingLike&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Matchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;somethingLike&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pasta carbonara&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    servings&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Matchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;somethingLike&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    duration&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Matchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;somethingLike&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;35&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can be more specific. You can set the expected length of a list, use regexes and a bunch of other things.&lt;/p&gt;
&lt;h4&gt;Integrating it in the pipeline&lt;/h4&gt;
&lt;p&gt;The pact tests rely on an external process, and having multiple tests hitting it can lead to non deterministic behavior. One solution is to run all the tests sequentially:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--coverage&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--runInBand&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to run the pact tests independently, we can build our own task to run them separately:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;pact&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;jest --transform &apos;{\&quot;^.+\\\\.ts$\&quot;: \&quot;ts-jest\&quot;}&apos; --testRegex &apos;.test.pact.ts$&apos; --runInBand&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which will become an extra step in our pipeline:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;check&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;working_directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ~/app

    &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; circleci/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12.4&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; checkout
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm run linter&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;js
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm test &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;coverage &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;runInBand
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm pact&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Storing the pact&lt;/h4&gt;
&lt;p&gt;Our pact is a json file that we are going to commit directly in the frontend repository, after running the tests locally. I’ve found that this tends to work well enough. Making the pipeline itself commit the pact to &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; does not seem to be necessary.
We’ll get to extending the pact and in a second.&lt;/p&gt;
&lt;h3&gt;The provider side&lt;/h3&gt;
&lt;p&gt;At this point we have a working pact, that is being verified by the consumer. But that is only half of the equation. Without a verification from the provider side, we haven’t accomplished anything. Maybe even less than that, because we might get a false sense of security!&lt;/p&gt;
&lt;p&gt;To do this, we are going to start the backend as a development server and run the pact against it. There is a &lt;code class=&quot;language-text&quot;&gt;gradle&lt;/code&gt; provider that takes care of this. We need to configure it and provide a way of finding the pact (which is stored in the frontend repository). You can fetch the pact from the internet, or from a local file, whichever is more convenient.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;buildscript &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    dependencies &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        classpath &lt;span class=&quot;token string&quot;&gt;&apos;au.com.dius:pact-jvm-provider-gradle_2.12:3.6.14&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

apply plugin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;au.com.dius.pact&apos;&lt;/span&gt;

pact &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    serviceProviders &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        api &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4003&lt;/span&gt;

            &lt;span class=&quot;token function&quot;&gt;hasPactWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;frontend&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                pactSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://path-to-the-pact/frontend-backend.json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                stateChangeUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;port&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/pact&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What remains is starting the server and running the pact against it, which we do with a small script:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;goal_test-pact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;trap&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;stop_server&quot;&lt;/span&gt; EXIT

  goal_build
  start_server

  ./gradlew pactVerify
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function-name function&quot;&gt;start_server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;artifact&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;app.jar
  &lt;span class=&quot;token assign-left variable&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4003&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lsof&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-P&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; LISTEN &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$port&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /dev/null &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Port[&lt;span class=&quot;token variable&quot;&gt;${port}&lt;/span&gt;] is busy. Server won&apos;t be able to start&quot;&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;nohup&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-Dspring.profiles.active&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;pact &lt;span class=&quot;token parameter variable&quot;&gt;-jar&lt;/span&gt; ./build/libs/&lt;span class=&quot;token variable&quot;&gt;${artifact}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/dev/null &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;&amp;amp;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# Wait for server to answer requests&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--output&lt;/span&gt; /dev/null &lt;span class=&quot;token parameter variable&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--fail&lt;/span&gt; http://localhost:&lt;span class=&quot;token variable&quot;&gt;$port&lt;/span&gt;/actuator/health&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function-name function&quot;&gt;stop_server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pkill&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;java -Dspring.profiles.active=pact -jar&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Fixtures&lt;/h4&gt;
&lt;p&gt;If you are running your backend in development mode, it will have to deliver some data, so that the contract is fulfilled. Even if we are not using exact matching, we have to return something, otherwise it won’t be possible to verify it.&lt;/p&gt;
&lt;p&gt;You can use mocks, but I’ve found that avoiding them as much as possible leads to more trustworthy results. Your app is closer to what will happen in production. So what other options are there? Remember that when we were defining interactions, we had a &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;. That’s the cue for the provider. One way of using it is the &lt;code class=&quot;language-text&quot;&gt;stateChangeUrl&lt;/code&gt;. We can provide a special controller to initialize our backend based on the &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; PATH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/pact&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Pact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; state&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token annotation builtin&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;PATH&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; consumes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;MediaType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;APPLICATION_JSON_VALUE&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@ConditionalOnExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\${pact.enabled:true}&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;PactController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; repository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; RecipeRepository&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@PostMapping&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@RequestBody&lt;/span&gt; body&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Pact&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ResponseEntity&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;i have a list of recipes&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initialRecipes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doNothing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ResponseEntity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that this controller is only active for a specific profile, and won’t exist outside of it.&lt;/p&gt;
&lt;h4&gt;Integrating it in the pipeline&lt;/h4&gt;
&lt;p&gt;As with the provider, we will run the check as part of our pipeline&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;working_directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ~/app

    &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; circleci/openjdk&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;8&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;jdk

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; checkout
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./go linter&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;kt
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./go test&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;unit
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./go test&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pact&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is a slight difference, though. Our contract gets generated by the consumer. That means that a change in the frontend could lead to a pact that does not verify properly anymore, even though no code was changed in the backend. So ideally, a change in the pact should trigger the backend pipeline as well. I haven’t found a way to represent this elegantly in &lt;em&gt;CircleCI&lt;/em&gt;, unlike say &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ConcourseCI&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;How the contract influences the relationship between frontend and backend&lt;/h2&gt;
&lt;p&gt;It’s nice that we got this set up. &lt;a href=&quot;https://en.wiktionary.org/wiki/never_change_a_running_system&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Never touch a running system&lt;/a&gt;, right? Well, we might! After all, quick change is why we invest in all this tooling. How would you introduce a change that requires extending the API?&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We start with the client. We want to define what the client will get that is not there yet. As we learned, we do that through a test in the frontend that defines the expectation for the new route, or the new fields. That will create a new version of the pact.&lt;/li&gt;
&lt;li&gt;Note that at this point the backend &lt;em&gt;does not&lt;/em&gt; fulfill the pact. A new deployment of the backend will fail. But also, the &lt;em&gt;existing&lt;/em&gt; backend does not fulfill the pact either right now. The change you introduced has to be backwards compatible. The frontend should not be relying on the changes, either.&lt;/li&gt;
&lt;li&gt;Now it’s time to fulfill the new pact from the backend side. If this takes a long time, you will block your deployment process, which is not good. Consider doing smaller increments in that case. Anyways, you’ve got to implement the new functionality. The pact test will verify that your change is what’s actually expected.&lt;/li&gt;
&lt;li&gt;Now that the backend is providing the new functionality, you can freely integrate it in your frontend.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This flow can get a bit awkward in the beginning. It is really important to work with the smallest quantum of functionality. You don’t want to block your deployment process.&lt;/p&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;For the integration between your own frontend and backend I have found this setup to be sufficient in practice. However, as complexity grows, versioning will become important. You’ll want to help multiple teams collaborate more easily. For that, we can use a &lt;a href=&quot;https://docs.pact.io/pact_broker&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;broker&lt;/a&gt;. This is a lot harder to implement, so you should ask yourself if you really need it. Don’t fix problems that you don’t have yet.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;To summarize, this is the setup we arrived at:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4af6bc4800ac62b28269735fdf6f7c2c/d0c0e/pipelines-full.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.148936170212764%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVR42k2S3UsbURDFr41ZE01EJfGrBVt0C9vAfpzfbGISSpvQpvgWqIjgW0t96kv/xfxlZeJdcGGYe2fP3HvOuROAE+AdMKyqqj2fz0NZlrtlWbZjJFVV7fk6y7KdxWIRhsNhWC6XocF4n2MkJQE4AErgIeYZcAh0gX0zS1arVYj7G+ALYMC0wUgaSLqQ1A91XTt4AjwBH4DfwGczK+q6rs3sh19qZn7AI/ALWAB/zawys1rSlaRrSYdOuwX0gQr4FHMynU6DmTXszwG/+IyXL/O6pB2gJcnldiUdOOgUuHTqfvhoNHLQkSSPfszHwLE3rNfrLYk0Tb336BX2RFLPi+dRzjfgI3DlbMbjcZDk/vSyLAuRYTeqeA+kwBtJrqQNOMtO4+ESWAM58Ay8NTOTdCnpdDabOWYc4x9wC/xxL83sGvgK3G82m9B46J7cmZkDv8fXHURf9ieTibMYRC9/RkV3rsbMetGyVFJ7K8tnLc5btygKn8HEs89WjE6e59vZjPWOr/M8bxVFsa35fyfwH0wDftgSb5wjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Full setup&quot; title=&quot;&quot; src=&quot;/static/4af6bc4800ac62b28269735fdf6f7c2c/d0c0e/pipelines-full.png&quot; srcset=&quot;/static/4af6bc4800ac62b28269735fdf6f7c2c/4dcb9/pipelines-full.png 188w,
/static/4af6bc4800ac62b28269735fdf6f7c2c/5ff7e/pipelines-full.png 375w,
/static/4af6bc4800ac62b28269735fdf6f7c2c/d0c0e/pipelines-full.png 715w&quot; sizes=&quot;(max-width: 715px) 100vw, 715px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Think about all the time you have spent writing tests to check that your backend is sending the right data. That is a lot more convenient to do with a contract. Moreover, releasing frontend and backend independently means being faster, releasing smaller pieces of functionality. It might feel scary at first, but you will realize that you actually are much more aware of what’s going out that way.&lt;/p&gt;
&lt;p&gt;Once you have adopted this for one service, there is no reason not to do it for all of them. I really don’t miss running costly end to end test suites just to verify that my backend is working. Here is the code that I used in the examples for the &lt;a href=&quot;https://github.com/sirech/cookery2-frontend&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;frontend&lt;/a&gt; and the &lt;a href=&quot;https://github.com/sirech/cookery2-backend&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;backend&lt;/a&gt;. It is a full running (albeit small) application. Good luck with your contracts!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kotlin tapas: Get a taste of Kotlin]]></title><description><![CDATA[A bunch of bite sized tapas to get a first taste of Kotlin]]></description><link>https://hceris.com/kotlin-tapas-a-taste-of-kotlin/</link><guid isPermaLink="false">https://hceris.com/kotlin-tapas-a-taste-of-kotlin/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[Tapas]]></category><category><![CDATA[Testing]]></category><pubDate>Sun, 27 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently did a workshop internally. It was intended to be an introduction about &lt;a href=&quot;https://kotlinlang.org&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlin&lt;/a&gt;. Given that I had limited time, I was wondering which format to use. I wanted to showcase a bunch of the features that &lt;em&gt;Kotlin&lt;/em&gt; brings to the table.&lt;/p&gt;
&lt;p&gt;Then I remembered &lt;a href=&quot;https://www.rubytapas.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RubyTapas&lt;/a&gt; from my earlier days as a &lt;em&gt;Ruby&lt;/em&gt; dev. That sounds like a good start! Who doesn’t like tapas? I did not quite remember how they were actually presented, though. My interpretation is to have small snippets of code. Each snippet illustrates a particular feature of the language. And thus &lt;a href=&quot;https://github.com/sirech/kotlintapas&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlintapas&lt;/a&gt; was born.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;What are you babbling about?&lt;/h2&gt;
&lt;p&gt;Let’s assume you have an audience of people who are maybe already familiar with &lt;em&gt;Java&lt;/em&gt;, but not with &lt;em&gt;Kotlin&lt;/em&gt;. While code samples are nice, it’s cooler to have something concrete to play with. We have the following elements.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A snippet of &lt;em&gt;Kotlin&lt;/em&gt; code&lt;/li&gt;
&lt;li&gt;A test for that snippet&lt;/li&gt;
&lt;li&gt;A problem to fix: Either refactor the code to make it more idiomatic, or implement missing functionality, making the test green in the process&lt;/li&gt;
&lt;li&gt;A link to the appropriate documentation&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;My goal is to allow everybody to play with the language a bit, and fix the problem and see the tests working for confirmation. Knowing how chaotic workshops can get, I wanted to avoid build a complex application that requires you to follow along without getting lost.&lt;/p&gt;
&lt;h2&gt;A sample tapa&lt;/h2&gt;
&lt;p&gt;Let’s check one of them. We have this this tapa about &lt;a href=&quot;https://kotlinlang.org/docs/reference/data-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Data classes&lt;/a&gt;, with the following starting code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hceris&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kotlintapas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataclasses

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DataClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; b&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;the test looks like this&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hceris&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kotlintapas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataclasses

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;junit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jupiter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Test
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; strikt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expectThat
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; strikt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;assertions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isEqualTo

&lt;span class=&quot;token keyword&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; DataClassTest &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; one &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DataClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;The number is &quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token annotation builtin&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;`sensible equals`&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; two &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DataClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;The number is &quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;one&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;two&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation builtin&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;`making a copy`&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; copy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DataClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;one&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; one&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;one&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;copy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;the exercise is to do the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;## Problem

- The test is failing because the instances are not actually equal. How to fix it?
- We want to make a copy of our class, but we are introducing a lot of duplication. What can be done about it?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which in this case is as easy as using &lt;code class=&quot;language-text&quot;&gt;data class&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;class&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;There is more!&lt;/h2&gt;
&lt;p&gt;This is a pretty simple example, but there are &lt;a href=&quot;https://github.com/sirech/kotlintapas#list-of-exercises&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;plenty more&lt;/a&gt;, some of them a lot more complex. I’ve tried to cover as many different aspects of &lt;em&gt;Kotlin&lt;/em&gt; as possible, but still there is plenty left.&lt;/p&gt;
&lt;p&gt;As I mentioned, we ran this workshop internally, with around 15 or 16 working in pairs. We had three people acting as coaches, running around offering help. We only managed to go through about five tapas in one hour, and it actually felt a bit rushed. So there is plenty of material there, specially for people new to the language.&lt;/p&gt;
&lt;p&gt;Check &lt;a href=&quot;https://github.com/sirech/kotlintapas&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the whole thing&lt;/a&gt; if you are intrigued and want to use it yourself. They are free!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Descriptive assertions in Kotlin for clearer tests]]></title><description><![CDATA[Readable assertions will make your Kotlin code a lot more self describing and your tests more maintainable]]></description><link>https://hceris.com/descriptive-assertions-in-kotlin/</link><guid isPermaLink="false">https://hceris.com/descriptive-assertions-in-kotlin/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[Testing]]></category><category><![CDATA[Strikt]]></category><pubDate>Sat, 28 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I’ve written already about &lt;a href=&quot;../mock-verification-in-kotlin/&quot;&gt;mocks in Kotlin&lt;/a&gt;. In that post, I was using &lt;a href=&quot;https://github.com/robstoll/atrium&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Atrium&lt;/a&gt; to write my assertions. Since then I gave &lt;a href=&quot;https://github.com/robfletcher/strikt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Strikt&lt;/a&gt; a try, which is another cool little library. Meanwhile I was using &lt;a href=&quot;https://joel-costigliola.github.io/assertj/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AssertJ&lt;/a&gt; at work, so I’ve had the opportunity to experiment quite a bit lately!&lt;/p&gt;
&lt;p&gt;There are two little tricks (&lt;em&gt;KotlinTapas&lt;/em&gt;, if you will) that I find worth sharing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Assertions for data classes&lt;/li&gt;
&lt;li&gt;Custom assertions&lt;/li&gt;
&lt;/ul&gt;
&lt;!--more--&gt;
&lt;h2&gt;Assertions for &lt;a href=&quot;https://kotlinlang.org/docs/reference/data-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;data classes&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Our functions receive and return &lt;em&gt;data classes&lt;/em&gt;. That means that our tests will often expect as a result a particular instance of one such class. For the assertions, we started by using &lt;code class=&quot;language-text&quot;&gt;isEqualTo&lt;/code&gt; to compare the whole instance.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SecurityContextHolder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authentication&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;this approach becomes a problem as your classes gain in complexity. Maybe they contain other entities, or there are lists or maps involved. Generating a proper instance to make &lt;code class=&quot;language-text&quot;&gt;isEqualTo&lt;/code&gt; happy ends up being a lot of work.&lt;/p&gt;
&lt;p&gt;Instead, we want to check just some of the properties. I prefer to avoid multiple assertions in one test, but in this case I see it as unavoidable. This is the solution I use for &lt;em&gt;AssertJ&lt;/em&gt;, followed by the one for &lt;em&gt;Strikt&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// AssertJ&lt;/span&gt;
SoftAssertions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assertSoftly&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2|3234123&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authorities&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authority &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;create:recipes&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Strikt&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2|3234123&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; authorities&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authority &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;create:recipes&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I really like the compactness of the &lt;em&gt;Strikt&lt;/em&gt; solution. To be fair, we could compress the &lt;em&gt;AssertJ&lt;/em&gt; one with &lt;code class=&quot;language-text&quot;&gt;apply&lt;/code&gt;. But I much prefer the second one.&lt;/p&gt;
&lt;p&gt;What about the error message? A drawback of having different assertions is that you get an error message lacking in context:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Expecting:
 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;EN&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
to be equal to:
 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;DE&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
but was not.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Who can make sense of that without looking at the test in detail? Luckily, our solution offers a much more meaningful message:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;org.opentest4j.AssertionFailedError: ▼ Expect that Some&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TokenAuthentication@52789c41: Authenticated: &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Details: null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Granted Authorities: profile, create:recipes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;:
  ▼ TokenAuthentication@52789c41: Authenticated: &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Details: null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Granted Authorities: profile, create:recipes:
    ▼ name:
      ✗ is equal to &lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2|3234123&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; found &lt;span class=&quot;token string&quot;&gt;&quot;google-oauth2|dude&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Much better, isn’t it?&lt;/p&gt;
&lt;h2&gt;Custom assertions&lt;/h2&gt;
&lt;p&gt;A way of making assertions &lt;em&gt;say&lt;/em&gt; more is to expand them according to our needs. For example, I have been playing with &lt;a href=&quot;https://arrow-kt.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Arrow&lt;/a&gt; a lot lately (which on its own can be an endless source of blog posts I believe). I am getting away from using exceptions as much as I can, instead using the &lt;a href=&quot;https://arrow-kt.io/docs/arrow/core/either/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Either datatype&lt;/a&gt;. Or &lt;em&gt;Monad&lt;/em&gt;, it’s not like I really know what I’m talking about.&lt;/p&gt;
&lt;p&gt;In any case, I have a repository with a function that I want to test.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RecipeDetails&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’m calling the method, and want to assert that I got a valid return (&lt;code class=&quot;language-text&quot;&gt;Either.Right&lt;/code&gt;). Then I want to check some of the properties of the output:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; recipe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;recipe&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isA&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Either&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Right&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;RecipeDetails&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;carbonara&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ingredients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; steps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;this code is a bit unsatisfying. I have to check if the value is a &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; value, convert it, and then get the actual content before I can start asserting. Luckily for us, &lt;em&gt;Strikt&lt;/em&gt; allows you to write &lt;a href=&quot;https://strikt.io/wiki/custom-assertions/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;custom assertions&lt;/a&gt; that are perfect for a case like this. After hitting my head against the typing for a while, I arrived at this helper:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;reified&lt;/span&gt; T&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;reified&lt;/span&gt; U&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Assertion&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Builder&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Either&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;U&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isRight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        isA&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Either&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Right&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; b &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which I use then like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; recipe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; repository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;expectThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;recipe&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isRight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;carbonara&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ingredients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; steps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;not a huge change. However, it increases the readability of that little snippet and makes the intentions behind it clearer. I like code with good intentions.&lt;/p&gt;
&lt;p&gt;The same can be done for the &lt;a href=&quot;https://arrow-kt.io/docs/arrow/core/option/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Option datatype&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;reified&lt;/span&gt; T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Assertion&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Builder&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Option&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isSome&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        isA&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Some&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; t &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;reified&lt;/span&gt; T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Assertion&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Builder&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Option&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        isA&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;None&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Why, though?&lt;/h2&gt;
&lt;p&gt;What did we accomplish? Two things, in my mind:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tests will tell a better story of what is being tested and why.&lt;/li&gt;
&lt;li&gt;When they fail, it will be easier to figure out the reason.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[How to automate REST API end-to-end tests in a CI environment with Postman and Newman]]></title><description><![CDATA[Postman is a great tool to explore REST APIs. You can build requests and try them out to get quick feedback. Then you can persist them as collections to make sure that the knowledge doesn't get lost.]]></description><link>https://hceris.com/how-to-automate-rest-api-end-to-end-tests/</link><guid isPermaLink="false">https://hceris.com/how-to-automate-rest-api-end-to-end-tests/</guid><category><![CDATA[REST]]></category><category><![CDATA[e2e]]></category><category><![CDATA[Postman]]></category><category><![CDATA[newman]]></category><pubDate>Mon, 19 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://learning.getpostman.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Postman&lt;/a&gt; is a great tool to explore REST APIs. You can build requests and try them out to get quick feedback. Then you can persist them as collections to make sure that the knowledge doesn’t get lost.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/postmanlabs/newman&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Newman&lt;/a&gt;, the CLI version of Postman, allows you to take it to the next level and transform a collection into a suite of automated end-to-end tests. This suite will run then in your CI tool of choice. In this article I will explore the benefits of doing so and show you how to set it up.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 110.10638297872339%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMEBQL/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAP/2gAMAwEAAhADEAAAAep5xXy0xKK51RIgf//EABkQAAMBAQEAAAAAAAAAAAAAAAABAiETA//aAAgBAQABBQKS9T8tix1joVHTOjP/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8BK//EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwEj/8QAFhAAAwAAAAAAAAAAAAAAAAAAECAy/9oACAEBAAY/AjTf/8QAGhABAQEBAQEBAAAAAAAAAAAAAQARIUExof/aAAgBAQABPyFGENw9J/RfAfxcBu3WztHEo3//2gAMAwEAAgADAAAAEAjogv/EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCxbEx//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAgEBPxBbhIys/8QAHRABAQEAAQUBAAAAAAAAAAAAAREAMSFBUXHB0f/aAAgBAQABPxCa7TH7ca398yI1PDCQUHKfmK4545y2V0NeQ3//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;You got to test it&quot; title=&quot;&quot; src=&quot;/static/18e1df9e3dd453fdf54be4301cdc255b/acb04/introduction.jpg&quot; srcset=&quot;/static/18e1df9e3dd453fdf54be4301cdc255b/bc01b/introduction.jpg 188w,
/static/18e1df9e3dd453fdf54be4301cdc255b/bf173/introduction.jpg 375w,
/static/18e1df9e3dd453fdf54be4301cdc255b/acb04/introduction.jpg 750w,
/static/18e1df9e3dd453fdf54be4301cdc255b/e6e7b/introduction.jpg 770w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;!--more--&gt;
&lt;h2&gt;What is an End-to-End test in the context of an API?&lt;/h2&gt;
&lt;p&gt;Testing nomenclature is a tricky thing. Keeping the &lt;a href=&quot;https://martinfowler.com/bliki/TestPyramid.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;testing pyramid in mind&lt;/a&gt;, we can picture them as very high level tests. These tests confirm that a particular REST API works as intended, treating the internals as a black box. We don’t involve any UI in the process, which helps reduce the flakiness.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 603px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 119.14893617021276%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsTAAALEwEAmpwYAAADc0lEQVR42qWT227iVhSG84yV+g7tA/Sic1elI0ZqlUpInRLNJJ2hGSeNoBBOY8zJ5hSMDTaE4CQYgw2YQzgksQHbHFZFnIaQpnPT/2Zra+vb69//2msLnsgwDH1T2j+azWYAoGna3d3dYrEAgOVyuWUuANDtdo+OjgiCiEQi0QdFCAKPxWLxeNzhcOAEIbfboihWq9VGo6Hr+hqu1WqZTMasP78XANyqqq4biqJwHMfzfCqVzmazOI43W61qtbqG6/U6RVEAYLoCgPl8Xj/F7/q98zI3Go1QFD3+89jr9R4cHHAcJ4riRmWSJAFANwyGpthCsXNZ+my1VItMni1UKpWLiwufzxcKhzEMq91rDUuSRBCEUKuVQz7a/ptYPgOAqMuZwz6vTkXR4/HILblSqfB8td1uz+fzNSzLst1uj0ajPVlO/nXEZZIrOOyw7Hyj6dr19TVBEE8ftZH2YDDY399/Y7F8sP/hPPy0t7ubo5kPiO2N9XsMC4bDEYZhzCAWi4WJbD02udvrud1uFEW9Xq/H6/P7/U6nw+f1oQHM4/EgCMJx3NPKG3AqlQqFQsvlUlGU8Xisqup0OlUmE0VRVrHX67FY7D9hiqYSicT6+N5Y47wwaMsA0Ol04vH4lyqbkayybTQrVWEo1RK7O2KJBYB2u/0ssAfYfD3DMOFweDi6KcWwU7utcJoaDQdkwMOnV3basvwluN/vIwhCZrN94Yo6OW6UCwBQyiWRjxZjPv93qx5gcz8cDn98/Xp7e/vQ4UT23r3d+fnykt/9/ZdvX32FBv3RSBQLYWarnsO3t7divV46K7EsS2YyFEVnshRFUflcnsmzuRxNktl+v/9ocw0LgiCK4v3Y6qlUKhgMsixL03SWonI52lQymcQwDDa1dXNzI0lSq9UKosF0Oj0eTyRJMkcfAKaaNtU0c05xHDcMYwNWVZXneUmSVi4pejAYCIJg/sDZbMYTwU71anXLdPoCDADNZrMuip1Op9vtsiybJcn6ZRnHYx2Bx2w7Qn415LquvQybri44zu/zFc/L50SI/vhr6ywPADyTK2LeOcBsZhAE8QJstqrX67lcLgRBisVi6MSFHiMAEI64v/vha164UhUVw7DHLJ5/z8lkEggErFbru/fvPSdum82WSCQdrsO3ez95vO5IJJJOp5+nDf9DfwMVZfpnvUVowAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;All to real&quot; title=&quot;&quot; src=&quot;/static/76e69979abd0fbfdb82c1914aa6fa4a7/9128f/poke-e2e.png&quot; srcset=&quot;/static/76e69979abd0fbfdb82c1914aa6fa4a7/4dcb9/poke-e2e.png 188w,
/static/76e69979abd0fbfdb82c1914aa6fa4a7/5ff7e/poke-e2e.png 375w,
/static/76e69979abd0fbfdb82c1914aa6fa4a7/9128f/poke-e2e.png 603w&quot; sizes=&quot;(max-width: 603px) 100vw, 603px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
    &lt;small class=&quot;figure__attribution&quot;&gt;
      &lt;span class=&quot;figure__attribution-link&quot;&gt;
        by geek &amp;amp; poke / &lt;a href=&quot;https://creativecommons.org/licenses/by/3.0/&quot;&gt;CC BY&lt;/a&gt;
      &lt;/span&gt;
    &lt;/small&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Flaky tests are extremely annoying, as every developer has experienced at some point. Instead of banging our head against the wall trying to fix the unfixable, we can mitigate the problem by using lower level tests.&lt;/p&gt;
&lt;h2&gt;Why should I have these tests?&lt;/h2&gt;
&lt;p&gt;There are two different scenarios I’d like to cover:&lt;/p&gt;
&lt;p&gt;The first is testing your own REST APIs. These tests add an extra layer of confidence. Surely, you are using a healthy mix of different tests (unit, integration, functional, …). End-to-end tests can be the final confirmation that everything looks fine.&lt;/p&gt;
&lt;p&gt;The second case is testing APIs that you don’t control. In my last projects most of the data we consumed came from APIs served by other teams. More than once I spent half a day debugging an error in my app, only to notice that a downstream API was borked all along. Automated tests cover that integration, and help isolate issues.&lt;/p&gt;
&lt;h3&gt;Living documentation&lt;/h3&gt;
&lt;p&gt;A collection of tests that are being regularly executed serve as the best documentation for an API. Have you searched for something in any corporate wiki lately? If you find anything at all you should be happy. It will be probably incomplete. Or just flat out wrong. Fun times.&lt;/p&gt;
&lt;h3&gt;Monitoring&lt;/h3&gt;
&lt;p&gt;In both cases, these tests can morph from a gateway in the building process to an active monitoring tool. By constantly running them, you make sure that the API is still behaving as you expect. Otherwise, the right alarms will be raised. You don’t want to realize something is wrong just when a customer complains.&lt;/p&gt;
&lt;h3&gt;Why not use consumer driven contract tests instead?&lt;/h3&gt;
&lt;p&gt;Great question, if I may say so myself. &lt;a href=&quot;https://www.thoughtworks.com/de/radar/techniques/consumer-driven-contract-testing&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CDCs&lt;/a&gt; are an excellent way to ensure that an API conforms to what a client expects from it. If you can set them up properly, they will replace end-to-end tests almost completely. Remember, keep pushing the tests to a lower level whenever you can.&lt;/p&gt;
&lt;p&gt;They don’t work in every situation, though. If you don’t control both the provider and the consumer, you have to rely on another party. If they don’t fulfill their part of the contract the tests will be useless. Some teams are just not in the position of continuously running tests against a contract. Running your own tests could be your best bet.&lt;/p&gt;
&lt;p&gt;Anyways, having laid out the rationale, it’s time for some &lt;strong&gt;code&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Creating a Postman collection&lt;/h2&gt;
&lt;h3&gt;The collection&lt;/h3&gt;
&lt;p&gt;We are defining a number of calls that will be executed sequentially inside our CI. Each call executes a request against the API. Then it runs some tests to check that the request was successful, checking the status code and the body as well.&lt;/p&gt;
&lt;p&gt;In order to create the collection, I tend to use the Postman app. I like to extract things like URLs and parameters to an &lt;a href=&quot;https://learning.getpostman.com/docs/postman/environments_and_globals/manage_environments/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;environment&lt;/a&gt;. Then configuring it becomes easier, and you don’t have any sensitive information in the collection itself. Your history is a &lt;a href=&quot;https://learning.getpostman.com/docs/postman/collections/creating_collections/#saving-to-a-collection-from-history&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;convenient place to start building this collection&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once you are satisfied with the collection, you can export it as a JSON file. That file can be committed in source control to serve as a base for the pipeline that will run the tests. There is a Pro and Enterprise version that helps managing collections, which I haven’t really tried. Still, a good ol’ &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; repository is more than enough to get rolling.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 118.08510638297874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEElEQVR42n2TW4/bRBiG89f5CZwu4AIJuEFUFCSQoBIUCVSEIrVbZTe7iUnixHbs8YzHnvM3JzsoMUpDuu17MbKt753nO3mCMZZSGmMAwFoLAEop/V5JKYUQjLFJVVUIIULIdrudz+cYY4SQMeb9Zkpp13WT/X6/OKlpmqIoxrveBVdKGWOapkmSZLPZTOq6FkIAAKU0z/Msy4qiEEKok0bD+S6lFAAghKbT6Xw+nxBCOOeMMa21MUYpZa0dn8fkx1NdiHNOKa2qajJCFovFbrfTWjPGuq6z1o5xAMA511r7/6vv+7ZtJ1LKEMIwDIfDwXufZVlVVUKIJEkeHh6qqloul1VVxRidc2dzCIFSeiQfYv9KlP8YGp03AGPQ+QwhnF+vzZdk55wQQkqptcYYE0IYY03TIITGsMfJd6LemDY6L5Ua45xzABBOusKO5mPNQsoYgu6DG/o+xiRJ7u7uOOez2Wyz2YwrgBC6qtl7jzH+r9vr9Xq/348JW2u993AqfpzT+OUSa61N03QihXDeg9T2uN0wLlnXdbe3t1mWLZfL3W73ds4AkOf5kTyEuDZt6WSwDk4sC8c5Wzhty1tDjjFemGNPI/DoDofD6/nd9OaVtLBYrzZFtsq2XKl46plzLsZIKS3L0lp7NEshlVJlltOuM0UtP/mh/fhp+PJX9dlP5otf+Iff2Sd/+IshAYDW+g3ZWtugmlntXyb1p0/LshQlXs3m2XJlazp8/rNjwl0M7Drt2il6iPF+Jz/4in37e/j+L/r1M/7N8/Dkz+GjH3vn+2GIMT7WsNhnTjTBROu6lw/sxUz8Pc+evaieT+vfpuj1YpOmeZ5jjK/NUkgAaEkjuTAGTB/t0KvgsWRE8A5MJ0V9Utu2j5CNMXmW1QhZa4uiyLJMa13kedM0GOOqqjDGjLHH0paij1H23gzRO9d2LedcKVUUxdlcliUh5J1LcitQatpD7Lfb7f39vbWWEFLXddd1TdNorfu+P3f7jbksS0qpEVJxobVerVY3NzcAsF6v0zRFCKVpSgi5+h9H879HoUKCrc2YsAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Postman export&quot; title=&quot;&quot; src=&quot;/static/d2bf1c564dd734894c569366134220ac/7c1cd/export-postman.png&quot; srcset=&quot;/static/d2bf1c564dd734894c569366134220ac/4dcb9/export-postman.png 188w,
/static/d2bf1c564dd734894c569366134220ac/5ff7e/export-postman.png 375w,
/static/d2bf1c564dd734894c569366134220ac/7c1cd/export-postman.png 582w&quot; sizes=&quot;(max-width: 582px) 100vw, 582px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;Running the collection&lt;/h3&gt;
&lt;p&gt;Until now we have been using regular Postman and nothing else. Now it’s the time for newman to shine. What am I talking about, anyways? I’ll quote the &lt;a href=&quot;https://learning.getpostman.com/docs/postman/collection_runs/command_line_integration_with_newman/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;official docs&lt;/a&gt; directly:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Newman is a command line Collection Runner for Postman. It allows you to run and test a Postman Collection directly from the command line.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Good that we clarified that! It is installed as a npm package, which can result in a &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; as simple as this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postman-utils&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;private&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Postman utilities&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;newman&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;node_modules/.bin/newman run&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;newman&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^4.4.1&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;as mentioned before, you don’t want to hardcode variables like URLs, parameters or, God forbid, passwords in that collection. It’s not flexible, and it’s not safe. Instead, I like to use a configuration file which includes all these values. But if we want to commit that file, we still need to figure out a way to avoid putting secrets in there. I use it as a template and replace values at runtime with envsubst. The configuration file looks like this&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
	&quot;id&quot;: &quot;425cf4df-d994-4d91-9efb-41eba1ead456&quot;,
	&quot;name&quot;: &quot;echo&quot;,
	&quot;values&quot;: [
		{
			&quot;key&quot;: &quot;host&quot;,
			&quot;value&quot;: &quot;${HOST}&quot;,
			&quot;enabled&quot;: true
		}
	]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can orchestrate this with a simple bash script. The script injects the variables into the template, runs newman, and deletes the files to avoid leaks. It goes very well with &lt;a href=&quot;https://hceris.com/storing-passwords-with-gopass/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;gopass&lt;/a&gt;, where you can safely store your secrets and fetch them through the script.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;setup-newman&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/tmp/settings.json.&lt;span class=&quot;token variable&quot;&gt;$$&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/tmp/variables.json.&lt;span class=&quot;token variable&quot;&gt;$$&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# shellcheck disable=SC2064&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;trap&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rm -f &lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$settings&lt;/span&gt;&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt; &lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;&quot;&lt;/span&gt; EXIT
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function-name function&quot;&gt;run-newman&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${1?You need to provide the service to check}&lt;/span&gt;

  envsubst &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$service&lt;/span&gt;.environment.json.template&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$settings&lt;/span&gt;&quot;&lt;/span&gt;

  npx newman run &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$service&lt;/span&gt;.json&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${settings}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      --export-environment &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${result}&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;that helper can be called with the collection that you want to test. Exported variables will be picked by &lt;code class=&quot;language-text&quot;&gt;envsubst&lt;/code&gt;. &lt;a href=&quot;https://www.npmjs.com/package/npx&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;npx&lt;/a&gt; gives us a little bit more of flexibility finding the &lt;code class=&quot;language-text&quot;&gt;newman&lt;/code&gt; binary, in case you don’t want to use a &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; but have it globally installed.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;goal_check-service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  setup

  &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;SERVICE_PASSWORD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${SERVICE_PASSWORD&lt;span class=&quot;token operator&quot;&gt;:-&lt;/span&gt;$(gopass store&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;service&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;password)}&lt;/span&gt;

  run_newman &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Tests&lt;/h3&gt;
&lt;p&gt;Doing a request is but the first step. Remember, we aim to build a test suite. We have a convenient test tab in Postman that we can use to write our tests.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 8.51063829787234%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaUlEQVR42iXIsQrCUBBE0fz/f6S2swjapBZJCkEJFop1SDK7s+s8EeF5q8NtMpMkaplpZgBmr4bNvkWdtgHviNszuvN6uuo4aHo1kiLCa3+b+xquUkguNEkkDfBvyfGe7X459GXXfy6PH/5+b/UWDbRxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;The test tab is on me&quot; title=&quot;&quot; src=&quot;/static/ba9c632166d1582f8eafb0adf6b627c7/1d69c/test-tab.png&quot; srcset=&quot;/static/ba9c632166d1582f8eafb0adf6b627c7/4dcb9/test-tab.png 188w,
/static/ba9c632166d1582f8eafb0adf6b627c7/5ff7e/test-tab.png 375w,
/static/ba9c632166d1582f8eafb0adf6b627c7/1d69c/test-tab.png 750w,
/static/ba9c632166d1582f8eafb0adf6b627c7/78797/test-tab.png 1125w,
/static/ba9c632166d1582f8eafb0adf6b627c7/f8836/test-tab.png 1214w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Our tests are written in &lt;em&gt;JavaScript&lt;/em&gt;, using &lt;a href=&quot;https://www.chaijs.com/api/bdd/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Chai&lt;/a&gt;. Let’s say I want to test that my call delivered a list of results, I could do it like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;getResults&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; jsonData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; jsonData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;results&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Request was successful&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;have&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;There are results&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getResults&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;be&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;above&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;More details can be found &lt;a href=&quot;https://blog.getpostman.com/2017/10/25/writing-tests-in-postman/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Building flows&lt;/h3&gt;
&lt;p&gt;All the calls in a collection get executed sequentially. This offers us the opportunity to test whole flows instead of just single calls. One such a flow for a &lt;code class=&quot;language-text&quot;&gt;/posts&lt;/code&gt; resource is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Get a list of all &lt;code class=&quot;language-text&quot;&gt;posts&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fetch the first &lt;code class=&quot;language-text&quot;&gt;post&lt;/code&gt; in the list&lt;/li&gt;
&lt;li&gt;Update the &lt;code class=&quot;language-text&quot;&gt;post&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We’ll build a suite of parametrized tests that will continue to work over time, not just the first time that you ran it. An important part of this is modifying the environment in a request. That is our way of transmitting parameters between requests. Let’s say our first request was successful, as corroborated by our tests. Then we store the id on a variable that will be used to fetch a particular entity.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// First result in the list&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; post &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getResults&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Pass variables to other stages&lt;/span&gt;
pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; post&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The next request can use that parameter as any that we set manually.&lt;/p&gt;
&lt;h4&gt;Ignoring calls based on a condition&lt;/h4&gt;
&lt;p&gt;Flows might need also need some logic to skip certain requests. Let’s say you have a request that is creating a new entity through a &lt;code class=&quot;language-text&quot;&gt;POST&lt;/code&gt;. You want to have that request, but you may not want to run it on every commit. Maybe you just want do it once per day. In that case, we’ll skip the test based on a certain variable.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Do not run create request in sequence, unless executeCreate is set to true&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;pm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;environment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;executeCreate&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    postman&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setNextRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Get other posts&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The variable goes into the configuration file, and is set to a environment variable that gets injected through our script, as I showed above.&lt;/p&gt;
&lt;h2&gt;Time for some continuous integration&lt;/h2&gt;
&lt;p&gt;At this point you should have a collection that runs locally. Running this once is fine, but why not run it for every commit? Or maybe every hour, if you want to check an API that you don’t control?&lt;/p&gt;
&lt;p&gt;Your CI pipeline is a perfect place to do this. I’m going to use &lt;a href=&quot;https://circleci.com&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CircleCI&lt;/a&gt; for my example, but any CI will do. I run the tests inside a &lt;a href=&quot;https://cloud.docker.com/repository/docker/sirech/newman-executor&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;docker image&lt;/a&gt; that I built which includes all the required dependencies. There is an official Docker image provided by Postman already. However, it does not contain &lt;code class=&quot;language-text&quot;&gt;envsubst&lt;/code&gt; and it uses an older &lt;em&gt;NodeJS&lt;/em&gt; version.&lt;/p&gt;
&lt;p&gt;The helper script that we built in the step before will work without any changes inside CircleCI. We just have to provide the required secrets &lt;a href=&quot;https://circleci.com/docs/2.0/env-vars/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;as variables&lt;/a&gt;. This is the job:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;healthcheck&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sirech/newman&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;executor&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12.6&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; checkout
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./go test&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;e2e&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which will produce a report similar to this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB30lEQVR42p2U6XaCQAyFeRDBhX0HQVH7/s+Vni9jClVabX/kBDIzN7k3mfGappFpmuR6vUrXdTKOo/R9L7vdTvb7/Z/NK8tCAYdhkLquJYoiCcPw/4BFUUgcR7LZbGS73SrQb2CvEnlFkUuSxN/A+J5t/jew30C9pqnl4+OqdKEK5SRJNAk+jp1P01QOh8PrCjkwTWcFvd0ucrlMcjz2kmWZlGWpHlnqunpLW49NeZ7rAarMslR835cgCMT3A/Xu23+LtpfnmYzjoFX1facecLpPZVRJQrSuqlIlWYI9AmuFgJzPJ7VhOCoIB5EDH0WhGv/o+DgNS9A7ZadTVVVf4hMPQ/PfzSWJVpvkITogaZp8dRN6UObbDf5ZKye+jFEE1f4IiHan06iH0Y2YraGfxUiMLCRYBaSzzlyDltUQx5PMYoBas54A2YDYGEPeto20bavgNtxWPeDE2AsYe5405AAbu67VsWEW+V4m4q5bdfZvzJ4AHQUnNJVBGWA6b2sYz5zTML1rWKxTplPQZAPaMZM0hhFiNJyOma7PDXSTsEqZ7lln7cbgMahDa6Ye3x8O93gAvALoRgUA8xiPhIFiyEEyGkeDWEOWFQ3dCEDJzVZxvzV2h+c4yfH2mFDlI+AnsMlEAbJzn+0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Output&quot; title=&quot;&quot; src=&quot;/static/4ada27bc72a0a092f1ca972a5ed21cf2/1d69c/output.png&quot; srcset=&quot;/static/4ada27bc72a0a092f1ca972a5ed21cf2/4dcb9/output.png 188w,
/static/4ada27bc72a0a092f1ca972a5ed21cf2/5ff7e/output.png 375w,
/static/4ada27bc72a0a092f1ca972a5ed21cf2/1d69c/output.png 750w,
/static/4ada27bc72a0a092f1ca972a5ed21cf2/78797/output.png 1125w,
/static/4ada27bc72a0a092f1ca972a5ed21cf2/e515d/output.png 1430w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;What about the alternatives?&lt;/h3&gt;
&lt;p&gt;Many frameworks provide their own way of running tests against a running API. In &lt;a href=&quot;https://spring.io/projects/spring-boot&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spring Boot&lt;/a&gt;, for instance, you can use &lt;a href=&quot;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/MockMvc.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;MockMvc&lt;/a&gt; to test controllers. You can use both, in my view. First the native tests, so to speak, and then layer Postman Tests on top.&lt;/p&gt;
&lt;p&gt;And let’s not forget about good ol’ &lt;a href=&quot;https://curl.haxx.se&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;curl&lt;/a&gt;. I had a huge collection of curl commands with which I tested an API that was needed for my last project. However, managing that becomes more and more tedious over time. If you want to use send complex requests, like certificates or cookies, Postman is way more convenient to use. Moreover, you can use JavaScript instead of bash, which can make things a bit easier to read and maintain.&lt;/p&gt;
&lt;h2&gt;What else?&lt;/h2&gt;
&lt;p&gt;This is already quite a lot and it’s just the beginning. Anything that you do with an API you can also automate. For instance, in my previous project we had a collection that ran an &lt;a href=&quot;https://auth0.com/docs/api-auth/which-oauth-flow-to-use&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OAuth Flow&lt;/a&gt;. That got us a token that we could use to make requests against an authorized endpoint.&lt;/p&gt;
&lt;h2&gt;A repo to use as an example&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/sirech/echo/blob/master/echo.json&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Here&lt;/a&gt; is a repository for a Kotlin application that runs a Postman collection as an e2e test. It can serve as a starter kit to get going with high quality End-to-End API Tests.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Custom Components in Formik]]></title><description><![CDATA[Formik is the new cool kid on the block for forms in react. Here is how to build custom input elements on top]]></description><link>https://hceris.com/custom-components-in-formik/</link><guid isPermaLink="false">https://hceris.com/custom-components-in-formik/</guid><category><![CDATA[React]]></category><category><![CDATA[Formik]]></category><category><![CDATA[react-hooks]]></category><pubDate>Thu, 15 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/96887b08014b3bd3c76a5a5b0a865292/3684f/react.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR42nWU3UsUYRTG9zr8LyTMfyBSI+kiooKygjAsyw+0IkFFTYIgugwKrLuioiAj6qYI6qo7re76kMpYc7bZnY81dx2t1d2dmV+cd2abmVpfXnbPnvc8533Os+e8KWLLVzswqn7orPqR0yexUnEkMFti2kGviu2qDWgV7ju8W4/CEmBX+Z6sskNjxKZN4/KSOKs+F/PszDBmy9HLX2HSBNhTn905XqnjgsugRZ9Jj8F5C0cdP12l34huStAGOnN82AhrW/dpTNOUpuyHqd+WJHuceYL2KYOZUnjQb3KtwNVlzlqh5/Vves1Qwgjs1croM+g2pNq9Olvm6chyMCvGPp0rPzlpMGiGNwXwVPD1wJG4Vo2WRW4Xhe3nMkUXx5VCtqa5U2T7Im0ZDmel+IB8KmDYkeVrGasqVfWa3CpS8RmyGLYl6EaBAVOKWlK59uvil5unHU4YUSUjNtsWxDhnkZqTPariGtNM2lHYsRzP1kg9cujKRd5Rm2YFHqqBx2vgiRj4aJbna4r2gMWRLN8r5F1R5bQhtD2VaCIvoTcLnLFES7PKXFn0G7Fjgt1b4YBOe4Z2jYeOMP9Slt5Y9fi4QdOCKNqm0aKJro/jgnmxDuvMMZlnd4aGeQ7pdOg0fGPPDy4tiWC9BvH4sEnUIAjh2VqT9BhcX2aqIEaw3pQEv2l7Hs/xSbWnh3Rlc1p0KtXa8/26BNQZyX8GY82TMeoy5F8ctuUniLwBbXezkWzVROFdGcbybPjSKuO2jOSFvKj1ou5I/p2VmZIIu1hJPAYLFe6uSM31H4O6z5BPQp7/n6E/fEU2evOWn70AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;React is like Angular, but totally different&quot; title=&quot;&quot; src=&quot;/static/96887b08014b3bd3c76a5a5b0a865292/3684f/react.png&quot; srcset=&quot;/static/96887b08014b3bd3c76a5a5b0a865292/4dcb9/react.png 188w,
/static/96887b08014b3bd3c76a5a5b0a865292/3684f/react.png 225w&quot; sizes=&quot;(max-width: 225px) 100vw, 225px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Forms and &lt;a href=&quot;https://reactjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React&lt;/a&gt;. Don’t they go well together? If you are doing any serious &lt;em&gt;React&lt;/em&gt; development, you will build sooner or later a complex form. The temptation to roll your own homemade framework can arise, but you have to fight it. There are plenty of good existing solutions to pick.&lt;/p&gt;
&lt;p&gt;You might choose &lt;a href=&quot;https://jaredpalmer.com/formik/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Formik&lt;/a&gt; for the task. In that case, I want to show you how to build a custom input component for it.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Wait, Formik?&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Formik&lt;/em&gt; is the new &lt;a href=&quot;https://jaredpalmer.com/formik/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;cool kid on the block&lt;/a&gt;. Quoting the official docs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Build forms in React, without the tears.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I certainly share the tears part. I used to build my forms with &lt;a href=&quot;https://redux.js.org&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;redux&lt;/a&gt;, using &lt;a href=&quot;https://github.com/davidkpiano/react-redux-form&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;react-redux-form&lt;/a&gt;. It is a fine library, don’t get me wrong, but in the end there is a lot of friction connecting things together. Not to mention dealing with the state. Why, anyways? Looking back, having the state of my forms  in &lt;em&gt;Redux&lt;/em&gt; did not seem to help me that much.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Formik&lt;/em&gt; takes a very different approach. It is declarative, relying on pure &lt;em&gt;React&lt;/em&gt;. It uses &lt;a href=&quot;https://reactjs.org/docs/render-props.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;render props&lt;/a&gt;, a pattern that is spreading quickly across the &lt;em&gt;React&lt;/em&gt; ecosystem. Speaking of that, &lt;a href=&quot;https://www.robinwieruch.de/react-render-props-pattern/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this article&lt;/a&gt; helped me finally understand them better.&lt;/p&gt;
&lt;p&gt;Anyways, my impression thus far has been that &lt;em&gt;Formik&lt;/em&gt; stays out of the way and allows you to focus on building your forms.&lt;/p&gt;
&lt;h2&gt;Customization&lt;/h2&gt;
&lt;p&gt;Regular &lt;code class=&quot;language-text&quot;&gt;input&lt;/code&gt; components, with a sprinkle of styling on top, will get you very far. They cover most typical use cases. But what if you want to spice it up?&lt;/p&gt;
&lt;p&gt;For example, I have a small app where I want to give a star rating, from one to five. I implemented it first with a regular number input, which felt boring. I wanted to click on the stars, something like this:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 348px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/de712265dbc0134757a2710f7de95326/34ea4/stars.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 51.06382978723405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABg0lEQVR42p2RzWoUQRSF+83iNos8gb6A75ClSxcGFIxkawTFUdw4URRRSGAwIRASBNFMMn+Z7plMhyTV1dXd55PqykSTMQgWVNfl9q3vnjo3cs7xtyWJ/1lRv99nb3ePg8MunU6Xw04X54pZ6DT253SHxFVgs7nG09VnPH6ywvOXr3jReM3RMPkNvAbwOamabXARR5NJyunZKWk6Ic8tWZZRFkXdOVwOgEvQH5ZMwZd1XqG1lrKa9esmB1UVKHl/w08RGXOOyw1lr0FlejVIJ1sw+hTi8gwNGsgdIztEo4/oYBmNv6B8DHaA4jVUmqDQZBa3v0y1fgt9W4RJC23fQV8X0OgDaj9CG3Po+z20v1SDajFxE/24D+PPyLQDVCWRycEN3lK1FtDPB6F45y7avo3yGA3foNY86q0il6LkXVDjzzxBx+vg1aabYcq1QpNQZUNkY28SskehuMwCxMaoOAn59sPaw/rZ3oZ8HBS69AJoDK6o8HPRPwfiQpPa23P/mRnKL0Km/K7Xxg+bAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Everybody wants to be a star&quot; title=&quot;&quot; src=&quot;/static/de712265dbc0134757a2710f7de95326/34ea4/stars.png&quot; srcset=&quot;/static/de712265dbc0134757a2710f7de95326/4dcb9/stars.png 188w,
/static/de712265dbc0134757a2710f7de95326/34ea4/stars.png 348w&quot; sizes=&quot;(max-width: 348px) 100vw, 348px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
  Rate it!
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;How does &lt;em&gt;Formik&lt;/em&gt; fare when building something like this? More after the break.&lt;/p&gt;
&lt;h2&gt;Representational component&lt;/h2&gt;
&lt;p&gt;Before we get into the actual form stuff, let’s build the &lt;code class=&quot;language-text&quot;&gt;Stars&lt;/code&gt; as a component for display. We are building a row of five stars. We have a prop (&lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt;) to set the number of stars that are set as full, and a handler (&lt;code class=&quot;language-text&quot;&gt;handleClick&lt;/code&gt;) to know when a particular star is clicked.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Stars&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handleClick &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;styles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stars&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Star&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;isFull&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;Star&lt;/code&gt; component is a thin wrapper around a &lt;a href=&quot;https://fontawesome.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Font Awesome&lt;/a&gt; clickable icon.&lt;/p&gt;
&lt;h2&gt;Custom input component&lt;/h2&gt;
&lt;p&gt;We are finally getting to the meaty part. How do we make the &lt;code class=&quot;language-text&quot;&gt;Stars&lt;/code&gt; component &lt;em&gt;Formik&lt;/em&gt; aware?&lt;/p&gt;
&lt;p&gt;We will be rendering our &lt;code class=&quot;language-text&quot;&gt;Stars&lt;/code&gt; representational component inside a &lt;a href=&quot;https://jaredpalmer.com/formik/docs/api/field&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Field&lt;/a&gt;. It uses render props as well, which we’ll use to connect it to our &lt;code class=&quot;language-text&quot;&gt;Stars&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There is a &lt;code class=&quot;language-text&quot;&gt;field&lt;/code&gt; hash that contains the &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;, aka the number of set stars. That will be the input for &lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt;. To update the the value after a click on a star, we use the &lt;code class=&quot;language-text&quot;&gt;setFieldValue&lt;/code&gt; function inside the &lt;code class=&quot;language-text&quot;&gt;form&lt;/code&gt; hash. That will update the value internally on &lt;em&gt;Formik&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fieldName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;stars&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;StarsInput&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;fieldName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;fieldName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;number&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;field&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; value &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; setFieldValue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;label&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;htmlFor&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;fieldName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;label-color&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;fieldName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;label&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Stars&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token attr-name&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setFieldValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fieldName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Field&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Integrating it into a form&lt;/h2&gt;
&lt;p&gt;Now that we have our custom input component ready, we can render it inside a regular &lt;em&gt;Formik&lt;/em&gt; form, and we are all set:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;MyForm&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;section&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Formik&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token attr-name&quot;&gt;onSubmit&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;onSubmit&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token attr-name&quot;&gt;initialValues&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; stars &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Form&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StarsInput&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;submit&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Submit&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Form&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Formik&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;section&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Codesandbox&lt;/h2&gt;
&lt;p&gt;You can play with a working implementation of this in the sandbox below. Check it out and extend it to fit your needs.&lt;/p&gt;
&lt;iframe src=&quot;https://codesandbox.io/embed/laughing-cookies-2t80u?fontsize=14&quot; title=&quot;custom-formik-component&quot; allow=&quot;geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media&quot; style=&quot;width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;&quot; sandbox=&quot;allow-modals allow-forms allow-popups allow-scripts allow-same-origin&quot;&gt;&lt;/iframe&gt;</content:encoded></item><item><title><![CDATA[Dockerizing a JVM app with CircleCI]]></title><description><![CDATA[Build a pipeline with CircleCI to dockerize a JVM app step by step. Includes linting, tests, creating and pushing the image]]></description><link>https://hceris.com/dockerizing-a-jvm-app-with-circleci/</link><guid isPermaLink="false">https://hceris.com/dockerizing-a-jvm-app-with-circleci/</guid><category><![CDATA[Docker]]></category><category><![CDATA[CircleCI]]></category><category><![CDATA[JVM]]></category><category><![CDATA[ServerSpec]]></category><pubDate>Mon, 15 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I had been using &lt;a href=&quot;https://travis-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Travis&lt;/a&gt; for a long time for my personal projects, until the news of massive layoffs scared me into checking alternatives. I had heard good things about &lt;a href=&quot;https://circleci.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CircleCI&lt;/a&gt;, so I decided to give it a try. Concretely, I wanted to build a pipeline that did the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Package a &lt;a href=&quot;https://spring.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot&lt;/a&gt; application written in &lt;a href=&quot;https://kotlinlang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlin&lt;/a&gt; as a &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt;, running linters and tests before, saving the tests results.&lt;/li&gt;
&lt;li&gt;Build a &lt;a href=&quot;https://www.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docker&lt;/a&gt; image to run the app, with &lt;a href=&quot;https://serverspec.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ServerSpec&lt;/a&gt; running first, and push it to a &lt;em&gt;Docker&lt;/em&gt; registry.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Following &lt;a href=&quot;https://github.com/sirech/talks/raw/master/2019-04-tw-build_pipelines.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;my own thoughts about pipelines&lt;/a&gt;, I wanted it to be fast, visual, easy to maintain and reliable build my toy app. Did it work? More after the break!&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Running in circles&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;CircleCI&lt;/em&gt; has a &lt;a href=&quot;https://circleci.com/pricing/usage/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;free plan&lt;/a&gt; that works really well for experimentation, with a seamless integration with &lt;a href=&quot;https://github.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Github&lt;/a&gt;, which makes getting started a breeze.&lt;/p&gt;
&lt;p&gt;The basics are covered in depth in &lt;a href=&quot;https://circleci.com/docs/2.0/getting-started/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;their own website&lt;/a&gt;, so I will skip that. Let’s jump straight into the details. This is the sketch of the pipeline to implement:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0e97374ecec4f5fdc3cc32511dfb83bd/fd85b/sketch.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 69.14893617021278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHpQmM1F//EABgQAAMBAQAAAAAAAAAAAAAAAAABAhIx/9oACAEBAAEFAnQ6N0Xzqyj/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAQIEH/2gAIAQEABj8CET//xAAeEAACAQMFAAAAAAAAAAAAAAAAIREBEDFBUXGRof/aAAgBAQABPyHFHomsab0JMdheI32P/9oADAMBAAIAAwAAABD07//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExYUFR/9oACAEBAAE/EEOJbvEccN+D9iy6Tw3KHQay/kDAEe2vYEaNz//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Sketch&quot; title=&quot;&quot; src=&quot;/static/0e97374ecec4f5fdc3cc32511dfb83bd/acb04/sketch.jpg&quot; srcset=&quot;/static/0e97374ecec4f5fdc3cc32511dfb83bd/bc01b/sketch.jpg 188w,
/static/0e97374ecec4f5fdc3cc32511dfb83bd/bf173/sketch.jpg 375w,
/static/0e97374ecec4f5fdc3cc32511dfb83bd/acb04/sketch.jpg 750w,
/static/0e97374ecec4f5fdc3cc32511dfb83bd/fd85b/sketch.jpg 1034w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I’m going to talk about some details that I found interesting, plus the code to implement parts of the pipeline. TLDR: &lt;a href=&quot;https://github.com/sirech/echo/blob/master/.circleci/config.yml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;This is the full pipeline&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Using workflows&lt;/h2&gt;
&lt;p&gt;Workflows are &lt;em&gt;CircleCI&lt;/em&gt;’s way of organizing dependencies between jobs. In my case that’s just a fancy way of saying that one job should execute after the other, like this screenshot shows:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/315918ecce43a06aad2be9d7b540b891/709cb/circle-workflow.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 85.63829787234043%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACaElEQVR42qWTT2sTQRjG5yLexItfQW8eFPEj6EnBm/g5xJOK0kJBaPEiErBNqx9A0YOtBw8t1vZSKoQ2baPVaNNN9k9258/u7O7sI+8kWZMmiODAb2fened95n2HXfZ6bxV3157j4ecqHqwvlNxfn8ejjUU83liyTG++wtTmy/7ewoiWcu+tVUBe7PbyFNjMebCnV8FmL4PNXurNTy7iVOUazs7fxOnKdZyr3sKZFzfA5gaaIeaugM1cwJ3labDV5jaefXmDyvZbLOy8R3V3uWSpvoKl+gcs1lf+sDtKdbenqdTegbwYcvSGGiz+Y6QFmFASxx0HbuDBcTv4evgNbbeDzORI8wyp+QfyDFlhEOsEzPMD1Hb2ECsFzjm63S601n8tpCgKy8lBeawbcfw67qAwBnmeI8syGGPKpGEMYUxpcFJnDbVOYEyOIAjgOA6EECNVjBgaYw+kLngUjVVrDROtrTBNU/uCEiaZDQzp8FinEIlGbopxQ3pMTjRjLVGcZxm4TtGWMXSWU4mlzhpSi0opxHFczsNr2h9BSigpESsJKeXYPqP72N/fx8HBARqNhoXWtVoNzWZzYhLBJ7yzhvSpeJ5n8X3fzu5QTPv/ijWkCqSStkXbpuq1HPdjanG4StmPS8RozOg+0lhDyF4bEecWiukvUv070ypBQncqJbjgJaSx2kHLh8ERPja30PZdBCoCT5WlHXo4ch18D47h8xCfWjVstepoey7CRFhNpCVanoNW0EHAQ3swc0IPe94PhCJCqDh4LMFjgUCE8HkXbhTYChr+TzS7jtVFsbC6SAlrRAeGPLIt/wZid963MRTfFwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Workflow&quot; title=&quot;&quot; src=&quot;/static/315918ecce43a06aad2be9d7b540b891/1d69c/circle-workflow.png&quot; srcset=&quot;/static/315918ecce43a06aad2be9d7b540b891/4dcb9/circle-workflow.png 188w,
/static/315918ecce43a06aad2be9d7b540b891/5ff7e/circle-workflow.png 375w,
/static/315918ecce43a06aad2be9d7b540b891/1d69c/circle-workflow.png 750w,
/static/315918ecce43a06aad2be9d7b540b891/709cb/circle-workflow.png 1034w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;Looks simple, right? However, the picture does not show the whole truth. I am using a filter to restrict the &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt; job to the &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; branch. The workflow definition looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;workflows&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pipeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; build
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;filters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; master
          &lt;span class=&quot;token key atrule&quot;&gt;requires&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Why the restriction? Well, I’m using &lt;a href=&quot;https://dependabot.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Dependabot&lt;/a&gt; to automatically check for new versions of dependencies, and I want the PRs generated by the tool to run my tests, but not to generate new docker images.&lt;/p&gt;
&lt;h2&gt;The build step&lt;/h2&gt;
&lt;p&gt;I always run my jobs inside some &lt;em&gt;Docker&lt;/em&gt; image. For the build I use the &lt;em&gt;OpenJDK&lt;/em&gt; image provided by &lt;em&gt;CircleCI&lt;/em&gt;, which is one among &lt;a href=&quot;https://circleci.com/docs/2.0/circleci-images/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the many images that they maintain&lt;/a&gt;. These are the steps.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; circleci/openjdk&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;8&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;jdk

  &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; checkout
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./gradlew detekt
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./gradlew clean test
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./gradlew assemble&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/arturbosch/detekt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;detekt&lt;/a&gt; is &lt;a href=&quot;https://www.thoughtworks.com/radar/tools/detekt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;basically a linter&lt;/a&gt; that can run self-contained inside the pipeline. Apart from that, the unit tests are executed and if everything works, a &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; is built.&lt;/p&gt;
&lt;h3&gt;Persistence&lt;/h3&gt;
&lt;p&gt;Unlike &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Concourse&lt;/a&gt;, &lt;em&gt;CircleCI&lt;/em&gt; allows you to persist artifacts between jobs, which is pretty damn convenient. In this case, I need the &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; file that we just generated later, when I build the &lt;em&gt;Docker&lt;/em&gt; image. In order to persist it, you add an extra directive to the list of steps in the &lt;code class=&quot;language-text&quot;&gt;build&lt;/code&gt; job:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;persist_to_workspace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; build/libs
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; echo.jar&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;You’ve got to save the tests&lt;/h3&gt;
&lt;p&gt;Another nifty feature that I found is &lt;a href=&quot;https://circleci.com/docs/2.0/collect-test-data/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;storing test results&lt;/a&gt;, which appear in the dashboard and make it easier to understand what your job is doing.&lt;/p&gt;
&lt;p&gt;Both the test results, as well as the execution summary are stored as artifacts. For that there are some additional steps to add:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Save test results
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
      mkdir -p ~/junit/
      find . -type f -regex &quot;.*/build/test-results/.*xml&quot; -exec cp {} ~/junit/ \;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always

&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;store_test_results&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ~/junit
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;store_artifacts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ~/junit&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All in all the build has a bunch of steps, as can be seen in this screenshot.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/117bfc521c13e320f2be63327bb1732c/bb051/detailed.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 86.17021276595744%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB40lEQVR42p2TzW7UMBSF84xQJARvwQAPUipVQuqCRREr2NDZIyQqzUx3zbZSm5Rkponj/NlxbM9B96pJBVNpUiwdzch2Pp/jex0cLI/wYnmEg+UHPFsc4tXqGK9Xx/yf1p4vDvFy9RFvwyvMwlvMwgizyxjvwhjvwxhvLmPMwgcFn65/4uT6Bz5H5ziNfuHr7xW+JRc4jc/HuS/xAvM0xzwtMU/ljs6SAmepxPdEIPC9gzQtoD20qKFFhTaTUHmJqcPWFWA6wFkEQlW4aTNorXEnMoiigKxKdL1B7yzLOgfr/a6ch/MeVV1DaQ1tDIJSNYjaHEZpZFkGIQTKssR2u4X3fq9oX1VVUErBMFA3iNsczvQMzPMc1lqOQpv3iQYBu677B9hb1HWNtm15YYq7weHgbgRSZNuZMTKdRmMqkIzsODS6gyxLti+l5NhT7vFR4K0SDBSFQFEU7PKpQOoSBkrV4KbJoBuFJE2wXq8ZmiQJn7oPSuuUaLj70WHfGRRScmRqGzpxqkOC7d6h0ri7L8pms+EYU4FkYow8VJn6MBc5mqYZn9RTGvvvorSCgRSZeso5x5rai/RN3/cPQH7LLRUl5aKkaYooirg4w4t5bAzztI8iEzRQWkH3htuEJuj3f0XQP0JIFHjV4AnrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Detailed view&quot; title=&quot;&quot; src=&quot;/static/117bfc521c13e320f2be63327bb1732c/1d69c/detailed.png&quot; srcset=&quot;/static/117bfc521c13e320f2be63327bb1732c/4dcb9/detailed.png 188w,
/static/117bfc521c13e320f2be63327bb1732c/5ff7e/detailed.png 375w,
/static/117bfc521c13e320f2be63327bb1732c/1d69c/detailed.png 750w,
/static/117bfc521c13e320f2be63327bb1732c/78797/detailed.png 1125w,
/static/117bfc521c13e320f2be63327bb1732c/bb051/detailed.png 1212w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h2&gt;Docker step&lt;/h2&gt;
&lt;h3&gt;The image itself&lt;/h3&gt;
&lt;p&gt;So if I want to dockerize our app I &lt;em&gt;kind&lt;/em&gt; of need a &lt;em&gt;Dockerfile&lt;/em&gt; (duh!). This image runs the &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; that was built on the previous job:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; openjdk:8-jre-alpine3.9&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /app&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPOSE&lt;/span&gt; 4000&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apk add --update --no-cache dumb-init &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  &amp;amp;&amp;amp; rm -rf /var/cache/apk/*&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; build/libs/echo.jar .&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; adduser -D runner&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;USER&lt;/span&gt; runner&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENTRYPOINT&lt;/span&gt; [&lt;span class=&quot;token string&quot;&gt;&quot;/usr/bin/dumb-init&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;--&quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CMD&lt;/span&gt; [&lt;span class=&quot;token string&quot;&gt;&quot;java&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;-jar&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;echo.jar&quot;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nothing out of the ordinary. &lt;a href=&quot;https://blog.docker.com/2019/07/intro-guide-to-dockerfile-best-practices/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Here is a recent post&lt;/a&gt; about improving the quality of your &lt;em&gt;Docker&lt;/em&gt; images.&lt;/p&gt;
&lt;h3&gt;Running ServerSpec&lt;/h3&gt;
&lt;p&gt;I am a big fan of testing containers with &lt;a href=&quot;https://serverspec.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ServerSpec&lt;/a&gt;, as &lt;a href=&quot;../testing-containers-serverspec-and-localstack/&quot;&gt;I’ve written before&lt;/a&gt; and spoken about &lt;a href=&quot;https://github.com/sirech/talks/blob/master/2019-01-tw-tdd_containers.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;multiple times&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Running these tests in a CI tends to be painful because of the infamous &lt;a href=&quot;https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;docker in docker&lt;/a&gt; problem. I was expecting yet another round of pain when trying to set them up for &lt;em&gt;CircleCI&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Not so much! Surprisingly, it went quite swiftly. Maybe I’m just used to it by now, who knows. How to do it, though?&lt;/p&gt;
&lt;p&gt;I’ve set up a new job for this. I created and uploaded my own &lt;a href=&quot;https://hub.docker.com/r/sirech/dind-ruby/tags&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;dind with ruby image&lt;/a&gt; so that I have access to newer &lt;code class=&quot;language-text&quot;&gt;ruby&lt;/code&gt; versions. A simplified version of it looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;
&lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

  &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sirech/dind&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ruby&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;2.6.3

  &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; checkout
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;attach_workspace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;at&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; build/libs
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; setup_remote_docker
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker build . &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;t echo
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServerSpec Tests
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
          bundle install
          bundle exec rspec spec&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thanks to the &lt;a href=&quot;https://circleci.com/docs/2.0/building-docker-images/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;setup_remote_docker&lt;/a&gt; directive, regular &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt; commands are available for this job. After installing the dependencies, the &lt;a href=&quot;https://github.com/sirech/echo/blob/master/spec/container_spec.rb&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tests&lt;/a&gt; can run inside the pipeline.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; that was generated in the previous job is available by using the &lt;code class=&quot;language-text&quot;&gt;attach_workspace&lt;/code&gt; directive.&lt;/p&gt;
&lt;h3&gt;Building the image&lt;/h3&gt;
&lt;p&gt;Once the container tests have passed, it’s time to build the image and publish it to some registry. That will be our final artifact that can be used for deployment. Deployment can happen in the same pipeline or in a separate one, it doesn’t really matter.&lt;/p&gt;
&lt;p&gt;Starting from the same job as before, it’s time to log in to whatever registry we should hold the image. Then we build the image with the right tag, and push it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Publish docker image
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
      echo $DOCKER_PASSWORD | docker login -u $DOCKER_USER $DOCKER_REGISTRY --password-stdin
      docker build . --tag $DOCKER_REGISTRY/echo
      docker push $DOCKER_REGISTRY/echo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see that I’m not versioning the image. Don’t do this for a serious application. You can attach the &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; commit by using the &lt;code class=&quot;language-text&quot;&gt;CIRCLE_SHA1&lt;/code&gt; variable, which is one of the many &lt;a href=&quot;https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;built-in&lt;/a&gt; variables that are available out of the box.&lt;/p&gt;
&lt;h2&gt;Caching&lt;/h2&gt;
&lt;p&gt;Isolation is great at keeping our builds reliable. It is often at odds with performance, though. I don’t want to cache the whole workspace like in the old, dark &lt;em&gt;Jenkins&lt;/em&gt; days, but avoiding downloading the dependencies every time is quite convenient and keeps the pipeline fast, just the way I like it.&lt;/p&gt;
&lt;p&gt;In &lt;em&gt;CircleCI&lt;/em&gt;, you do that by saving a particular folder based on a key. For instance, if I want to cache the &lt;code class=&quot;language-text&quot;&gt;ruby&lt;/code&gt; dependencies that I use for the container tests, I use a block like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;restore_cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; checksum &quot;Gemfile.lock&quot; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle check &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; bundle install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;without ops development
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;save_cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; checksum &quot;Gemfile.lock&quot; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; vendor/bundle&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All the steps inside the same job after this will have them available, and they will be cached until there is a change to the &lt;code class=&quot;language-text&quot;&gt;Gemfile.lock&lt;/code&gt; file.&lt;/p&gt;
&lt;h2&gt;Defining variables&lt;/h2&gt;
&lt;p&gt;I have been using variables throughout my pipeline to encode certain values, like my &lt;em&gt;Docker&lt;/em&gt; credentials. &lt;a href=&quot;https://circleci.com/docs/2.0/env-vars/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;They are managed through the UI&lt;/a&gt;, which frankly is not ideal. I would prefer a more programmatic solution, to be honest. Needless to say, putting secrets in the &lt;code class=&quot;language-text&quot;&gt;config.yml&lt;/code&gt; directly is out of the question, so this will have to do.&lt;/p&gt;
&lt;p&gt;If you want to manage a set of variables for multiple projects, one option could be &lt;a href=&quot;https://circleci.com/docs/2.0/contexts/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;using contexts&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;How does it all look together?&lt;/h2&gt;
&lt;p&gt;That wasn’t that bad after all. I find &lt;em&gt;CircleCI&lt;/em&gt; quite intuitive, and for hobby projects their standard account is more than enough. In fact, the pipelines run very quickly. In the beginning I was waiting a bit to check on them, and they had been finished for a while by the time I had a look.&lt;/p&gt;
&lt;p&gt;The whole pipeline is in &lt;a href=&quot;https://github.com/sirech/echo/blob/master/.circleci/config.yml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;github&lt;/a&gt;. That should be a good start to build your own app. In fact, the pipeline does not stop at the &lt;em&gt;Docker&lt;/em&gt; stage, but has a deployment step based on a custom script.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Painless JSON with Kotlin and jackson]]></title><description><![CDATA[Backends that provide a REST API or consume other APIs have to deal with JSON quite a lot. Luckily combining Kotlin and Jackson makes it a breeze]]></description><link>https://hceris.com/painless-json-with-kotlin-and-jackson/</link><guid isPermaLink="false">https://hceris.com/painless-json-with-kotlin-and-jackson/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[JSON]]></category><category><![CDATA[Jackson]]></category><category><![CDATA[REST]]></category><category><![CDATA[SpringBoot]]></category><pubDate>Sun, 16 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;It seems that many backends that provide a REST API end up being glorified proxies that move &lt;a href=&quot;https://www.json.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JSON&lt;/a&gt; from one place to another. It is especially true if you are trying to keep those backends as simple as possible (&lt;a href=&quot;https://microservices.io/patterns/microservices.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Microservices&lt;/a&gt; anyone?). Having the right tools to parse and produce JSON can thus make a big impact in keeping the code tidy and compact. I want to talk about my experience using &lt;a href=&quot;https://kotlinlang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlin&lt;/a&gt; and &lt;a href=&quot;https://github.com/FasterXML/jackson&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jackson&lt;/a&gt; for this.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;I remember that dealing with JSON in Java used to be pretty painful back in the day, as you had to write a ton of code to map objects. That is what initially led me to use &lt;a href=&quot;https://www.ruby-lang.org/en/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Ruby&lt;/a&gt;. Things have changed a lot (for the better!) since then. Nowadays, using &lt;em&gt;Kotlin&lt;/em&gt; and &lt;em&gt;Jackson&lt;/em&gt; you can deal with JSON with minimal effort. &lt;em&gt;Jackson&lt;/em&gt; is a mighty library, but you can get lost easily. I have a bunch of examples showing how to parse different classes, plus some code to integrate it into your workflow. In this case, I will be using &lt;a href=&quot;https://spring.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Serialize/Deserialize&lt;/h3&gt;
&lt;p&gt;We will be using &lt;a href=&quot;https://kotlinlang.org/docs/reference/data-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;data classes&lt;/a&gt; to represent the entities that will get converted to a from JSON. They are the equivalent of using the &lt;a href=&quot;https://projectlombok.org/features/Value&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;@Value&lt;/a&gt; annotation in &lt;em&gt;Lombok&lt;/em&gt;, with first-class support from the language. They are immutable (yay!) and have convenience methods like &lt;code class=&quot;language-text&quot;&gt;equals&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;toString&lt;/code&gt; out of the box.&lt;/p&gt;
&lt;p&gt;You can use an &lt;a href=&quot;https://fasterxml.github.io/jackson-databind/javadoc/2.7/com/fasterxml/jackson/databind/ObjectMapper.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ObjectMapper&lt;/a&gt; to do the parsing, although you can configure &lt;em&gt;SpringBoot&lt;/em&gt; to do it mostly automatically, which I will show later. I have a &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; entity with two fields that I want to convert to JSON and back.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; age&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; User&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toJson&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ObjectMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeValueAsString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; User &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ObjectMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For simple cases, just defining the data class is enough, as long as you have the &lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;right module&lt;/a&gt;. There are a bunch of extra configurations that you can do on top of it, though. Many of them can be controlled with annotations, which make the code a lot more compact. Abusing them will turn your code into an unmaintainable mess, though.&lt;/p&gt;
&lt;h4&gt;Nullability&lt;/h4&gt;
&lt;p&gt;If some of the fields are optional, you provide default values.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can also allow them to be &lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;not doing anything will make the parsing fail with an exception, which I find a good thing.&lt;/p&gt;
&lt;h4&gt;Aliasing&lt;/h4&gt;
&lt;p&gt;If you are parsing your object from a different source that uses different attribute names, but still want to keep a &lt;em&gt;canonical&lt;/em&gt; representation, &lt;code class=&quot;language-text&quot;&gt;@JsonAlias&lt;/code&gt; is your friend.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token annotation builtin&quot;&gt;@JsonAlias&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;userId&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;this will correctly parse something like&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;userId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;123&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Ignore properties&lt;/h4&gt;
&lt;p&gt;Maybe you are parsing an object with a ton of fields that you don’t need. If you are not going to use it in your code, you really should avoid adding them, as that makes it harder to understand what is needed and what is not. &lt;code class=&quot;language-text&quot;&gt;@JsonIgnoreProperties&lt;/code&gt; can be used for this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@JsonIgnoreProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ignoreUnknown &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Different representations&lt;/h4&gt;
&lt;p&gt;If your backend is acting as a proxy, you will be reading your data from somewhere and passing it to your client. In this case, you might want to skip some fields in the serialization to give your client precisely the fields it needs. You can accomplish this by customizing the access property.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token annotation builtin&quot;&gt;@JsonProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;access &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; JsonProperty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Access&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WRITE_ONLY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; age&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The serialization of this object won’t contain the &lt;code class=&quot;language-text&quot;&gt;age&lt;/code&gt;, but it is available in our code. This approach does not scale that well, however. If you find that you have two different representations of the same entity and are adding a ton of annotations to use one class, it’s probably better to split it into two distinct classes and provide a method one into the other.&lt;/p&gt;
&lt;p&gt;This underscores an important point. You don’t need to use annotations and implicit conversions for everything. In some places having dedicated converters is just more readable, more so if you want to attach some logic to that process.&lt;/p&gt;
&lt;h4&gt;And if you want more…&lt;/h4&gt;
&lt;p&gt;This article shows just a small part of what is possible to do. You can control every aspect of the serialization/deserialization process. Have a look at &lt;a href=&quot;https://www.baeldung.com/jackson-annotations&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this post&lt;/a&gt; if you want to know about other options.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;Getting away from untyped strings&lt;/h3&gt;
&lt;p&gt;In JSON you tend to use strings to represent many entities. Any id type like a user id, or something like a language code, for example. I prefer mapping them to dedicated classes in my code. I’ve seen many bugs where the wrong entity is used when that could be prevented directly by the compiler. Taking a &lt;code class=&quot;language-text&quot;&gt;UserId&lt;/code&gt; as an example, I like to model it as follows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It should be an immutable data class&lt;/li&gt;
&lt;li&gt;It should not force a change in the structure of the JSON (i.e., no nesting)&lt;/li&gt;
&lt;li&gt;Serialize/Deserialize should work out of the box&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;UserId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;companion&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token annotation builtin&quot;&gt;@JvmStatic&lt;/span&gt;
        &lt;span class=&quot;token annotation builtin&quot;&gt;@JsonCreator&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;UserId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation builtin&quot;&gt;@JsonValue&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using a data class, we get an immutable object that represents this entity. We can do relatively little with it. In fact, we don’t even want access to the internal fields. We are going to compare instances directly, and if we need to get a string representation, we’ll do that through the &lt;code class=&quot;language-text&quot;&gt;toString&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;The serialization happens through the &lt;code class=&quot;language-text&quot;&gt;@JsonValue&lt;/code&gt; annotation, where we use the value directly. If we modify our &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; class that we have been using before, it will look like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; age&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That class serializes to this JSON&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;123&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That representation matches how most clients (especially a frontend) would expect this structure to look like, without sacrificing any safety in the backend.&lt;/p&gt;
&lt;p&gt;The deserialization happens automatically. However, I like to define a static constructor (using the &lt;code class=&quot;language-text&quot;&gt;@JvmStatic&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;@JsonCreator&lt;/code&gt; annotations) so that I can do things like sanitizing the input before generating my instance. This helps to make sure our models are in a consistent state.&lt;/p&gt;
&lt;p&gt;Since Kotlin 1.3, a new concept called &lt;a href=&quot;https://kotlinlang.org/docs/reference/inline-classes.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;inline classes&lt;/a&gt; has been introduced, which might match better with this use case. Jackson has some trouble deserializing it properly in nested objects as of 16/06/19, so I could not replace my data classes with it so far. There is an &lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin/issues/199&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;open issue in Github&lt;/a&gt; to follow.&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;SpringBoot integration&lt;/h3&gt;
&lt;p&gt;Here we get the last piece of the puzzle. We can manually use an &lt;code class=&quot;language-text&quot;&gt;ObjectMapper&lt;/code&gt; and convert things explicitly. It is much easier if that happens on its own. The good news is that there is not much to do here other than adding the &lt;a href=&quot;https://github.com/FasterXML/jackson-module-kotlin&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jackson-module-kotlin&lt;/a&gt; as a dependency:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;gradle&quot;&gt;&lt;pre class=&quot;language-gradle&quot;&gt;&lt;code class=&quot;language-gradle&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.fasterxml.jackson.module:jackson-module-kotlin:&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;jacksonVersion&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you are using the latest versions of everything, that will be enough. If the spring magic does not happen on its own (spring does a lot of magic that I don’t quite understand), you can do it manually. You can use a &lt;code class=&quot;language-text&quot;&gt;@Configuration&lt;/code&gt; so that your controllers can map to and from JSON automatically.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; JacksonConfiguration &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mappingJackson2HttpMessageConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MappingJackson2HttpMessageConverter &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MappingJackson2HttpMessageConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;objectMapper &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ObjectMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;registerModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;KotlinModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;if you are making REST request to another service, you can build a custom &lt;code class=&quot;language-text&quot;&gt;RestTemplate&lt;/code&gt; doing the same:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DefaultRestTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;baseUrl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;RestTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HttpComponentsClientHttpRequestFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                HttpClientBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;useSystemProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;init&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        uriTemplateHandler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DefaultUriBuilderFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;baseUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        messageConverters &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;jacksonConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;messageConverters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;jacksonConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;converters&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MutableList&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HttpMessageConverter&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HttpMessageConverter&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; jsonConverter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MappingJackson2HttpMessageConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        jsonConverter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;objectMapper &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;jacksonObjectMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;registerModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;KotlinModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        converters&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jsonConverter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; converters
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Again, all this should happen by just adding the library to the classpath. Use this as a fallback in case that does not work for some reason. Also, this template can be extended to use a base URL, receive environment variables (to include the keystore for instance), or automatically add certain headers to your requests.&lt;/p&gt;
&lt;h4&gt;PathVariables are not JSON&lt;/h4&gt;
&lt;p&gt;Now that we are waist-deep in automated JSON mapping, I’m getting ambitious. As mentioned above, we are no longer using plain strings but proper domain classes. Let’s say you have a route like &lt;code class=&quot;language-text&quot;&gt;GET /users/:userId&lt;/code&gt;. The controller would look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@RequestMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/users&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; produces &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;MediaType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;APPLICATION_JSON_VALUE&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; HelloController &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{userId}&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@PathVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;userId&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; userId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ResponseEntity&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you send a request to this route, the &lt;code class=&quot;language-text&quot;&gt;userId&lt;/code&gt; will get parsed automatically, but our custom &lt;code class=&quot;language-text&quot;&gt;create&lt;/code&gt; method won’t get called, because this is a URL, not JSON. We didn’t come this far to start parsing strings manually again. Let’s fix this by using a custom converter.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; ConverterConfiguration &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; WebMvcConfigurer &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addFormatters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;registry&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FormatterRegistry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        registry&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addConverter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Converter&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; UserId&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Converter&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; UserId&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; source &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; UserId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s it. Now we can be sure that those pesky strings are not floating through our app at any point in the flow of a request.&lt;/p&gt;
&lt;h3&gt;Summary&lt;/h3&gt;
&lt;p&gt;Jackson is a very powerful library, and to be honest, you can overdo it with all the annotations. If you use them judiciously, though, working with JSON becomes very easy while keeping a good amount of type safety in the process. For testing, this goes well with &lt;a href=&quot;https://hceris.com/recording-apis-with-wiremock/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;recorded APIs using WireMock&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 25/12/2019:&lt;/em&gt; Grammar review&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Mock verification in Kotlin using MockK and Atrium]]></title><description><![CDATA[When working with Kotlin you might need to build some non trivial mocks that need to be verified. Here is how to do it by combining MockK and Atrium]]></description><link>https://hceris.com/mock-verification-in-kotlin/</link><guid isPermaLink="false">https://hceris.com/mock-verification-in-kotlin/</guid><category><![CDATA[Kotlin]]></category><category><![CDATA[Testing]]></category><category><![CDATA[MockK]]></category><category><![CDATA[SpringBoot]]></category><category><![CDATA[Atrium]]></category><pubDate>Mon, 27 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been working with &lt;a href=&quot;https://kotlinlang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Kotlin&lt;/a&gt; a lot lately. It is a really awesome language. Elegant, powerful and succinct, it fixes most of the annoyances that I had with &lt;em&gt;Java&lt;/em&gt;, yet it keeps a certain amount of familiarity that allows the transition from it to be very manageable.&lt;/p&gt;
&lt;p&gt;Anyhow, I found myself recently having to build a filter in &lt;a href=&quot;https://spring.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SpringBoot&lt;/a&gt; that I wanted to test. For that I needed to use both a mock and verify that behavior at the same time. &lt;em&gt;Kotlin&lt;/em&gt; is evolving quite fast and there are plenty of alternatives to choose from. I will show how to do this with two excellent libraries, &lt;a href=&quot;https://mockk.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;MockK&lt;/a&gt;, and &lt;a href=&quot;https://docs.atriumlib.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Atrium&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;MockK and Atrium, a powerful combo&lt;/h2&gt;
&lt;p&gt;In the short time that I have been developing &lt;em&gt;Kotlin&lt;/em&gt;, I’ve noticed a pattern. Whenever you need something not provided in the standard library, you tend to start by using the existing &lt;em&gt;Java&lt;/em&gt; library that you are familiar with. Then, at some point, you figure out there is a native &lt;em&gt;Kotlin&lt;/em&gt; library that leverages the features from the language better.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.thoughtworks.com/radar/languages-and-frameworks/mockk&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;MockK&lt;/a&gt; seems to be on its way to become the defacto mocking library for &lt;em&gt;Kotlin&lt;/em&gt; apps. With a syntax based heavily around lambdas, it just looks like a DSL, as you can see in this example taken directly from their page:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; car &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mockk&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Car&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

every &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; car&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Direction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NORTH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; returns Outcome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OK
car&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Direction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NORTH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// returns OK&lt;/span&gt;

verify &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; car&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Direction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NORTH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Meanwhile, &lt;em&gt;Atrium&lt;/em&gt; is less established, but after getting the recommendation from a colleague, I gave it a try. It uses &lt;code class=&quot;language-text&quot;&gt;expect&lt;/code&gt;, so for somebody like me who is used to &lt;em&gt;RSpec&lt;/em&gt; it is already a win. Anyhow, the syntax takes some time to get used to, but it can be quite expressive. I particularly like combining it with data classes to have exactly one assertion per test instead of many.&lt;/p&gt;
&lt;h2&gt;The problem at hand&lt;/h2&gt;
&lt;p&gt;What I was trying to build was not particularly complex. I wanted to write a filter for a &lt;em&gt;SpringBoot&lt;/em&gt; application that would inject some headers into the request based on some logic. All controllers would use these values transparently, without having to care about the computation. The filter looks like this.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; Filter &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;OncePerRequestFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; processor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Processor

    &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doFilterInternal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpServletRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpServletResponse&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterChain&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FilterChain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; wrappedRequest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;HttpServletRequestWrapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;addHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Headers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EXTRA_HEADER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; processor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        filterChain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wrappedRequest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I want to test two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;filterChain&lt;/code&gt; should be called with my &lt;code class=&quot;language-text&quot;&gt;wrappedRequest&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;wrappedRequest&lt;/code&gt; should have the correct header in it&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Setting up the test&lt;/h3&gt;
&lt;p&gt;I am using &lt;a href=&quot;https://junit.org/junit5/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;JUnit 5&lt;/a&gt; for the test (Speaking of native libraries, I haven’t tried something like &lt;a href=&quot;https://dzone.com/articles/testing-kotlin-with-spock-part-1-object&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spock&lt;/a&gt; yet). The basic setup of the test requires to set up the filter and the mocks that I need.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@ExtendWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockKExtension&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; FilterTest &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; request &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MockHttpServletRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token annotation builtin&quot;&gt;@MockK&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; HttpServletResponse

    &lt;span class=&quot;token annotation builtin&quot;&gt;@RelaxedMockK&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; filterChain&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FilterChain

    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        processor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ProcessorImpl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I am using annotations to initialize the mocks (which requires annotating the test with &lt;code class=&quot;language-text&quot;&gt;MockKExtension&lt;/code&gt;). My &lt;code class=&quot;language-text&quot;&gt;filterChain&lt;/code&gt; is a &lt;code class=&quot;language-text&quot;&gt;RelaxedMockK&lt;/code&gt;, which means that its methods will return a default value unless otherwise specified.&lt;/p&gt;
&lt;h3&gt;A very simple test&lt;/h3&gt;
&lt;p&gt;If I just want to check that the method is being called, I don’t really need much&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;`calls the next step in the filter`&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    filter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterChain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    verify &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; filterChain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Testing the wrapped request&lt;/h3&gt;
&lt;p&gt;The previous test is OK, but it is a bit bland for my taste. I want to make sure that that the &lt;code class=&quot;language-text&quot;&gt;filterChain&lt;/code&gt; is being called with my &lt;code class=&quot;language-text&quot;&gt;wrappedRequest&lt;/code&gt;, and that it contains the header I injected. This test becomes much more interesting&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;`injects header into the request and passes it to the filter`&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    filter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterChain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    slot&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ServletRequest&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; slot &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        verify &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; filterChain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;capture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;slot&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;slot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;captured&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isA&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HttpServletRequestWrapper&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Headers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EXTRA_HEADER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not so simple anymore! Let’s break it down.&lt;/p&gt;
&lt;p&gt;First we are capturing the first argument for &lt;code class=&quot;language-text&quot;&gt;doFilter&lt;/code&gt; (i.e: the wrapped request). We are creating a new slot by doing &lt;code class=&quot;language-text&quot;&gt;slot&amp;lt;ServletRequest&gt;&lt;/code&gt;, and capturing it by passing it in the &lt;code class=&quot;language-text&quot;&gt;verify&lt;/code&gt; block by doing &lt;code class=&quot;language-text&quot;&gt;capture(slot)&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;let&lt;/code&gt; block wrapping everything is there so that we don’t need an extra local variable (and to feel more kotlin-y inside).&lt;/p&gt;
&lt;p&gt;After all this &lt;code class=&quot;language-text&quot;&gt;slot.captured&lt;/code&gt; contains the &lt;code class=&quot;language-text&quot;&gt;wrappedRequest&lt;/code&gt; that we created in the filter. Here is where &lt;em&gt;Atrium&lt;/em&gt; can shine. We use &lt;code class=&quot;language-text&quot;&gt;isA&lt;/code&gt; first to check that the request is of the right type. Then inside the block &lt;code class=&quot;language-text&quot;&gt;subject&lt;/code&gt; is the casted type, where we finally check that our header is there.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;With this our small filter can be tested properly and with very little overhead. I am no &lt;em&gt;Kotlin&lt;/em&gt; connoisseur, but the syntax of both &lt;em&gt;MockK&lt;/em&gt; and &lt;em&gt;Atrium&lt;/em&gt; feels quite elegant to me, once you wrap your head around it. I think this is a good starting point to build better and better tests without a ton of boilerplate code.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Making Concourse's fly tool work behind an authenticated ALB]]></title><description><![CDATA[Setting Concourse CI with an authenticated ALB in AWS is an easy way to increase the security of your CI setup, but if you want to still use fly you need to do some adaptations]]></description><link>https://hceris.com/concourse-fly-behind-alb-oidc/</link><guid isPermaLink="false">https://hceris.com/concourse-fly-behind-alb-oidc/</guid><category><![CDATA[Concourse CI]]></category><category><![CDATA[AWS]]></category><pubDate>Sat, 13 Apr 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We recently put a &lt;em&gt;Concourse CI&lt;/em&gt; instance behind an authenticated &lt;a href=&quot;https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ALB&lt;/a&gt; in &lt;em&gt;AWS&lt;/em&gt;, to make sure there are two distinct logins happening without having to resort to using a bastion host.&lt;/p&gt;
&lt;p&gt;The way this works is that whenever you try to access the URL assigned to &lt;em&gt;Concourse&lt;/em&gt;, there is a redirection that sends you to the identity provider. Once you log in there (using, hopefully, MFA), a cookie named &lt;code class=&quot;language-text&quot;&gt;AWSELBAuthSessionCookie-0&lt;/code&gt; is set in your browser and then you will reach the tool again.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;The code to do this is fairly straightforward. You set up a new app in your &lt;code class=&quot;language-text&quot;&gt;IdP&lt;/code&gt;, from which you get a &lt;code class=&quot;language-text&quot;&gt;client_id&lt;/code&gt; and a &lt;code class=&quot;language-text&quot;&gt;client_secret&lt;/code&gt;. Then set up a check in the &lt;em&gt;ALB&lt;/em&gt; using &lt;code class=&quot;language-text&quot;&gt;terraform&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_lb_listener&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;web-alb&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;load_balancer_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_lb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web-alb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arn&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;port&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;443&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;protocol&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;HTTPS&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;ssl_policy&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ELBSecurityPolicy-TLS-1-2-2017-01&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;certificate_arn&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_acm_certificate_validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;certificate_arn&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;default_action&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;authenticate-oidc&quot;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;authenticate_oidc&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;authorization_endpoint&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;idp_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/oidc/auth&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;client_id&lt;/span&gt;              &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;client_id_oidc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;client_secret&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;client_secret_oidc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;issuer&lt;/span&gt;                 &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;idp_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/oidc&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;token_endpoint&lt;/span&gt;         &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;idp_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/oidc/token&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;user_info_endpoint&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;idp_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/oidc/me&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;default_action&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;             &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;forward&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;target_group_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_lb_target_group&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web-alb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arn&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, this has an unintended consequence. &lt;code class=&quot;language-text&quot;&gt;fly&lt;/code&gt; also accesses &lt;em&gt;Concourse CI&lt;/em&gt; through that URL, and it cannot deal with the redirection. You are not supposed to trigger many things locally, as that should be covered by the pipelines themselves. You still need to upload a pipeline for the first time when you create a new one, and there are commands like &lt;code class=&quot;language-text&quot;&gt;intercept&lt;/code&gt; that you also want to use, so it is nice to have this option open in this setup.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;fly&lt;/code&gt; itself does not help much, so we had to find a workaround. What we did was building a local proxy that forwards the request from &lt;code class=&quot;language-text&quot;&gt;fly&lt;/code&gt; to the &lt;em&gt;ALB&lt;/em&gt; and injects the cookie in the request to make it work. The proxy is simply &lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt; with a parametrized configuration, running inside a &lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt; container. One interesting thing to note is that we have to set up some headers to that &lt;code class=&quot;language-text&quot;&gt;intercept&lt;/code&gt; works as well, as it relies on &lt;em&gt;websockets&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;events&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;worker_connections&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;http&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; $&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;CONCOURSE_PROXY_PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server_name&lt;/span&gt; localhost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; /&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; $&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;CONCOURSE_URL&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; Cookie AWSELBAuthSessionCookie-0=$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;COOKIE&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;# Fix `websocket: bad handshake` when using `fly intercept`&lt;/span&gt;
            &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; Upgrade &lt;span class=&quot;token variable&quot;&gt;$http_upgrade&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; Connection &lt;span class=&quot;token string&quot;&gt;&quot;upgrade&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This configuration is converted to a valid one in the &lt;code class=&quot;language-text&quot;&gt;CMD&lt;/code&gt; of the container, like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#! /usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# shellcheck disable=SC2016&lt;/span&gt;
envsubst &lt;span class=&quot;token string&quot;&gt;&apos;$COOKIE $CONCOURSE_URL $CONCOURSE_PROXY_PORT&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; /tmp/nginx.conf.template &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/nginx/nginx.conf
nginx &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;daemon off;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We run the container using &lt;code class=&quot;language-text&quot;&gt;docker-compose&lt;/code&gt; and provide the &lt;code class=&quot;language-text&quot;&gt;COOKIE&lt;/code&gt; in an &lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt; file.&lt;/p&gt;
&lt;h2&gt;Connecting to Concourse&lt;/h2&gt;
&lt;p&gt;Once the &lt;em&gt;proxy&lt;/em&gt; is running, we just need to log in with &lt;code class=&quot;language-text&quot;&gt;fly&lt;/code&gt;. We do that from our &lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt; script directly:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;goal_login-to-concourse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  fly &lt;span class=&quot;token parameter variable&quot;&gt;--target&lt;/span&gt; aftersales login --concourse-url &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:&lt;span class=&quot;token variable&quot;&gt;$CONCOURSE_PROXY_PORT&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is where we see one of the pain points of this solution. When you try to log in, you see something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;navigate to the following URL &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; your browser:

  http://localhost:3232/sky/login?redirect_uri&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://127.0.0.1:50449/auth/callback

or enter token manually:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;that URL won’t work. You need to replace the &lt;code class=&quot;language-text&quot;&gt;localhost&lt;/code&gt; part with the actual URL of the &lt;em&gt;Concourse&lt;/em&gt; server. We could not really figure out a way to make this a bit more user friendly, so we just need to deal with it.&lt;/p&gt;
&lt;p&gt;Getting the cookie is also a bit cumbersome, as you need to get it manually from your browser and put it in the &lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt; file. I experimented a bit getting this cookie programatically, but I could not get a decrypted cookie from Chrome, so I just left at this for now.&lt;/p&gt;
&lt;p&gt;And that’s basically it. It is a bit of a hack, to be honest, but it does the job without having to compromise on the two logins setup that we were after.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[An overview of IAM in AWS]]></title><description><![CDATA[IAM in AWS can be scary. I wrote a small guide to understand the basic concepts so that you can get started with it]]></description><link>https://hceris.com/aws-iam-an-overview/</link><guid isPermaLink="false">https://hceris.com/aws-iam-an-overview/</guid><category><![CDATA[AWS]]></category><category><![CDATA[IAM]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[Security]]></category><pubDate>Sat, 09 Mar 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If you use &lt;a href=&quot;https://aws.amazon.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS&lt;/a&gt;, you should make sure you have &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/using-aws-security-first-class-citizen&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the right account structure in place&lt;/a&gt;. If you just go ahead and use a root account, you might just lose your &lt;a href=&quot;https://threatpost.com/hacker-puts-hosting-service-code-spaces-out-of-business/106761/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;whole business&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now that I have your attention (and that you are rightfully scared of the bad people out there) I wanted to talk about the tools that &lt;em&gt;AWS&lt;/em&gt; offers to manage permissions for its resources, also called &lt;a href=&quot;https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;IAM&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;&lt;em&gt;IAM&lt;/em&gt; is extremely powerful, but the sheer amount of things that they throw at you can be scary at first. Just check how big their &lt;a href=&quot;https://aws.amazon.com/iam/faqs/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;FAQ&lt;/a&gt; is. I have been using it extensively in my project to manage access to our resources, but I realized recently that we did not have a very sound understanding of the basic pieces, so I drew all of that on a whiteboard to make it easier to understand.&lt;/p&gt;
&lt;h2&gt;Core principles&lt;/h2&gt;
&lt;p&gt;All our policies are &lt;a href=&quot;https://en.wikipedia.org/wiki/Infrastructure_as_code&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;represented in code&lt;/a&gt;. We use &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; for that. Having the policies represented in code is crucial if you want to maintain them properly over time.&lt;/p&gt;
&lt;p&gt;The roles that we provision should have as &lt;a href=&quot;https://en.wikipedia.org/wiki/Principle_of_least_privilege&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;little rights&lt;/a&gt; as possible. The fewer permissions that you grant the better. That protects you against attacks, but also against bugs.&lt;/p&gt;
&lt;h2&gt;Our starting point&lt;/h2&gt;
&lt;p&gt;This picture should give you an idea of where we are:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a7810e2c061e0ea8256d1c97efed87a4/b4294/iam-basic-components.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 107.4468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDAf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB3qWW3FZBNBl//8QAFxAAAwEAAAAAAAAAAAAAAAAAABARIP/aAAgBAQABBQLVKv/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABkQAAIDAQAAAAAAAAAAAAAAAAABEBExcf/aAAgBAQABPyEstiyeY6j/2gAMAwEAAgADAAAAELgnwf/EABYRAQEBAAAAAAAAAAAAAAAAABEAEP/aAAgBAwEBPxBnC//EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QhMrP/8QAHBABAAIDAAMAAAAAAAAAAAAAAQARITFRcZGh/9oACAEBAAE/EBaKoxyC3dQ7QFPEC5ZDEOK3MTX2FA0+5//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;IAM Basic components&quot; title=&quot;&quot; src=&quot;/static/a7810e2c061e0ea8256d1c97efed87a4/b4294/iam-basic-components.jpg&quot; srcset=&quot;/static/a7810e2c061e0ea8256d1c97efed87a4/bc01b/iam-basic-components.jpg 188w,
/static/a7810e2c061e0ea8256d1c97efed87a4/bf173/iam-basic-components.jpg 375w,
/static/a7810e2c061e0ea8256d1c97efed87a4/b4294/iam-basic-components.jpg 600w&quot; sizes=&quot;(max-width: 600px) 100vw, 600px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;We have our infrastructure that we want to operate. There are a ton of services that you might be using from &lt;em&gt;AWS&lt;/em&gt;, from places to put data such as &lt;code class=&quot;language-text&quot;&gt;S3&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;RDS&lt;/code&gt;, to something like &lt;code class=&quot;language-text&quot;&gt;ECS&lt;/code&gt; to run your containerized applications, but also everything that surrounds it, like networks, security groups, DNS and whatnot.&lt;/li&gt;
&lt;li&gt;Then there are the actors interacting with the infrastructure. They can be human actors, such as the developers building and operating the platform. They can also be machine actors, like the CI/CD tool that you might use to provision your infrastructure, or the applications that you run themselves.&lt;/li&gt;
&lt;li&gt;These actors will want to perform certain operations. We might want to get data out of our stores, launch services or create new resources.&lt;/li&gt;
&lt;li&gt;And you need authorization to perform those operations. At the end, you will need to log in into &lt;em&gt;AWS&lt;/em&gt; and use the credentials, one way or the other.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At this point you could say fuck it, I’m just going to pass these credentials around. But there are a ton of things that can go wrong. What happens if those credentials are leaked, for instance? Thankfully, &lt;em&gt;AWS&lt;/em&gt; offers a way to deal with this. We will be using &lt;a href=&quot;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;roles&lt;/a&gt; to group the permissions that we want to create.&lt;/p&gt;
&lt;h2&gt;Role&lt;/h2&gt;
&lt;p&gt;What is a role? Quoting the official documentation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An IAM role is an IAM identity that you can create in your account that has specific permissions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Check out &lt;a href=&quot;https://spacelift.io/blog/aws-iam-roles&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this article&lt;/a&gt; for a more detailed introduction to roles in AWS.&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5cfe232cea145a5e6d00c8638100e81f/b4294/iam-role.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdBYIP/EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAT8hX//aAAwDAQACAAMAAAAQJP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QiP/EABkQAQEBAQEBAAAAAAAAAAAAAAERADEQUf/aAAgBAQABPxBKsZNGdcc8H7qb/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;IAM Role&quot; title=&quot;&quot; src=&quot;/static/5cfe232cea145a5e6d00c8638100e81f/b4294/iam-role.jpg&quot; srcset=&quot;/static/5cfe232cea145a5e6d00c8638100e81f/bc01b/iam-role.jpg 188w,
/static/5cfe232cea145a5e6d00c8638100e81f/bf173/iam-role.jpg 375w,
/static/5cfe232cea145a5e6d00c8638100e81f/b4294/iam-role.jpg 600w&quot; sizes=&quot;(max-width: 600px) 100vw, 600px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;This means that we are going to create different roles that will be assumed by some of our actors (&lt;code class=&quot;language-text&quot;&gt;ci-web&lt;/code&gt; for example, or a specific role for each application that we want to deploy). They are defined using &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/iam_role.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_iam_role&lt;/a&gt;. It looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_role&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;               &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ci-web&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;assume_role_policy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;aws_iam_policy_document&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;assume_role_policy_ec2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If this &lt;em&gt;role&lt;/em&gt; is going to be assumed, we need to grant permissions for that as well. In this case, we want an &lt;a href=&quot;https://aws.amazon.com/ec2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;EC2&lt;/a&gt; instance to be able to assume it, as our &lt;em&gt;CI&lt;/em&gt; will be running there. We can do that with a &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/d/iam_policy_document.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_iam_policy_document&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_policy_document&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;assume_role_policy_ec2&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;statement&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;effect&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;actions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sts:AssumeRole&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;principals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Service&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;identifiers&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ec2.amazonaws.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The last part of the puzzle is defining an &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/iam_instance_profile.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_iam_instance_profile&lt;/a&gt;, and using it in the &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/launch_configuration.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_launch_configuration&lt;/a&gt; of said instance.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_instance_profile&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;role&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_launch_configuration&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;iam_instance_profile&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ci-web&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Defining policies&lt;/h2&gt;
&lt;p&gt;Thus far, we have set up our roles, but those roles are not actually allowed to do anything, yet. We need to create some policies that allow access to the resources we want to use, through &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/iam_policy.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_iam_policy&lt;/a&gt;:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5503210dd0c47debfcc6e148e0b281c6/b4294/iam-policy.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 123.40425531914893%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEE/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHXJc2gg1II/8QAFhABAQEAAAAAAAAAAAAAAAAAESAA/9oACAEBAAEFAnMN/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ak//xAAZEAEAAwEBAAAAAAAAAAAAAAABABARITH/2gAIAQEAAT8h3QNPLEHG9hGv/9oADAMBAAIAAwAAABCoETH/xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQMBAT8QZ3//xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQIBAT8QI3//xAAfEAEAAQMEAwAAAAAAAAAAAAABABExYRAhQYFRkeH/2gAIAQEAAT8QzPuLS0aoB6gK3iSlEDEq+Q6jyw2fNRvP/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;IAM Policy&quot; title=&quot;&quot; src=&quot;/static/5503210dd0c47debfcc6e148e0b281c6/b4294/iam-policy.jpg&quot; srcset=&quot;/static/5503210dd0c47debfcc6e148e0b281c6/bc01b/iam-policy.jpg 188w,
/static/5503210dd0c47debfcc6e148e0b281c6/bf173/iam-policy.jpg 375w,
/static/5503210dd0c47debfcc6e148e0b281c6/b4294/iam-policy.jpg 600w&quot; sizes=&quot;(max-width: 600px) 100vw, 600px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I already wrote about how to use these policies to grant &lt;a href=&quot;../using-asm-in-concourse/&quot;&gt;access to the &lt;em&gt;AWS Secrets Manager&lt;/em&gt; from Concourse&lt;/a&gt;. In the end, we always follow a similar structure. Each &lt;em&gt;policy&lt;/em&gt; contains a of &lt;em&gt;statements&lt;/em&gt; that define the access we want to give. Don’t forget to use a &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/iam_role_policy_attachment.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;aws_iam_role_policy_attachment&lt;/a&gt; to bind the policies to the role.&lt;/p&gt;
&lt;h3&gt;Making a statement&lt;/h3&gt;
&lt;p&gt;Statements are quite flexible and have a bunch of configuration options. I am going to focus on three of their arguments, &lt;code class=&quot;language-text&quot;&gt;effect&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;actions&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;resources&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;effect&lt;/code&gt; can be either &lt;em&gt;Allow&lt;/em&gt; or &lt;em&gt;Deny&lt;/em&gt;. We actually always set them to &lt;code class=&quot;language-text&quot;&gt;Allow&lt;/code&gt;. Why? As mentioned, we want to give the least possible amount of privileges, so our policies should only be granting what a role absolutely needs. That means there should never be necessary to revoke a particular permission in a different part of the code.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;actions&lt;/code&gt; are what we want to be able to do in &lt;em&gt;AWS&lt;/em&gt;. They basically map to single API calls, and they are really granular. What you should really avoid is giving blanket permissions such as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;statement&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow&quot;&lt;/span&gt;

    &lt;span class=&quot;token property&quot;&gt;actions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;ec2:*&quot;&lt;/span&gt;,
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This not only goes against the principle of least privilege, but it also will create a maintainability mess, as you will have a very hard time afterwards reducing permissions without something breaking. Trust me on this one, invest the time upfront and make sure you only give permissions that are needed. There is an excellent &lt;a href=&quot;https://iam.cloudonaut.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;reference guide&lt;/a&gt; that I find extremely useful when giving permissions incrementally.&lt;/p&gt;
&lt;p&gt;Lastly, &lt;code class=&quot;language-text&quot;&gt;resources&lt;/code&gt; are the &lt;a href=&quot;https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ARN’s&lt;/a&gt; that this statement applies to. As with the &lt;code class=&quot;language-text&quot;&gt;actions&lt;/code&gt;, it is a very good idea to avoid using wildcards.&lt;/p&gt;
&lt;p&gt;There are more things you can do, such as using &lt;code class=&quot;language-text&quot;&gt;principals&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;conditions&lt;/code&gt;, which are out of the scope of this article. However, you can get a lot of mileage out of just &lt;code class=&quot;language-text&quot;&gt;actions&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;resources&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Wrapping it up&lt;/h2&gt;
&lt;p&gt;This is it, you don’t really need anything else to build a solid and secure foundation in which to run your applications. Using different roles and giving them the access they need through policies step by step is all there is to it, really.&lt;/p&gt;
&lt;p&gt;Testing this still remains a challenge, as &lt;em&gt;IAM&lt;/em&gt; failures tend to manifest only when you actually try to run the whole thing in your environment. Don’t succumb to the temptation to take the easy route, though. Fixing a bad permission setup is hard, and you will regret it.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 19/02/2023:&lt;/em&gt; Added link to AWS role guide&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Checking the validity of a certificate in Concourse]]></title><description><![CDATA[If you are managing a certificate for an application, you should make sure you know when it is going to expire. This can be automated as part of your build pipeline]]></description><link>https://hceris.com/check-certificate-validity-concourse/</link><guid isPermaLink="false">https://hceris.com/check-certificate-validity-concourse/</guid><category><![CDATA[Continuous integration]]></category><category><![CDATA[Concourse CI]]></category><category><![CDATA[Certificates]]></category><pubDate>Thu, 14 Feb 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We had a situation recently where a certificate that we created using &lt;a href=&quot;https://letsencrypt.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LetsEncrypt&lt;/a&gt; was about to expire, and we barely noticed in time thanks to a reminder email. For a variety of reasons we cannot automate the renewal right now, but this made me think that relying on emails begin read on time is just asking for trouble.&lt;/p&gt;
&lt;p&gt;What I did was making this check part of our build pipeline in &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Concourse&lt;/a&gt;, which should be triggered 30 days before the expiration of the certificate, so that we get plenty of time to address it.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Repeated checks in Concourse&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Concourse&lt;/em&gt; uses the &lt;a href=&quot;https://github.com/concourse/time-resource&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;time&lt;/a&gt; resource to model a periodic trigger. You can define a daily check just like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 24h
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; time
  &lt;span class=&quot;token key atrule&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;interval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 24h
    &lt;span class=&quot;token key atrule&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 11&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;00 AM
    &lt;span class=&quot;token key atrule&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 11&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;15 AM
    &lt;span class=&quot;token key atrule&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Europe/Berlin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then you can define a job that will be triggered every 24 hours by getting this resource:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; certificate
  &lt;span class=&quot;token key atrule&quot;&gt;serial&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;plan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
      &lt;span class=&quot;token key atrule&quot;&gt;passed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;prepare&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 24h
      &lt;span class=&quot;token key atrule&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;passed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;prepare&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; check&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;certificate
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;CERT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; certs/fullchain.pem
    &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git/pipeline/tasks/check&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;certificate/task.yml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using the timer as a resource is a bit funky compared to what you would do in something like &lt;em&gt;Jenkins&lt;/em&gt;, but once you get used to how &lt;em&gt;Concourse&lt;/em&gt; does things, it makes sense to use a resource to model every “input” coming from the outside.&lt;/p&gt;
&lt;h2&gt;Checking the certificate&lt;/h2&gt;
&lt;p&gt;We can leverage &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt; to do this check, and integrate it into our pipeline by installing the it on the container as well (through &lt;code class=&quot;language-text&quot;&gt;apk&lt;/code&gt; if you use alpine). The script to check a certificate looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;THIRTY_DAYS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2592000&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; openssl x509 &lt;span class=&quot;token parameter variable&quot;&gt;-checkend&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${THIRTY_DAYS}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-noout&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${CERT}&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Certificate is good for another day!&quot;&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Certificate has expired or will do so within 30 days!&quot;&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see that we are checking the certificate file that is part of the proxy that serves the domain, and not the live URL. This relies on your pipeline running often enough so that what you have there matches what is deployed.&lt;/p&gt;
&lt;h2&gt;That’s it?&lt;/h2&gt;
&lt;p&gt;Pretty much! With this check your pipeline will become red one month before the expiration of the cert, giving you ample time to do something about it. Next step could be automating not only the alert, but the renewal of the certificate as well?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Testing containers with dependencies with localstack]]></title><description><![CDATA[Testing containers with ServerSpec can be augmented through localstack to test more complex setups with dependencies]]></description><link>https://hceris.com/testing-containers-serverspec-and-localstack/</link><guid isPermaLink="false">https://hceris.com/testing-containers-serverspec-and-localstack/</guid><category><![CDATA[TDD]]></category><category><![CDATA[ServerSpec]]></category><category><![CDATA[AWS]]></category><category><![CDATA[localstack]]></category><pubDate>Mon, 21 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bd8f606798f32990e9c6c77dcf2c514a/5a46d/localstack.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 52.12765957446809%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42lWQTauqUBSGzx/sClHOHGoUB3IQ/YKmSQnRn2jW2BskRYRBe1Ka5TZQkTT6MvzcrsNNzumeZ7DYe20e3rXXBwB4nscwjCAIoij2er3BYNDtdjudTr/fHw6HRbP/QhRFQRDK5TLGGAA+AMBxHJ7nCSHwwvd9hJBhGAih2+0GAHme/9Q0TTmO2+12b7nZbMZxDABRFE0mkzRNAeDxeMiyvFwuEULFa57nYRiyLKvr+q/kPM+DIFgsFofDAQCu1+vlcnk+n0mSGIahKMp6vb7f74QQlmV/JfM8n2XZfD73PA8A4jg2TTMMwyAITNNMkiTLMt/3Z7NZHMe1Wu0t27bdbrdN0yyGKWazLOt0Ormua9t2FEXFh3Vdxxh/fn5qmvaWW62W67oIoWJnRc75fC4qIaSQEUKO4zQajXeyZVk8zwPAdrtVVdX7xjTN4/H4c1VVdbPZEEI4jnsnu65br9c1TcMYy7IsSdLfF5MXxVmSpOl0ijHWNI1hmP1+/09WFGU8Hler1VKpRFEUTdPVbyqVSvU/aJqmKOrPi9FotFqtvgAifNvzOy73MQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Localstack&quot; title=&quot;&quot; src=&quot;/static/bd8f606798f32990e9c6c77dcf2c514a/5a46d/localstack.png&quot; srcset=&quot;/static/bd8f606798f32990e9c6c77dcf2c514a/4dcb9/localstack.png 188w,
/static/bd8f606798f32990e9c6c77dcf2c514a/5a46d/localstack.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;I recently spoke at a meetup where I talked about &lt;a href=&quot;https://github.com/sirech/talks/blob/master/2019-01-tw-tdd_containers.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TDD for containers&lt;/a&gt; using &lt;a href=&quot;https://serverspec.org&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ServerSpec&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There I showed an example based on my current project. We have some containerized applications that are fetching secrets from &lt;a href=&quot;https://aws.amazon.com/secrets-manager/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS Secrets Manager&lt;/a&gt;. Testing that is tricky because of the dependency to &lt;em&gt;ASM&lt;/em&gt;. Thanks to &lt;a href=&quot;https://github.com/localstack/localstack&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;localstack&lt;/a&gt;, you can write meaningful tests by mocking those dependencies. If you just want the code it can be found &lt;a href=&quot;https://github.com/sirech/example-serverspec-aws&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;. If you can spare me some minutes I’ll go over it in more detail.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;The initial image&lt;/h2&gt;
&lt;p&gt;Let’s say you have an existing &lt;em&gt;Node.js&lt;/em&gt; application that is being packaged. Following a &lt;em&gt;TDD&lt;/em&gt; approach, you could arrive at tests like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;require_relative &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;spec_helper&apos;&lt;/span&gt;&lt;/span&gt;

describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Application Container&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  describe file&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/etc/alpine-release&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    its&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex-literal&quot;&gt;&lt;span class=&quot;token regex&quot;&gt;/3.8.2/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;node&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    describe command&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;node --version&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      its&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:stdout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex-literal&quot;&gt;&lt;span class=&quot;token regex&quot;&gt;/11.6/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    describe process&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;node&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      it &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to be_running &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      its&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to contain&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app.js&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      its&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to eq&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;runner&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;listens to correct port&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      it &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; wait_for&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to be_listening&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;with&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;tcp&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;


  describe file&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app.js&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    it &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to be_file &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which is implemented by the following &lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; node:11.6-alpine&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /app&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# hadolint ignore=DL3018,DL3013&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apk update --no-cache &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  apk add --no-cache bash jq &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  rm -rf /var/cache/apk/*&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; package.json .&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yarn&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; app.js .&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; adduser -D runner&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;USER&lt;/span&gt; runner&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SHELL&lt;/span&gt; [&lt;span class=&quot;token string&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;-o&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;pipefail&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CMD&lt;/span&gt; [&lt;span class=&quot;token string&quot;&gt;&quot;node&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;app.js&quot;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What if we get extra requirements? Our application is going to make use of some secrets. Namely:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;there will be a secret named &lt;code class=&quot;language-text&quot;&gt;SECRET&lt;/code&gt; with the value &lt;code class=&quot;language-text&quot;&gt;localstack_secret&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;our &lt;code class=&quot;language-text&quot;&gt;GET /secret&lt;/code&gt; route will output &lt;code class=&quot;language-text&quot;&gt;The super secret value is ${SECRET}&lt;/code&gt; (this app trusts its callers a bit too much!)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This changes everything! Our app needs some dependencies, and that influences the tests as well. Let’s see how.&lt;/p&gt;
&lt;h2&gt;Injecting secrets into the container&lt;/h2&gt;
&lt;p&gt;We are going to be injecting the secrets at runtime. You can find the pitfalls of writing them at build time in &lt;a href=&quot;https://medium.com/@mccode/dont-embed-configuration-or-secrets-in-docker-images-7b2e0f916fdd&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;plenty of other posts&lt;/a&gt;, so let’s 👋 that.&lt;/p&gt;
&lt;p&gt;A second requirement is that we want to make the secret handling transparent to our existing app. The app will get the secrets injected as environment variables. We’ll achieve this by adding an &lt;code class=&quot;language-text&quot;&gt;ENTRYPOINT&lt;/code&gt; to our image that takes care of fetching the secrets.&lt;/p&gt;
&lt;p&gt;We’ll be storing our secrets in &lt;em&gt;ASM&lt;/em&gt;. This is how the architecture looks like:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 717px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/27b33952d390a2795b796b39321bde6a/0ad97/arch.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVR42pWTS08TYRSGG01cGP+AO/+cunBl2Lhho8DGRCPGmEgUWeBOaoFgKUk7hSoKlXDpFCml7TDT25SZKb1MO9fHzBRMdGHwS97vLL4vzzkn5z0Rz/fRey4Nw6ZhWKjnzu84tD2C4/t+cHOVE+mYLvmqTWLziKXUHtFElqXULvvSAEV3Q1DACxK7vhfGv+VevAWJI+1+AHTIKxaHNSeEBxKrDrJ2CbxadWGFRt+j1DBptM4pKypluUm1qaO0elTUAa7nhh+LvTNSeol055RNq8F374xvTouMWUNoS2zoFTSrT0TveUjNPpqmUZYUShWZer2OqnfDRL3BIATez8W4uT7Fx2aex8koY7E5HsbmmNn9wlT1K5HEOCvNo1HLojwgX/MpnJxwXCxQUOHg1KRqePSHI+C9XIw72VdY/Q4baykSqxkyG1mk7S0yPYnrwgTx1jERo+dQ0uC0C0pRpCwm2ZM9JANkzWHo2OGA7x584vbmc4aDLjS2obKMU45DfYtVVeRaepK4WiBiurAQ3+J9dJmlQ4GZ+SiPxqeYjyWRWjaOP7LOg/wyt1KTzOynmcut825/jdfZFWZ30oztLHJDmOBz0HLfhujqNrMLizxLTfPk5TRPX7zlzYcYtbaP53kXQ9EQjEo4FKErI5h10madVEcifS6R0SU0yxy1XDwDuQ0/yirJn3kkHYrqqOXAhP9lm8DYomJzWHUQqxaiMgz9mFOcEfAvY/9LobEvVy9YtVbHvZAT6s/Vu1qFvwCkt3AAH7493QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Architecture&quot; title=&quot;&quot; src=&quot;/static/27b33952d390a2795b796b39321bde6a/0ad97/arch.png&quot; srcset=&quot;/static/27b33952d390a2795b796b39321bde6a/4dcb9/arch.png 188w,
/static/27b33952d390a2795b796b39321bde6a/5ff7e/arch.png 375w,
/static/27b33952d390a2795b796b39321bde6a/0ad97/arch.png 717w&quot; sizes=&quot;(max-width: 717px) 100vw, 717px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;h3&gt;Extending the app&lt;/h3&gt;
&lt;p&gt;Given that we are fully TDD compliant, let’s define the test that proves that our app is successfully returning the secret:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;describe &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fetches a secret from ASM&apos;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  it &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; wait_for&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex-literal&quot;&gt;&lt;span class=&quot;token regex&quot;&gt;/localstack_secret/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;secret&lt;/span&gt;&lt;/span&gt;
  command&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;curl localhost:3000/secret&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stdout
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;this is how the route is implemented in the app:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/secret&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;The super secret value is &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SECRET&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;this test will fail because we do not, in fact, provide the secret to the app. But we will!&lt;/p&gt;
&lt;h3&gt;Providing the secret&lt;/h3&gt;
&lt;p&gt;So as I said, there will be an &lt;em&gt;entrypoint&lt;/em&gt; for this. We start with the test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;describe file&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/usr/sbin/entrypoint.sh&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  it &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; is_expected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to be_file &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;the &lt;em&gt;entrypoint&lt;/em&gt; itself will use the &lt;a href=&quot;https://aws.amazon.com/cli/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;awscli&lt;/a&gt; to fetch the secrets. It looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;aws --endpoint-url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://localstack:4584 &lt;span class=&quot;token parameter variable&quot;&gt;--region&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${AWS_REGION}&lt;/span&gt;&quot;&lt;/span&gt; secretsmanager get-secret-value --secret-id &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${SECRET_KEY}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq &lt;span class=&quot;token parameter variable&quot;&gt;-r&lt;/span&gt; .SecretString&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;SECRET&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$secret&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that for a production image, you might be better served using something like &lt;a href=&quot;https://github.com/glassechidna/pstore&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pstore&lt;/a&gt; instead.&lt;/p&gt;
&lt;p&gt;Regardless, we need to modify our &lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt; bit to integrate this. There are some things to do. We need to add &lt;code class=&quot;language-text&quot;&gt;awscli&lt;/code&gt; as a dependency and we need to add our &lt;em&gt;entrypoint&lt;/em&gt; and make sure it runs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# hadolint ignore=DL3018,DL3013&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apk update --no-cache &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  apk add --no-cache bash jq python py-pip curl &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  pip --no-cache-dir install --upgrade pip awscli &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  apk -v --purge del py-pip &amp;amp;&amp;amp; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
  rm -rf /var/cache/apk/*&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; entrypoint.sh /usr/sbin/entrypoint.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENTRYPOINT&lt;/span&gt; [&lt;span class=&quot;token string&quot;&gt;&quot;/usr/sbin/entrypoint.sh&quot;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So everything should be ready! Now we can just run the tests and see that … they all fail. Including the old ones that were perfectly green before.&lt;/p&gt;
&lt;h2&gt;Introducing dependencies&lt;/h2&gt;
&lt;p&gt;Our container does not work anymore because it is trying to access &lt;em&gt;ASM&lt;/em&gt; at runtime and failing. The dreaded dependencies are sabotaging our tests once again. A solution like logging into &lt;em&gt;AWS&lt;/em&gt; and fetching the real secret feels unsatisfactory. What else to do?&lt;/p&gt;
&lt;p&gt;Enter &lt;em&gt;localstack&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Thanks to this &lt;a href=&quot;https://www.thoughtworks.com/radar/tools/localstack&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;awesome project&lt;/a&gt; we can mock &lt;em&gt;AWS&lt;/em&gt; dependencies and keep our tests running (almost) transparently. First, we need to orchestrate our app so that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;localstack&lt;/em&gt; gets started and serves a replica of &lt;em&gt;ASM&lt;/em&gt; in port 4584&lt;/li&gt;
&lt;li&gt;an init container gets executed to inject a secret into &lt;em&gt;ASM&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;our application is booted with &lt;em&gt;localstack&lt;/em&gt; as a dependency, so that fetching secrets works&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;we do this by using &lt;a href=&quot;https://docs.docker.com/compose/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docker Compose&lt;/a&gt;. The full includes the three elements, gracefully orchestrated together:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;localstack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localstack
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localstack/localstack

    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4584:4584&quot;&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DEFAULT_REGION=eu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;central&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; SERVICES=secretsmanager

  &lt;span class=&quot;token key atrule&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; init
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./init

    &lt;span class=&quot;token key atrule&quot;&gt;env_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .env

    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; localstack

    &lt;span class=&quot;token key atrule&quot;&gt;links&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; localstack

  &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; app
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./app

    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3000:3000&quot;&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;env_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .env

    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; init

    &lt;span class=&quot;token key atrule&quot;&gt;links&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; localstack&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt; container is just ruby alpine executing this script:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;asm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Aws&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;SecretsManager&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Client&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;AWS_REGION&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://localstack:4584&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
asm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_secret&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;SECRET_KEY&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;secret_string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;localstack_secret&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;the &lt;em&gt;entrypoint&lt;/em&gt;  from the beginning needs to account for the url, so we change it to &lt;code class=&quot;language-text&quot;&gt;aws --endpoint-url=http://localstack:4584&lt;/code&gt;. We can pick the URL based on the environment for a full example.&lt;/p&gt;
&lt;p&gt;With this we are almost done. We just need to tell &lt;code class=&quot;language-text&quot;&gt;ServerSpec&lt;/code&gt; to use &lt;code class=&quot;language-text&quot;&gt;docker-compose&lt;/code&gt; to start up our container setup, which can be done in the &lt;code class=&quot;language-text&quot;&gt;rails_helper.rb&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;serverspec&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;docker&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;docker/compose&apos;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;rspec/wait&apos;&lt;/span&gt;&lt;/span&gt;

set &lt;span class=&quot;token symbol&quot;&gt;:backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:docker&lt;/span&gt;
set &lt;span class=&quot;token symbol&quot;&gt;:docker_container&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;app&apos;&lt;/span&gt;&lt;/span&gt;

RSpec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wait_timeout &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# seconds&lt;/span&gt;

  compose &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Docker&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Compose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;

  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    compose&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;up&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;detached&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;after&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    compose&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kill
    compose&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;rm&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;force&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And that is basically it! Now our tests run perfectly fine. We have containers that are interacting with a secret store that have a good test suite to make sure everything runs correctly. It does not get much more &lt;em&gt;TDD’ish&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;What’s next?&lt;/h2&gt;
&lt;p&gt;There is a but (isn’t always one?). As of today, &lt;em&gt;localstack&lt;/em&gt; can only store one secret in its implementation, so if your container relies on fetching more than one secret it won’t be able to find them all. This has been recently patched in &lt;a href=&quot;https://github.com/spulec/moto/pull/1898&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;moto&lt;/a&gt;, the library underneath, and it is just waiting for the next release of &lt;em&gt;localstack&lt;/em&gt; to be available. After that, no secret will be safe from mocking.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using AWS Secrets Manager in Concourse]]></title><description><![CDATA[Connecting Concourse CI with AWS Secrets Manager offers you a way of conveniently using secrets in a safe manner]]></description><link>https://hceris.com/using-asm-in-concourse/</link><guid isPermaLink="false">https://hceris.com/using-asm-in-concourse/</guid><category><![CDATA[Continuous integration]]></category><category><![CDATA[Terraform]]></category><category><![CDATA[AWS Secrets Manager]]></category><category><![CDATA[Concourse CI]]></category><pubDate>Mon, 26 Nov 2018 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/10dbb304c8c5ad37269239e7a1855de6/fc83b/lock.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 77.12765957446808%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGLDqppFIf/xAAbEAADAAMBAQAAAAAAAAAAAAABAgMEERIAIf/aAAgBAQABBQLMrTvHu+h9DS69p0M0Kj//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAACAgIDAAAAAAAAAAAAAAAAARExAiESI1H/2gAIAQEABj8C44aSO2vYJRZEJj3bk//EABsQAQACAwEBAAAAAAAAAAAAAAEAIRExQVFx/9oACAEBAAE/IQWu47G4FpWyIJBHpDS9cmMvvXXyZ2voT//aAAwDAQACAAMAAAAQsM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAEAAgICAwAAAAAAAAAAAAABABEhUTFhscHR/9oACAEBAAE/EL/MBei03ohjdCy7rzMsJhLGAShyV+oNhcCwe6gowxGILXyf/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Keeping it secret&quot; title=&quot;&quot; src=&quot;/static/10dbb304c8c5ad37269239e7a1855de6/acb04/lock.jpg&quot; srcset=&quot;/static/10dbb304c8c5ad37269239e7a1855de6/bc01b/lock.jpg 188w,
/static/10dbb304c8c5ad37269239e7a1855de6/bf173/lock.jpg 375w,
/static/10dbb304c8c5ad37269239e7a1855de6/acb04/lock.jpg 750w,
/static/10dbb304c8c5ad37269239e7a1855de6/ec605/lock.jpg 1125w,
/static/10dbb304c8c5ad37269239e7a1855de6/c58a3/lock.jpg 1500w,
/static/10dbb304c8c5ad37269239e7a1855de6/fc83b/lock.jpg 1556w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
    &lt;small class=&quot;figure__attribution&quot;&gt;
      &lt;span class=&quot;figure__attribution-link&quot;&gt;
        by FreeImages.com/Braden Hays
      &lt;/span&gt;
    &lt;/small&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;When I wrote about &lt;a href=&quot;../modernizing-your-build-pipelines&quot;&gt;modernizing build pipelines&lt;/a&gt; I had a ton of content left that did not quite fit the article. I am going to dump some of that here as small articles. I believe they could be useful as a starting point to go towards a better &lt;em&gt;CI&lt;/em&gt; setup.&lt;/p&gt;
&lt;p&gt;The first thing I want to talk about is connecting &lt;a href=&quot;https://concourse-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Concourse CI&lt;/a&gt; with &lt;a href=&quot;https://aws.amazon.com/secrets-manager/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;AWS Secrets Manager&lt;/a&gt;. Why would you want to do that, I picture you asking?&lt;/p&gt;
&lt;p&gt;Well, if you have pipelines building stuff, they will probably want to access some secrets at some point. It could be a deploy key to access &lt;em&gt;Github&lt;/em&gt;, or credentials for &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; or something else. You don’t want to store this in plaintext. If you have had to maintain credentials manually for something like &lt;a href=&quot;https://jenkins.io/doc/book/using/using-credentials/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jenkins&lt;/a&gt; you know that can really suck. But it does not have to. An alternative is to connect &lt;code class=&quot;language-text&quot;&gt;Concourse&lt;/code&gt; and the &lt;code class=&quot;language-text&quot;&gt;AWS Secrets Manager&lt;/code&gt;, using &lt;a href=&quot;https://www.terraform.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; to keep everything as code.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;&lt;em&gt;Concourse&lt;/em&gt; supports a bunch of &lt;a href=&quot;https://concourse-ci.org/creds.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;credentials managers&lt;/a&gt; out of the box. Once you have it configured, your jobs and tasks can access secrets in a very convenient way. It looks as simple as this&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;platform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; linux
&lt;span class=&quot;token key atrule&quot;&gt;inputs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; shared&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;tasks
&lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;NPM_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ((npm_auth_token))
&lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sh
  &lt;span class=&quot;token key atrule&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; git
  &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ec
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
    ../shared-tasks/scripts/install-yarn-packages.sh
    ./go linter-js&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;with that, the &lt;em&gt;linter&lt;/em&gt; task will have access to the &lt;code class=&quot;language-text&quot;&gt;NPM_TOKEN&lt;/code&gt;, which is needed to pull from a private &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; repository, in a safe manner. But with a lot of convenience for whoever is writing this pipeline and doesn’t want to do a lot of plumbing.&lt;/p&gt;
&lt;h3&gt;I gotta get me some of this&lt;/h3&gt;
&lt;p&gt;First, concourse needs to be started with the right settings, so that it will know to use &lt;code class=&quot;language-text&quot;&gt;ASM&lt;/code&gt; with the right region, and the right path&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/usr/local/bin/concourse web &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --aws-secretsmanager-region&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;us-east-1 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --aws-secretsmanager-team-secret-template&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/concourse-ci/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;.Secret&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --aws-secretsmanager-pipeline-secret-template&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/concourse-ci/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;.Secret&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can use a lot more granularity, and have a &lt;code class=&quot;language-text&quot;&gt;{{.Team}}&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;{{.Pipeline}}&lt;/code&gt; in there, but for this case we want just simple secrets. With this, the instance will be able to find the secrets under the given path with the syntax mentioned above.&lt;/p&gt;
&lt;h3&gt;Give me the rights&lt;/h3&gt;
&lt;p&gt;We are not yet there, though. &lt;em&gt;Concourse&lt;/em&gt; needs to be able to access those secrets. You can pass it credentials, but a more secure method is to define an &lt;em&gt;IAM Role&lt;/em&gt;, as the documentation mentions. This example will work if you are running your CI on EC2. First, the policy&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_policy&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;policy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;aws_iam_policy_document&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_policy_document&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;statement&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow&quot;&lt;/span&gt;

    &lt;span class=&quot;token property&quot;&gt;actions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;secretsmanager:DescribeSecret&quot;&lt;/span&gt;,
      &lt;span class=&quot;token string&quot;&gt;&quot;secretsmanager:GetSecretValue&quot;&lt;/span&gt;,
      &lt;span class=&quot;token string&quot;&gt;&quot;kms:Decrypt&quot;&lt;/span&gt;,
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token property&quot;&gt;resources&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:secretsmanager:*:*:secret:concourse-ci/*&quot;&lt;/span&gt;,
      &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:secretsmanager:*:*:secret:/concourse-ci/*&quot;&lt;/span&gt;,
      &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;formatlist&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:kms:*:*:key/%s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;asm_key_ids&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;,
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then that policy gets connected to a role that is assumed by EC2&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_role&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt;               &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci-web&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;assume_role_policy&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token type variable&quot;&gt;aws_iam_policy_document&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;assume_role_policy_ec2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_instance_profile&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;role&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;resource &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_role_policy_attachment&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;concourse-ci-web&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;policy_arn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_policy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arn&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;role&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;aws_iam_role&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concourse-ci-web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and finally the policy for assuming the role&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hcl&quot;&gt;&lt;pre class=&quot;language-hcl&quot;&gt;&lt;code class=&quot;language-hcl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;data &lt;span class=&quot;token type variable&quot;&gt;&quot;aws_iam_policy_document&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;assume_role_policy_ec2&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;statement&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;effect&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Allow&quot;&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;actions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sts:AssumeRole&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;principals&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;type&lt;/span&gt;        &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Service&quot;&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;identifiers&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ec2.amazonaws.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;That’s it?&lt;/h3&gt;
&lt;p&gt;Well, mostly. The example is not complete, and there will be some more code needed to make it work, but this is the gist of it. The best part is that you set it up once, and then you can access the secrets that you define in that namespace, just like that.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Modernizing your build pipelines]]></title><description><![CDATA[This article about modernizing pipelines got published in our blog: www.thoughtworks.com/insights/blog/modernizing-your-build-pipelines]]></description><link>https://hceris.com/modernizing-your-build-pipelines/</link><guid isPermaLink="false">https://hceris.com/modernizing-your-build-pipelines/</guid><category><![CDATA[Continuous integration]]></category><pubDate>Fri, 02 Nov 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been writing an article about modernizing build pipelines and it finally got published in our &lt;a href=&quot;https://www.thoughtworks.com/insights&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Insights Blog&lt;/a&gt;: &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/modernizing-your-build-pipelines&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://www.thoughtworks.com/insights/blog/modernizing-your-build-pipelines&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It ended up being pretty long, but it condenses a couple of months of work. I hope it is useful for anybody who actually reaches the end of it!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Migrating to Gatsby 2]]></title><description><![CDATA[Gatsby 2 is out! How did the migration go?]]></description><link>https://hceris.com/migrating-to-gatsby2/</link><guid isPermaLink="false">https://hceris.com/migrating-to-gatsby2/</guid><category><![CDATA[React]]></category><category><![CDATA[Gatsby]]></category><pubDate>Wed, 03 Oct 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been using &lt;a href=&quot;https://www.gatsbyjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Gatsby&lt;/a&gt; for about 6 months, and I am quite &lt;a href=&quot;../migrating-to-gatsby&quot;&gt;happy with it&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Recently &lt;em&gt;Version 2&lt;/em&gt; was &lt;a href=&quot;https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;released&lt;/a&gt;. It has quite a few improvements. It is faster, smaller, and it brings major library updates:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;React 16.5&lt;/li&gt;
&lt;li&gt;Webpack 4&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://babeljs.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Babel 7&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The official documentation has a &lt;a href=&quot;https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;comprehensive migration guide&lt;/a&gt;, which is what I followed. I had to spend some extra effort to get everything running again, though.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Removing old plugins&lt;/h2&gt;
&lt;p&gt;I had some plugins that either stopped working or that I actually did not use at all, so I did some cleanup. &lt;code class=&quot;language-text&quot;&gt;gatsby-plugin-manifest&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;gatsby-plugin-google-analytics&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;gatsby-plugin-react-next&lt;/code&gt; are out. Conversely, I added &lt;code class=&quot;language-text&quot;&gt;gatsby-plugin-layout&lt;/code&gt;, as &lt;em&gt;Gatsby 2&lt;/em&gt; has changed how the main layout works, and I did not want to change too much at once.&lt;/p&gt;
&lt;h2&gt;Missing favicon&lt;/h2&gt;
&lt;p&gt;I had my &lt;em&gt;favicon&lt;/em&gt; under &lt;em&gt;static/img&lt;/em&gt;, which stopped working. Instead I went with another plugin &lt;a href=&quot;https://github.com/Creatiwity/gatsby-plugin-favicon&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;gatsby-plugin-favicon&lt;/a&gt;, which works basically out of the box.&lt;/p&gt;
&lt;h2&gt;Global styles&lt;/h2&gt;
&lt;p&gt;I mostly use &lt;a href=&quot;https://github.com/css-modules/css-modules&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CSS Modules&lt;/a&gt; for styling, but I have some global styles that I use for convenience and to style &lt;a href=&quot;https://github.com/xtianmiller/emergence.js/blob/master/README.md&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;emergence&lt;/a&gt;. It seems that &lt;em&gt;Gatsby 2&lt;/em&gt; is stricter about how assets are imported, as these stylings were not being applied anymore. I had to extract them from a component to a proper &lt;a href=&quot;https://github.com/sirech/homepage2/blob/master/src/layouts/globals.scss&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;global file&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Babel 7 and Jest&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Babel 7&lt;/em&gt; and &lt;em&gt;Jest&lt;/em&gt; do not play nice with each other, as &lt;a href=&quot;https://www.google.de/search?q=jest+babel+7&amp;#x26;oq=jest+babel+7&amp;#x26;aqs=chrome..69i57j69i60l3j0l2.3871j0j7&amp;#x26;sourceid=chrome&amp;#x26;ie=UTF-8&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;many&lt;/a&gt; resources illustrate. Getting this to work without breaking the normal compilation process took me some time to figure out. In the end I am doing it through the &lt;em&gt;Jest&lt;/em&gt; configuration.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;moduleNameMapper&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string-property property&quot;&gt;&apos;\\.(jpg|jpeg|png|svg|woff|woff2)$&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;rootDir&gt;/__mocks__/fileMock.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string-property property&quot;&gt;&apos;^.*\\.s?css$&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;identity-obj-proxy&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string-property property&quot;&gt;&apos;^.+\\.jsx?$&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./jest/transformer.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;setupFiles&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;rootDir&gt;/setupTests.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;testPathIgnorePatterns&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/node_modules/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;rootDir&gt;/.cache/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;globals&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;__PATH_PREFIX__&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I am using a custom transformer that applies the new &lt;em&gt;Babel&lt;/em&gt; presets, like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;babelrc&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;presets&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;@babel/preset-env&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@babel/preset-react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;babel-jest&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createTransformer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I ended up having to install some extra dependencies:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yarn add --dev babel-jest babel-core@^7.0.0-bridge.0 @babel/core regenerator-runtime&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This made it work although it is a bit fragile. Trying to stop using &lt;code class=&quot;language-text&quot;&gt;graphql&lt;/code&gt; as a global gave me a lot of errors, for instance.&lt;/p&gt;
&lt;h2&gt;Up and running&lt;/h2&gt;
&lt;p&gt;And that is basically it, now the whole site runs on the most modern version of most packages, which is great. I am looking forward to use some of the new &lt;em&gt;fancy&lt;/em&gt; features at some point.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Recording APIs with WireMock]]></title><description><![CDATA[Using WireMock to record third party API calls you can get high quality mocks that reflect reality and are much easier to maintain]]></description><link>https://hceris.com/recording-apis-with-wiremock/</link><guid isPermaLink="false">https://hceris.com/recording-apis-with-wiremock/</guid><category><![CDATA[Java]]></category><category><![CDATA[WireMock]]></category><category><![CDATA[SpringBoot]]></category><category><![CDATA[Testing]]></category><pubDate>Mon, 10 Sep 2018 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--right&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f848aea11cf8e83b7deb3b37a8b8ed63/01e7c/cassette.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFhUlEQVR42p2Ua2xTZRjHn7WIi0oYbmPLzGi7y+nac3pv1yt2a8toB203Wtaul23dDWa70a4tbFyGBidjRlDYACcmimEUoxAgiLgF+WCGOmYWQ0AxKiqihiB+IkDb85gz/Ghi4pO8yfvl/8v/uQL8j1iyZAnk5uaCXC7P0Wq1ORMTE/8tslqtgIhQUJAPLpcrJxbrZ0XCYXaos5ftbB5gR2ObWcuXF4FMJgODwQArV658LFQoFLBz506oq6tbECYSW1jDwyPs4ZFxdkvPO6xDVzDHUQ2QDNugb0MjhFq9YHdtgEikD/Ly8p6RSCT5Go0G1Go1FBcXA8TjcbDbHSzGzXr3GkjGm2F4VxJ27x6B1o3jMP4ZwloFLEuG68iQf9Vqt8sebXT7D9vtjimbzXaztrZ2Pj8/fwkDKy8vB0gkEmAymRfSa3BaijbHPYotye51m/oiW6PxXUejm/dfDieP/BSKHnvY0n8WW7Z8jr7El7jW6cU1a6y4qq4OZTJZNZO6SqViQSAQKAyFQqmRkd1XBwdf/KN/4GQ2MTSD/S9dw/DQj9ix4zdsHfoLm7feoQM77qabt/6aaYpfTTtcHWgx16DeYEClUhliamg0GtnQ1NRUlUgk8fDhgxiNbcXu/mvYO/RnunvwZro1MZ/2913IeF84nnX496DRugEtNm/abLGly8srbpeWls5zOJxvCYLYV1ZWBjwejwUatbpgdHT0zvj4QRwcHMgEQi/SrR07sz5/V2Zdo5OuNWpQLFyBBcuenLatrp0b3fMKHjo0jntGRi4XFhaali5dapdIJJNMg0mSBKipNT/V3t5+vaO9FT1N67LRvm4cH9uHr+97DbcNJrDWIMlq5ARaavVvnTx1+uvR0VenjqdS705PT+Pk5LE4ACzT6/WTBEGU8fn8x6PTEvRd6gwFMNzTkUmlUvTkZOpKKnXi0zNnzj6KhkMoripBv6fh3tzcV7cCAb8FAEr37t37y4H9+48CgEEmkx2gKKpOLBYDfHL+JLS1Bk5FetpxaFscZ2Zm7h4/ngoEAn79hydP3RhI9iK/rAjVSmr2xo3vLs7Ozt766Ny52QsXPr49Nn6w+rniZzsFVcR0ZSXRSYnEAIn+Xgj4vYeTsY24Odr56IMT7+H8/Pz1qampi28fefNBtYxPU1UrUExWnPYHgt7hl3f93B/bhPX1tqsURV2SSqU/iMVipChqQiqTATQ2OKGxsWF7b08bDsS7M+HuAL19MI7JeBQda1ejzWqh1zU60e1y3Xe53ffNZnNGo9Fk1Go1KhQKZGD/AL8YGxsD8Hi94HA4Qxu6u7CvN5zt6uqkvR5P1ufzZdrbO+jOzi5sawvRHo8HrVYrmkwmNBgMqFKpaLlcnhGJRGmRSMQAf+dwOCXg8/mYQ7A2EolgT09P1uPxLkBaWlropqYm2maz0TU1NbRer89qtdqsWq3OMCCZTJYmSTItEAiyEokENRoN8ni856GhoQEsFos8GAxiMBik169fnw2FQtnm5uaM3W7P1NfXp00mU9poNNI6nQ6rq6uRATCuhEIhEgTB/B9KJJLveTxeOQODmpoantvtvu/3+2mHw4EWiwWdTudCakajEZl6URSFJEnek0ql31AUdZ4kyTf4fH6EIIj6qqoqYV5eXm5RURFASUkJFBQUPG02m2+azWbG+gOFQnFbqVTOiUSi90Ui0S6SJIMVFRUrORzOCgB4gsfjgVQqBWbuCIIAoVAIXC4XFoA6nS5Hp9OBQCAQC4XCRi6XK1m8eHEBc30YkUqlAqVSCZWVlVBaWrqwCFwuN0cul7MUCgVbIBCw+Xx+DofDgVgsBmAymZiXIxAIFgDMki9atGjhnInFYpZOp2NrtVq2SCRiMcLCwkJgVoxx9m/xN327NkprVh7QAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Recording the API&quot; title=&quot;&quot; src=&quot;/static/f848aea11cf8e83b7deb3b37a8b8ed63/01e7c/cassette.png&quot; srcset=&quot;/static/f848aea11cf8e83b7deb3b37a8b8ed63/4dcb9/cassette.png 188w,
/static/f848aea11cf8e83b7deb3b37a8b8ed63/5ff7e/cassette.png 375w,
/static/f848aea11cf8e83b7deb3b37a8b8ed63/01e7c/cassette.png 512w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;When an application depends on a third party API, you always seem to face similar challenges. Do you integrate against it, even in development? What about the tests, won’t they be flaky if the API needs to be there?&lt;/p&gt;
&lt;p&gt;Meanwhile, if you decide to use stubs, how sure are you that the application is, well, working? I can’t remember how many times I have had perfectly green tests based on mocks that were not testing anything, because the API had changed in some way.&lt;/p&gt;
&lt;p&gt;Recently I’ve been thinking about this, and I have tried to address this through API recordings.
I know this idea from the Ruby world, concretely &lt;a href=&quot;https://github.com/vcr/vcr&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;VCR&lt;/a&gt;. This time, however, I wanted to use it in a &lt;em&gt;Java&lt;/em&gt; project, so I looked at &lt;a href=&quot;http://wiremock.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;WireMock&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Why?&lt;/h2&gt;
&lt;p&gt;Following the &lt;a href=&quot;https://martinfowler.com/bliki/TestPyramid.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Testing Pyramid&lt;/a&gt;, we want to have most of our tests at the lowest possible level. Unit tests should not be doing network requests. On the other hand, if we use mocks, they should be close to the source, ideally based on actual requests.&lt;/p&gt;
&lt;p&gt;If we have these mocks already, why not use them for our local development? I want my app to boot and quickly show something, again without the need to connect to the outside.&lt;/p&gt;
&lt;p&gt;And, I want automation. Editing &lt;code class=&quot;language-text&quot;&gt;.json&lt;/code&gt; files by hand is a recipe for errors and outdated data. I want to avoid friction.&lt;/p&gt;
&lt;p&gt;Thanks to &lt;em&gt;WireMock&lt;/em&gt;, this process is very convenient and almost transparent to the app. A bit of plumbing is required, but it is &lt;em&gt;real easy&lt;/em&gt; to do.&lt;/p&gt;
&lt;h2&gt;Mock me!&lt;/h2&gt;
&lt;p&gt;I have this &lt;a href=&quot;https://github.com/sirech/example-wiremock-recorder&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;repository in Github&lt;/a&gt; with all the details. It can be summarized in one picture:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;img src=&quot;https://github.com/sirech/example-wiremock-recorder/raw/master/images/diagram.png&quot; alt=&quot;Recording the API&quot;&gt;
&lt;/figure&gt;
&lt;p&gt;For the example API, I took this very useful &lt;a href=&quot;https://jsonplaceholder.typicode.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;sample API&lt;/a&gt;. There are four pieces to take into account in this setup.&lt;/p&gt;
&lt;h3&gt;Production&lt;/h3&gt;
&lt;p&gt;The app in &lt;code class=&quot;language-text&quot;&gt;production&lt;/code&gt; mode goes directly to the API, just like that. The request is something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Todo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;todos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Todo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; template&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exchange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;/todos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;HttpMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ParameterizedTypeReference&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Todo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Development&lt;/h3&gt;
&lt;p&gt;For the development server, we rely on certain mocks being present, that we will serve transparently by starting a &lt;em&gt;WireMock&lt;/em&gt; server on startup. To do that in a &lt;a href=&quot;https://spring.io/projects/spring-boot&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Spring Boot&lt;/a&gt; project, we use this initializer:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MockServerInitializer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${mock.active}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; active&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${mock.port}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@EventListener&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onApplicationEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ContextRefreshedEvent&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;active&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is important to set &lt;code class=&quot;language-text&quot;&gt;mock.active&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; for any non-development environment. Other than that, the configuration points to the local server instead of the real API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;serverUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;$&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;mock.port&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Unit tests&lt;/h3&gt;
&lt;p&gt;The unit tests that need to use this mock data will use the same mocks from &lt;em&gt;WireMock&lt;/em&gt; that the development server uses. Activating the mocks is as easy as inheriting from the &lt;code class=&quot;language-text&quot;&gt;RecordedTest&lt;/code&gt; class, which looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RecordedTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${record.port}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Before&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@After&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;stopUsingMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Inheritance and &lt;code class=&quot;language-text&quot;&gt;@Before&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;@After&lt;/code&gt; annotations is perhaps not a best practice, but it makes the tests really succint. Defining additional behavior is easy by just defining extra &lt;em&gt;WireMock&lt;/em&gt; rules. This way you can test more specific scenarios like timeouts while keeping most of the regular code quite clean.&lt;/p&gt;
&lt;h3&gt;Integration tests&lt;/h3&gt;
&lt;p&gt;This is where everything comes together. Our integration tests make sure that the connection to the real API works. In the process, the interactions get recorded so that we can store that as the mocks that the rest of the app uses. To enable a test to become a &lt;code class=&quot;language-text&quot;&gt;RecordingTest&lt;/code&gt;, you need to inherit the class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RecordingTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${record.port}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recordingServerUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${record.persist}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; persistRecordings&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${record.extractBody}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; extractBody&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt; server&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Before&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setUp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startRecording&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@After&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tearDown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stopRecording&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RecordSpec&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recordSpec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forTarget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recordingServerUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;makeStubsPersistent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;persistRecordings&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractTextBodiesOver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;extractBody&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This class proxies all the requests to the real API, and stores them in the default folder when configured. The URL of the server that we want to integrate with is defined in the abstract method &lt;code class=&quot;language-text&quot;&gt;recordingServerUrl&lt;/code&gt;. This way each test can define a different endpoint, and we are not limited to a single external endpoint.&lt;/p&gt;
&lt;p&gt;Why not every time? We don’t want new files being created each time a test runs. Instead, this is a conscious decision, triggered with this script target:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function-name function&quot;&gt;goal_refresh-recordings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;RECORD_PERSIST&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true &lt;span class=&quot;token assign-left variable&quot;&gt;RECORD_EXTRACTBODY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; ./gradlew clean integration
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After that the new recordings are present and ready to be used. This can be done manually or integrated into a pipeline, to make sure that it happens often.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;NOTE:&lt;/em&gt; If the &lt;em&gt;Third Party API&lt;/em&gt; is secured through &lt;code class=&quot;language-text&quot;&gt;mTLS&lt;/code&gt;, you can still make this setup work by making &lt;em&gt;WireMock&lt;/em&gt; aware of the keystore that your code uses to connect to it, by creating a custom config for the &lt;em&gt;WireMock&lt;/em&gt; server:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WireMockServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trustStorePath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;javax.net.ssl.keyStore&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trustStorePassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;changeit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;The setup contains a bit of magic, but the result is quite simple to use. This way, you can achieve a great testing coverage without compromising the development experience, all while keeping your core unit tests slim and fast. If you have fought with out-of-sync mocks before, you will see the advantage!&lt;/p&gt;
&lt;p&gt;&lt;em&gt;EDIT 05/08/2019:&lt;/em&gt; Added support for multiple external APIs&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Replacing ESLint with prettier]]></title><description><![CDATA[I've started using Prettier for formatting my code. ESLint is now purely a linter. Both of them work together beautifully]]></description><link>https://hceris.com/replacing-eslint-with-prettier/</link><guid isPermaLink="false">https://hceris.com/replacing-eslint-with-prettier/</guid><category><![CDATA[JavaScript]]></category><category><![CDATA[prettier]]></category><category><![CDATA[eslint]]></category><pubDate>Wed, 29 Aug 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As I mentioned &lt;a href=&quot;../angular-from-react-part1/#linting&quot;&gt;while talking about Angular&lt;/a&gt;, I have been thinking lately about what should be the role of a linter on a project.&lt;/p&gt;
&lt;p&gt;I am a huge fan of linters in general. I love the idea of outsourcing pointless discussions about how to style code to a ruthless program that runs automatically. I imagine the pipeline laughing at whoever broke the build last and scolding them:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nothing personal, human, but if you do not put a space before that brace I will block your feature forever&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Linters can help with consistency throughout a codebase. They help catching potential errors as well. It is truly built-in quality almost for free.&lt;/p&gt;
&lt;p&gt;However, I have been using some tools lately, such as &lt;a href=&quot;https://www.terraform.io/docs/commands/fmt.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Terraform&lt;/a&gt; or &lt;a href=&quot;https://golang.org/pkg/fmt/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Go&lt;/a&gt;, that take this one step further, and include a tool to directly format the code, without a linting and fixing phase. It actually makes a lot of sense, if you think about it. Automated checking is the first step, but why bother fixing the problems manually when you can automate that step as well?&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Prettier&lt;/h2&gt;
&lt;p&gt;I have been using &lt;a href=&quot;https://github.com/prettier/prettier&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Prettier&lt;/a&gt; more and more in my projects. With this you can actually leave the formatting of the code to it, and use &lt;a href=&quot;https://eslint.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ESLint&lt;/a&gt; to catch other errors. I really like this combination. &lt;em&gt;ESLint&lt;/em&gt; can still provide plenty of value, but I leave getting my code aligned and formatted to a tool that runs as often as I like.&lt;/p&gt;
&lt;p&gt;Adding it to a project is really easy. You need to add the dependency first&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;yarn add --dev prettier&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then you can extend the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; with a target for it&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token property&quot;&gt;&quot;format&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;prettier --write \&quot;**/*.+(js|jsx|json|css|scss)\&quot;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can run this on commit. For this very blog if have it set up using &lt;a href=&quot;https://github.com/okonet/lint-staged&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;lint-staged&lt;/a&gt; like &lt;a href=&quot;https://github.com/sirech/homepage2/blob/master/package.json#L81-L100&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;And that is pretty (duh) much it. Neat and formatted code that you can share with people who obsess about these kind of details like you.&lt;/p&gt;
&lt;h3&gt;Play nice with ESLint&lt;/h3&gt;
&lt;p&gt;Now you don’t want your nicely formatted code to trigger a thousand &lt;em&gt;ESLint&lt;/em&gt; warnings. Luckily, somebody already thought of this. &lt;a href=&quot;https://github.com/prettier/eslint-config-prettier&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;eslint-config-prettier&lt;/a&gt; allows you to turn off these rules, so that both tools keep working together properly.&lt;/p&gt;
&lt;h3&gt;You want more?&lt;/h3&gt;
&lt;p&gt;Once you start with the formatting, you cannot stop. We already made it part of the commit hook, but why wait so long? Shouldn’t the editor run &lt;code class=&quot;language-text&quot;&gt;prettier&lt;/code&gt; automatically on save? You bet it should. In my case, as a faithful &lt;em&gt;Emacs/Spacemacs&lt;/em&gt; user, I again made use of a bunch of existing packages so that I get &lt;code class=&quot;language-text&quot;&gt;prettier&lt;/code&gt; run on my &lt;em&gt;JavaScript&lt;/em&gt; buffers on save. The config &lt;a href=&quot;https://github.com/sirech/spacemacs.d/blob/master/layers/aj-javascript/packages.el&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ain’t pretty&lt;/a&gt;, but it does the job.&lt;/p&gt;
&lt;h2&gt;Next&lt;/h2&gt;
&lt;p&gt;This is so cool, why keep it only for JS? I managed to integrate &lt;code class=&quot;language-text&quot;&gt;terraform fmt&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;gofmt&lt;/code&gt; already, and I wouldn’t mind doing something similar for every language that I have to touch (even &lt;em&gt;bash&lt;/em&gt;).&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setting up Traefik]]></title><description><![CDATA[Traefik is a cloud native reverse proxy. I want to show how to do load balancing, SSL termination, routing and Mutual TLS with it]]></description><link>https://hceris.com/setting-up-traefik/</link><guid isPermaLink="false">https://hceris.com/setting-up-traefik/</guid><category><![CDATA[Traefik]]></category><category><![CDATA[DevOps]]></category><category><![CDATA[Load Balancing]]></category><category><![CDATA[SSL Termination]]></category><category><![CDATA[mTLS]]></category><category><![CDATA[Smart Routing]]></category><pubDate>Thu, 16 Aug 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been setting up a new cloud based infrastructure for an application lately. As part of it, we had some requirements regarding load balancing, SSL and so on. As part of that I had the opportunity to evaluate &lt;a href=&quot;https://traefik.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Traefik&lt;/a&gt;. This a pretty cool tool that works as a Reverse Proxy (and more).&lt;/p&gt;
&lt;p&gt;Now, this sounds just like using &lt;a href=&quot;https://www.nginx.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;nginx&lt;/a&gt;, right? There is nothing new here. However, &lt;em&gt;Traefik&lt;/em&gt; is built with &lt;a href=&quot;https://www.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docker&lt;/a&gt; and the Cloud in mind, and it is quite lightweight and worth exploring.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Putting it together&lt;/h2&gt;
&lt;p&gt;I have set up a &lt;a href=&quot;https://github.com/sirech/traefik-test&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;repository in Github&lt;/a&gt; with a simple, practical demonstration. If you are using &lt;a href=&quot;https://docs.docker.com/compose/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;docker-compose&lt;/a&gt; to bind a bunch of containers together, it is basically ready to go!&lt;/p&gt;
&lt;p&gt;With this minimal setup you get:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Load balancing between different containers&lt;/li&gt;
&lt;li&gt;SSL Termination&lt;/li&gt;
&lt;li&gt;Automated discovery&lt;/li&gt;
&lt;li&gt;Routing&lt;/li&gt;
&lt;li&gt;And even mTLS if you need it&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It really packs a punch with a fairly small configuration effort.&lt;/p&gt;
&lt;h2&gt;Comparing it with nginx&lt;/h2&gt;
&lt;p&gt;If you check the &lt;a href=&quot;https://github.com/sirech/traefik-test/blob/master/traefik/traefik.toml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;configuration file&lt;/a&gt;, you see the basic setup to serve apps. For comparison, here is a config file to serve a static app in &lt;em&gt;nginx&lt;/em&gt; over https:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
    listen 80;
    server_name ${HOST};
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name ${HOST} www.${HOST};

    root /srv/main;

    ssl_certificate           /cert/live/${HOST}/fullchain.pem;
    ssl_certificate_key       /cert/live/${HOST}/privkey.pem;
    ssl_trusted_certificate   /cert/live/${HOST}/chain.pem;

    location / {
        rewrite ^([^.\?]*[^/])$ $1/ permanent;
        try_files $uri $uri/ $uri/index.html =404;

        gzip_static on;
        expires off;
        add_header Cache-Control &quot;no-store&quot;;
    }

    location ^~ /static/  {
        gzip_static on;
        expires max;
        add_header Cache-Control public;
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now something to note is that &lt;em&gt;nginx&lt;/em&gt; is a proper webserver while &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; is not. So this example actually serves assets. Even then, you can argue that the set up is quite similar, so why not stay with what is already there? There are two features that I really like from &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;The dashboard&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; gives you a really nice dashboard where you can see the actual connections between your services. Here is a screenshot:&lt;/p&gt;
&lt;figure class=&quot;figure&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/14e6f619c5778085e8d2df0dfc66073a/2adcb/traefik.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 61.702127659574465%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2ElEQVR42pWSS2sUQRRG+ze59bVy586Vims3Zqm4FdeuXPgf3IiSKOQFkSg6GgIuVCbziDGZJGTaflTfqu569JHuGQeFGSQXTt269fig6rtRLppcDKayWB+wzs/Feb9wr8V7dGmJRqnhONWIXowSTVpotDZoMcgcmnUlhmi1l/Pu6w92+0cMYs1gLBNimdX7iWbl8Iy33/b4cnRKPxP2EjWjlyi6ieIwK4ie7ihuLqfcXk648zrj1krKjVdTXiZcf5Hy+H3Gk8EJVz/2uPapz5VOn4udHpem+XKnx4UPezzqjoiULpHSUVjwoca4gHE1YgPKuHauSoeuKqoQKFxAvEecR3xTexJt2lo1f5jminH8qzVmLI4m6rpuRv6Ec56sMKTaI7Y9MN2ZZFsa8L49F+kiJ+iMY7FsH5X/CM2iduTGEmtPLI7K/u2wm3WBLiuizwcZb7oZa/vC1oGwNhQ2hsL6ULO5r1kdCDujidNNizU5m7o+j+j5d83DbeH+luLBlmrz0qZiaSPn3nrK3TXFs12FaENSLBZqadrGaI2vzJynNnWYTINvL2Ri/kuU5gVn45jTTNONbXu/cTvUE5r/L607h2CWUxSKn+LonFTYEAiNYJtDK3oewd9uzIZqVJOmSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Traefik&apos;s Dashboard&quot; title=&quot;&quot; src=&quot;/static/14e6f619c5778085e8d2df0dfc66073a/1d69c/traefik.png&quot; srcset=&quot;/static/14e6f619c5778085e8d2df0dfc66073a/4dcb9/traefik.png 188w,
/static/14e6f619c5778085e8d2df0dfc66073a/5ff7e/traefik.png 375w,
/static/14e6f619c5778085e8d2df0dfc66073a/1d69c/traefik.png 750w,
/static/14e6f619c5778085e8d2df0dfc66073a/78797/traefik.png 1125w,
/static/14e6f619c5778085e8d2df0dfc66073a/aa440/traefik.png 1500w,
/static/14e6f619c5778085e8d2df0dfc66073a/2adcb/traefik.png 1984w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/figure&gt;
&lt;p&gt;It is a small detail, but I really like having a visual overview of the state of my routes. This can be extremely helpful in the beginning, when you are still setting up services. I always found &lt;em&gt;nginx&lt;/em&gt; particularly obscure to debug when I had problems.&lt;/p&gt;
&lt;p&gt;But there is a bigger benefit than that…&lt;/p&gt;
&lt;h3&gt;Discovery&lt;/h3&gt;
&lt;p&gt;If you checked the configuration, you might have noticed that there are no services configured there. This is in my opinion the killer feature of &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt;. It can connect to the provider that you specify, in this case &lt;a href=&quot;https://docs.traefik.io/configuration/backends/docker/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;docker&lt;/a&gt;, and automatically fetch all the running containers for you, dynamically. Say goodbye to painfully creating a new configuration and adding it to your &lt;em&gt;nginx&lt;/em&gt; configuration, plus the required restart afterwards.&lt;/p&gt;
&lt;p&gt;The only need you need to do is adding some configuration every time you spin up a new service, to let &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; now how you want it to be reached. It really does not get much easier:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;labels:
  - &quot;traefik.backend=echo&quot;
  - &quot;traefik.frontend.entryPoints=https&quot;
  - &quot;traefik.frontend.rule=Host:echo.testing.com;Path:/standard&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this simple snippet, we are making &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; aware of our new service, and setting up an entrypoint and the routing to reach it. That’s it. You do not need to do anything else. The simplicity is really refreshing. For most cases I feel you will not need much more than this.&lt;/p&gt;
&lt;h2&gt;Pending ideas&lt;/h2&gt;
&lt;p&gt;There are more things to check, actually. &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; has a lot of routing posibilities, albeit less comprehensive than other reverse proxies. We have been considering doing some fancy header checks to route to different test systems that share the same url, which I might talk about in more detail when I actually have something more concrete.&lt;/p&gt;
&lt;p&gt;The other feature I am really keen to try out is &lt;a href=&quot;https://docs.traefik.io/configuration/acme/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;automated certificate configuration&lt;/a&gt; through &lt;a href=&quot;https://letsencrypt.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;LetsEncrypt&lt;/a&gt;. &lt;em&gt;LetsEncrypt&lt;/em&gt; alone is a life saver, it is extremely convenient to set up https for your domains. I use it for my website already through some custom scripts that call the &lt;a href=&quot;https://hub.docker.com/r/certbot/certbot/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;certbot docker container&lt;/a&gt;. However &lt;code class=&quot;language-text&quot;&gt;traefik&lt;/code&gt; takes this one step further by taking the task out of your hands altogether. I want to jump on this the moment I got a free moment.&lt;/p&gt;
&lt;h2&gt;Where to start?&lt;/h2&gt;
&lt;p&gt;I can only encourage reading &lt;a href=&quot;https://docs.traefik.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the starter guide&lt;/a&gt; first, to get everything running. Then I would read about the &lt;a href=&quot;https://docs.traefik.io/basics/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;basics&lt;/a&gt;, to understand the terminology and how everything is bound together. After that you can really start playing and experimenting. The &lt;a href=&quot;https://github.com/sirech/traefik-test&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;repository&lt;/a&gt; I posted can help you bootstrapping a bit the process.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Angular from the perspective of a React fan - Part 3]]></title><description><![CDATA[Third part of my series on Angular, coming from a React background. This article focus on state management]]></description><link>https://hceris.com/angular-from-react-part3/</link><guid isPermaLink="false">https://hceris.com/angular-from-react-part3/</guid><category><![CDATA[JavaScript]]></category><category><![CDATA[React]]></category><category><![CDATA[Angular]]></category><category><![CDATA[TypeScript]]></category><category><![CDATA[angular-cli]]></category><category><![CDATA[redux]]></category><pubDate>Sat, 07 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Angular Series&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part1/&quot;&gt;Part 1 - Bootstrapping and TypeScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part2/&quot;&gt;Part 2 - Testing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part3/&quot;&gt;&lt;strong&gt;Part 3 - State Management&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;When building a complex application, it is really important to think about how the data flows through it. I remember, back in the &lt;a href=&quot;https://jquery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;jQuery&lt;/a&gt; days, having code that would modify multiple unrelated parts of the page. It is a good thing we did not do a lot of unit testing back then, because that code was basically impossible to test.&lt;/p&gt;
&lt;p&gt;Still suffering PTSD from that, I instantly became a fan of &lt;a href=&quot;https://redux.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;redux&lt;/a&gt;, once I actually manage to understand how it works. Anyways, the &lt;a href=&quot;https://redux.js.org/basics/data-flow&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;unidirectional flow pattern&lt;/a&gt; is a very good way to alter the state of an application in a predictable way.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Angular&lt;/em&gt; has a bunch of different options to handle state. The project I am working on did not have somebody with a lot of experience in the matter when it was being set up, so I have seen many attempts to do this, stored in its history. Some of them failed quite spectacularly at making our life easier. I am still looking for a good way of treating state in &lt;em&gt;Angular&lt;/em&gt;, but at least I have learned a couple of lessons (the hard way) that I want to share. This are some examples of ways of modeling state in &lt;em&gt;Angular&lt;/em&gt; that I have seen and used.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Input/Output&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://angular.io/guide/component-interaction#pass-data-from-parent-to-child-with-input-binding&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Input/Output&lt;/a&gt; is basically the equivalent of &lt;a href=&quot;https://reactjs.org/docs/components-and-props.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;props in React&lt;/a&gt;. The state is not kept in the component, but injected from the outside. Whenever the component needs to trigger a notification, an &lt;em&gt;Output&lt;/em&gt; can be used with a callback.&lt;/p&gt;
&lt;p&gt;This is a fine way to manage state and create mostly components that are representational and don’t manage their own state. It has one drawback, shared with &lt;em&gt;props&lt;/em&gt;, which is that if your component hierarchy is very deep you can end up having a lot of components passing data and callbacks up and down, even if there are not using it themselves.&lt;/p&gt;
&lt;p&gt;I really like seeing small and simple components where you instantly understand what data is needed, and which actions are being triggered from it.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleComponent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;Input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; selectedDate&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;Output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; onJump &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventEmitter&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Date&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;jumpBack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onJumpto&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, the state has to be managed &lt;em&gt;somewhere&lt;/em&gt;. At least one component needs to take on that responsibility. But if most components do not need to care about state, it becomes a lot easier to reason about them, and to, dare I say, &lt;strong&gt;reuse&lt;/strong&gt; them.&lt;/p&gt;
&lt;h2&gt;ViewChild&lt;/h2&gt;
&lt;p&gt;A &lt;a href=&quot;https://angular.io/api/core/ViewChild&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ViewChild&lt;/a&gt; gives a reference to a child component to a parent component, which allows it to break every rule in unidirectional flow and call methods directly. It is extremely easy to misue it to build a web of deeply connected components that you will never be able to refactor. You can do something like this&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Bad idea&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Evil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;ViewChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;PoorChildrenComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token literal-property property&quot;&gt;sayGoodbyeToEncapsulation&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PoorChildrenComponent&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 

  &lt;span class=&quot;token function&quot;&gt;ngOnInit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sayGoodbyeToEncapsulation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;changeStuffExternally&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I am sure there is a reason for this feature, and a proper way to use it, but I have seen it mostly to tightly couple components together. Until I see a compelling reason to use this feature that does not lead to broken designs, I do not see a place for this feature outside of component tests.&lt;/p&gt;
&lt;h2&gt;Nested Forms&lt;/h2&gt;
&lt;p&gt;Another way to create a somewhat hidden connection between components are &lt;a href=&quot;https://angular.io/guide/reactive-forms&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;nested forms&lt;/a&gt;. The idea for nesting forms as far as I understand it is to combine multiple forms across different components into one form that can be validated and submitted as a unit. That sure sounds good. However, without discipline you can do things like change the values of the form from very far away.&lt;/p&gt;
&lt;p&gt;In fact, using this pattern without really thinking about how the state is updated led to some lost updates, which ended up being solved by plastering the code with &lt;code class=&quot;language-text&quot;&gt;detectChanges&lt;/code&gt;. Debugging that problem was no fun at all.&lt;/p&gt;
&lt;h2&gt;Data Services&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://angular.io/guide/component-interaction#parent-and-children-communicate-via-a-service&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Communication through data services&lt;/a&gt; seems to be a pretty accepted practice in the &lt;em&gt;Angular&lt;/em&gt; community. The gist of it is to define a service that belongs to a component up in the hierarchy, which is made available to the children without creating new instances. The service provides a number of methods to alter the state in a well defined way. Updates are fetched through &lt;a href=&quot;https://angular.io/guide/observables&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;observables&lt;/a&gt;. This has a bunch of advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The logic to alter state is gathered in one place, outside of any component.&lt;/li&gt;
&lt;li&gt;The state can be only modified through this API, which makes it easier to control and understand changes.&lt;/li&gt;
&lt;li&gt;Anybody which is interested in getting updates regarding a certain subject can just subscribe to an observable. This decouples the actions from the reactions.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A simple service could look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;@&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TimeStore&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; timeslotSubject &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BehaviorSubject&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Date&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  timeslot$ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timeslotSubject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asObservable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;selectTimeslot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token literal-property property&quot;&gt;timeslot&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timeslotSubject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeslot&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the most satisfying way of dealing with state I have found in &lt;em&gt;Angular&lt;/em&gt; thus far. It allows you to decouple things pretty nicely, and it scales quite well if the number of components that are interested in certain updates increases. It is not &lt;a href=&quot;https://blog.angular-university.io/how-to-build-angular2-apps-using-rxjs-observable-data-services-pitfalls-to-avoid/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;without caveats&lt;/a&gt;, though. It tends to require a lot of boilerplate as well. But then again, &lt;em&gt;Angular&lt;/em&gt; seems to require a lot of boilerplate code in general.&lt;/p&gt;
&lt;p&gt;Another important thing to remember is that you really have to avoid creating services without a good API, or even worse, with just some public fields. Otherwise you just created a semi-global mutable shared state. At that point, we might as well just define things in the global namespace (avoid that).&lt;/p&gt;
&lt;h2&gt;ngrx store&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ngrx/platform/blob/master/docs/store/README.md&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ngrx store&lt;/a&gt; is the &lt;em&gt;Angular&lt;/em&gt; equivalent to &lt;em&gt;redux&lt;/em&gt;. Unlike the &lt;em&gt;React&lt;/em&gt; community, it does not seem to be as an accepted as a state management solution, at least according to other developers I have talked with. I have not managed to use it for any real code thus far, although it decidedly looks like &lt;em&gt;redux&lt;/em&gt;, maybe a bit more verbose. It has the same problem as &lt;em&gt;redux&lt;/em&gt;, though: It is not easy to grasp as first. Introducing it to an inexperienced team can lead to a lot of blank looks.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;My conclusion is that I do not have a conclusion. How do you deal with state in &lt;em&gt;Angular&lt;/em&gt;? I do not feel a lot wiser now that some months ago. I have seen a lot of things I do not want to do, but it is not like I can offer a solid overarching strategy. My &lt;strong&gt;TL;DR&lt;/strong&gt;  would be use &lt;em&gt;Data Services&lt;/em&gt;, and hope for the best.&lt;/p&gt;
&lt;p&gt;These are my main points with &lt;em&gt;Angular&lt;/em&gt; for now. I think I have other small points that I might compile into another entry, maybe.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Angular from the perspective of a React fan - Part 2]]></title><description><![CDATA[Second part of my series on Angular, coming from a React background. This article focus on testing]]></description><link>https://hceris.com/angular-from-react-part2/</link><guid isPermaLink="false">https://hceris.com/angular-from-react-part2/</guid><category><![CDATA[JavaScript]]></category><category><![CDATA[React]]></category><category><![CDATA[Angular]]></category><category><![CDATA[TypeScript]]></category><category><![CDATA[angular-cli]]></category><pubDate>Sun, 29 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Angular Series&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part1/&quot;&gt;Part 1 - Bootstrapping and TypeScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part2/&quot;&gt;&lt;strong&gt;Part 2 - Testing&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part3/&quot;&gt;Part 3 - State Management&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;The first part of the series was about the first steps when setting up &lt;em&gt;Angular&lt;/em&gt;. In this post I want to talk about testing. This has been the part that has disappointed me the most thus far. Compared to something like &lt;a href=&quot;https://facebook.github.io/jest/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jest&lt;/a&gt;, it does not seem to be that straightforward to set up your testing. Writing new tests for &lt;em&gt;Angular&lt;/em&gt; reminds me of an old project where we used &lt;a href=&quot;http://qunitjs.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;QUnit&lt;/a&gt;, where writing JS Tests was something that everybody actively tried to avoid.&lt;/p&gt;
&lt;h2&gt;The importance of testing&lt;/h2&gt;
&lt;p&gt;I have been trying to focus much more on &lt;a href=&quot;https://en.wikipedia.org/wiki/Test-driven_development&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TDD&lt;/a&gt; lately. This is a good practice to follow in general. When you are working with an unfamiliar technology putting extra focus on testing can give you a lot more confidence to change things.&lt;/p&gt;
&lt;p&gt;If you want to do any decent &lt;a href=&quot;https://en.wikipedia.org/wiki/CI/CD&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CI/CD&lt;/a&gt;, there is no other way than having a good suite of tests that are easy to maintain and expand, which run reliably fast. The framework plays a big role in ensuring that, or at least it should get out of the way so that you can build what you need on top of it.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Speed&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://xkcd.com/303/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Fast tests&lt;/a&gt; are not a luxury, but a crucial requirement
in order to have a quick feedback loop. In turn, that enables you to move
quickly with small changes, always being in a state that works. Here is the
point where &lt;em&gt;Angular&lt;/em&gt; drops the ball the most. This prompt has become a big part
of my life lately:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; t
01 05 &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; 00:39:58.283:INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;karma&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Karma v2.0.0 server started at http://0.0.0.0:9876/
01 05 &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; 00:39:58.285:INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;launcher&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Launching browser ChromeHeadless with unlimited concurrency
01 05 &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; 00:39:58.372:INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;launcher&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Starting browser ChromeHeadless
01 05 &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; 00:40:29.587:INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;HeadlessChrome &lt;span class=&quot;token number&quot;&gt;67.0&lt;/span&gt;.3391 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Mac OS X &lt;span class=&quot;token number&quot;&gt;10.13&lt;/span&gt;.4&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Connected on socket jC8ho-ctNv4E4irCAAAA with &lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;26948242&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For reasons that I do not quite understand, even running simple unit tests requires launching an instance of &lt;em&gt;Headless Chrome&lt;/em&gt;. Coming from &lt;em&gt;Jest&lt;/em&gt;, having to wait two minutes to run a single test drives me crazy. In theory there is a watch mode, but I was told that, at least on our project, it was not reliable at picking up changes.&lt;/p&gt;
&lt;p&gt;And speaking of running single tests, the only way I have found to run single tests is to use &lt;code class=&quot;language-text&quot;&gt;fit&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;fdescribe&lt;/code&gt; blocks, which is quite inconvenient. &lt;a href=&quot;https://stackoverflow.com/a/43669082/3785&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;It seems&lt;/a&gt; that there is no easy way of achieving this, so I might have to give the watch mode another try. For now we had to configure &lt;a href=&quot;https://palantir.github.io/tslint/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tslint&lt;/a&gt; so that it fails when you accidentally commit a test using &lt;code class=&quot;language-text&quot;&gt;fit&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;fdescribe&lt;/code&gt;. Otherwise you might disable most of your test suite by mistake.&lt;/p&gt;
&lt;p&gt;In any case, this is a pretty big drawback. Having to wait for your simple test over and over totally takes me out of the flow, and is very tempting to take shortcuts and build a lot of changes at once, instead of testing them separately. I really hope that this is just me using the tool incorrectly, and that enlightment will come when I least expect it. My faith has not been rewarded thus far.&lt;/p&gt;
&lt;h2&gt;Unit Tests&lt;/h2&gt;
&lt;p&gt;There are two main types of unit tests that I have been writing: Tests for services and components. Services are fairly straightforward, as they tend to be pure functions that can be easily tested. Remote calls can be mocked fairly easily with &lt;a href=&quot;https://jasmine.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jasmine&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Components need their own section.&lt;/p&gt;
&lt;h3&gt;Testing components&lt;/h3&gt;
&lt;p&gt;My first instinct when starting to work on an &lt;code class=&quot;language-text&quot;&gt;Angular&lt;/code&gt; project was to break the bigger components apart into multiple small &lt;a href=&quot;https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;presentational components&lt;/a&gt;. However, writing some simple unit tests for them has proven to be quite challenging.&lt;/p&gt;
&lt;p&gt;When testing small simple components that don’t manage any state, I often find it enough to either do a sanity check (the component can be rendered without an error), or a simple snapshot test to have a glance at the html. It could look like this in &lt;em&gt;React&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; shallow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;enzyme&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Techs &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./Techs&apos;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;components&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Techs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;renders correctly&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shallow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Techs &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;component&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I wanted to do a similar thing in &lt;em&gt;Angular&lt;/em&gt;, and I have had a lot of trouble to
achieve the same result without writing a lot of code. Thankfully, a colleague of mine &lt;a href=&quot;https://medium.com/@AikoPath/testing-angular-components-with-input-3bd6c07cfaf6&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;already wrote about this&lt;/a&gt;. As far as I know, this is the smallest sanity check test that you can get for an &lt;em&gt;Angular&lt;/em&gt; component:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Component&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@angular/core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;ComponentFixture&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@angular/core/testing&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MyComponent&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./my-component.component&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MyComponent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;host-component&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;
      &amp;lt;my-component [count]=&quot;count&quot;&gt;&amp;lt;/my-component&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestHostComponent&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;testHostFixture&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ComponentFixture&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TestHostComponent&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;configureTestingModule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;declarations&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;MyComponent&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TestHostComponent&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;compileComponents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    testHostFixture &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TestBed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TestHostComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    testHostFixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detectChanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;should create&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;testHostFixture&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;componentInstance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBeTruthy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That is a lot of cruft just to render a simple component! You need to create a mock component to wrap the one that you want to test, and do a bunch of initializations with &lt;code class=&quot;language-text&quot;&gt;TestBed&lt;/code&gt;. Also, this seems to get more and more complex the more your component grows. Compared to &lt;a href=&quot;https://airbnb.io/enzyme/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Enzyme&lt;/a&gt; this feels quite heavyweight. Again, you can actually test everything you want. But the more friction you add the bigger the chance that shortcuts will be taken.&lt;/p&gt;
&lt;p&gt;Another point of confusion to me is when to use &lt;code class=&quot;language-text&quot;&gt;detectChanges&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;whenStable&lt;/code&gt; in tests. I have seen tests that use them in different combinations. They tend to break easily if you don’t use the right order as well.&lt;/p&gt;
&lt;h2&gt;End to end tests&lt;/h2&gt;
&lt;p&gt;Given that you are already using a browser for unit tests, the conceptional jump to full end to end tests is smaller than in other frameworks. &lt;em&gt;Angular&lt;/em&gt; uses &lt;a href=&quot;https://www.protractortest.org/#/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Protractor&lt;/a&gt;, which sits on top of &lt;a href=&quot;https://www.seleniumhq.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Selenium&lt;/a&gt;. In completely expected news, they suffer from the same flakyness that every other &lt;em&gt;e2e&lt;/em&gt; framework has. Making sure that you test at the right level can save you a lot of pain. Don’t write an &lt;em&gt;e2e&lt;/em&gt; test when a unit test will suffice!&lt;/p&gt;
&lt;h2&gt;The right level of testing&lt;/h2&gt;
&lt;p&gt;What more is there to say about this? Just read &lt;a href=&quot;https://martinfowler.com/bliki/TestPyramid.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the testing pyramid&lt;/a&gt;. This reminds me about discussions I had in the past about the need of having automated tests. Luckily that war seems to be over. Writing tests at different levels of integration instead of just doing super high level tests has now taken its place.&lt;/p&gt;
&lt;h2&gt;Next&lt;/h2&gt;
&lt;p&gt;Testing has been pretty rough thus far. Working on an app that is poorly architected does not help, but it is still more painful that you would expect nonetheless. Another area that was very important to me, coming from &lt;em&gt;React&lt;/em&gt;, was state management. I will talk about that in the next entry.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Playing with CSS Grid]]></title><description><![CDATA[CSS Grid is the way to do two dimensional layouts that was promised to us long ago. Let's show some examples of its magic]]></description><link>https://hceris.com/playing-with-css-grid/</link><guid isPermaLink="false">https://hceris.com/playing-with-css-grid/</guid><category><![CDATA[CSS]]></category><category><![CDATA[CSS Grid]]></category><pubDate>Sat, 28 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;figure class=&quot;figure figure--left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; &quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 149.468085106383%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABQACAf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAT8o4DpeN4A6LQsf/8QAHRAAAQQCAwAAAAAAAAAAAAAAAAECAxIRIRATIv/aAAgBAQABBQJIyh1itwVw+o9dSeXJPqylncf/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAdEAACAQQDAAAAAAAAAAAAAAAAARARITFBIlGB/9oACAEBAAY/ApvPLsq1o16zJlx//8QAHRABAAMAAgMBAAAAAAAAAAAAAQARITFBEFFxkf/aAAgBAQABPyHQsgX7F3EpqUEsquomYWhi/wBnEAHWXn1yBqWpi3LfXx//2gAMAwEAAgADAAAAEBMAMP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQADAAIDAQAAAAAAAAAAAAEAESExQVGRwdH/2gAIAQEAAT8QEJdHk2Bo9vkBAC00tq2x8Svw08Dklrr1OjkwtV+IbL2s4bd+oQRNLYLXcoaBaXyy80CnTJc//9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Pre-Twitter Grid&quot; title=&quot;&quot; src=&quot;/static/89342629b7da9773def6e3847e2c40e9/acb04/grid.jpg&quot; srcset=&quot;/static/89342629b7da9773def6e3847e2c40e9/bc01b/grid.jpg 188w,
/static/89342629b7da9773def6e3847e2c40e9/bf173/grid.jpg 375w,
/static/89342629b7da9773def6e3847e2c40e9/acb04/grid.jpg 750w,
/static/89342629b7da9773def6e3847e2c40e9/870a8/grid.jpg 803w&quot; sizes=&quot;(max-width: 750px) 100vw, 750px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
    &lt;/span&gt;
  &lt;figcaption class=&quot;figure__caption&quot;&gt;
     &lt;a href=&quot;https://www.flickr.com/photos/jrladia/7151535423&quot;&gt;Power Grid | Winnipeg&lt;/a&gt;
    &lt;small class=&quot;figure__attribution&quot;&gt;
      &lt;span class=&quot;figure__attribution-link&quot;&gt;
        by Justin Ladia / &lt;a href=&quot;https://creativecommons.org/licenses/by/2.0/&quot;&gt;CC BY&lt;/a&gt;
      &lt;/span&gt;
    &lt;/small&gt;
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;I heard about the &lt;em&gt;CSS Grid&lt;/em&gt; layout for the first time at the &lt;a href=&quot;https://2016.fullstackfest.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Full Stack Fest 2016&lt;/a&gt;, in a talk from &lt;a href=&quot;http://www.jenkramer.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jen Kramer&lt;/a&gt;. I remember thinking at the time that it was a cool idea. However, it seemed that the support was just not there and thus we had to remain with classical grids.&lt;/p&gt;
&lt;p&gt;In the meantime, grids have been slowly moving from floats to &lt;em&gt;flexboxes&lt;/em&gt;, like &lt;a href=&quot;https://getbootstrap.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Bootstrap&lt;/a&gt;. So that’s progress, I guess. I am always surprised to find a self written grid implementation whenever I join a new project. That has happened to me a bunch of times already. I guess people just get attached to their grids.&lt;/p&gt;
&lt;p&gt;Anyways, it seems that the support has getting lately to a point where it is becoming viable to build layouts with them. It is even featured on &lt;a href=&quot;https://www.thoughtworks.com/radar/languages-and-frameworks/css-grid-layout&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ThoughtWorks’s radar&lt;/a&gt;. According to &lt;a href=&quot;https://caniuse.com/#feat=css-grid&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;caniuse&lt;/a&gt;, if you support &lt;em&gt;Edge&lt;/em&gt; and upwards you are actually good to go. &lt;em&gt;IE11&lt;/em&gt; only has partial support with prefixes, which might be an issue, though.&lt;/p&gt;
&lt;h2&gt;Learning the grid&lt;/h2&gt;
&lt;p&gt;In order to get a better feeling I had a look at some very good guides:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://css-tricks.com/snippets/css/complete-guide-grid/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://css-tricks.com/snippets/css/complete-guide-grid/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/updates/2017/01/css-grid&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://developers.google.com/web/updates/2017/01/css-grid&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It feels a bit like when I learnt about &lt;em&gt;flexboxes&lt;/em&gt; for the first time. There are a lot of options and complexity, but I get the impression that once you get used to it you will use it everywhere. So maybe we will finally get rid of all the rows and columns we have building for the last years.&lt;/p&gt;
&lt;p&gt;I have built some small examples to showcase what you can do with it.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;&lt;em&gt;Example 1&lt;/em&gt;: Main Structure&lt;/h2&gt;
&lt;iframe height=&apos;445&apos; scrolling=&apos;no&apos; title=&apos;Main + Sidebar layout&apos; src=&apos;//codepen.io/sirech/embed/wmLbby/?height=365&amp;theme-id=0&amp;default-tab=result&amp;embed-version=2&apos; frameborder=&apos;no&apos; allowtransparency=&apos;true&apos; allowfullscreen=&apos;true&apos; style=&apos;width: 100%;&apos;&gt;See the Pen &lt;a href=&apos;https://codepen.io/sirech/pen/wmLbby/&apos;&gt;Main + Sidebar layout&lt;/a&gt; by Mario Fernández (&lt;a href=&apos;https://codepen.io/sirech&apos;&gt;@sirech&lt;/a&gt;) on &lt;a href=&apos;https://codepen.io&apos;&gt;CodePen&lt;/a&gt;.
&lt;/iframe&gt;
&lt;p&gt;Most websites follow a similar structure, with a main content, and then maybe a navigation bar and a sidebar. With the &lt;em&gt;CSS Grid&lt;/em&gt; you can build this in a very flexible way, and adapt it for mobile by using media queries. What I love the most about this is that you can do it with a very compact and semantic html layout. If you use something like &lt;em&gt;Bootstrap&lt;/em&gt;, the same layout as above could look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;container-fluid&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;col&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;nav&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Navigation&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;nav&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;col-12 col-sm-9&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; Main content&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;col-12 col-sm-3&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;aside&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Sidebar&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;aside&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That is a lot of nesting for such a simple thing. Also, if you want to do something about the height, you need to do it on your own. I like the pure grid solution so much better. One thing that I never liked about traditional grids is the amount of negative margins and paddings that are used to build the gutters between the columns (I just remember how hard was to have a full width image across a row). Instead, just using &lt;code class=&quot;language-text&quot;&gt;grid-gap&lt;/code&gt; makes everything much easier.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Example 2&lt;/em&gt;: Matrix&lt;/h2&gt;
&lt;p&gt;The problem with flexboxes is that they only allow you to control the flow in one direction. Sometimes you want to build components that are more complex like that, like an image gallery. Let’s say you want to build a grid and position pictures of different sizes there.&lt;/p&gt;
&lt;iframe height=&apos;445&apos; scrolling=&apos;no&apos; title=&apos;3 by 3 Grid&apos; src=&apos;//codepen.io/sirech/embed/mxZYQR/?height=438&amp;theme-id=0&amp;default-tab=result&amp;embed-version=2&apos; frameborder=&apos;no&apos; allowtransparency=&apos;true&apos; allowfullscreen=&apos;true&apos; style=&apos;width: 100%;&apos;&gt;See the Pen &lt;a href=&apos;https://codepen.io/sirech/pen/mxZYQR/&apos;&gt;3 by 3 Grid&lt;/a&gt; by Mario Fernández (&lt;a href=&apos;https://codepen.io/sirech&apos;&gt;@sirech&lt;/a&gt;) on &lt;a href=&apos;https://codepen.io&apos;&gt;CodePen&lt;/a&gt;.
&lt;/iframe&gt;
&lt;p&gt;That is a 3x3 grid with pictures of different sizes that are aligned automatically. Another cool feature that gives you a lot of flexibility is that you can have elements span multiple rows or columns.&lt;/p&gt;
&lt;h2&gt;&lt;em&gt;Example 3&lt;/em&gt;: Alignment&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;CSS Grid&lt;/em&gt; is quite flexible regarding alignments. It supports many of the properties that a flexbox supports, such as &lt;code class=&quot;language-text&quot;&gt;justify-items&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;align-items&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;justify-content&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;align-content&lt;/code&gt; for the main container, or the equivalent ones for single items.&lt;/p&gt;
&lt;iframe height=&apos;445 scrolling=&apos;no&apos; title=&apos;CSS Grid Alignment&apos; src=&apos;//codepen.io/sirech/embed/aGpvWg/?height=265&amp;theme-id=0&amp;default-tab=result&amp;embed-version=2&apos; frameborder=&apos;no&apos; allowtransparency=&apos;true&apos; allowfullscreen=&apos;true&apos; style=&apos;width: 100%;&apos;&gt;See the Pen &lt;a href=&apos;https://codepen.io/sirech/pen/aGpvWg/&apos;&gt;CSS Grid Alignment&lt;/a&gt; by Mario Fernández (&lt;a href=&apos;https://codepen.io/sirech&apos;&gt;@sirech&lt;/a&gt;) on &lt;a href=&apos;https://codepen.io&apos;&gt;CodePen&lt;/a&gt;.
&lt;/iframe&gt;
&lt;h2&gt;Gimme the Grid!&lt;/h2&gt;
&lt;p&gt;This looks awesome. &lt;em&gt;CSS Grid&lt;/em&gt; allows you to build layouts in a way that feels much more natural than what we have been doing until now, and opens up a lot of new possibilities to control the height of your elements, which is something you could not easily do before. Not only that, but it synergizes very well with flexboxes. You can build the main page structure with a grid, and then style the single elements with flexboxes, while using a very consistent set of attributes. This definitely feels like the future of building high quality pages.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Storing team passwords with gopass]]></title><link>https://hceris.com/storing-passwords-with-gopass/</link><guid isPermaLink="false">https://hceris.com/storing-passwords-with-gopass/</guid><category><![CDATA[Security]]></category><category><![CDATA[gopass]]></category><pubDate>Sun, 15 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;When you are working in a team, you tend to have a bunch of passwords that you need to share, such as the credentials that your app needs to start for example. Or maybe you need to share an account for some service.&lt;/p&gt;
&lt;p&gt;Everybody kind of knows that posting their own passwords in the open is not a great idea. Yet, team passwords are often not subjected to the same courtesy. These are some practices that I have observed recently:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Storing the passwords on Post-It notes that everybody in the whole office can easily check.&lt;/li&gt;
&lt;li&gt;Writing the the password directly on the source code.&lt;/li&gt;
&lt;li&gt;Sending the passwords around via unencrypted email.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When I see this, I can only think of this quote from Scott Adams:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The goal of every engineer is to retire without getting blamed for a major catastrophe.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Leaking sensitive information is something that I personally don’t want to attach to my resume, so I have been preaching a lot lately about storing them somewhere safe. There is a tool which I like for that, which is &lt;a href=&quot;https://github.com/justwatchcom/gopass&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;gopass&lt;/a&gt;. I want to talk about setting it up and using it.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h3&gt;What are you even talking about?&lt;/h3&gt;
&lt;p&gt;Quoting the website of the project, &lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; is a rewrite of the pass password manager in Go. In other words, it is a password manager that can be easily used by multiple people. It is very command line friendly, which allows you to include it in scripts. Very easy to install as well with &lt;a href=&quot;https://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;brew&lt;/a&gt;. We will be installing &lt;a href=&quot;https://www.gnupg.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;GPG&lt;/a&gt; as well, since that is what actually provides the security:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; gopass gpg2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;GPG keys are still a PITA&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; itself is quite easy to use, but the encryption is done with &lt;em&gt;GPG&lt;/em&gt;. Everybody who has dealt with that knows that it is everything but user friendly. One shortcut is to use &lt;a href=&quot;https://keybase.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Keybase&lt;/a&gt;. This is a tool that makes creating keys significantly easier, as explained &lt;a href=&quot;https://github.com/pstadler/keybase-gpg-github&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is a rough summary of the steps you need to follow in order to get your &lt;em&gt;GPG&lt;/em&gt; up and running with &lt;em&gt;Keybase&lt;/em&gt; for OS X:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Install &lt;em&gt;Keybase&lt;/em&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;brew cask install keybase&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Open the app and create an account&lt;/li&gt;
&lt;li&gt;Create a key through the &lt;em&gt;CLI&lt;/em&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;keybase login
keybase pgp gen&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You will be asked if you want to push the secret key to keybase.io. That is more convenient, but you have to be aware that this puts your key in somebody’s else server.&lt;/p&gt;
&lt;p&gt;Also it is a good idea to set a passphrase when the key is exported to the GnuPG keychain.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The key you just created is not trusted by default. You do this with &lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; itself:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gpg --edit-key &lt;span class=&quot;token variable&quot;&gt;${YOUR_EMAIL}&lt;/span&gt;
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; trust &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ultimate level&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; save&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In order for &lt;em&gt;GPG&lt;/em&gt; to work properly, you need to run this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GPG_TTY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;adding it to your &lt;code class=&quot;language-text&quot;&gt;~/.bashrc&lt;/code&gt; will ensure that you don’t have to do it manually every time.&lt;/p&gt;
&lt;h2&gt;Initializing a new password store&lt;/h2&gt;
&lt;p&gt;The sharing part happens through a &lt;code class=&quot;language-text&quot;&gt;git&lt;/code&gt; repository. Every developer syncs with it in order to access the secrets. The first step is to initialize &lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; itself:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass init&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It will ask for a key, which we just created. It should for the passphrase that you set up for your &lt;em&gt;GPG&lt;/em&gt; key. After that, you can set up the store for the team:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass setup &lt;span class=&quot;token parameter variable&quot;&gt;--remote&lt;/span&gt; ssh://git@bitbucket.internal.instance.org/your-team/password-store &lt;span class=&quot;token parameter variable&quot;&gt;--alias&lt;/span&gt; team-store
gopass &lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Adding a new sub-store&lt;/h3&gt;
&lt;p&gt;It’s a good idea to create multiple sub-stores, so that you can separate secrets and put them in different repositories. In that case, you need to initialize and set up a remote for the new store. Assuming there is an existing remote repository, you’ll do this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass init &lt;span class=&quot;token parameter variable&quot;&gt;--path&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--store&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$STORE&lt;/span&gt;
gopass &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; remote &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--store&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$STORE&lt;/span&gt; origin &lt;span class=&quot;token variable&quot;&gt;$REPO_URL&lt;/span&gt;
gopass &lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Adding/Removing people&lt;/h2&gt;
&lt;p&gt;Once you have the whole thing set up, you can add your fellow developers to the repository. For every developer, you need to import her &lt;em&gt;GPG&lt;/em&gt; key and trust it, otherwise will fail when trying to add new recipients&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; https://keybase.io/&lt;span class=&quot;token variable&quot;&gt;${keybase_user}&lt;/span&gt;/pgp_keys.asc &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; gpg &lt;span class=&quot;token parameter variable&quot;&gt;--import&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Trust&lt;/span&gt;
gpg --edit-key &lt;span class=&quot;token variable&quot;&gt;${EMAIL_OF_THE_DEV}&lt;/span&gt;
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; lsign
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; trust &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;level &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
gpg&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; save&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After that adding somebody to the repository is a piece of cake.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass recipients &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--store&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;team-store &lt;span class=&quot;token variable&quot;&gt;${KEYID}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;your fellow developers don’t need to create a new repository. Instead, once they key has been added to the recipients list, they can just clone it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass clone ssh://git@bitbucket.internal.instance.org/your-team/password-store team-store&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that if you don’t add them to the recipients list first, cloning the repo will result in an error.&lt;/p&gt;
&lt;h2&gt;Using passwords from the command line&lt;/h2&gt;
&lt;p&gt;You know the best part about this? Any shell script can be integrated with this quite easily. I have a script at work that runs a test, and it prompts you for two keys every time it runs. I did this like ten times, and then I got sick of it and rewrote the script to read them from &lt;em&gt;gopass&lt;/em&gt; directly.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gopass show team-store/somewebsite/password&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Is that quality of life or what? Notice that if you are running the script on a &lt;code class=&quot;language-text&quot;&gt;CI&lt;/code&gt; pipeline, you can inject the variables beforehand, and the script will work both locally and there, without having to install &lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; anywhere else and without changing the script.&lt;/p&gt;
&lt;h2&gt;Troubleshooting&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gpg&lt;/code&gt; tends to give arcane error messages. I built a &lt;a href=&quot;https://github.com/sirech/gopass-verify&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;verification script&lt;/a&gt; that helps debugging the most common issues. You can run it with:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git clone https://github.com/sirech/gopass-verify.git &amp;amp;&amp;amp; cd gopass-verify &amp;amp;&amp;amp; ./go verify&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Otherwise you can set the debugging flag.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export GOPASS_DEBUG=true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Running any &lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; command afterwards will produce a lot more output that should send you in the right direction.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;In summary, there is no reason to have these passwords laying around when they can be safely stored in something like &lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt;. You know who has access, and can remove the keys when people leave the team. This of course does not fix the need to rotate the keys if somebody had access to them and now shouldn’t.&lt;/p&gt;
&lt;h2&gt;Alternatives&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gopass&lt;/code&gt; is only one tool among many to deal with passwords. The point is not to use a concrete tool, but to become aware of the huge risk that you can incur by leaving passwords laying around. Here are some alternatives that can work as well:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.keepassx.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;KeePassX&lt;/a&gt;: Free an open source. The drawback is that there is only one master password for everybody.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://1password.com/teams/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;1Password for teams&lt;/a&gt;: I haven’t used personally but it was used by some colleagues. It is not free, and the passwords end up in the cloud.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/share-secrets-safely/cli&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Sheesy&lt;/a&gt;: Written by a work colleague.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vaultproject.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Vault by HashiCorp&lt;/a&gt;: Introduces an online dependency and it is quite involved to set up and operate. &lt;code class=&quot;language-text&quot;&gt;Vault&lt;/code&gt; works better for providing secrets for applications.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Revisions&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;08/2019: Added &lt;em&gt;Troubleshooting&lt;/em&gt; section.&lt;/li&gt;
&lt;li&gt;01/2021: Added &lt;em&gt;Addind a new sub-store&lt;/em&gt; section.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Angular from the perspective of a React fan - Part 1]]></title><description><![CDATA[First part of my series on Angular, coming from a React background. This article is about bootstrapping and TypeScript]]></description><link>https://hceris.com/angular-from-react-part1/</link><guid isPermaLink="false">https://hceris.com/angular-from-react-part1/</guid><category><![CDATA[JavaScript]]></category><category><![CDATA[React]]></category><category><![CDATA[Angular]]></category><category><![CDATA[TypeScript]]></category><category><![CDATA[angular-cli]]></category><pubDate>Sun, 25 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;div class=&quot;guide&quot;&gt;
&lt;h3&gt;Angular Series&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part1/&quot;&gt;&lt;strong&gt;Part 1 - Bootstrapping and TypeScript&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part2/&quot;&gt;Part 2 - Testing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;../angular-from-react-part3/&quot;&gt;Part 3 - State Management&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;I have using &lt;a href=&quot;https://reactjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React&lt;/a&gt; in personal and work projects for about two years already. I like it so much that I wanted to change my middle name to &lt;em&gt;React&lt;/em&gt;, but then I realized that I do not have a middle name.&lt;/p&gt;
&lt;p&gt;Anyways, I recently started on a new project, and they built the frontend using … &lt;a href=&quot;https://angular.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Angular&lt;/a&gt;. Rewriting it from scratch just because the new guy really likes something else is frowned upon by people who like delivering software to customers and stuff like that, so I found myself with no other option than finally digging into it.&lt;/p&gt;
&lt;p&gt;I am grossly unqualified to give opinions about &lt;em&gt;Angular&lt;/em&gt;, but that won’t stop me from doing it anyways. I want to write about my impressions thus far, comparing it with what I am used to doing in the &lt;em&gt;React&lt;/em&gt; world. Note that I started directly with &lt;em&gt;Angular 4&lt;/em&gt;, and I have zero plans to check &lt;em&gt;AngularJS&lt;/em&gt; anytime soon, so I might be missing a lot of context about why things are as they are in &lt;code class=&quot;language-text&quot;&gt;ng&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I will start with the basics, bootstrapping, defaults and so on.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Bootstrapping&lt;/h2&gt;
&lt;p&gt;Bootstrapping is kind of a dirty word in the &lt;em&gt;React&lt;/em&gt; world. Setting up a new project is, frankly, a pain in the ass. I personally decided at some point that keeping up with &lt;a href=&quot;https://webpack.js.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Webpack&lt;/a&gt; is a full time job, so I have outsourced my configuration to &lt;a href=&quot;https://github.com/facebook/create-react-app&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Create React App&lt;/a&gt;. Even then, I am still waiting for things like &lt;em&gt;CSS Modules&lt;/em&gt; out of the box. Cannot say that this is perfect.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Angular&lt;/em&gt;, on the other hand, follows more of a &lt;strong&gt;batteries included&lt;/strong&gt; approach. Once you have the package, you get a very comprehensive initial setup just by running&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ng new awesome-app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which installs a bunch of stuff. Let’s have a look at what the &lt;code class=&quot;language-text&quot;&gt;awesome-app&lt;/code&gt; directory&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;.3K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 .angular-cli.json
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;245&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 .editorconfig
drwxr-xr-x  &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;384&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:39 .git
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;544&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 .gitignore
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;.1K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 README.md
drwxr-xr-x   &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;160&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 e2e
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;923&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 karma.conf.js
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;894&lt;/span&gt; mfernandez  28K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:37 node_modules
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez 415K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:37 package-lock.json
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;.3K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 package.json
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;722&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 protractor.conf.js
drwxr-xr-x  &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;448&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 src
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez  &lt;span class=&quot;token number&quot;&gt;363&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 tsconfig.json
-rw-r--r--   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; mfernandez &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;.0K Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:36 tslint.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A lot of goodies straight from the beginning! I love free stuff. You have &lt;a href=&quot;https://palantir.github.io/tslint/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tslint&lt;/a&gt; configured, &lt;a href=&quot;https://karma-runner.github.io/2.0/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;karma&lt;/a&gt; for the unit tests, and even end-to-end tests with &lt;a href=&quot;https://www.protractortest.org/#/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;protractor&lt;/a&gt;. Pretty impressive. I wish it was as easy to get started in &lt;em&gt;React&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It is &lt;em&gt;very&lt;/em&gt; opinionated, though. It seems there is a strong consensus in the community regarding the tools to use. &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; is favored over &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;TypeScript&lt;/code&gt; over &lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt;, and so on.&lt;/p&gt;
&lt;h2&gt;TypeScript&lt;/h2&gt;
&lt;p&gt;I remember back in my old company there were some internal discussions regarding typing in JS. One camp favored &lt;a href=&quot;http://www.typescriptlang.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;TypeScript&lt;/a&gt;, the other &lt;em&gt;JavaScript&lt;/em&gt; and &lt;a href=&quot;https://flow.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Flow&lt;/a&gt;. I ended up going with &lt;em&gt;flow&lt;/em&gt;, but I always had the feeling that it was not catching a lot of errors, and that I was spending a lot of time making it sort of work, like with &lt;a href=&quot;https://github.com/flowtype/flow-typed&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;flow-typed&lt;/a&gt;. I haven’t yet fully understood the whole type system that &lt;em&gt;TypeScript&lt;/em&gt; provides, yet you can see that there is one important difference with flow. It is much more integrated with the core language itself, which makes it a lot more reliable in my impression.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;TypeScript&lt;/em&gt; is refreshing in a sense because things seem to work more naturally. The tooling seems to be very mature as well, from what I have seen from other people using &lt;em&gt;Visual Studio Code&lt;/em&gt; or &lt;em&gt;IntelliJ&lt;/em&gt; (not that I would know anything about that, I remain loyal to &lt;em&gt;Emacs&lt;/em&gt;). In any case, I have found it pretty enjoyable thus far to work with.&lt;/p&gt;
&lt;p&gt;In a sense, it feels like it is bringing &lt;em&gt;JavaScript&lt;/em&gt; closer to &lt;em&gt;Java&lt;/em&gt;. This might sound like treason, but it can allow you to build more resilient software. Things like &lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/interfaces.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;interfaces&lt;/a&gt; or &lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/classes.html#public-private-and-protected-modifiers&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;private modifiers for class members&lt;/a&gt; help to avoid surprises and to build more isolated components. For projects with multiple developers working on the same codebase I can see this leading to a better overall architecture.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;TypeScript&lt;/em&gt; is being driven pretty heavily by &lt;em&gt;Microsoft&lt;/em&gt;. They are actively developing features themselves, but also porting the &lt;a href=&quot;https://github.com/tc39/proposals&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;proposals&lt;/a&gt; that come into &lt;em&gt;EcmasScript&lt;/em&gt;. I was a bit confused in the beginning about that, but you only have to remember that only stage 3 proposals or above seem to be supported. I found &lt;a href=&quot;http://kangax.github.io/compat-table/es2016plus/#typescript2_8&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this&lt;/a&gt; site that allows you to check exactly which features are supported.&lt;/p&gt;
&lt;h2&gt;Linting &lt;a name=&quot;linting&quot;&gt;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I am a big fan of linting, and &lt;code class=&quot;language-text&quot;&gt;ng&lt;/code&gt; delivers by including a config for &lt;a href=&quot;https://palantir.github.io/tslint/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;tslint&lt;/a&gt; out of the box. You just run &lt;code class=&quot;language-text&quot;&gt;ng lint&lt;/code&gt; and you get instant feedback.&lt;/p&gt;
&lt;p&gt;Lately, however, I have been thinking about the role of a linter in general. After seeing how well &lt;a href=&quot;https://golang.org/cmd/gofmt/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;gofmt&lt;/a&gt; works, I am starting to think that a linter should not be concerned with the formatting of the code, just avoiding bad practices or possible bugs. In the case of &lt;em&gt;JavaScript&lt;/em&gt;, I have experimented a bit with &lt;a href=&quot;https://github.com/prettier/prettier&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;prettier&lt;/a&gt; to automatically format my code, although I have only used it thus far in personal projects. That is something I want to check in more detail in the future.&lt;/p&gt;
&lt;h2&gt;Next&lt;/h2&gt;
&lt;p&gt;First impression was good, but other things have not worked that well. The next part will be about testing.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Migrating to Gatsby]]></title><description><![CDATA[It all starts here. After using Create React App for a while, I decided to switch to Gatsby for my personal website]]></description><link>https://hceris.com/migrating-to-gatsby/</link><guid isPermaLink="false">https://hceris.com/migrating-to-gatsby/</guid><category><![CDATA[React]]></category><category><![CDATA[Gatsby]]></category><pubDate>Sun, 18 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Some months ago, I decided to rewrite my website using &lt;a href=&quot;https://reactjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;React&lt;/a&gt;, to experiment with a bunch of new features of &lt;em&gt;React&lt;/em&gt; that I wanted to use at work. To spare myself the trouble of bootstrapping the whole thing, I used the awesome &lt;a href=&quot;https://github.com/facebook/create-react-app&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Create React App&lt;/a&gt; from &lt;em&gt;Facebook&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Lately I have been working with a lot of different technologies and setups, and I wanted to get into the habit of writing about it a bit more, if only for my own amusement. I have been looking for a super simple way to publish &lt;em&gt;Markdown&lt;/em&gt; files that I could host myself. After looking a bit around, it seemed to me that &lt;em&gt;CRA&lt;/em&gt; was not going to provide that unless I built a significant part of it myself.&lt;/p&gt;
&lt;p&gt;Then I stumbled across &lt;a href=&quot;https://www.gatsbyjs.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Gatsby&lt;/a&gt;. I was not keen to spend a lot of time doing plumbing and configuration, but &lt;em&gt;Gatsby&lt;/em&gt; offered a lot of useful features, and seemed to be a very convenient way to set up a simple blog while keeping &lt;em&gt;React&lt;/em&gt; pages. I went with &lt;a href=&quot;https://github.com/jaxx2104/gatsby-starter-bootstrap&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this bootrapper&lt;/a&gt;, as it came with &lt;em&gt;Bootstrap 4&lt;/em&gt;, which is what I have been using for my personal projects lately.&lt;/p&gt;
&lt;p&gt;There are basically endless possibilities to customize &lt;em&gt;Gatsby&lt;/em&gt;, and plenty of resources on the internet to get inspiration from as well. There were a few areas where I couldn’t find much help, though, so I wrote down some thoughts about how to get things like testing, dockerizing or a CI/CD pipeline.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2&gt;Testing&lt;/h2&gt;
&lt;p&gt;The initial distribution does not come with any setup infrastructure. For building static pages testing is not as important as in other cases, but I still want some simple sanity tests to make sure my components are not blowing up. &lt;a href=&quot;https://gist.github.com/m-allanson/3dd343db56951ba852fd09a7e52d6a89&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;This Gist&lt;/a&gt; helped me get in the right direction to do a minimal setup for &lt;a href=&quot;https://facebook.github.io/jest/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Jest&lt;/a&gt;, which is my goto framework for testing &lt;em&gt;React&lt;/em&gt; apps.&lt;/p&gt;
&lt;p&gt;For my components I am not really interested in snapshot tests (I feel visual inspection is enough to check the layout), so I went with &lt;a href=&quot;https://github.com/airbnb/enzyme&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Enzyme&lt;/a&gt; instead, to do a shallow render of every component. I added this &lt;code class=&quot;language-text&quot;&gt;setupTests.js&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; configure &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;enzyme&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Adapter &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;enzyme-adapter-react-15&apos;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Adapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// a global graphql is expected by gatsby&lt;/span&gt;
global&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;graphql&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All my tests are very similar, just a quick check that the component renders. An example would be:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; shallow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;enzyme&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Talks &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./index&apos;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;components&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Talks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;renders correctly&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shallow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Talks &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;component&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Dockerizing the app&lt;/h2&gt;
&lt;p&gt;Since quite some time, I tend to use &lt;a href=&quot;https://www.docker.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Docker&lt;/a&gt; to package all my applications. I love having a unified way to build artifacts that can be dealt in an unified manner, regardless of technology. Following &lt;a href=&quot;http://heiber.im/post/creating-a-solid-docker-base-image/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;the best practices&lt;/a&gt; from a colleague from work, I set out to containerize my freshly built website, which turned out to be much harder than I thought.&lt;/p&gt;
&lt;p&gt;My use case for &lt;em&gt;Docker&lt;/em&gt; in this case is a bit forced, as I am not really running anything inside the container. Instead, I am using it to compile the repo to a bunch of html, css and js files, which I extract from the container so that it can be served by &lt;a href=&quot;https://www.nginx.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;nginx&lt;/a&gt;. Nevertheless, I still want to use a good quality image for that.&lt;/p&gt;
&lt;p&gt;My problems with &lt;em&gt;Gatsby&lt;/em&gt; were mostly related to image plugins. There is &lt;code class=&quot;language-text&quot;&gt;sharp&lt;/code&gt; and some others that needed &lt;code class=&quot;language-text&quot;&gt;libpng&lt;/code&gt; among others. After much fighting and cursing, I shamefully gave up on using &lt;em&gt;alpine&lt;/em&gt; to build the code and switched instead to a &lt;em&gt;slim&lt;/em&gt; image, which bloated the size of the container quite a lot. Here is how it looks like&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docker&quot;&gt;&lt;pre class=&quot;language-docker&quot;&gt;&lt;code class=&quot;language-docker&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; node:9.8.0-slim &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; builder&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /app&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ARG&lt;/span&gt; SITE_URL=&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; . .&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apt-get update &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; apt-get install -y build-essential libpng-dev zlib1g-dev &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; yarn &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; yarn run build &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; yarn cache clean &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; find public -regextype posix-basic -regex &lt;span class=&quot;token string&quot;&gt;&apos;.*\.\(js\|css\)\(.map\)\?$&apos;&lt;/span&gt; | xargs -I@ sh -c &lt;span class=&quot;token string&quot;&gt;&quot;gzip -c @ &gt; @.gz&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; rm -Rf node_modules &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; apt-get remove -y build-essential libpng-dev zlib1g-dev &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; apt-get clean&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; alpine:3.7&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /app&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; &lt;span class=&quot;token options&quot;&gt;&lt;span class=&quot;token property&quot;&gt;--from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;builder&lt;/span&gt;&lt;/span&gt; /app/public build&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CMD&lt;/span&gt; cp -a build/* public/ &amp;amp;&amp;amp; echo &lt;span class=&quot;token string&quot;&gt;&apos;Build done&apos;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I am using a &lt;a href=&quot;https://docs.docker.com/develop/develop-images/multistage-build/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Multi Stage build for docker&lt;/a&gt;. That way, even if the building takes quite a lot of space, the resulting image is very small, and it can be published easily. I really like using this feature to get the smallest possible images.&lt;/p&gt;
&lt;h2&gt;CI/CD Pipeline&lt;/h2&gt;
&lt;p&gt;Writing a pipeline for a hobby project like this is a complete overkill, but I still wanted to get it automatically deployed after each commit while doing a bunch of quality checks before. I host it on &lt;a href=&quot;https://travis-ci.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Travis&lt;/a&gt;, which is awesome for this kind of projects.&lt;/p&gt;
&lt;p&gt;My pipeline is relatively standard, which a bunch of steps to ensure that it works, plus packaging it and deploying it after that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;stages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; lint
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; test
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; security
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker
    &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; branch = master
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; deploy
    &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; branch = master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The steps are implemented using &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; scripts. I included some security checks using &lt;a href=&quot;https://github.com/Stono/hawkeye&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Hawkeye&lt;/a&gt; because it is super easy to do and that gives me a bit of peace of mind.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;It took me some effort to understand and deploy to my server, but I am pretty pleased with the result, which is &lt;a href=&quot;https://github.com/sirech/homepage2&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;on Github&lt;/a&gt;. It is quite easy to set up, and pretty flexible to modify to your own liking. The only thing I didn’t manage to do was to leverage &lt;a href=&quot;https://reactstrap.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Reactstrap&lt;/a&gt; to get Bootstrap aware React components. As I understood it is related to &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/issues/2714&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;this issue&lt;/a&gt;, which will get hopefully fixed sometime soon.&lt;/p&gt;</content:encoded></item></channel></rss>